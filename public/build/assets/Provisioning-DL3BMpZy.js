import{r as o,n as Y,e as w,j as e,H as v,c as u,a as g,d as N,s as M,b as h,L as O}from"./app-BAXRlJ48.js";import{A as k}from"./AuthCard-DPZ_-bwF.js";import{R as S}from"./RegisterLayout-DBdMbW-p.js";import{s as _}from"./toastUtils-CgpXtHQI.js";import{P as $}from"./ProgressSteps-KHI1AfBP.js";import{p as H}from"./chunk-VFIJPDYX-CnqB3wTu.js";import"./app-Bq-q9uAS.js";import"./SafeLink-BwBKfTir.js";import"./routeUtils-B8YzhDEw.js";import"./chunk-AUA5GDXN-CgSoZYyJ.js";import"./index-_s1yLG4v.js";import"./index-D-IZDB6p.js";import"./chunk-WQVQ7P2I-D0_WLrzH.js";import"./number-CB4zbwAz.js";import"./chunk-LGMZDQT5-B8Sl4UZV.js";import"./index-1fQ0x8g_.js";import"./useBranding-COW0C88J.js";/* empty css                      */import"./MaintenanceModeBanner-DwAWmFt4.js";import"./ArrowLeftIcon-D4-_RCwU.js";import"./useProgressBar-CgE7BD74.js";import"./useLabel-B3fAPYpc.js";import"./useLabels-pxb2sUWj.js";import"./useNumberFormatter-CPGSRRsJ.js";import"./NumberFormatter-DNR9MAW-.js";const E={creating_db:{label:"Creating database",description:"Setting up your isolated workspace database...",progress:25},migrating:{label:"Configuring schema",description:"Running database migrations and preparing tables...",progress:50},seeding_roles:{label:"Setting up roles",description:"Configuring default roles for your workspace...",progress:75},completed:{label:"Finalizing",description:"Completing workspace setup...",progress:100}},P=({status:c})=>c==="active"?e.jsx("div",{className:"h-16 w-16 rounded-full bg-emerald-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"h-8 w-8 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):c==="failed"?e.jsx("div",{className:"h-16 w-16 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}):e.jsx(M,{size:"lg",color:"primary"});function fe({steps:c=[],currentStep:f,tenant:r={},baseDomain:C="platform.test"}){const[l,U]=o.useState(r.status==="active"),[V,B]=o.useState(0),[m,j]=o.useState(l?"provisioning":r.status||"pending"),[L,b]=o.useState(l?"creating_db":r.provisioning_step),[R,I]=o.useState(null),[A,z]=o.useState(null),[d,T]=o.useState(!1),{themeSettings:F}=Y(),p=F?.mode==="dark",t={heading:p?"text-white":"text-slate-900",copy:p?"text-slate-300":"text-slate-600",badge:p?"text-slate-300":"text-slate-500",surface:p?"bg-white/5 border border-white/10":"bg-white border border-slate-200 shadow-sm"},W=["creating_db","migrating","seeding_roles","completed"];o.useEffect(()=>{if(!l)return;(async()=>{for(let s=0;s<W.length;s++)b(W[s]),B(s),await new Promise(a=>setTimeout(a,600));if(U(!1),j(r.status),b(r.provisioning_step),r.status==="active")try{const a=(await w.get(route("platform.register.provisioning.status",{tenant:r.id}))).data;a.is_ready&&a.login_url&&(z(a.login_url),T(!0),setTimeout(()=>{window.location.href=a.login_url},2e3))}catch(s){console.error("Failed to fetch redirect URL:",s)}})()},[l,r.status,r.provisioning_step,r.id]);const x=E[L]||{label:"Preparing",description:"Initializing your workspace...",progress:10},y=o.useCallback(async()=>{if(!(l||m==="active"||m==="failed"||d))try{const s=(await w.get(route("platform.register.provisioning.status",{tenant:r.id}))).data;if(j(s.status),b(s.provisioning_step),s.is_ready&&s.login_url&&(z(s.login_url),T(!0),setTimeout(()=>{window.location.href=s.login_url},2e3)),s.has_failed){const a=s.error||"Provisioning failed. Please contact support.";I(a),_.error(a,{autoClose:!1,closeButton:!0})}}catch(i){console.error("Status fetch error:",i),m==="failed"&&_.error("Unable to check provisioning status. Please refresh the page.",{autoClose:5e3})}},[r.id,m,d,l]);return o.useEffect(()=>{if(l)return;y();const i=setInterval(y,2e3);return()=>clearInterval(i)},[y,l]),m==="active"?e.jsxs(S,{children:[e.jsx(v,{title:"Workspace Ready"}),e.jsxs("section",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-6 sm:py-12 space-y-6 sm:space-y-8 text-center",children:[e.jsx($,{steps:c,currentStep:f}),e.jsx(k,{children:e.jsx(u,{className:"bg-transparent border-none shadow-none",children:e.jsxs(g,{className:"space-y-4 sm:space-y-6 py-6 sm:py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(P,{status:"active"})}),e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsx(N,{color:"success",variant:"flat",size:"lg",className:"text-xs sm:text-sm",children:"Workspace Ready"}),e.jsx("h1",{className:`text-xl sm:text-3xl font-semibold ${t.heading}`,children:d?"Redirecting to complete setup...":"Almost Done!"}),e.jsxs("p",{className:`${t.copy} text-sm sm:text-base`,children:["Your workspace ",e.jsx("strong",{children:r.name})," is now live. Complete your admin account setup to get started."]})]}),e.jsxs("div",{className:`p-3 sm:p-4 rounded-lg ${t.surface}`,children:[e.jsx("p",{className:`text-xs sm:text-sm ${t.badge}`,children:"Your workspace URL"}),e.jsxs("p",{className:`font-mono text-sm sm:text-lg ${t.heading} break-all`,children:["https://",r.subdomain,".",C]})]}),d&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(M,{size:"sm"}),e.jsx("span",{className:`${t.copy} text-sm sm:text-base`,children:"Redirecting to admin setup..."})]}),A&&!d&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 sm:gap-4",children:[e.jsx(h,{as:"a",href:A,color:"primary",className:"bg-gradient-to-r from-blue-500 to-purple-600 w-full sm:w-auto",children:"Complete Admin Setup"}),e.jsx(h,{as:O,href:route("landing"),variant:"bordered",className:"w-full sm:w-auto",children:"Back to home"})]})]})})})]})]}):m==="failed"?e.jsxs(S,{children:[e.jsx(v,{title:"Provisioning Failed"}),e.jsxs("section",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-6 sm:py-12 space-y-6 sm:space-y-8 text-center",children:[e.jsx($,{steps:c,currentStep:f}),e.jsx(k,{children:e.jsx(u,{className:"bg-transparent border-none shadow-none",children:e.jsxs(g,{className:"space-y-4 sm:space-y-6 py-6 sm:py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(P,{status:"failed"})}),e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsx(N,{color:"danger",variant:"flat",size:"lg",className:"text-xs sm:text-sm",children:"Provisioning Failed"}),e.jsx("h1",{className:`text-xl sm:text-3xl font-semibold ${t.heading}`,children:"Something went wrong"}),e.jsx("p",{className:`${t.copy} text-sm sm:text-base`,children:"We encountered an issue while setting up your workspace."})]}),R&&e.jsx(u,{className:"bg-red-500/10 border border-red-500/20",children:e.jsx(g,{children:e.jsx("p",{className:"text-red-400 text-xs sm:text-sm break-words",children:R})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 sm:gap-4",children:[e.jsx(h,{color:"primary",onPress:()=>{const i=new Promise(async(s,a)=>{try{const n=await w.post(route("platform.register.provisioning.retry",{tenant:r.id}));n.status===200&&(j("provisioning"),I(null),s([n.data.message||"Retrying provisioning..."]))}catch(n){a([n.response?.data?.message||"Failed to retry. Please contact support."])}});_.promise(i,{loading:"Retrying provisioning...",success:s=>s[0],error:s=>s[0]})},className:"bg-gradient-to-r from-blue-500 to-purple-600 w-full sm:w-auto",children:"Retry Provisioning"}),e.jsx(h,{as:"a",href:"mailto:support@eos365.com",variant:"bordered",className:"w-full sm:w-auto",children:"Contact Support"})]}),e.jsx("p",{className:"mt-3 sm:mt-4 text-center text-xs sm:text-sm text-default-500 px-2",children:"All resources have been cleaned up. You can register again with the same details."})]})})})]})]}):e.jsxs(S,{children:[e.jsx(v,{title:"Setting up your workspace"}),e.jsxs("section",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-6 sm:py-12 space-y-6 sm:space-y-8 text-center",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3 px-2",children:[e.jsx("p",{className:`text-[10px] sm:text-sm uppercase tracking-[0.3em] ${t.badge}`,children:"Almost there"}),e.jsx("h1",{className:`text-2xl sm:text-4xl font-semibold ${t.heading}`,children:"Setting up your workspace"}),e.jsxs("p",{className:`${t.copy} text-sm sm:text-base break-words`,children:["We're preparing everything for ",e.jsx("strong",{children:r.name}),". This usually takes less than a minute."]})]}),e.jsx($,{steps:c,currentStep:f}),e.jsx(k,{children:e.jsx(u,{className:"bg-transparent border-none shadow-none",children:e.jsxs(g,{className:"space-y-6 sm:space-y-8 py-6 sm:py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(P,{status:"provisioning"})}),e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsx(N,{color:"primary",variant:"flat",size:"lg",className:"text-xs sm:text-sm",startContent:e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-blue-500 animate-pulse"}),children:x.label}),e.jsx("p",{className:`${t.copy} text-sm sm:text-base`,children:x.description})]}),e.jsx("div",{className:"max-w-md mx-auto w-full px-2",children:e.jsx(H,{"aria-label":"Provisioning progress",value:x.progress,color:"primary",showValueLabel:!0,className:"max-w-md",classNames:{indicator:"bg-gradient-to-r from-blue-500 to-purple-600",track:p?"bg-white/10":"bg-slate-200"}})}),e.jsx("div",{className:`grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4 text-xs sm:text-sm ${t.copy}`,children:Object.entries(E).map(([i,s])=>{const a=s.progress<x.progress,n=i===L;return e.jsx("div",{className:`p-2 sm:p-3 rounded-lg transition-colors ${n?"bg-blue-500/10 border border-blue-500/30":a?"bg-emerald-500/10 border border-emerald-500/30":`${t.surface}`}`,children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 mb-1",children:[a&&e.jsx("svg",{className:"h-3 w-3 sm:h-4 sm:w-4 text-emerald-500 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),n&&e.jsx("span",{className:"inline-block h-1.5 w-1.5 sm:h-2 sm:w-2 rounded-full bg-blue-500 animate-pulse shrink-0"}),e.jsx("span",{className:`font-medium break-words ${n?"text-blue-400":a?"text-emerald-400":""}`,children:s.label})]})},i)})}),e.jsxs("div",{className:`p-3 sm:p-4 rounded-lg ${t.surface}`,children:[e.jsx("p",{className:`text-xs sm:text-sm ${t.badge}`,children:"Your workspace URL (coming soon)"}),e.jsxs("p",{className:`font-mono text-sm sm:text-lg ${t.heading} break-all`,children:["https://",r.subdomain,".",C]})]})]})})}),e.jsx("p",{className:`text-xs sm:text-sm ${t.copy} px-2`,children:"Please don't close this page. You'll be redirected automatically when ready."})]})]})}export{fe as default};
