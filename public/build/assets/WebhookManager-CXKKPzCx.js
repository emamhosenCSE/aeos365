import{Y as ce,at as Q,r as n,a5 as de,q as ue,j as e,H as me,b as h,g as H,c as B,a as K,d as M,p as pe,e as g}from"./app-DLWZL5EI.js";import{s as x}from"./toastUtils-CQ8tPw7l.js";import{F as Y,d as he,a as xe,b as je,m as b}from"./PlusIcon-CgcHryUb.js";import{F as G}from"./CheckCircleIcon-CaJShsm_.js";import{F as fe}from"./BoltIcon-BRTqiOqL.js";import{F as ge,c as be,b as ve,a as ye}from"./TrashIcon-C6DesZfk.js";import{m as E,a as O,b as A,c as V}from"./chunk-TW2E3XVA-dNGvEz5r.js";import{i as S}from"./chunk-SQIAVXJX-C5zDfxFa.js";import{s as _e}from"./chunk-I3A4XRYQ-CbmreU5k.js";import{m as D}from"./chunk-5LXTSPS7-CJuDP5FM.js";import{s as J}from"./chunk-P7ACKWSP-C7P2-EIz.js";import{t as Ne,a as we,b as Se,c as v}from"./chunk-F3UDT23P-iuiXDnoX.js";import{t as Ce,a as y}from"./chunk-YRZGWF2W-C3idaI1g.js";import"./app-BI-xrU3s.js";import"./index-lAyyVki8.js";import"./Item-hnCJOaQ5.js";import"./SelectionManager-UhxaObWG.js";import"./keyboard-CSKkBtIV.js";import"./index-B5MKI_DQ.js";import"./index-Dz459_my.js";import"./useDialog-LKdJQ55I.js";import"./getScrollParent-B27hviGV.js";import"./useLabels-CKC_NELL.js";import"./VisuallyHidden-Dslt4DE9.js";import"./chunk-WQVQ7P2I-BXEU6rr0.js";import"./number-CB4zbwAz.js";import"./index-D3fxkw17.js";import"./useSelectableItem-Qild1lMf.js";import"./chunk-IHO36JMK-DYeauZfe.js";import"./useTreeState-CsNDLaZy.js";import"./useMenuTriggerState-CpMESG3a.js";import"./chunk-LGMZDQT5-BbUrfslF.js";import"./chunk-KQW2TNLT-BxZBj3py.js";import"./useField-CN4URFK6.js";import"./useLabel-BC4q2FsI.js";import"./chunk-ICU6NNET-BuoRM2Mj.js";import"./useToggleState-C1tJJPv7.js";import"./chunk-PMMJMDBI-DH4qNxn7.js";import"./index-BJ8QHXMy.js";import"./useHasTabbableChild-DwAon3z_.js";import"./chunk-7F3ZLNJ6-BH294qJ7.js";import"./index-CGn2JJsk.js";function Pe(_){const[j,f]=ce(_,Q.variantKeys),{as:o,children:i,className:C,...u}=j,T=o||"code",N=n.useMemo(()=>Q({...f,className:C}),[de(f),C]);return{Component:T,children:i,getCodeProps:()=>({className:N,...u})}}var X=ue((_,j)=>{const{Component:f,children:o,getCodeProps:i}=Pe({..._});return e.jsx(f,{ref:j,...i(),children:o})});X.displayName="HeroUI.Code";var L=X;const gs=({webhooks:_=[]})=>{const[j,f]=n.useState(_),[o,i]=n.useState(null),[C,u]=n.useState(!1),[T,N]=n.useState(!1),[I,R]=n.useState(!1),[Te,Re]=n.useState("list"),[z,P]=n.useState(!1),[$,Z]=n.useState([]),[m,F]=n.useState(null),[c,w]=n.useState("lg"),[r,l]=n.useState({name:"",url:"",secret:"",events:[],is_active:!0,retry_attempts:3,timeout:30}),ee=[{value:"subscription.created",label:"Subscription Created",category:"Subscription"},{value:"subscription.updated",label:"Subscription Updated",category:"Subscription"},{value:"subscription.cancelled",label:"Subscription Cancelled",category:"Subscription"},{value:"subscription.renewed",label:"Subscription Renewed",category:"Subscription"},{value:"subscription.upgraded",label:"Subscription Upgraded",category:"Subscription"},{value:"subscription.downgraded",label:"Subscription Downgraded",category:"Subscription"},{value:"payment.succeeded",label:"Payment Succeeded",category:"Payment"},{value:"payment.failed",label:"Payment Failed",category:"Payment"},{value:"quota.warning",label:"Quota Warning (80%)",category:"Quota"},{value:"quota.exceeded",label:"Quota Exceeded",category:"Quota"},{value:"tenant.created",label:"Tenant Created",category:"Tenant"},{value:"tenant.updated",label:"Tenant Updated",category:"Tenant"},{value:"tenant.suspended",label:"Tenant Suspended",category:"Tenant"},{value:"user.created",label:"User Created",category:"User"},{value:"user.updated",label:"User Updated",category:"User"},{value:"user.deleted",label:"User Deleted",category:"User"}];n.useEffect(()=>{const t=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",a=parseInt(t);a===0?w("none"):a<=4?w("sm"):a<=8?w("md"):a<=12?w("lg"):w("xl")},[]);const W=async()=>{P(!0);try{const s=await g.get(route("admin.webhooks.index"));f(s.data.data||[])}catch{x.error("Failed to load webhooks")}finally{P(!1)}},q=()=>{l({name:"",url:"",secret:k(),events:[],is_active:!0,retry_attempts:3,timeout:30}),i(null),u(!0)},se=s=>{l({name:s.name,url:s.url,secret:s.secret,events:s.events||[],is_active:s.is_active,retry_attempts:s.retry_attempts||3,timeout:s.timeout||30}),i(s),u(!0)},k=()=>"whsec_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),te=async()=>{if(!r.name||!r.url||r.events.length===0){x.error("Please fill in all required fields and select at least one event");return}const s=new Promise(async(t,a)=>{try{const d=o?route("admin.webhooks.update",o.id):route("admin.webhooks.store"),U=await g[o?"put":"post"](d,r);(U.status===200||U.status===201)&&(await W(),u(!1),t([U.data.message||"Webhook saved successfully"]))}catch(d){a(d.response?.data?.errors||["Failed to save webhook"])}});x.promise(s,{loading:o?"Updating webhook...":"Creating webhook...",success:t=>t.join(", "),error:t=>Array.isArray(t)?t.join(", "):t})},ae=async s=>{const t=new Promise(async(a,d)=>{try{(await g.delete(route("admin.webhooks.destroy",s))).status===200&&(await W(),a(["Webhook deleted successfully"]))}catch{d(["Failed to delete webhook"])}});x.promise(t,{loading:"Deleting webhook...",success:a=>a.join(", "),error:a=>a.join(", ")})},re=async s=>{i(s),F(null),N(!0);const t=new Promise(async(a,d)=>{try{const p=await g.post(route("admin.webhooks.test",s.id));F(p.data),a(["Test webhook sent successfully"])}catch(p){F({success:!1,error:p.response?.data?.message||"Test failed"}),d(["Failed to send test webhook"])}});x.promise(t,{loading:"Sending test webhook...",success:a=>a.join(", "),error:a=>a.join(", ")})},ne=async s=>{i(s),R(!0),P(!0);try{const t=await g.get(route("admin.webhooks.logs",s.id));Z(t.data.data||[])}catch{x.error("Failed to load webhook logs")}finally{P(!1)}},le=async s=>{const t=new Promise(async(a,d)=>{try{const p=await g.put(route("admin.webhooks.toggle",s.id),{is_active:!s.is_active});await W(),a(["Webhook status updated"])}catch{d(["Failed to update webhook status"])}});x.promise(t,{loading:"Updating status...",success:a=>a.join(", "),error:a=>a.join(", ")})},oe=async s=>{l({name:s.name+" (Copy)",url:s.url,secret:k(),events:s.events||[],is_active:!1,retry_attempts:s.retry_attempts||3,timeout:s.timeout||30}),i(null),u(!0)},ie=()=>z?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((s,t)=>e.jsx(J,{className:"h-24 rounded-lg"},t))}):j.length===0?e.jsx(B,{children:e.jsxs(K,{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 mx-auto text-default-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Webhooks Yet"}),e.jsx("p",{className:"text-default-500 mb-4",children:"Create your first webhook to start receiving event notifications"}),e.jsx(h,{color:"primary",startContent:e.jsx(Y,{className:"w-4 h-4"}),onPress:q,children:"Create Webhook"})]})}):e.jsxs(Ne,{"aria-label":"Webhooks table",classNames:{wrapper:"shadow-none border border-divider rounded-lg",th:"bg-default-100 text-default-600 font-semibold"},children:[e.jsxs(Ce,{children:[e.jsx(y,{children:"NAME"}),e.jsx(y,{children:"URL"}),e.jsx(y,{children:"EVENTS"}),e.jsx(y,{children:"STATUS"}),e.jsx(y,{children:"SUCCESS RATE"}),e.jsx(y,{children:"ACTIONS"})]}),e.jsx(we,{children:j.map(s=>e.jsxs(Se,{children:[e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-xs text-default-500",children:["Last triggered: ",s.last_triggered_at||"Never"]})]})}),e.jsx(v,{children:e.jsx(L,{size:"sm",className:"max-w-xs truncate",children:s.url})}),e.jsx(v,{children:e.jsxs(M,{size:"sm",variant:"flat",children:[s.events?.length||0," events"]})}),e.jsx(v,{children:e.jsx(M,{size:"sm",color:s.is_active?"success":"default",variant:"flat",startContent:s.is_active?e.jsx(G,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"}),children:s.is_active?"Active":"Inactive"})}),e.jsx(v,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:s.success_rate>=95?"text-success":s.success_rate>=80?"text-warning":"text-danger",children:[s.success_rate||0,"%"]})})}),e.jsx(v,{children:e.jsxs(he,{children:[e.jsx(xe,{children:e.jsx(h,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(ge,{className:"w-5 h-5"})})}),e.jsxs(je,{"aria-label":"Webhook actions",children:[e.jsx(b,{onPress:()=>se(s),children:"Edit"},"edit"),e.jsx(b,{startContent:e.jsx(be,{className:"w-4 h-4"}),onPress:()=>re(s),children:"Test Webhook"},"test"),e.jsx(b,{startContent:e.jsx(pe,{className:"w-4 h-4"}),onPress:()=>ne(s),children:"View Logs"},"logs"),e.jsx(b,{startContent:e.jsx(ve,{className:"w-4 h-4"}),onPress:()=>oe(s),children:"Duplicate"},"duplicate"),e.jsx(b,{onPress:()=>le(s),children:s.is_active?"Deactivate":"Activate"},"toggle"),e.jsx(b,{className:"text-danger",color:"danger",startContent:e.jsx(ye,{className:"w-4 h-4"}),onPress:()=>ae(s.id),children:"Delete"},"delete")]})]})})]},s.id))})]});return e.jsxs(e.Fragment,{children:[e.jsx(me,{title:"Webhook Manager"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Webhook Manager"}),e.jsx("p",{className:"text-default-500",children:"Manage webhook endpoints and event subscriptions"})]}),e.jsx(h,{color:"primary",startContent:e.jsx(Y,{className:"w-4 h-4"}),onPress:q,radius:c,children:"Create Webhook"})]}),ie(),e.jsx(E,{isOpen:C,onOpenChange:u,size:"2xl",scrollBehavior:"inside",classNames:{base:"bg-content1",header:"border-b border-divider",body:"py-6",footer:"border-t border-divider"},children:e.jsxs(O,{children:[e.jsx(A,{children:e.jsx("h2",{className:"text-lg font-semibold",children:o?"Edit Webhook":"Create Webhook"})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{label:"Webhook Name",placeholder:"My Webhook",value:r.name,onValueChange:s=>l({...r,name:s}),isRequired:!0,radius:c}),e.jsx(S,{label:"Endpoint URL",placeholder:"https://example.com/webhook",value:r.url,onValueChange:s=>l({...r,url:s}),isRequired:!0,radius:c}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{label:"Secret Key",value:r.secret,onValueChange:s=>l({...r,secret:s}),isRequired:!0,radius:c,className:"flex-1"}),e.jsx(h,{onPress:()=>l({...r,secret:k()}),className:"mt-6",radius:c,children:"Generate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Event Types"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-60 overflow-y-auto p-2 border border-divider rounded-lg",children:ee.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:s.value,checked:r.events.includes(s.value),onChange:t=>{t.target.checked?l({...r,events:[...r.events,s.value]}):l({...r,events:r.events.filter(a=>a!==s.value)})},className:"rounded"}),e.jsx("label",{htmlFor:s.value,className:"text-sm cursor-pointer",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(S,{type:"number",label:"Retry Attempts",value:r.retry_attempts.toString(),onValueChange:s=>l({...r,retry_attempts:parseInt(s)||3}),radius:c}),e.jsx(S,{type:"number",label:"Timeout (seconds)",value:r.timeout.toString(),onValueChange:s=>l({...r,timeout:parseInt(s)||30}),radius:c})]}),e.jsx(_e,{isSelected:r.is_active,onValueChange:s=>l({...r,is_active:s}),children:"Active"})]})}),e.jsxs(D,{children:[e.jsx(h,{variant:"flat",onPress:()=>u(!1),radius:c,children:"Cancel"}),e.jsx(h,{color:"primary",onPress:te,radius:c,children:o?"Update":"Create"})]})]})}),e.jsx(E,{isOpen:T,onOpenChange:N,size:"lg",children:e.jsxs(O,{children:[e.jsx(A,{children:"Test Webhook"}),e.jsx(V,{children:m?e.jsxs("div",{className:`p-4 rounded-lg ${m.success?"bg-success-50":"bg-danger-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.success?e.jsx(G,{className:"w-6 h-6 text-success"}):e.jsx(H,{className:"w-6 h-6 text-danger"}),e.jsx("span",{className:"font-semibold",children:m.success?"Test Successful":"Test Failed"})]}),m.response&&e.jsx(L,{className:"mt-2 w-full",children:JSON.stringify(m.response,null,2)}),m.error&&e.jsx("p",{className:"text-danger mt-2",children:m.error})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Sending test webhook..."})})}),e.jsx(D,{children:e.jsx(h,{onPress:()=>N(!1),children:"Close"})})]})}),e.jsx(E,{isOpen:I,onOpenChange:R,size:"3xl",scrollBehavior:"inside",children:e.jsxs(O,{children:[e.jsx(A,{children:"Webhook Logs"}),e.jsx(V,{children:z?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,t)=>e.jsx(J,{className:"h-16 rounded-lg"},t))}):$.length===0?e.jsx("div",{className:"text-center py-8 text-default-500",children:"No logs available"}):e.jsx("div",{className:"space-y-2",children:$.map((s,t)=>e.jsx(B,{className:"shadow-none border border-divider",children:e.jsxs(K,{className:"p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{size:"sm",color:s.status==="success"?"success":s.status==="pending"?"warning":"danger",variant:"flat",children:s.status}),e.jsx("span",{className:"text-sm font-medium",children:s.event})]}),e.jsx("span",{className:"text-xs text-default-500",children:s.created_at})]}),e.jsxs(L,{size:"sm",className:"w-full",children:[s.response_code," - ",s.response_time,"ms"]}),s.error&&e.jsx("p",{className:"text-xs text-danger mt-2",children:s.error})]})},t))})}),e.jsx(D,{children:e.jsx(h,{onPress:()=>R(!1),children:"Close"})})]})})]})]})};export{gs as default};
