import{r as y,j as e,p as N,s as M,b as m,c as P,a as R,d as z}from"./app-DInl32dX.js";import{s as h}from"./toastUtils-Dk6tac5H.js";import{F as D}from"./DocumentIcon-CBf8GOfS.js";import{I as B,K as S}from"./App-WuTgSQpq.js";import{F as L}from"./CheckCircleIcon-CBemRlBB.js";import{F as V}from"./UserIcon-BXV25mJ2.js";import{F as k}from"./EyeIcon-D4ng1SC5.js";import{F as C}from"./IdentificationIcon-CKrgedc9.js";import{m as O,a as E,b as H,c as K}from"./chunk-TW2E3XVA-iMcMikRA.js";import{t as p}from"./chunk-AUA5GDXN-D3hqgLS_.js";import{m as T}from"./chunk-5LXTSPS7-DX-2Lz-B.js";const A=l=>{if(!l)return"0 B";const c=["B","KB","MB","GB"],r=Math.floor(Math.log(l)/Math.log(1024));return`${(l/Math.pow(1024,r)).toFixed(1)} ${c[r]}`},G=l=>{if(!l)return"";const c=new Date(l),i=new Date-c,t=Math.floor(i/(1e3*60*60*24));return t===0?"Today":t===1?"Yesterday":t<7?`${t} days ago`:t<30?`${Math.floor(t/7)} weeks ago`:t<365?`${Math.floor(t/30)} months ago`:`${Math.floor(t/365)} years ago`},ae=({isOpen:l,onClose:c,document:r,versions:i=[],isLoading:t=!1,onRollback:x,onDownloadVersion:u,onPreviewVersion:j,onCompareVersions:g})=>{const[o,b]=y.useState([]),[w,f]=y.useState(null),_=async a=>{if(x){f(a.id);try{await x(r.id,a.id),h(`Rolled back to version ${a.version}`,"success"),c()}catch{h("Failed to rollback to this version","error")}finally{f(null)}}},F=async a=>{if(u){f(a.id);try{await u(r.id,a.id)}catch{h("Failed to download version","error")}finally{f(null)}}},$=()=>{if(o.length!==2){h("Please select exactly 2 versions to compare","warning");return}g&&g(r.id,o[0],o[1])},v=a=>{b(s=>s.includes(a)?s.filter(n=>n!==a):s.length>=2?[s[1],a]:[...s,a])};return e.jsx(O,{isOpen:l,onClose:c,size:"3xl",scrollBehavior:"inside",children:e.jsx(E,{children:a=>e.jsxs(e.Fragment,{children:[e.jsxs(H,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-6 h-6 text-primary"}),e.jsx("span",{children:"Version History"})]}),e.jsx("p",{className:"text-sm font-normal text-default-500",children:r?.title||"Document"})]}),e.jsx(K,{className:"py-4",children:t?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(M,{size:"lg"}),e.jsx("p",{className:"mt-4 text-default-500",children:"Loading version history..."})]}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(D,{className:"w-16 h-16 text-default-300"}),e.jsx("p",{className:"mt-4 text-default-500",children:"No version history available"}),e.jsx("p",{className:"text-sm text-default-400",children:"Version history will appear when you upload new versions"})]}):e.jsxs("div",{className:"space-y-4",children:[i.length>1&&e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-divider",children:[e.jsx("p",{className:"text-sm text-default-500",children:o.length>0?`${o.length} version(s) selected`:"Select 2 versions to compare"}),e.jsx(m,{size:"sm",color:"primary",variant:"flat",isDisabled:o.length!==2,onPress:$,startContent:e.jsx(B,{className:"w-4 h-4"}),children:"Compare Selected"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gradient-to-b from-primary via-primary/50 to-default-200"}),i.map((s,n)=>e.jsxs("div",{className:`relative pl-12 pb-6 ${n===i.length-1?"pb-0":""}`,children:[e.jsx("div",{className:`absolute left-2 top-1 w-5 h-5 rounded-full border-2 flex items-center justify-center ${n===0?"bg-primary border-primary":o.includes(s.id)?"bg-secondary border-secondary":"bg-background border-default-300"}`,children:n===0&&e.jsx(L,{className:"w-3 h-3 text-white"})}),e.jsx(P,{className:`transition-all ${o.includes(s.id)?"ring-2 ring-secondary":"hover:shadow-md"}`,isPressable:i.length>1,onPress:()=>i.length>1&&v(s.id),children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-semibold",children:["Version ",s.version]}),n===0&&e.jsx(z,{size:"sm",color:"success",variant:"flat",children:"Current"})]}),e.jsx("p",{className:"text-sm text-default-500 mt-1",children:s.change_summary||"No description provided"}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-default-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:s.creator?.name||"Unknown"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:G(s.created_at)})]}),e.jsx("span",{children:A(s.file_size)})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[j&&e.jsx(p,{content:"Preview",children:e.jsx(m,{isIconOnly:!0,size:"sm",variant:"light",onPress:d=>{d.stopPropagation(),j(r.id,s.id)},children:e.jsx(k,{className:"w-4 h-4"})})}),e.jsx(p,{content:"Download",children:e.jsx(m,{isIconOnly:!0,size:"sm",variant:"light",isLoading:w===s.id,onPress:d=>{d.stopPropagation(),F(s)},children:e.jsx(C,{className:"w-4 h-4"})})}),n!==0&&x&&e.jsx(p,{content:"Restore this version",children:e.jsx(m,{isIconOnly:!0,size:"sm",variant:"light",color:"warning",isLoading:w===s.id,onPress:d=>{d.stopPropagation(),_(s)},children:e.jsx(S,{className:"w-4 h-4"})})})]})]})})})]},s.id))]})]})}),e.jsx(T,{children:e.jsx(m,{color:"default",variant:"flat",onPress:a,children:"Close"})})]})})})};export{ae as V};
