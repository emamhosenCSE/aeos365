import{r as l,e as f,j as e,H as M,b as _,c as b,a as y,d as O}from"./app-DLWZL5EI.js";import{s as g}from"./toastUtils-CQ8tPw7l.js";import{A as z}from"./App-CPiN04Y0.js";import{P as D}from"./PageHeader-CiRohPv4.js";import{T as H,a as U}from"./ThemedCard-Dc5moHAm.js";import{F as G}from"./PlusIcon-CgcHryUb.js";import{F as K}from"./BoltIcon-BRTqiOqL.js";import{F as J}from"./ShieldCheckIcon-BxwQA0uM.js";import{F as Q}from"./CheckCircleIcon-CaJShsm_.js";import{F as X}from"./PencilIcon-Da-ZoIco.js";import{a as Y}from"./TrashIcon-C6DesZfk.js";import{t as Z,a as k}from"./chunk-ML27DD5T-C2q6bFa5.js";import{s as ee}from"./chunk-P7ACKWSP-C7P2-EIz.js";import{t as te,a as se,b as ie,c as ae}from"./chunk-F3UDT23P-iuiXDnoX.js";import{t as re,a as oe}from"./chunk-YRZGWF2W-C3idaI1g.js";import{m as le,a as ne,b as me,c as de}from"./chunk-TW2E3XVA-dNGvEz5r.js";import{s as ce}from"./chunk-C3QHEOC2-Bmp2Jpe_.js";import{l as j}from"./chunk-Y5DMIIWQ-zhqLBGLU.js";import{i as h}from"./chunk-SQIAVXJX-C5zDfxFa.js";import{t as N}from"./chunk-WEIB4WXA-BkR_II6X.js";import{s as S}from"./chunk-I3A4XRYQ-CbmreU5k.js";import{m as pe}from"./chunk-5LXTSPS7-CJuDP5FM.js";import"./app-BI-xrU3s.js";import"./index-lAyyVki8.js";/* empty css                      */import"./routeUtils-C6MiLID5.js";import"./chunk-CV4BWJDJ-C645uC3W.js";import"./index-DD7PnbC4.js";import"./index-Dz459_my.js";import"./UserIcon-DiPxEy9e.js";import"./Cog6ToothIcon-CI3NiAkm.js";import"./GlobeAltIcon-CFAl4tmE.js";import"./useBranding-C98uB2bk.js";import"./useDialog-LKdJQ55I.js";import"./getScrollParent-B27hviGV.js";import"./keyboard-CSKkBtIV.js";import"./useLabels-CKC_NELL.js";import"./VisuallyHidden-Dslt4DE9.js";import"./index-B5MKI_DQ.js";import"./XMarkIcon-C9tv-sqJ.js";import"./MagnifyingGlassIcon-C9l2NPQE.js";import"./chunk-AUA5GDXN-DgHZKZnK.js";import"./chunk-WQVQ7P2I-BXEU6rr0.js";import"./number-CB4zbwAz.js";import"./chunk-LGMZDQT5-BbUrfslF.js";import"./useMediaQuery-CZ_V8brP.js";import"./chunk-IHO36JMK-DYeauZfe.js";import"./AcademicCapIcon-Bs9t2qow.js";import"./IdentificationIcon-6E2VOCK1.js";import"./ArrowLeftIcon-a6q7R3tQ.js";import"./ArrowRightIcon-BZNmx9ah.js";import"./UsersIcon-CpsA-xGl.js";import"./BriefcaseIcon-CunjT5yU.js";import"./BuildingOfficeIcon-BJoAl2gF.js";import"./CalendarDaysIcon-BR4QgBq8.js";import"./CalendarIcon-BTj7Nn7B.js";import"./ChartBarIcon-CnSK0enl.js";import"./CircleStackIcon-20fpj2M5.js";import"./ClipboardDocumentCheckIcon-Bwahsg1t.js";import"./CogIcon-CQIGGanJ.js";import"./DeviceTabletIcon-CR6eyvHQ.js";import"./CpuChipIcon-Dkmm6hKt.js";import"./CurrencyDollarIcon-DK6JNn4H.js";import"./DevicePhoneMobileIcon-DzKKUXAD.js";import"./DocumentArrowUpIcon-CdnT1l-_.js";import"./DocumentIcon-YVJ_odhG.js";import"./EnvelopeIcon-BNQywoLu.js";import"./ExclamationCircleIcon-D-5waelr.js";import"./EyeSlashIcon-C7uJqcIF.js";import"./EyeIcon-Ds6DAjR7.js";import"./FunnelIcon-D8WHt0li.js";import"./InformationCircleIcon-2sIUPx4E.js";import"./KeyIcon-Dl6jmBIi.js";import"./LockClosedIcon-DWSbAAT6.js";import"./MapPinIcon-CoSq0ZKP.js";import"./PlusCircleIcon-borTRmVT.js";import"./PrinterIcon-jsVlFWpL.js";import"./RocketLaunchIcon-C1ofXZeY.js";import"./ShoppingCartIcon-DijpYrUE.js";import"./UserCircleIcon-D9Bl7hMN.js";import"./UserGroupIcon-DLyCB4U6.js";import"./MaintenanceModeBanner-CpiCdC4n.js";import"./chunk-C6WKGNND-Dq1nEPC1.js";import"./Item-hnCJOaQ5.js";import"./SelectionManager-UhxaObWG.js";import"./index-D3fxkw17.js";import"./useSelectableItem-Qild1lMf.js";import"./useTreeState-CsNDLaZy.js";import"./useMenuTriggerState-CpMESG3a.js";import"./useHasTabbableChild-DwAon3z_.js";import"./index-CokAva9Y.js";import"./chunk-PMMJMDBI-DH4qNxn7.js";import"./useToggleState-C1tJJPv7.js";import"./chunk-ICU6NNET-BuoRM2Mj.js";import"./index-BJ8QHXMy.js";import"./chunk-7F3ZLNJ6-BH294qJ7.js";import"./index-CGn2JJsk.js";import"./useField-CN4URFK6.js";import"./useLabel-BC4q2FsI.js";import"./chunk-KQW2TNLT-BxZBj3py.js";const ls=({auth:ue})=>{const[R,P]=l.useState([]),[F,v]=l.useState(!0),[A,c]=l.useState(!1),[x,C]=l.useState(null),[m,I]=l.useState("global"),[a,p]=l.useState("lg"),[r,o]=l.useState({tenant_id:null,limit_type:"api",max_requests:1e3,time_window_seconds:3600,burst_limit:100,throttle_percentage:100,block_duration_seconds:3600,whitelist_ips:"",blacklist_ips:"",is_active:!0});l.useEffect(()=>{const s=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",i=parseInt(s);i===0?p("none"):i<=4?p("sm"):i<=8?p("md"):i<=12?p("lg"):p("xl")},[]);const u=l.useCallback(async()=>{v(!0);try{const t=await f.get("/api/v1/admin/rate-limit-configs",{params:{tenant_id:m==="global"?void 0:m}});P(t.data.data||[])}catch{g.error("Failed to load rate limit configurations")}finally{v(!1)}},[m]);l.useEffect(()=>{u()},[u]);const q=()=>{o({tenant_id:m==="global"?null:m,limit_type:"api",max_requests:1e3,time_window_seconds:3600,burst_limit:100,throttle_percentage:100,block_duration_seconds:3600,whitelist_ips:"",blacklist_ips:"",is_active:!0}),C(null),c(!0)},T=t=>{o({tenant_id:t.tenant_id,limit_type:t.limit_type,max_requests:t.max_requests,time_window_seconds:t.time_window_seconds,burst_limit:t.burst_limit||100,throttle_percentage:t.throttle_percentage||100,block_duration_seconds:t.block_duration_seconds||3600,whitelist_ips:(t.whitelist_ips||[]).join(`
`),blacklist_ips:(t.blacklist_ips||[]).join(`
`),is_active:t.is_active}),C(t),c(!0)},V=async()=>{const t=new Promise(async(s,i)=>{try{const n={...r,whitelist_ips:r.whitelist_ips.split(`
`).filter(w=>w.trim()),blacklist_ips:r.blacklist_ips.split(`
`).filter(w=>w.trim())},d=x?`/api/v1/admin/rate-limit-configs/${x.id}`:"/api/v1/admin/rate-limit-configs",W=await f[x?"put":"post"](d,n);await u(),c(!1),s([W.data.message||"Configuration saved successfully"])}catch(n){i(n.response?.data?.errors||["Failed to save configuration"])}});g.promise(t,{loading:"Saving configuration...",success:s=>s.join(", "),error:s=>Array.isArray(s)?s.join(", "):s})},E=async t=>{const s=new Promise(async(i,n)=>{try{const d=await f.delete(`/api/v1/admin/rate-limit-configs/${t}`);await u(),i([d.data.message||"Configuration deleted successfully"])}catch{n(["Failed to delete configuration"])}});g.promise(s,{loading:"Deleting configuration...",success:i=>i.join(", "),error:i=>i.join(", ")})},$=async t=>{const s=new Promise(async(i,n)=>{try{const d=await f.put(`/api/v1/admin/rate-limit-configs/${t.id}/toggle`,{is_active:!t.is_active});await u(),i(["Configuration status updated"])}catch{n(["Failed to update configuration"])}});g.promise(s,{loading:"Updating status...",success:i=>i.join(", "),error:i=>i.join(", ")})},L=[{key:"limit_type",label:"Type"},{key:"max_requests",label:"Max Requests"},{key:"time_window",label:"Time Window"},{key:"burst_limit",label:"Burst Limit"},{key:"status",label:"Status"},{key:"actions",label:"Actions"}],B=(t,s)=>{switch(s){case"limit_type":return e.jsx(O,{size:"sm",variant:"flat",color:"primary",radius:a,children:t.limit_type.toUpperCase()});case"max_requests":return t.max_requests.toLocaleString();case"time_window":return`${t.time_window_seconds}s (${Math.round(t.time_window_seconds/60)}m)`;case"burst_limit":return t.burst_limit||"N/A";case"status":return e.jsx(S,{isSelected:t.is_active,onValueChange:()=>$(t),size:"sm",color:"success"});case"actions":return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>T(t),children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(_,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>E(t.id),children:e.jsx(Y,{className:"w-4 h-4"})})]});default:return t[s]}};return e.jsxs(z,{children:[e.jsx(M,{title:"Rate Limit Configuration"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(D,{title:"Rate Limit Configuration",description:"Configure rate limiting for API, web, and webhook requests",action:e.jsx(_,{color:"primary",startContent:e.jsx(G,{className:"w-4 h-4"}),onPress:q,radius:a,children:"Add Configuration"})}),e.jsxs(b,{className:"transition-all duration-200",style:{background:"var(--theme-content1, #FAFAFA)",borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:[e.jsx(H,{children:e.jsxs(Z,{selectedKey:m,onSelectionChange:I,"aria-label":"Configuration tabs",radius:a,children:[e.jsx(k,{title:"Global Settings"},"global"),e.jsx(k,{title:"Tenant-Specific"},"tenant")]})}),e.jsx(U,{children:F?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,s)=>e.jsx(ee,{className:"h-16 rounded-lg"},s))}):e.jsxs(te,{"aria-label":"Rate limit configurations",classNames:{wrapper:"shadow-none",th:"bg-default-100 text-default-600 font-semibold"},children:[e.jsx(re,{columns:L,children:t=>e.jsx(oe,{children:t.label},t.key)}),e.jsx(se,{items:R,emptyContent:"No configurations found",children:t=>e.jsx(ie,{children:s=>e.jsx(ae,{children:B(t,s)})},t.id)})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(b,{className:"aero-card",children:e.jsxs(y,{className:"text-center",children:[e.jsx(K,{className:"w-8 h-8 mx-auto mb-2 text-primary"}),e.jsx("h3",{className:"font-semibold",children:"API Rate Limiting"}),e.jsx("p",{className:"text-sm text-default-500 mt-1",children:"Control request rates per tenant/IP"})]})}),e.jsx(b,{className:"aero-card",children:e.jsxs(y,{className:"text-center",children:[e.jsx(J,{className:"w-8 h-8 mx-auto mb-2 text-success"}),e.jsx("h3",{className:"font-semibold",children:"IP Whitelisting"}),e.jsx("p",{className:"text-sm text-default-500 mt-1",children:"Bypass rate limits for trusted IPs"})]})}),e.jsx(b,{className:"aero-card",children:e.jsxs(y,{className:"text-center",children:[e.jsx(Q,{className:"w-8 h-8 mx-auto mb-2 text-warning"}),e.jsx("h3",{className:"font-semibold",children:"Burst Protection"}),e.jsx("p",{className:"text-sm text-default-500 mt-1",children:"Handle traffic spikes gracefully"})]})})]})]}),e.jsx(le,{isOpen:A,onOpenChange:c,size:"2xl",scrollBehavior:"inside",radius:a,children:e.jsxs(ne,{children:[e.jsx(me,{children:x?"Edit Configuration":"Add Configuration"}),e.jsx(de,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ce,{label:"Limit Type",selectedKeys:[r.limit_type],onSelectionChange:t=>o(s=>({...s,limit_type:Array.from(t)[0]})),radius:a,isRequired:!0,children:[e.jsx(j,{children:"API"},"api"),e.jsx(j,{children:"Web"},"web"),e.jsx(j,{children:"Webhook"},"webhook"),e.jsx(j,{children:"Custom"},"custom")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(h,{type:"number",label:"Max Requests",value:String(r.max_requests),onValueChange:t=>o(s=>({...s,max_requests:parseInt(t)||0})),radius:a,isRequired:!0}),e.jsx(h,{type:"number",label:"Time Window (seconds)",value:String(r.time_window_seconds),onValueChange:t=>o(s=>({...s,time_window_seconds:parseInt(t)||0})),radius:a,isRequired:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(h,{type:"number",label:"Burst Limit",value:String(r.burst_limit),onValueChange:t=>o(s=>({...s,burst_limit:parseInt(t)||0})),radius:a}),e.jsx(h,{type:"number",label:"Throttle %",value:String(r.throttle_percentage),onValueChange:t=>o(s=>({...s,throttle_percentage:parseInt(t)||100})),radius:a})]}),e.jsx(h,{type:"number",label:"Block Duration (seconds)",value:String(r.block_duration_seconds),onValueChange:t=>o(s=>({...s,block_duration_seconds:parseInt(t)||0})),radius:a}),e.jsx(N,{label:"Whitelist IPs (one per line)",value:r.whitelist_ips,onValueChange:t=>o(s=>({...s,whitelist_ips:t})),placeholder:`192.168.1.1
10.0.0.1`,radius:a,minRows:3}),e.jsx(N,{label:"Blacklist IPs (one per line)",value:r.blacklist_ips,onValueChange:t=>o(s=>({...s,blacklist_ips:t})),placeholder:`192.168.1.100
10.0.0.100`,radius:a,minRows:3}),e.jsx(S,{isSelected:r.is_active,onValueChange:t=>o(s=>({...s,is_active:t})),children:"Active"})]})}),e.jsxs(pe,{children:[e.jsx(_,{variant:"flat",onPress:()=>c(!1),radius:a,children:"Cancel"}),e.jsx(_,{color:"primary",onPress:V,radius:a,children:"Save"})]})]})})]})};export{ls as default};
