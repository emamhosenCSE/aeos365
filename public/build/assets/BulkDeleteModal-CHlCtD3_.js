import{r as o,j as e,b as A,g as _e,e as ne,R as Fe,u as ze,p as Ne,d as Y,c as ie,a as de,F as we,s as Xe}from"./app-DLWZL5EI.js";import{u as De,a as ts}from"./useMediaQuery-CZ_V8brP.js";import{s as H}from"./toastUtils-CQ8tPw7l.js";import{au as Le,e as Se,al as rs,ah as as,aq as ns,q as os}from"./App-CPiN04Y0.js";import{D as Me}from"./index-3SaTkLKc.js";import{F as he}from"./CheckCircleIcon-CaJShsm_.js";import{u as Ae}from"./index-rgMU3Ab7.js";import{m as ye,a as ge,b as ve,c as be}from"./chunk-TW2E3XVA-dNGvEz5r.js";import{t as Pe}from"./chunk-WEIB4WXA-BkR_II6X.js";import{m as je}from"./chunk-5LXTSPS7-CJuDP5FM.js";import{a as xe,F as qe}from"./TrashIcon-C6DesZfk.js";import{F as Be}from"./PencilIcon-Da-ZoIco.js";import{F as ls}from"./XCircleIcon-DW8GIZFZ.js";import{F as is}from"./CheckCircleIcon-CwqcGE0l.js";import{F as ds}from"./ClockIcon-iG5DOLZm.js";import{F as cs}from"./ExclamationTriangleIcon-B9464KYk.js";import{F as oe}from"./CalendarDaysIcon-BR4QgBq8.js";import{l as Ue}from"./chunk-3YGGVHYO-Bv3qvRjj.js";import{c as ms}from"./createLucideIcon-DKR2YbRb.js";import{F as Ze}from"./UserIcon-DiPxEy9e.js";import{F as us}from"./BriefcaseIcon-CunjT5yU.js";import{c as ue,t as fs,a as ps,b as xs}from"./chunk-F3UDT23P-iuiXDnoX.js";import{t as Re}from"./chunk-AUA5GDXN-DgHZKZnK.js";import{d as Ve,a as He,b as We,m as Ee}from"./PlusIcon-CgcHryUb.js";import{u as Oe}from"./chunk-NGIUTAK3-BIjgviLU.js";import{a as Ye,s as Ce}from"./chunk-C3QHEOC2-Bmp2Jpe_.js";import{p as Ke}from"./chunk-NL7EUJG2-cD5brqfz.js";import{t as hs,a as ys}from"./chunk-YRZGWF2W-C3idaI1g.js";import{d as Te}from"./chunk-IHO36JMK-DYeauZfe.js";import{p as gs}from"./chunk-VFIJPDYX-DD_no7wC.js";import{C as Ie}from"./calendar-CVc76sod.js";import{U as vs}from"./user-DpzAHKME.js";import{C as Qe}from"./clock-B0bNGOxC.js";import{l as le}from"./chunk-Y5DMIIWQ-zhqLBGLU.js";import{i as pe}from"./chunk-SQIAVXJX-C5zDfxFa.js";import{c as $e}from"./chunk-C6WKGNND-Dq1nEPC1.js";import{F as Ge}from"./InformationCircleIcon-2sIUPx4E.js";import{s as bs}from"./chunk-I3A4XRYQ-CbmreU5k.js";const Je=ms("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);function js({leave:l,onApprovalComplete:v}){const{isOpen:b,onOpen:j,onClose:f}=Ae(),{isOpen:N,onOpen:R,onClose:x}=Ae(),[k,p]=o.useState(""),[F,S]=o.useState(""),[w,I]=o.useState(!1),[E,i]=o.useState({}),y=async()=>{I(!0),i({});const _=new Promise(async(C,$)=>{try{const D=await ne.post(Me("leaves.approve",l.id),{comments:k||null});D.status===200&&D.data.success?(f(),p(""),v&&v(D.data),C([D.data.message||"Leave approved successfully"])):$([D.data.message||"Failed to approve leave"])}catch(D){console.error("Approval error:",D),D.response?.data?.message?$([D.response.data.message]):$(["An error occurred while approving the leave"])}finally{I(!1)}});H.promise(_,{loading:"Approving leave...",success:C=>C[0],error:C=>C[0]})},d=async()=>{if(I(!0),i({}),!F||F.trim().length<10){i({reason:"Rejection reason must be at least 10 characters"}),I(!1);return}const _=new Promise(async(C,$)=>{try{const D=await ne.post(Me("leaves.reject",l.id),{reason:F});D.status===200&&D.data.success?(x(),S(""),v&&v(D.data),C([D.data.message||"Leave rejected successfully"])):$([D.data.message||"Failed to reject leave"])}catch(D){console.error("Rejection error:",D),D.response?.status===422?(i(D.response.data.errors||{}),$([Object.values(D.response.data.errors||{}).flat().join(", ")])):D.response?.data?.message?$([D.response.data.message]):$(["An error occurred while rejecting the leave"])}finally{I(!1)}});H.promise(_,{loading:"Rejecting leave...",success:C=>C[0],error:C=>C[0]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{color:"success",variant:"solid",startContent:e.jsx(he,{className:"w-4 h-4"}),onPress:j,size:"sm",children:"Approve"}),e.jsx(A,{color:"danger",variant:"solid",startContent:e.jsx(_e,{className:"w-4 h-4"}),onPress:R,size:"sm",children:"Reject"})]}),e.jsx(ye,{isOpen:b,onClose:f,size:"md",children:e.jsxs(ge,{children:[e.jsx(ve,{children:"Approve Leave Request"}),e.jsxs(be,{children:[e.jsx("p",{className:"text-sm text-default-600 mb-4",children:"Are you sure you want to approve this leave request?"}),e.jsx(Pe,{label:"Comments (Optional)",placeholder:"Add any comments for the approval...",value:k,onValueChange:p,variant:"bordered",size:"sm",minRows:3,maxRows:5})]}),e.jsxs(je,{children:[e.jsx(A,{color:"default",variant:"bordered",onPress:f,size:"sm",isDisabled:w,children:"Cancel"}),e.jsx(A,{color:"success",onPress:y,size:"sm",isLoading:w,startContent:!w&&e.jsx(he,{className:"w-4 h-4"}),children:"Approve"})]})]})}),e.jsx(ye,{isOpen:N,onClose:x,size:"md",children:e.jsxs(ge,{children:[e.jsx(ve,{children:"Reject Leave Request"}),e.jsxs(be,{children:[e.jsx("p",{className:"text-sm text-default-600 mb-4",children:"Please provide a reason for rejecting this leave request."}),e.jsx(Pe,{label:"Rejection Reason",placeholder:"Explain why this leave is being rejected (minimum 10 characters)...",value:F,onValueChange:S,isInvalid:!!E.reason,errorMessage:E.reason,variant:"bordered",size:"sm",minRows:3,maxRows:5,isRequired:!0})]}),e.jsxs(je,{children:[e.jsx(A,{color:"default",variant:"bordered",onPress:x,size:"sm",isDisabled:w,children:"Cancel"}),e.jsx(A,{color:"danger",onPress:d,size:"sm",isLoading:w,startContent:!w&&e.jsx(_e,{className:"w-4 h-4"}),children:"Reject"})]})]})})]})}const Ns=Fe.forwardRef(({leaves:l,allUsers:v,handleClickOpen:b,setCurrentLeave:j,openModal:f,setLeaves:N,setCurrentPage:R,currentPage:x,totalRows:k,lastPage:p,perPage:F,selectedMonth:S,employee:w,isAdminView:I=!1,onBulkApprove:E,onBulkReject:i,onBulkDelete:y,canApproveLeaves:d=!1,canEditLeaves:_=!1,canDeleteLeaves:C=!1,fetchLeavesStats:$},D)=>{const{auth:X}=ze().props,B=De("(min-width: 1025px)");De("(min-width: 641px) and (max-width: 1024px)");const ee=De("(max-width: 640px)"),[K,te]=o.useState(!1),[s,h]=o.useState(null),[t,W]=o.useState(new Set);Fe.useMemo(()=>Array.from(t).join(", ").replaceAll("_"," "),[t]);const L=()=>{if(typeof window>"u")return"lg";const P=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",c=parseInt(P);return c===0?"none":c<=4?"sm":c<=8?"md":c<=16?"lg":"full"},O=Fe.useMemo(()=>{const n=t==="all",P=n||t.size>0,c=n?l.length:t.size;return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between gap-3 items-end",children:e.jsx("div",{className:"flex gap-3",children:P&&y&&e.jsxs(A,{color:"danger",variant:"flat",startContent:e.jsx(xe,{className:"w-4 h-4"}),onPress:()=>{const a=n?l:l.filter(r=>t.has(r.id.toString()));y(a)},style:{background:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-danger) 30%, transparent)",color:"var(--theme-danger)",borderRadius:L()},children:["Delete ",c," selected"]})})}),P&&e.jsxs("span",{className:"text-small opacity-70",style:{color:"var(--theme-foreground)"},children:[c," of ",l.length," selected"]})]})},[t,l,y]);X.permissions?.includes("leaves.view"),X.permissions?.includes("leave.own.view");const z={New:{color:"primary",icon:cs},Pending:{color:"warning",icon:ds},Approved:{color:"success",icon:is},Declined:{color:"danger",icon:ls}},U=n=>{switch(n?.toLowerCase()){case"casual":return e.jsx(us,{className:"w-3 h-3 text-blue-500"});case"weekend":return e.jsx(rs,{className:"w-3 h-3 text-yellow-500"});case"sick":return e.jsx(ts,{className:"w-3 h-3 text-red-500"});case"earned":return e.jsx(Ne,{className:"w-3 h-3 text-green-500"});default:return e.jsx(Se,{className:"w-3 h-3 text-primary"})}},q=o.useCallback(n=>{R&&R(n)},[R]),G=o.useCallback(async(n,P)=>{if(n.status===P)return H.info(`Leave is already ${P}.`),Promise.resolve(`The leave status is already updated to ${P}`);const c=`${n.id}-${P}`;if(s===c)return;h(c);const a=new Promise(async(r,m)=>{try{const u=await ne.post(route("leave-update-status"),{id:n.id,status:P});u.status===200?(N(g=>g.map(Q=>Q.id===n.id?{...Q,status:P}:Q)),$(),r(u.data.message||"Leave status updated successfully")):m(u.data?.message||"Failed to update leave status")}catch(u){const g=u.response?.data?.message||u.response?.statusText||"Failed to update leave status";m(g)}finally{h(null)}});return H.promise(a,{loading:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),a},[N,s,$]),Z=n=>{const c=(z[n]||z.New).icon,r=(m=>{switch(m.toLowerCase()){case"approved":return{bg:"color-mix(in srgb, var(--theme-success) 20%, transparent)",border:"color-mix(in srgb, var(--theme-success) 40%, transparent)",color:"var(--theme-success)"};case"rejected":return{bg:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",border:"color-mix(in srgb, var(--theme-danger) 40%, transparent)",color:"var(--theme-danger)"};case"pending":return{bg:"color-mix(in srgb, var(--theme-warning) 20%, transparent)",border:"color-mix(in srgb, var(--theme-warning) 40%, transparent)",color:"var(--theme-warning)"};default:return{bg:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",border:"color-mix(in srgb, var(--theme-primary) 40%, transparent)",color:"var(--theme-primary)"}}})(n);return e.jsx(Y,{size:"sm",variant:"flat",startContent:e.jsx(c,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},style:{background:r.bg,border:`1px solid ${r.border}`,color:r.color,borderRadius:L()},children:n})},J=(n,P)=>{const c=new Date(n),a=new Date(P),r=Math.abs(a-c),m=Math.ceil(r/(1e3*60*60*24))+1;return m===1?"1 day":`${m} days`},T=n=>new Date(n).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),V=n=>v?.find(P=>String(P.id)===String(n))||{name:"Unknown User",phone:""},ce=({leave:n,updatingLeave:P,setCurrentLeave:c,openModal:a,handleClickOpen:r,updateLeaveStatus:m,canEditLeaves:u,canDeleteLeaves:g,canApproveLeaves:Q,isAdminView:M})=>{const re=V(n.user_id),ss=J(n.from_date,n.to_date);return z[n.status]||z.New,e.jsx(ie,{className:"mb-2",style:{background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",backdropFilter:"blur(16px)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:L()},children:e.jsxs(de,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-3 flex-1",children:M&&e.jsx(Oe,{avatarProps:{src:re?.profile_image_url||re?.profile_image,size:"sm",name:re?.name||"Unnamed User",...Le({name:re?.name||"Unnamed User",size:"sm"})},description:re?.phone?e.jsx(Ue,{href:`tel:${re?.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:re?.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(Je,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:re?.name||"Unnamed User"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[Z(n.status),(u||g)&&e.jsxs(Ve,{children:[e.jsx(He,{children:e.jsx(A,{isIconOnly:!0,size:"sm",variant:"light",className:"min-w-8 h-8",children:e.jsx(qe,{className:"w-4 h-4"})})}),e.jsxs(We,{"aria-label":"Leave actions",children:[u&&e.jsx(Ee,{startContent:e.jsx(Be,{className:"w-4 h-4"}),onPress:()=>{c(n),a("edit_leave")},children:"Edit Leave"},"edit"),g&&e.jsx(Ee,{className:"text-danger",color:"danger",startContent:e.jsx(xe,{className:"w-4 h-4"}),onPress:()=>r(n.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e.jsx(Te,{className:"my-3"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:n.leave_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsxs("span",{className:"text-sm opacity-80",style:{color:"var(--theme-foreground)"},children:[T(n.from_date)," - ",T(n.to_date)]}),e.jsx(Y,{size:"sm",variant:"bordered",style:{background:"color-mix(in srgb, var(--theme-content2) 50%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)",color:"var(--theme-foreground)",borderRadius:L()},children:ss})]}),n.reason&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 mt-0.5 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsx("span",{className:"text-sm flex-1 opacity-80",style:{color:"var(--theme-foreground)"},children:n.reason})]})]}),M&&Q&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"my-3"}),e.jsx("div",{className:"flex gap-2",children:["Approved","Declined"].map(ae=>e.jsx(A,{size:"sm",variant:n.status===ae?"solid":"bordered",color:z[ae].color,isLoading:P===`${n.id}-${ae}`,onPress:()=>{P!==`${n.id}-${ae}`&&m(n,ae)},startContent:P!==`${n.id}-${ae}`?Fe.createElement(z[ae].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:ae},ae))})]})]})})},me=o.useCallback((n,P)=>{const c=V(n.user_id);switch(P){case"employee":return e.jsx(ue,{className:"whitespace-nowrap",children:e.jsx(Oe,{avatarProps:{src:c?.profile_image_url||c?.profile_image,size:"sm",name:c?.name||"Unnamed User",...Le({name:c?.name||"Unnamed User",size:"sm"})},description:c?.phone?e.jsx(Ue,{href:`tel:${c?.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:c?.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(Je,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:c?.name||"Unnamed User"})})});case"leave_type":return e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[U(n.leave_type),e.jsx("span",{className:"text-sm font-medium capitalize",children:n.leave_type})]})});case"from_date":case"to_date":return e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",style:{color:"var(--theme-foreground)"},children:T(n[P])}),P==="from_date"&&e.jsx("div",{className:"text-xs opacity-60",style:{color:"var(--theme-foreground)"},children:J(n.from_date,n.to_date)})]})]})});case"status":const a=n.approval_chain&&n.status==="pending"&&n.approval_chain.some(r=>r.level===n.current_approval_level&&r.approver_id===X.user.id&&r.status==="pending");return e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[Z(n.status),a?e.jsx(js,{leave:n,onApprovalComplete:()=>{$&&$(),window.location.reload()}}):I&&d&&e.jsxs(Ve,{children:[e.jsx(He,{children:e.jsx(A,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:s&&s.startsWith(`${n.id}-`),onPress:()=>{},className:"min-w-8 h-8",children:e.jsx(qe,{className:"w-4 h-4"})})}),e.jsx(We,{"aria-label":"Status actions",onAction:r=>G(n,r),children:Object.keys(z).map(r=>{const m=z[r],u=m.icon;return e.jsx(Ee,{startContent:e.jsx(u,{className:"w-4 h-4"}),color:m.color,children:r},r)})})]})]})});case"reason":return e.jsx(ue,{children:e.jsx(Re,{content:n.reason||"No reason provided",children:e.jsx("span",{className:"max-w-xs truncate cursor-help text-xs opacity-70",style:{color:"var(--theme-foreground)"},children:n.reason||"No reason provided"})})});case"actions":return e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[_&&e.jsx(Re,{content:"Edit Leave",children:e.jsx(A,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",isDisabled:s&&s.startsWith(`${n.id}-`),onPress:()=>{s&&s.startsWith(`${n.id}-`)||(j(n),f("edit_leave"))},className:"min-w-8 h-8",children:e.jsx(Be,{className:"w-4 h-4"})})}),C&&e.jsx(Re,{content:"Delete Leave",color:"danger",children:e.jsx(A,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",isDisabled:s&&s.startsWith(`${n.id}-`),onPress:()=>{s&&s.startsWith(`${n.id}-`)||(j(n),b(n.id,"delete_leave"))},className:"min-w-8 h-8",children:e.jsx(xe,{className:"w-4 h-4"})})})]})});default:return e.jsx(ue,{children:n[P]})}},[I,d,_,C,B,s,j,f,b,G,X,$]),fe=[...I?[{name:"Employee",uid:"employee",icon:Ze}]:[],{name:"Leave Type",uid:"leave_type",icon:Se},{name:"From Date",uid:"from_date",icon:oe},{name:"To Date",uid:"to_date",icon:oe},{name:"Status",uid:"status",icon:Ne},{name:"Reason",uid:"reason",icon:Se},...I?[{name:"Actions",uid:"actions"}]:[]];return ee?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ye,{className:"max-h-[70vh]",children:l.map(n=>e.jsx(ce,{leave:n,updatingLeave:s,setCurrentLeave:j,openModal:f,handleClickOpen:b,updateLeaveStatus:G,canEditLeaves:_,canDeleteLeaves:C,canApproveLeaves:d,isAdminView:I},n.id))}),k>F&&e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(Ke,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:x,radius:L(),total:p,onChange:q,style:{fontFamily:'var(--fontFamily, "Inter")'}})})]}):e.jsxs("div",{children:[e.jsx(Ye,{className:"max-h-[70vh]",children:e.jsxs(fs,{isStriped:!0,setSelection:!0,selectionMode:I?"multiple":"none",selectedKeys:t,onSelectionChange:W,topContent:O,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",disabledBehavior:"selection",radius:L(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(hs,{columns:fe,children:n=>e.jsx(ys,{align:n.uid==="actions"?"center":"start",className:"backdrop-blur-md",style:{backgroundColor:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[n.icon&&e.jsx(n.icon,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-semibold",children:n.name})]})},n.uid)}),e.jsx(ps,{items:l,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(oe,{className:"w-12 h-12 mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),e.jsx("h6",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No leaves found"}),e.jsx("p",{className:"text-sm opacity-70",style:{color:"var(--theme-foreground)"},children:w?`No leaves found for "${w}"`:"No leave requests for the selected period"})]}),children:n=>e.jsx(xs,{className:"transition-all duration-200 hover:scale-[1.01]",style:{color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)"},children:P=>me(n,P)},n.id)})]})}),k>F&&e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(Ke,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:x,radius:L(),total:p,onChange:q,style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsxs("div",{className:"text-xs opacity-70",style:{color:"var(--theme-foreground)"},children:["Page ",x," of ",p," (Total: ",k," records)"]})]})]})});Ns.displayName="LeaveEmployeeTable";const es=({selectedDepartmentId:l,selectedEmployeeId:v,onDepartmentChange:b,onEmployeeChange:j,allUsers:f=[],departments:N=[],showSearch:R=!0,variant:x="outlined",size:k="medium",disabled:p=!1,required:F=!1,error:S={},label:w={department:"Department",employee:"Employee"},showAllOption:I=!0,autoSelectFirstDepartment:E=!0,className:i="",theme:y})=>{const d=()=>{if(typeof window>"u")return"lg";const h=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",t=parseInt(h);return t===0?"none":t<=4?"sm":t<=8?"md":t<=16?"lg":"full"},[_,C]=o.useState(""),[$,D]=o.useState(""),[X,B]=o.useState(!1);o.useEffect(()=>{if(E&&N.length>0&&!l){const s=N[0];s&&b(s.id)}},[N,l,b,E]);const ee=o.useMemo(()=>_.trim()?N.filter(s=>s.name.toLowerCase().includes(_.toLowerCase())||s.id.toString().includes(_)):N,[N,_]),K=o.useMemo(()=>l?f.filter(s=>String(s.department_id)===String(l)):I?f:[],[f,l,I]),te=o.useMemo(()=>$.trim()?K.filter(s=>s.name.toLowerCase().includes($.toLowerCase())||s.email?.toLowerCase().includes($.toLowerCase())||s.id.toString().includes($)||s.designation?.toLowerCase().includes($.toLowerCase())):K,[K,$]);return o.useEffect(()=>{l&&v&&(K.some(h=>String(h.id)===String(v))||j(""))},[l,v,K,j]),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-4 ${i}`,children:[e.jsx("div",{children:e.jsxs(Ce,{label:w.department,placeholder:"Select Department",selectionMode:"single",selectedKeys:l!=null?new Set([String(l)]):new Set,onSelectionChange:s=>{const h=Array.from(s)[0],t=h===""||h===void 0||h===null?null:parseInt(h);b(t),v&&j(null),C(""),D("")},isDisabled:p,isRequired:F,isInvalid:!!S.department_id,errorMessage:S.department_id,variant:"bordered",size:k==="medium"?"sm":k,radius:d(),className:"w-full",classNames:{trigger:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[I&&e.jsx(le,{value:"",textValue:"All Departments",children:e.jsx("span",{children:"All Departments"})},""),ee.map(s=>e.jsx(le,{value:String(s.id),textValue:s.name,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.name}),e.jsx(Y,{size:"sm",variant:"bordered",className:"ml-auto text-xs",children:f.filter(h=>h.department_id===s.id).length})]})},String(s.id)))]})}),e.jsx("div",{children:e.jsxs(Ce,{label:w.employee,placeholder:!l&&!I?"Select department first":"Select Employee",selectionMode:"single",selectedKeys:v!=null?new Set([String(v)]):new Set,onSelectionChange:s=>{const h=Array.from(s)[0],t=h===""||h===void 0||h===null?null:parseInt(h);j(t),D("")},isDisabled:p||X||!l&&!I,isRequired:F,isInvalid:!!S.user_id,errorMessage:S.user_id,variant:"bordered",size:k==="medium"?"sm":k,radius:d(),className:"w-full",classNames:{trigger:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[I&&e.jsx(le,{value:"",textValue:l?"All Employees in Department":"Select Department First",children:e.jsx("span",{children:l?"All Employees in Department":"Select Department First"})},""),te.map(s=>e.jsx(le,{value:String(s.id),textValue:s.name,children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(as,{src:s.profile_image_url||s.profile_image,size:"sm",name:s.name}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),s.designation&&e.jsx("span",{className:"text-xs text-gray-500",children:s.designation})]}),s.department&&e.jsx(Y,{size:"sm",variant:"bordered",className:"text-xs h-5",children:s.department})]})},String(s.id))),te.length===0&&e.jsx(le,{isDisabled:!0,children:e.jsx("span",{className:"text-sm text-gray-500",children:l?"No employees found in selected department":"No employees found"})},"no-employees")]})})]})};function ws({approvalChain:l,currentLevel:v,status:b}){if(!l||l.length===0)return null;const j=x=>{switch(x){case"approved":return e.jsx(he,{className:"w-5 h-5 text-success"});case"rejected":return e.jsx(_e,{className:"w-5 h-5 text-danger"});case"pending":return e.jsx(Ne,{className:"w-5 h-5 text-warning"});default:return e.jsx(Ne,{className:"w-5 h-5 text-default-400"})}},f=x=>{switch(x){case"approved":return"success";case"rejected":return"danger";case"pending":return"warning";default:return"default"}},N=l.filter(x=>x.status==="approved").length,R=N/l.length*100;return e.jsx(ie,{className:"w-full",children:e.jsxs(de,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Approval Workflow"}),e.jsx(Y,{size:"sm",color:f(b),variant:"flat",children:b||"Pending"})]}),e.jsx(gs,{value:R,color:b==="rejected"?"danger":"success",size:"sm",className:"mb-2"}),e.jsx("div",{className:"space-y-3",children:l.map((x,k)=>{const p=x.level===v;return x.level<v,e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg transition-colors ${p?"bg-warning-50 dark:bg-warning-900/20 border-l-3 border-warning":x.status==="approved"?"bg-success-50 dark:bg-success-900/20":x.status==="rejected"?"bg-danger-50 dark:bg-danger-900/20":"bg-default-100 dark:bg-default-50"}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:j(x.status)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground truncate",children:["Level ",x.level,": ",x.approver_name]}),p&&e.jsx(Y,{size:"sm",color:"warning",variant:"flat",children:"Current"})]}),x.approved_at&&e.jsxs("p",{className:"text-xs text-default-500",children:[x.status==="approved"?"Approved":"Reviewed"," on"," ",new Date(x.approved_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),x.comments&&e.jsxs("p",{className:"text-xs text-default-600 mt-1 italic",children:['"',x.comments,'"']}),p&&x.status==="pending"&&e.jsx("p",{className:"text-xs text-warning-600 dark:text-warning-400 mt-1 font-medium",children:"Awaiting approval"})]})]},k)})}),b==="pending"&&e.jsxs("div",{className:"text-xs text-default-500 text-center pt-2 border-t border-divider",children:[N," of ",l.length," approvals completed"]})]})})}const ct=({open:l,closeModal:v,leavesData:b,setLeavesData:j,currentLeave:f,allUsers:N,departments:R=[],setTotalRows:x,setLastPage:k,setLeaves:p,handleMonthChange:F,employee:S,selectedMonth:w,addLeaveOptimized:I,updateLeaveOptimized:E,fetchLeavesStats:i})=>{const y=()=>{if(typeof window>"u")return"lg";const r=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",m=parseInt(r);return m===0?"none":m<=4?"sm":m<=8?"md":m<=16?"lg":"full"},{auth:d}=ze().props,[_,C]=o.useState(f?.user_id||d.user.id),$=()=>f?.user_id?N?.find(r=>r.id===f.user_id)?.department_id||null:d?.user?.department_id||null,[D,X]=o.useState($()),[B,ee]=o.useState(b?.leaveTypes||[]),[K,te]=o.useState([]),[s,h]=o.useState(f?.leave_type||""),t=a=>{if(!a)return new Date().toISOString().split("T")[0];if(typeof a=="string"&&a.match(/^\d{4}-\d{2}-\d{2}$/))return a;if(typeof a=="string"&&a.includes("T")){if(a.includes("T18:00:00")){const m=a.split("T")[0].split("-"),u=parseInt(m[0]),g=parseInt(m[1]),Q=parseInt(m[2])+1;return new Date(u,g-1,Q).toISOString().split("T")[0]}return a.split("T")[0]}try{const r=new Date(a);if(isNaN(r.getTime()))return new Date().toISOString().split("T")[0];const m=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),g=String(r.getDate()).padStart(2,"0");return`${m}-${u}-${g}`}catch(r){return console.error("Error formatting date:",r),new Date().toISOString().split("T")[0]}},[W,L]=o.useState(f?.from_date?t(f.from_date):""),[O,z]=o.useState(f?.to_date?t(f.to_date):""),[U,q]=o.useState(f?.no_of_days||""),[G,Z]=o.useState(""),[J,T]=o.useState(f?.reason||""),[V,ce]=o.useState({}),[me,fe]=o.useState(!1),[n,P]=o.useState("");o.useEffect(()=>{if(b){const a=b.leaveTypes||[];ee(a);const r=b.leaveCountsByUser?.[_]||[];if(te(r),a.length>0&&!s&&!f&&h(a[0].type),f&&!s){const m=a?.find(u=>u.id===f.leave_type);m&&h(m.type)}}},[b,_,f]),o.useEffect(()=>{if(f){C(f.user_id);const a=N?.find(r=>r.id===f.user_id);a?.department_id&&X(a.department_id)}},[f,N]),o.useEffect(()=>{if(!s||!K||!B)return;const r=K.find(u=>u.leave_type===s)?.days_used||0;P(r);const m=B.find(u=>u.type===s);if(m){const u=m.days-r;Z(u),f&&U>u&&q(u)}},[s,K,B,f,U]),o.useEffect(()=>{q(((r,m)=>{if(!r||!m)return"";const u=new Date(r),g=new Date(m);if(u>g)return"";const Q=g.getTime()-u.getTime();return Math.ceil(Q/(1e3*3600*24))+1})(W,O))},[W,O]);const c=async a=>{a.preventDefault(),fe(!0);const r=new Promise(async(m,u)=>{try{const g={route:route().current(),user_id:_,leaveType:s,fromDate:W,toDate:O,daysCount:U,leaveReason:J,employee:S,month:w},Q=f?route("leave-update"):route("leave-add");f&&(g.id=f.id);const M=await axios.post(Q,g);M.status===200||M.status===201?(j(M.data.leavesData),f&&E&&M.data.leave?(E(M.data.leave),i()):I&&M.data.leave?(I(M.data.leave),i(),M.data.pagination&&(x(M.data.pagination.total),k(M.data.pagination.lastPage))):(M.data.leaves&&(p(M.data.leaves.data),x(M.data.leaves.total),k(M.data.leaves.last_page)),M.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(M.data.leavesData)),v(),m([M.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",M.status),u(`Unexpected response status: ${M.status}`))}catch(g){console.error("Full error object:",g),g.response?(console.error("Error response status:",g.response.status),console.error("Error response data:",g.response.data),g.response.status===422?(ce(g.response.data.errors||{}),u(g.response.data.error||"Failed to submit leave application")):u(`HTTP Error ${g.response.status}: ${g.response.data.message||"An unexpected error occurred. Please try again later."}`)):g.request?(console.error("No response received:",g.request),u("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",g.message),u("An error occurred while setting up the request."))}finally{fe(!1)}});H.promise(r,{loading:"Submitting leave application...",success:m=>Array.isArray(m)?m.join(", "):m,error:m=>typeof m=="string"?m:"Failed to submit leave application"})};return e.jsx(ye,{isOpen:l,onClose:v,size:"3xl",radius:y(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ge,{children:a=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{size:20,style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:f?"Edit Leave":"Add Leave"})]})}),e.jsxs("form",{onSubmit:c,children:[e.jsx(be,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(Ce,{label:"Leave Type",placeholder:"Select Leave Type",selectionMode:"single",selectedKeys:s&&s!==""?new Set([s]):new Set,onSelectionChange:r=>{const m=Array.from(r)[0];h(m||"")},isInvalid:!!V.leaveType,errorMessage:V.leaveType,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(vs,{size:16,className:"text-default-400"}),classNames:{trigger:"min-h-unit-10",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:B.map(r=>{const m=K?.find(Q=>Q.leave_type===r.type),g=(m?r.days-m.days_used:r.days)<=0;return e.jsx(le,{value:r.type,isDisabled:g,title:g?"No remaining leaves available":"",textValue:r.type,children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:r.type}),e.jsx("span",{className:"text-small text-default-500",children:m?`${m.days_used} / ${r.days} days`:`${r.days} days`})]})},r.type)})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(pe,{label:"From Date",type:"date",value:W,onValueChange:L,isInvalid:!!V.fromDate,errorMessage:V.fromDate,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(Ie,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(pe,{label:"To Date",type:"date",value:O,onValueChange:z,isInvalid:!!V.toDate,errorMessage:V.toDate,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(Ie,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(pe,{label:"Number of Days",value:U.toString(),isReadOnly:!0,isInvalid:!!V.daysCount,errorMessage:V.daysCount,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(Qe,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(pe,{label:"Remaining Leaves",value:`${G} day${G!==1?"s":""} of ${B.find(r=>r.type===s)?.days||0} total`,isReadOnly:!0,isInvalid:!!V.remainingLeaves,errorMessage:V.remainingLeaves,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(Qe,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),route().current()==="leaves"&&e.jsx("div",{className:"col-span-full",children:e.jsx(es,{selectedDepartmentId:D,selectedEmployeeId:_,onDepartmentChange:X,onEmployeeChange:C,allUsers:N,departments:R,showSearch:!0,error:V,variant:"bordered",size:"sm",showAllOption:!1,autoSelectFirstDepartment:!0,required:!0})}),e.jsx("div",{className:"col-span-full",children:e.jsx(Pe,{label:"Leave Reason",placeholder:"Please provide a detailed reason for your leave request...",value:J,onValueChange:T,isInvalid:!!V.leaveReason,errorMessage:V.leaveReason,variant:"bordered",size:"sm",radius:y(),minRows:3,maxRows:5,classNames:{input:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),f&&f.approval_chain&&f.approval_chain.length>0&&e.jsx("div",{className:"col-span-full",children:e.jsx(ws,{approvalChain:f.approval_chain,currentLevel:f.current_approval_level,status:f.status})})]})}),e.jsxs(je,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(A,{color:"default",variant:"bordered",onPress:a,radius:y(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(A,{type:"submit",color:"primary",variant:"solid",isLoading:me,isDisabled:me,radius:y(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:me?"Submitting...":"Submit"})]})]})]})})})},mt=({open:l,closeModal:v,leaveId:b,setLeavesData:j,setLeaves:f,setTotalRows:N,setLastPage:R,setError:x,deleteLeaveOptimized:k,fetchLeavesStats:p})=>{const[F,S]=o.useState(!1),w=()=>{if(typeof window>"u")return"lg";const i=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",y=parseInt(i);return y===0?"none":y<=4?"sm":y<=8?"md":y<=16?"lg":"full"},I=async()=>{if(!b){H.error("Invalid leave ID provided");return}S(!0);const E=new Promise(async(i,y)=>{try{const d=await ne.delete(route("leave-delete",{id:b,route:route().current()}));d.status===200&&(k?(k(b),N(_=>Math.max(0,_-1)),p&&p()):(j&&j(d.data.leavesData),N&&N(d.data.leaves.total),R&&R(d.data.leaves.last_page),f&&f(d.data.leaves.data),x&&x(!1),p&&p()),i("Leave application deleted successfully"))}catch(d){if(console.error("Error deleting leave:",d),d.response?.status===404){const{leavesData:_}=d.response.data||{};j&&_&&j(_),x&&x(d.response?.data?.message||"Leave not found."),y("Leave not found or already deleted")}else d.response?.status===403?y("You do not have permission to delete this leave"):d.response?.status===422?y("Cannot delete leave with current status"):y(d.response?.data?.error||"Failed to delete leave application")}finally{S(!1),v()}});H.promise(E,{pending:"Deleting leave application...",success:{render({data:i}){return i}},error:{render({data:i}){return i}}})};return e.jsx(ye,{isOpen:l,onClose:v,size:"md",radius:w(),classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"py-6",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},isDismissable:!F,hideCloseButton:F,children:e.jsx(ge,{children:E=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:"color-mix(in srgb, #ef4444 15%, transparent)",color:"#ef4444"},children:e.jsx(we,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")',color:"var(--theme-foreground)"},children:"Confirm Deletion"})]})}),e.jsx(be,{style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{className:"w-5 h-5 mt-0.5 flex-shrink-0",style:{color:"#ef4444"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Are you sure you want to delete this leave application?"}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"This action cannot be undone. The leave application will be permanently removed from the system."})]})]})}),e.jsxs(je,{className:"flex justify-end gap-2 px-6 py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(A,{color:"default",variant:"bordered",onPress:E,radius:w(),size:"sm",isDisabled:F,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(A,{color:"danger",variant:"solid",onPress:I,radius:w(),size:"sm",isLoading:F,isDisabled:F,startContent:!F&&e.jsx(xe,{className:"w-4 h-4"}),style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:F?"Deleting...":"Delete Leave"})]})]})})})},se=()=>{if(typeof window>"u")return"lg";const v=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",b=parseInt(v);return b===0?"none":b<=4?"sm":b<=8?"md":b<=12?"lg":"xl"},Fs=({selectedDates:l=[],onDatesChange:v,existingLeaves:b=[],publicHolidays:j=[],minDate:f=null,maxDate:N=null,userId:R=null,fetchFromAPI:x=!1})=>{const[k,p]=o.useState(new Date),[F,S]=o.useState({existingLeaves:b,publicHolidays:j}),[w,I]=o.useState(!1),[E,i]=o.useState(null),y=o.useCallback(async s=>{if(!(!x||!R)&&E!==s){I(!0);try{const h=await ne.get(route("leaves.bulk.calendar-data"),{params:{user_id:R,year:s}});h.data.success&&(S({existingLeaves:h.data.data.existingLeaves||[],publicHolidays:h.data.data.publicHolidays||[]}),i(s))}catch(h){console.error("Failed to fetch calendar data:",h)}finally{I(!1)}}},[x,R,E]);o.useEffect(()=>{const s=k.getFullYear();y(s)},[y,k.getFullYear()]),o.useEffect(()=>{x&&R&&i(null)},[R,x]);const d=x?F.existingLeaves:b,_=x?F.publicHolidays:j,C=o.useMemo(()=>{const s=k.getFullYear(),h=k.getMonth(),t=new Date(s,h,1),L=new Date(s,h+1,0).getDate(),O=t.getDay(),z=new Date(s,h,0).getDate(),U=[];for(let T=O-1;T>=0;T--)U.push({date:z-T,isCurrentMonth:!1,fullDate:new Date(s,h-1,z-T)});const q=[];for(let T=1;T<=L;T++)q.push({date:T,isCurrentMonth:!0,fullDate:new Date(s,h,T)});const Z=42-(U.length+q.length),J=[];for(let T=1;T<=Z;T++)J.push({date:T,isCurrentMonth:!1,fullDate:new Date(s,h+1,T)});return[...U,...q,...J]},[k]),$=o.useCallback(()=>{p(s=>new Date(s.getFullYear(),s.getMonth()-1,1))},[]),D=o.useCallback(()=>{p(s=>new Date(s.getFullYear(),s.getMonth()+1,1))},[]),X=o.useCallback(()=>{p(new Date)},[]),B=o.useCallback(s=>{if(!s.isCurrentMonth||w)return;const h=s.fullDate.getFullYear()+"-"+String(s.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(s.fullDate.getDate()).padStart(2,"0"),t=d.some(z=>{if(!z.from_date||!z.to_date)return!1;const U=z.from_date.split("T")[0],q=z.to_date.split("T")[0];return h>=U&&h<=q}),W=_.includes(h);if(t||W||f&&s.fullDate<new Date(f)||N&&s.fullDate>new Date(N))return;const L=l.includes(h);let O;L?O=l.filter(z=>z!==h):O=[...l,h],v(O.sort())},[l,v,f,N,w,d,_]),ee=o.useCallback(s=>{if(!s.isCurrentMonth)return{selectable:!1};const h=s.fullDate.getFullYear()+"-"+String(s.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(s.fullDate.getDate()).padStart(2,"0"),t=l.includes(h),W=s.fullDate.toDateString()===new Date().toDateString(),L=s.fullDate<new Date().setHours(0,0,0,0),O=s.fullDate.getDay()===0||s.fullDate.getDay()===6,z=d.some(G=>{if(!G.from_date||!G.to_date)return!1;const Z=G.from_date.split("T")[0],J=G.to_date.split("T")[0];return h>=Z&&h<=J}),U=_.includes(h),q=!w&&!z&&!U&&(!f||s.fullDate>=new Date(f))&&(!N||s.fullDate<=new Date(N));return{isSelected:t,isToday:W,isPast:L,isWeekend:O,hasExistingLeave:z,isPublicHoliday:U,selectable:q}},[l,d,_,f,N,w]),K=k.toLocaleDateString("en-US",{month:"long",year:"numeric"}),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs(ie,{radius:se(),className:"w-full shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                    color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                    color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx($e,{className:"pb-3 px-4 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 sm:w-5 sm:h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:K}),x&&E&&e.jsx(Y,{size:"sm",variant:"bordered",color:"primary",className:"ml-2 text-xs hidden sm:flex",radius:se(),style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:E})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{isIconOnly:!0,size:"sm",variant:"light",onClick:$,isDisabled:w,radius:se(),className:"min-w-8 h-8",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(ns,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx(A,{size:"sm",variant:"light",onClick:X,isDisabled:w,radius:se(),className:"px-2 py-1 text-xs hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Today"}),e.jsx(A,{isIconOnly:!0,size:"sm",variant:"light",onClick:D,isDisabled:w,radius:se(),className:"min-w-8 h-8",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(os,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]})}),e.jsxs(de,{className:"pt-0 px-4 pb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[w&&e.jsxs("div",{className:"flex justify-center items-center py-4 rounded-lg mb-4",style:{background:"var(--theme-content2, #F4F4F5)",borderColor:"var(--theme-divider, #E4E4E7)"},children:[e.jsx(Xe,{size:"sm",color:"primary"}),e.jsxs("span",{className:"ml-2 text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:["Loading calendar data for ",k.getFullYear(),"..."]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mb-4",children:[e.jsx(Y,{size:"sm",color:"primary",variant:"solid",radius:se(),className:"text-xs font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Selected"}),e.jsx(Y,{size:"sm",color:"danger",variant:"solid",radius:se(),className:"text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Leave"}),e.jsx(Y,{size:"sm",color:"warning",variant:"solid",radius:se(),className:"text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Holiday"}),e.jsx(Y,{size:"sm",color:"secondary",variant:"solid",radius:se(),className:"text-xs font-medium hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Today"}),e.jsx(Y,{size:"sm",color:"default",variant:"bordered",radius:se(),className:"text-xs hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Weekend"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0.5 sm:gap-1 mb-2",children:te.map(s=>e.jsx("div",{className:"flex items-center justify-center w-8 h-6 sm:w-10 sm:h-8 text-xs sm:text-sm font-medium",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-0.5 sm:gap-1",children:C.map((s,h)=>{const t=ee(s);return e.jsxs("div",{onClick:()=>B(s),className:`
                                    relative flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 min-h-8 sm:min-h-10
                                    rounded-md transition-all duration-200 text-xs sm:text-sm select-none
                                    ${t.selectable?"cursor-pointer":"cursor-not-allowed"}
                                    ${s.isCurrentMonth?"":"opacity-30"}
                                    ${w?"opacity-50 pointer-events-none":""}
                                    ${t.isSelected?"font-bold border-2 shadow-md scale-105 z-10":""}
                                    ${t.hasExistingLeave&&!t.isSelected?"border-2 font-medium cursor-not-allowed":""}
                                    ${t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"border-2 font-medium cursor-not-allowed":""}
                                    ${t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"font-semibold border-2 shadow-sm":""}
                                    ${t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"border opacity-70":""}
                                    ${!t.selectable&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"cursor-not-allowed opacity-60":""}
                                    ${t.selectable&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"border border-transparent hover:scale-105":""}
                                `,style:{backgroundColor:t.isSelected?"var(--theme-primary)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-200)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday||w?"var(--theme-content2)":"transparent",color:t.isSelected?"var(--theme-primary-foreground)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger-foreground)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning-foreground)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-800)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"var(--theme-foreground-500)":!t.selectable&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"var(--theme-foreground-400)":"var(--theme-foreground-900)",borderColor:t.isSelected?"var(--theme-primary-600)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger-600)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning-600)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-500)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"var(--theme-divider)":"transparent",borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},role:"button",tabIndex:t.selectable?0:-1,title:t.hasExistingLeave?"Existing leave - cannot select":t.isPublicHoliday?"Public holiday - cannot select":t.selectable?"":"Not selectable","aria-label":`${s.fullDate.toDateString()}${t.isSelected?" (selected)":""}${t.hasExistingLeave?" (existing leave)":""}${t.isPublicHoliday?" (public holiday)":""}`,onKeyDown:W=>{(W.key==="Enter"||W.key===" ")&&(W.preventDefault(),B(s))},children:[s.date,t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&e.jsx("div",{className:"absolute top-0.5 right-0.5 w-1 h-1 rounded-full opacity-50 hidden sm:block",style:{backgroundColor:"var(--theme-foreground-500)"}})]},h)})}),l.length>0&&e.jsxs("div",{className:"mt-4 p-3 sm:p-4 rounded-lg relative overflow-hidden",style:{background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-primary) 10%, transparent) 20%, 
                            color-mix(in srgb, var(--theme-primary) 5%, transparent) 80%)`,border:"1px solid color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"text-xs sm:text-sm font-semibold mb-2",style:{color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:["ðŸ“… ",l.length," date",l.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.slice(0,8).map(s=>e.jsx(Y,{size:"sm",color:"primary",variant:"solid",radius:se(),className:"text-xs font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})},s)),l.length>8&&e.jsxs(Y,{size:"sm",color:"primary",variant:"bordered",radius:se(),className:"text-xs font-medium",style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:["+",l.length-8," more"]})]})]}),e.jsx("div",{className:"absolute -top-2 -right-2 w-12 h-12 rounded-full opacity-30",style:{backgroundColor:"var(--theme-primary)"}})]})]})]})},ke=()=>{if(typeof window>"u")return"lg";const v=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",b=parseInt(v);return b===0?"none":b<=4?"sm":b<=8?"md":b<=12?"lg":"xl"},Ss=({validationResults:l=[],balanceImpact:v=null,isValidating:b=!1})=>{if(l.length===0&&!b)return null;const j=l.filter(p=>p.status==="valid").length,f=l.filter(p=>p.status==="warning").length,N=l.filter(p=>p.status==="conflict").length;l.length;const R=p=>{const F={className:"w-4 h-4"};switch(p){case"valid":return e.jsx(he,{...F,style:{color:"var(--theme-success, #22C55E)"}});case"warning":return e.jsx(we,{...F,style:{color:"var(--theme-warning, #F59E0B)"}});case"conflict":return e.jsx(_e,{...F,style:{color:"var(--theme-danger, #EF4444)"}});default:return e.jsx(Ge,{...F,style:{color:"var(--theme-foreground-400, #A1A1AA)"}})}},x=p=>{switch(p){case"valid":return"success";case"warning":return"warning";case"conflict":return"danger";default:return"default"}},k=p=>new Date(p).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[e.jsxs(ie,{radius:ke(),className:"shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                        color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                        color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx($e,{className:"pb-2 px-4 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Validation Results"}),b&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{size:"sm",color:"primary"}),e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Validating..."})]})]})}),e.jsxs(de,{className:"pt-0 px-4 pb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-success, #22C55E)",fontFamily:'var(--fontFamily, "Inter")'},children:j}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-success, #22C55E)",fontFamily:'var(--fontFamily, "Inter")'},children:"Valid"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-warning, #F59E0B)",fontFamily:'var(--fontFamily, "Inter")'},children:f}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-warning, #F59E0B)",fontFamily:'var(--fontFamily, "Inter")'},children:"Warnings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-danger, #EF4444)",fontFamily:'var(--fontFamily, "Inter")'},children:N}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-danger, #EF4444)",fontFamily:'var(--fontFamily, "Inter")'},children:"Conflicts"})]})]}),v&&e.jsxs("div",{className:"p-3 sm:p-4 rounded-lg border",style:{background:"var(--theme-content2, #F4F4F5)",borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 8px)"},children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-medium mb-3 sm:mb-4 flex items-center gap-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ge,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}}),"Leave Balance Impact"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Leave Type:"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:v.leave_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Current Balance:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[v.current_balance," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Requested Days:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[v.requested_days," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Remaining Balance:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{color:v.remaining_balance<0?"var(--theme-danger)":"var(--theme-success)",fontFamily:'var(--fontFamily, "Inter")'},children:[v.remaining_balance," days"]})]})]}),v.remaining_balance<0&&e.jsx("div",{className:"mt-3 p-2 sm:p-3 rounded-md border",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["âš ï¸ This request exceeds your available leave balance by ",Math.abs(v.remaining_balance)," days."]})})]})]})]}),l.length>0&&e.jsxs(ie,{radius:ke(),className:"shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                            color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx($e,{className:"px-4 pt-4 pb-2",children:e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Date-by-Date Results"})}),e.jsx(de,{className:"px-4 pb-4 pt-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex flex-col gap-2 max-h-40 overflow-y-auto",children:l.map((p,F)=>e.jsxs("div",{className:"flex items-start justify-between p-3 rounded-lg border transition-colors",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 8px)"},onMouseEnter:S=>{S.target.style.borderColor="var(--theme-divider-hover, #D4D4D8)"},onMouseLeave:S=>{S.target.style.borderColor="var(--theme-divider, #E4E4E7)"},children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[R(p.status),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:k(p.date)}),e.jsx("p",{className:"text-xs opacity-75",style:{color:"var(--theme-foreground-500, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:p.date})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(Y,{size:"sm",variant:"bordered",color:x(p.status),radius:ke(),className:"capitalize text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:p.status}),p.errors&&p.errors.length>0&&e.jsx("div",{className:"text-right",children:p.errors.map((S,w)=>e.jsx("p",{className:"text-xs",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:S},w))}),p.warnings&&p.warnings.length>0&&e.jsx("div",{className:"text-right",children:p.warnings.map((S,w)=>e.jsx("p",{className:"text-xs",style:{color:"var(--theme-warning)",fontFamily:'var(--fontFamily, "Inter")'},children:S},w))})]})]},F))})})]})]})},ut=({open:l,onClose:v,onSuccess:b,allUsers:j=[],departments:f=[],leavesData:N={leaveTypes:[],leaveCountsByUser:{}},isAdmin:R=!1,existingLeaves:x=[],publicHolidays:k=[]})=>{const{auth:p}=ze().props,F=()=>{if(typeof window>"u")return"lg";const a=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",r=parseInt(a);return r===0?"none":r<=4?"sm":r<=8?"md":r<=16?"lg":"full"},[S,w]=o.useState([]),[I,E]=o.useState(null),[i,y]=o.useState(null),[d,_]=o.useState(""),[C,$]=o.useState(""),[D,X]=o.useState(!1),[B,ee]=o.useState([]),[K,te]=o.useState(!1),[s,h]=o.useState([]),[t,W]=o.useState(null),[L,O]=o.useState(!1),[z,U]=o.useState(!1),[q,G]=o.useState(!1),[Z,J]=o.useState({});o.useMemo(()=>!x||x.length===0?[]:x.filter(c=>c.user_id===parseInt(i)),[x,i]);const T=o.useMemo(()=>B.length>0?B:N?.leaveTypes||[],[B,N]),V=o.useMemo(()=>B.length>0?B.map(c=>({leave_type:c.type,days_used:c.used,total_days:c.days,remaining_days:c.remaining})):N?.leaveCountsByUser?.[i]||[],[B,N,i]),ce=o.useCallback(async c=>{if(c){te(!0);try{const a=await ne.get(route("leaves.bulk.leave-types"),{params:{user_id:c,year:new Date().getFullYear()}});a.data.success&&ee(a.data.leave_types)}catch(a){console.error("Failed to fetch user leave types:",a),ee([])}finally{te(!1)}}},[]);o.useEffect(()=>{(l&&i&&R||l&&i&&!R)&&ce(i)},[i,l,R,ce]),o.useEffect(()=>{if(l&&p?.user){const c=j?.find(a=>a.id===p.user.id);(c&&c.department_id&&!R||R&&!I&&!i&&c&&c.department_id)&&(E(c.department_id),y(p.user.id))}},[l,p?.user,j,R,I,i]),o.useEffect(()=>{l||(w([]),E(null),y(p?.user?.id||null),_(""),$(""),X(!1),h([]),W(null),U(!1),J({}),ee([]))},[l,p?.user?.id]),o.useEffect(()=>{if(T.length>0&&!d&&l&&i){const c=T.find(a=>{if(B.length>0)return a.remaining>0;const r=V?.find(u=>u.leave_type===a.type);return(r?a.days-r.days_used:a.days)>0});c&&_(c.type)}},[T,V,B,d,l,i]);const me=o.useCallback(async()=>{if(S.length===0){const c=Promise.reject(new Error("No dates selected"));H.promise(c,{error:"Please select at least one date"});return}if(!d){const c=Promise.reject(new Error("No leave type selected"));H.promise(c,{error:"Please select a leave type"});return}if(!C.trim()||C.trim().length<5){const c=Promise.reject("Please provide a reason for leave (at least 5 characters)");H.promise(c,{error:"Please provide a reason for leave (at least 5 characters)"});return}O(!0),J({});try{const c=T.find(r=>r.type===d),a=await ne.post(route("leaves.bulk.validate"),{user_id:parseInt(i),dates:S,leave_type_id:c?.id,reason:C.trim()});if(a.data.success){h(a.data.validation_results),W(a.data.estimated_balance_impact),U(!0);const r=a.data.validation_results.filter(g=>g.status==="conflict").length,m=a.data.validation_results.filter(g=>g.status==="warning").length,u=Promise.resolve();r>0?H.promise(u,{success:`${r} date(s) have conflicts. Please review before submitting.`}):m>0?H.promise(u,{success:`${m} date(s) have warnings. You may proceed if acceptable.`}):H.promise(u,{success:"All dates validated successfully!"})}}catch(c){console.error("Validation error:",c),c.response?.status===422&&J(c.response.data.errors||{});const a=Promise.reject(c);H.promise(a,{error:c.response?.data?.message||"Failed to validate dates"})}finally{O(!1)}},[S,d,C,i,T]),fe=o.useCallback(async()=>{if(!z){const r=Promise.reject(new Error("Not validated"));H.promise(r,{error:"Please validate dates before submitting"});return}if(s.filter(r=>r.status==="conflict").length>0&&!D){const r=Promise.reject("Please resolve conflicts or enable partial success mode");H.promise(r,{error:"Please resolve conflicts or enable partial success mode"});return}G(!0);const a=new Promise(async(r,m)=>{try{const u=T.find(Q=>Q.type===d),g=await ne.post(route("leaves.bulk.store"),{user_id:parseInt(i),dates:S,leave_type_id:u?.id,reason:C.trim(),allow_partial_success:D});g.status===200||g.status===201?(b?.(g.data),v(),r([g.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",g.status),m(`Unexpected response status: ${g.status}`))}catch(u){console.error("Full error object:",u),u.response?(console.error("Error response status:",u.response.status),console.error("Error response data:",u.response.data),u.response.status===422?(J(u.response.data.errors||{}),m(u.response.data.error||"Failed to submit bulk leave requests")):m(`HTTP Error ${u.response.status}: ${u.response.data.message||"An unexpected error occurred. Please try again later."}`)):u.request?(console.error("No response received:",u.request),m("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",u.message),m("An error occurred while setting up the request."))}finally{G(!1)}});H.promise(a,{pending:"Creating bulk leave requests...",success:{render({data:r}){return r.join(", ")}},error:{render({data:r}){return r}}})},[z,s,D,i,S,d,C,b,v,T]),n=S.length>0&&d&&C.trim().length>=5,P=z&&(s.filter(c=>c.status==="conflict").length===0||D);return e.jsx(ye,{isOpen:l,onClose:v,size:"5xl",radius:F(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md max-h-[95vh] my-2",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider flex-shrink-0",body:"overflow-y-auto max-h-[calc(95vh-160px)]",footer:"border-t border-divider flex-shrink-0",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ge,{children:c=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"flex flex-col gap-1 py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 sm:w-6 sm:h-6",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Add Bulk Leave"}),e.jsx("p",{className:"text-sm text-default-500 mt-0.5",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Select multiple dates and create leave requests in batch"})]})]})}),e.jsx(be,{className:"py-4 px-4 sm:py-6 sm:px-6 overflow-y-auto",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",style:{color:"var(--theme-foreground-900, #18181B)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(oe,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),"Select Dates"]}),e.jsx(Fs,{selectedDates:S,onDatesChange:a=>{w(a),U(!1)},userId:i,fetchFromAPI:!0})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",style:{color:"var(--theme-foreground-900, #18181B)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ze,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),"Leave Details"]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[R&&j.length>0&&e.jsx(es,{selectedDepartmentId:I,selectedEmployeeId:i,onDepartmentChange:E,onEmployeeChange:a=>{y(a),_(""),U(!1),ee([])},allUsers:j,departments:f,showSearch:!0,error:Z,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!1,required:!0,disabled:q||L}),e.jsx("div",{children:e.jsx(Ce,{label:"Leave Type",placeholder:"Select Leave Type",selectionMode:"single",selectedKeys:d?new Set([d]):new Set,onSelectionChange:a=>{const r=Array.from(a)[0];_(r||""),U(!1)},isDisabled:q||L||K,isInvalid:!!Z.leave_type_id,errorMessage:Z.leave_type_id,variant:"bordered",size:"sm",radius:F(),classNames:{trigger:"min-h-unit-10",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:K?e.jsx(le,{isDisabled:!0,children:"Loading leave types..."},"loading"):T.map(a=>{let r,m;if(B.length>0)r=a.remaining,m=r<=0;else{const u=V?.find(g=>g.leave_type===a.type);r=u?a.days-u.days_used:a.days,m=r<=0}return e.jsx(le,{value:a.type,isDisabled:m,title:m?"No remaining leaves available":"",textValue:a.type,children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:a.type}),e.jsxs("span",{children:["(",r," remaining)"]})]})},a.type)})})}),d&&e.jsx(pe,{label:"Remaining Leaves",value:(()=>{const a=T.find(u=>u.type===d);let r,m;if(B.length>0&&a)r=a.remaining,m=a.days;else{const u=V?.find(g=>g.leave_type===d);r=u?a?.days-u.days_used:a?.days,m=a?.days}return`${r||0} remaining of ${m||0} total`})(),isReadOnly:!0,variant:"bordered",size:"sm",radius:F(),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(pe,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:C,onChange:a=>{$(a.target.value),U(!1)},isRequired:!0,isInvalid:!!Z.reason||C.length>0&&C.length<5,errorMessage:Z.reason||(C.length>0&&C.length<5?"Reason must be at least 5 characters":`${C.length}/500 characters`),maxLength:500,isDisabled:q||L,variant:"bordered",size:"sm",radius:F(),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(bs,{isSelected:D,onValueChange:X,size:"sm",isDisabled:q||L}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allow partial success"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Valid dates will be processed even if some dates fail validation"})]})]})]})]}),S.length>0&&e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",style:{borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                            color-mix(in srgb, var(--theme-content1) 30%, transparent) 20%, 
                                            color-mix(in srgb, var(--theme-content2) 20%, transparent) 10%)`,fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Selected Dates Summary"}),e.jsxs("p",{className:"text-base font-medium text-gray-900 dark:text-white",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("strong",{children:S.length})," date",S.length!==1?"s":""," selected"]}),d&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Leave type: ",d]})]}),e.jsx(Ss,{validationResults:s,balanceImpact:t,isValidating:L})]})})]})}),e.jsxs(je,{className:"flex flex-col sm:flex-row justify-between items-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(A,{variant:"light",onPress:c,isDisabled:q,radius:F(),className:"w-full sm:w-auto order-2 sm:order-1",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto order-1 sm:order-2",children:[e.jsx(A,{variant:"bordered",color:"primary",onPress:me,isLoading:L,isDisabled:!n||q,startContent:!L&&e.jsx(we,{className:"w-4 h-4"}),radius:F(),className:"w-full sm:w-auto",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("span",{className:"truncate",children:L?"Validating...":"Validate Dates"})}),e.jsx(A,{variant:"solid",color:"primary",onPress:fe,isLoading:q,isDisabled:!P||L,startContent:!q&&e.jsx(he,{className:"w-4 h-4"}),radius:F(),className:"w-full sm:w-auto",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("span",{className:"truncate",children:q?"Creating...":`Create ${S.length} Leave${S.length!==1?"s":""}`})})]})]})]})})})},ft=({open:l,onClose:v,onSuccess:b,selectedLeaves:j=[],allUsers:f=[]})=>{const N=()=>{if(typeof window>"u")return"lg";const i=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",y=parseInt(i);return y===0?"none":y<=4?"sm":y<=8?"md":y<=16?"lg":"full"},[R,x]=o.useState(!1),[k,p]=o.useState({}),F=o.useCallback(E=>f.find(y=>y.id===E)?.name||`User ID: ${E}`,[f]),S=j.filter(E=>E.status&&E.status.toLowerCase()==="approved"),w=S.length===0,I=o.useCallback(async()=>{if(!w){const i=Promise.reject("Cannot delete approved leaves");H.promise(i,{error:"Cannot delete approved leave requests"});return}if(j.length===0){const i=Promise.reject("No leaves selected");H.promise(i,{error:"No leave requests selected for deletion"});return}x(!0);const E=new Promise(async(i,y)=>{try{const d=j.map(C=>C.id),_=await ne.delete(route("leaves.bulk.delete"),{data:{leave_ids:d}});_.status===200&&_.data.success?(b?.(_.data),v(),i([_.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",_.status),y(`Unexpected response status: ${_.status}`))}catch(d){console.error("Full error object:",d),d.response?(console.error("Error response status:",d.response.status),console.error("Error response data:",d.response.data),d.response.status===422?(p(d.response.data.errors||{}),y(d.response.data.error||"Failed to delete leave requests")):d.response.status===403?y(d.response.data.error||"You are not authorized to delete these leave requests"):d.response.status===404?y(d.response.data.error||"Some leave requests were not found"):y(`HTTP Error ${d.response.status}: ${d.response.data.message||"An unexpected error occurred. Please try again later."}`)):d.request?(console.error("No response received:",d.request),y("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",d.message),y("An error occurred while setting up the request."))}finally{x(!1)}});H.promise(E,{pending:"Deleting leave requests...",success:{render({data:i}){return i.join(", ")}},error:{render({data:i}){return i}}})},[j,w,b,v]);return e.jsx(ye,{isOpen:l,onClose:v,size:"2xl",radius:N(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ge,{children:E=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-6 h-6",style:{color:"var(--theme-danger, #f31260)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")',color:"var(--theme-foreground)"},children:"Delete Leave Requests"}),e.jsxs("p",{className:"text-sm mt-0.5",style:{color:"var(--theme-foreground-600)"},children:["Confirm deletion of ",j.length," leave request",j.length!==1?"s":""]})]})]})}),e.jsx(be,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[!w&&e.jsx(ie,{className:"border",style:{backgroundColor:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 30%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(de,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("h4",{className:"font-semibold",style:{color:"var(--theme-danger)"},children:"Cannot Delete Approved Leaves"})]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:[S.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:["Selected Leave Requests (",j.length,")"]})]}),e.jsx(ie,{className:"border max-h-80 overflow-y-auto",style:{backgroundColor:"var(--theme-content1)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(de,{className:"p-0",children:j.map((i,y)=>{const d=i.status&&i.status.toLowerCase()==="approved";return e.jsxs("div",{children:[e.jsxs("div",{className:`p-4 ${d?"opacity-60":""}`,style:{backgroundColor:d?"color-mix(in srgb, var(--theme-danger) 5%, transparent)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx("span",{className:"font-medium text-sm",style:{color:"var(--theme-foreground)"},children:F(i.user_id)}),e.jsx(Y,{size:"sm",variant:"bordered",color:i.status?.toLowerCase()==="approved"?"success":i.status?.toLowerCase()==="pending"?"warning":i.status?.toLowerCase()==="rejected"?"danger":"default",radius:N(),style:{borderRadius:"var(--borderRadius, 8px)"},children:i.status||"Unknown"}),d&&e.jsx(Y,{size:"sm",variant:"bordered",color:"danger",radius:N(),style:{borderRadius:"var(--borderRadius, 8px)"},children:"Cannot Delete"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:[i.leave_type," - ",i.from_date," to ",i.to_date]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:[i.no_of_days," day",i.no_of_days!==1?"s":""," - ",i.reason]})]})]}),y<j.length-1&&e.jsx(Te,{style:{background:"var(--theme-divider)"}})]},i.id)})})})]}),w&&e.jsx(ie,{className:"border",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(de,{className:"p-4",children:e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--theme-warning)"},children:"âš ï¸ This action cannot be undone. The selected leave requests will be permanently deleted."})})})]})}),e.jsxs(je,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(A,{color:"default",variant:"bordered",onPress:E,radius:N(),size:"sm",isDisabled:R,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(A,{color:"danger",variant:"solid",onPress:I,isLoading:R,isDisabled:!w||R||j.length===0,startContent:!R&&e.jsx(xe,{className:"w-4 h-4"}),radius:N(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:R?"Deleting...":`Delete ${j.length} Request${j.length!==1?"s":""}`})]})]})})})};export{ut as B,mt as D,ct as L,ft as a,Ns as b};
