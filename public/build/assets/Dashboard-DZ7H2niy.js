import{r as t,j as e,H as ee,c,a as d,e as _,F as q,p as se,b as te,d as m,h as P,M as ae}from"./app-DLWZL5EI.js";import{A as re,l as ie}from"./App-CPiN04Y0.js";import{s as v}from"./toastUtils-CQ8tPw7l.js";import{F as le}from"./MagnifyingGlassIcon-C9l2NPQE.js";import{F as T}from"./ChartBarIcon-CnSK0enl.js";import{F as oe}from"./TrashIcon-C6DesZfk.js";import{F as ne}from"./BriefcaseIcon-CunjT5yU.js";import{F as ce}from"./CpuChipIcon-Dkmm6hKt.js";import{F as de}from"./UsersIcon-CpsA-xGl.js";import{i as me}from"./chunk-SQIAVXJX-C5zDfxFa.js";import{s as k}from"./chunk-C3QHEOC2-Bmp2Jpe_.js";import{l as r}from"./chunk-Y5DMIIWQ-zhqLBGLU.js";import{t as pe,a as ue,b as xe,c as he}from"./chunk-F3UDT23P-iuiXDnoX.js";import{t as fe,a as ge}from"./chunk-YRZGWF2W-C3idaI1g.js";import{s as x}from"./chunk-P7ACKWSP-C7P2-EIz.js";import{p as je}from"./chunk-NL7EUJG2-cD5brqfz.js";import{d as Ne,a as we,b as ye,m as F}from"./PlusIcon-CgcHryUb.js";import{p as be}from"./chunk-VFIJPDYX-DD_no7wC.js";import"./app-BI-xrU3s.js";import"./index-lAyyVki8.js";/* empty css                      */import"./routeUtils-C6MiLID5.js";import"./chunk-CV4BWJDJ-C645uC3W.js";import"./index-DD7PnbC4.js";import"./index-Dz459_my.js";import"./UserIcon-DiPxEy9e.js";import"./Cog6ToothIcon-CI3NiAkm.js";import"./GlobeAltIcon-CFAl4tmE.js";import"./useBranding-C98uB2bk.js";import"./useDialog-LKdJQ55I.js";import"./getScrollParent-B27hviGV.js";import"./keyboard-CSKkBtIV.js";import"./useLabels-CKC_NELL.js";import"./VisuallyHidden-Dslt4DE9.js";import"./index-B5MKI_DQ.js";import"./XMarkIcon-C9tv-sqJ.js";import"./chunk-AUA5GDXN-DgHZKZnK.js";import"./chunk-WQVQ7P2I-BXEU6rr0.js";import"./number-CB4zbwAz.js";import"./chunk-LGMZDQT5-BbUrfslF.js";import"./useMediaQuery-CZ_V8brP.js";import"./chunk-IHO36JMK-DYeauZfe.js";import"./ShieldCheckIcon-BxwQA0uM.js";import"./AcademicCapIcon-Bs9t2qow.js";import"./IdentificationIcon-6E2VOCK1.js";import"./ArrowLeftIcon-a6q7R3tQ.js";import"./ArrowRightIcon-BZNmx9ah.js";import"./BoltIcon-BRTqiOqL.js";import"./BuildingOfficeIcon-BJoAl2gF.js";import"./CalendarDaysIcon-BR4QgBq8.js";import"./CalendarIcon-BTj7Nn7B.js";import"./CheckCircleIcon-CaJShsm_.js";import"./CircleStackIcon-20fpj2M5.js";import"./ClipboardDocumentCheckIcon-Bwahsg1t.js";import"./CogIcon-CQIGGanJ.js";import"./DeviceTabletIcon-CR6eyvHQ.js";import"./CurrencyDollarIcon-DK6JNn4H.js";import"./DevicePhoneMobileIcon-DzKKUXAD.js";import"./DocumentArrowUpIcon-CdnT1l-_.js";import"./PencilIcon-Da-ZoIco.js";import"./DocumentIcon-YVJ_odhG.js";import"./EnvelopeIcon-BNQywoLu.js";import"./ExclamationCircleIcon-D-5waelr.js";import"./EyeSlashIcon-C7uJqcIF.js";import"./EyeIcon-Ds6DAjR7.js";import"./FunnelIcon-D8WHt0li.js";import"./InformationCircleIcon-2sIUPx4E.js";import"./KeyIcon-Dl6jmBIi.js";import"./LockClosedIcon-DWSbAAT6.js";import"./MapPinIcon-CoSq0ZKP.js";import"./PlusCircleIcon-borTRmVT.js";import"./PrinterIcon-jsVlFWpL.js";import"./RocketLaunchIcon-C1ofXZeY.js";import"./ShoppingCartIcon-DijpYrUE.js";import"./UserCircleIcon-D9Bl7hMN.js";import"./UserGroupIcon-DLyCB4U6.js";import"./chunk-TW2E3XVA-dNGvEz5r.js";import"./chunk-I3A4XRYQ-CbmreU5k.js";import"./useToggleState-C1tJJPv7.js";import"./chunk-ICU6NNET-BuoRM2Mj.js";import"./MaintenanceModeBanner-CpiCdC4n.js";import"./chunk-KQW2TNLT-BxZBj3py.js";import"./useField-CN4URFK6.js";import"./useLabel-BC4q2FsI.js";import"./useMenuTriggerState-CpMESG3a.js";import"./useSelectableItem-Qild1lMf.js";import"./SelectionManager-UhxaObWG.js";import"./Item-hnCJOaQ5.js";import"./chunk-7F3ZLNJ6-BH294qJ7.js";import"./index-D3fxkw17.js";import"./index-CGn2JJsk.js";import"./chunk-PMMJMDBI-DH4qNxn7.js";import"./index-BJ8QHXMy.js";import"./useHasTabbableChild-DwAon3z_.js";import"./index-CokAva9Y.js";import"./chunk-OH2E76JR-Bg0Or-mv.js";import"./useTreeState-CsNDLaZy.js";import"./useProgressBar-BmJFnG-i.js";import"./useNumberFormatter-DOVyNCK1.js";import"./NumberFormatter-DNR9MAW-.js";const _e=()=>{if(typeof window>"u")return"lg";const o=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",n=parseInt(o);return n===0?"none":n<=4?"sm":n<=8?"md":n<=12?"lg":"xl"},p=()=>({background:"linear-gradient(135deg, var(--theme-content1, #FAFAFA) 0%, var(--theme-content2, #F4F4F5) 100%)",borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'}),ve={users:de,storage:ae,api_calls:ce,employees:ne,projects:ie};function jt({auth:S,tenants:o,statistics:n}){const[E,I]=t.useState(o?.data||[]),[W,A]=t.useState(!1),[h,C]=t.useState(!1),[u,$]=t.useState("lg"),[N,z]=t.useState(""),[f,D]=t.useState("all"),[g,M]=t.useState("all"),[w,O]=t.useState(o?.current_page||1),[R,Fe]=t.useState(10),[j,H]=t.useState(n||{total_tenants:0,tenants_at_risk:0,tenants_over_quota:0,total_warnings:0,quota_types:{}});t.useEffect(()=>{$(_e())},[]);const Q=async()=>{A(!0);try{const s=await _.get(route("admin.quotas.index"),{params:{search:N,status:f!=="all"?f:void 0,quota_type:g!=="all"?g:void 0,page:w,per_page:R}});I(s.data.data)}catch{v.error("Failed to fetch tenant data")}finally{A(!1)}},y=async()=>{C(!0);try{const s=await _.get(route("admin.quotas.statistics"));H(s.data)}catch{v.error("Failed to fetch statistics")}finally{C(!1)}};t.useEffect(()=>{Q()},[N,f,g,w,R]),t.useEffect(()=>{y();const s=setInterval(y,6e4);return()=>clearInterval(s)},[]);const V=async(s,i)=>{const l=new Promise(async(a,Z)=>{try{const b=await _.post(route("admin.quotas.dismiss-warning",s),{quota_type:i});a([b.data.message||"Warning dismissed"]),Q(),y()}catch(b){Z(b.response?.data?.errors||["Failed to dismiss warning"])}});v.promise(l,{loading:"Dismissing warning...",success:a=>a.join(", "),error:a=>Array.isArray(a)?a.join(", "):a})},L=s=>{P.visit(route("admin.quotas.show",s))},U=s=>{P.visit(route("admin.quotas.configure",s))},G=s=>s>=100||s>=90?"danger":s>=80?"warning":"success",K=s=>s>=100?e.jsx(m,{color:"danger",size:"sm",variant:"flat",children:"Over Quota"}):s>=90?e.jsx(m,{color:"danger",size:"sm",variant:"flat",children:"Critical"}):s>=80?e.jsx(m,{color:"warning",size:"sm",variant:"flat",children:"Warning"}):e.jsx(m,{color:"success",size:"sm",variant:"flat",children:"Healthy"}),B=s=>{const i=Math.min(100,Math.round(s.current/s.limit*100)),l=G(i),a=ve[s.type]||T;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-4 h-4 text-default-500"}),e.jsx("span",{className:"font-medium capitalize",children:s.type.replace("_"," ")})]}),e.jsxs("span",{className:"text-default-500",children:[s.current," / ",s.limit]})]}),e.jsx(be,{value:i,color:l,size:"sm",radius:u,classNames:{track:"bg-default-200",indicator:`${l==="danger"?"bg-danger":l==="warning"?"bg-warning":"bg-success"}`}})]},s.type)},J=()=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(c,{className:"transition-all duration-200",style:p(),children:e.jsx(d,{className:"p-4",children:h?e.jsx(x,{className:"h-16 rounded"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-default-500",children:"Total Tenants"}),e.jsx(T,{className:"w-5 h-5 text-primary"})]}),e.jsx("p",{className:"text-2xl font-bold",children:j.total_tenants}),e.jsx("p",{className:"text-xs text-default-400 mt-1",children:"Active tenants monitored"})]})})}),e.jsx(c,{className:"transition-all duration-200",style:p(),children:e.jsx(d,{className:"p-4",children:h?e.jsx(x,{className:"h-16 rounded"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-default-500",children:"At Risk"}),e.jsx(q,{className:"w-5 h-5 text-warning"})]}),e.jsx("p",{className:"text-2xl font-bold text-warning",children:j.tenants_at_risk}),e.jsx("p",{className:"text-xs text-default-400 mt-1",children:"80%+ quota usage"})]})})}),e.jsx(c,{className:"transition-all duration-200",style:p(),children:e.jsx(d,{className:"p-4",children:h?e.jsx(x,{className:"h-16 rounded"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-default-500",children:"Over Quota"}),e.jsx(q,{className:"w-5 h-5 text-danger"})]}),e.jsx("p",{className:"text-2xl font-bold text-danger",children:j.tenants_over_quota}),e.jsx("p",{className:"text-xs text-default-400 mt-1",children:"Exceeded limits"})]})})}),e.jsx(c,{className:"transition-all duration-200",style:p(),children:e.jsx(d,{className:"p-4",children:h?e.jsx(x,{className:"h-16 rounded"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-default-500",children:"Active Warnings"}),e.jsx(se,{className:"w-5 h-5 text-warning"})]}),e.jsx("p",{className:"text-2xl font-bold",children:j.total_warnings}),e.jsx("p",{className:"text-xs text-default-400 mt-1",children:"Pending dismissal"})]})})})]}),X=[{key:"tenant",label:"TENANT"},{key:"quotas",label:"QUOTA USAGE"},{key:"status",label:"STATUS"},{key:"warnings",label:"WARNINGS"},{key:"actions",label:"ACTIONS"}],Y=(s,i)=>{switch(i){case"tenant":return e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-xs text-default-400",children:s.domain})]});case"quotas":return e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[s.quotas&&s.quotas.slice(0,2).map(B),s.quotas&&s.quotas.length>2&&e.jsxs("p",{className:"text-xs text-default-400",children:["+",s.quotas.length-2," more"]})]});case"status":const l=Math.max(...s.quotas?.map(a=>a.current/a.limit*100)||[0]);return K(l);case"warnings":return e.jsx("div",{className:"flex items-center gap-2",children:s.active_warnings>0?e.jsxs(m,{color:"warning",size:"sm",variant:"dot",children:[s.active_warnings," active"]}):e.jsx(m,{color:"success",size:"sm",variant:"dot",children:"None"})});case"actions":return e.jsxs(Ne,{children:[e.jsx(we,{children:e.jsx(te,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(oe,{className:"w-5 h-5"})})}),e.jsxs(ye,{"aria-label":"Tenant Actions",children:[e.jsx(F,{onPress:()=>L(s.id),children:"View Details"},"view"),e.jsx(F,{onPress:()=>U(s.id),children:"Configure Quotas"},"configure"),s.active_warnings>0&&e.jsx(F,{className:"text-warning",color:"warning",onPress:()=>V(s.id,"all"),children:"Dismiss All Warnings"},"dismiss")]})]});default:return null}};return e.jsxs(re,{user:S.user,header:"Quota Management",children:[e.jsx(ee,{title:"Quota Management"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsx(J,{}),e.jsx(c,{className:"mb-6 transition-all duration-200",style:p(),children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(me,{placeholder:"Search tenants...",value:N,onValueChange:z,startContent:e.jsx(le,{className:"w-4 h-4 text-default-400"}),radius:u,classNames:{inputWrapper:"bg-default-100"},className:"flex-1"}),e.jsxs(k,{placeholder:"Status",selectedKeys:[f],onSelectionChange:s=>D(Array.from(s)[0]),radius:u,className:"w-full sm:w-[180px]",classNames:{trigger:"bg-default-100"},children:[e.jsx(r,{children:"All Status"},"all"),e.jsx(r,{children:"Healthy"},"healthy"),e.jsx(r,{children:"Warning"},"warning"),e.jsx(r,{children:"Critical"},"critical"),e.jsx(r,{children:"Over Quota"},"over_quota")]}),e.jsxs(k,{placeholder:"Quota Type",selectedKeys:[g],onSelectionChange:s=>M(Array.from(s)[0]),radius:u,className:"w-full sm:w-[180px]",classNames:{trigger:"bg-default-100"},children:[e.jsx(r,{children:"All Types"},"all"),e.jsx(r,{children:"Users"},"users"),e.jsx(r,{children:"Storage"},"storage"),e.jsx(r,{children:"API Calls"},"api_calls"),e.jsx(r,{children:"Employees"},"employees"),e.jsx(r,{children:"Projects"},"projects")]})]})})}),e.jsx(c,{className:"transition-all duration-200",style:p(),children:e.jsxs(d,{className:"p-0",children:[e.jsxs(pe,{"aria-label":"Quota management table",isHeaderSticky:!0,classNames:{wrapper:"shadow-none",th:"bg-default-100 text-default-600 font-semibold",td:"py-4"},children:[e.jsx(fe,{columns:X,children:s=>e.jsx(ge,{children:s.label},s.key)}),e.jsx(ue,{items:E,isLoading:W,loadingContent:e.jsx(x,{className:"h-12 rounded"}),emptyContent:"No tenants found",children:s=>e.jsx(xe,{children:i=>e.jsx(he,{children:Y(s,i)})},s.id)})]}),o?.last_page>1&&e.jsx("div",{className:"flex justify-center p-4 border-t border-divider",children:e.jsx(je,{total:o.last_page,page:w,onChange:O,showControls:!0,radius:u})})]})})]})})]})}export{jt as default};
