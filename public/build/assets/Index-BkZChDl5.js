import{r as a,j as e,c as K,d as H,s as _e,b as u,l as je,e as B,i as Fe,F as Se,n as U,k as Oe,H as Ve,m as We,a as Be}from"./app-B1idACz3.js";import{z as Ke,o as ae,F as te,d as He,c as be,ar as qe,h as Ge,N as Je,y as Qe,as as Xe,A as Ye}from"./App-BxA45E4t.js";import{S as Ze}from"./StatsCards-BcTb12h8.js";import{A as we,I as es,U as ss}from"./InviteUserForm-Cr-p28fT.js";import{s as I}from"./toastUtils-CW5B8m6C.js";import{F as X}from"./EnvelopeIcon-B0z_TX9R.js";import{F as ts}from"./UserGroupIcon-C2aGroqx.js";import{F as Ce}from"./BuildingOfficeIcon-DRKs9y4o.js";import{F as as}from"./BriefcaseIcon-CtncUTGk.js";import{f as rs}from"./formatDistanceToNow-Ctx6mZEP.js";import{c as Re}from"./chunk-C6WKGNND-DYIi9UqF.js";import{d as is}from"./chunk-IHO36JMK-_QcGGA4V.js";import{t as Y}from"./chunk-AUA5GDXN-Dy7XAS6o.js";import{m as ie,a as ne,b as le,c as oe}from"./chunk-TW2E3XVA-DozWYklk.js";import{m as de}from"./chunk-5LXTSPS7-Cw-SP9Ff.js";import{F as ke}from"./XMarkIcon-BkS9W9l-.js";import{s as z}from"./chunk-C3QHEOC2-tt4DAwFy.js";import{l as F}from"./chunk-Y5DMIIWQ-CwpVnCx_.js";import{i as re}from"./chunk-SQIAVXJX-BmeQe73H.js";import{F as Z}from"./LockClosedIcon-D4pmCoEC.js";import{t as ns}from"./chunk-WEIB4WXA-DGofE0K0.js";import{F as ls}from"./CheckCircleIcon-znT6UY48.js";import{F as ye}from"./ShieldCheckIcon-BVzIZ77z.js";import{F as os}from"./MagnifyingGlassIcon-DgboSUq1.js";import{b as ds}from"./chunk-57V4RE7B-HilHExJA.js";import{F as cs}from"./UserIcon-1qA6iUQn.js";import{F as Ne}from"./DevicePhoneMobileIcon-BEyIwQb0.js";import{F as ms}from"./useMediaQuery-oujQjmbJ.js";import{a as ps,F as xs}from"./DeviceTabletIcon--UjnqdVT.js";import{s as W}from"./chunk-P7ACKWSP-5o7fRwLF.js";import{p as us}from"./chunk-NL7EUJG2-aTLCznnI.js";import{u as fs}from"./chunk-NGIUTAK3-DEWLG6K6.js";import{d as hs,a as gs,b as vs,m as js}from"./PlusIcon-B7YJbjTI.js";import{s as bs}from"./chunk-I3A4XRYQ-2BhccB5I.js";import"./app-BmhO9GrS.js";import"./index-B22Xm-65.js";/* empty css                      */import"./chunk-CV4BWJDJ-BFly1wX0.js";import"./index-CaNeU5V8.js";import"./index-BvevyAVm.js";import"./Cog6ToothIcon-BTkQVx_H.js";import"./GlobeAltIcon-BXsgRUBL.js";import"./useBranding-BpzGYNdv.js";import"./useDialog-Ch8oEuGx.js";import"./VisuallyHidden-8dXxwzFE.js";import"./keyboard-Ct-gpNNq.js";import"./useLabels-xtEGP3rr.js";import"./index-BvG5LGgQ.js";import"./AcademicCapIcon-QvlhCYpE.js";import"./IdentificationIcon-CvziX476.js";import"./ArrowLeftIcon-B39h7gxR.js";import"./ArrowRightIcon-DyVdpuyc.js";import"./CalendarDaysIcon-CPIWRTu0.js";import"./CalendarIcon-DXmDQodP.js";import"./CircleStackIcon-DdzMQ0P3.js";import"./ClipboardDocumentCheckIcon-DRpcDtD7.js";import"./CpuChipIcon-Czc12K36.js";import"./CurrencyDollarIcon-nhXxeFAs.js";import"./DocumentArrowUpIcon-1h0_t1N_.js";import"./DocumentIcon-CZnboGRP.js";import"./EyeIcon-Cqrke5l0.js";import"./InformationCircleIcon-DqlZzEsT.js";import"./KeyIcon-EZeCAT5w.js";import"./MapPinIcon-CvRrNoqN.js";import"./PlusCircleIcon-ChwrtP31.js";import"./PrinterIcon-BAYK2vO7.js";import"./UserCircleIcon-BluwysQc.js";import"./useHasTabbableChild-D7clvTMF.js";import"./chunk-LGMZDQT5-BFW_lSqD.js";import"./useSelectableItem-2B3SBj_3.js";import"./SelectionManager-CcfpIYkh.js";import"./Item-C3GqwNyW.js";import"./MaintenanceModeBanner-BuwtjklV.js";import"./chunk-F3UDT23P-C-ho-l6F.js";import"./chunk-PMMJMDBI-B-BWMVyO.js";import"./useToggleState-DFwZ_RpM.js";import"./chunk-ICU6NNET-CXrsm0Bw.js";import"./index-CcVAKcbs.js";import"./chunk-7F3ZLNJ6-CMjtQ9ZK.js";import"./index-BMFea15Y.js";import"./chunk-YRZGWF2W-DSN9j3G1.js";import"./camera-B3eXSxmq.js";import"./createLucideIcon-b1nPBkyS.js";import"./eye-BMpPdxRV.js";import"./chunk-WQVQ7P2I-BDe9YmDI.js";import"./number-CB4zbwAz.js";import"./chunk-KQW2TNLT-Cz1cLYHm.js";import"./useLabel-BWLgnRON.js";import"./useMenuTriggerState-ZTP0zge5.js";import"./index-BsK0-JqV.js";import"./chunk-OH2E76JR-ZyB0wyOM.js";import"./useTreeState-D7Kaxu17.js";const ws=({onInvitationChange:y})=>{const[x,N]=a.useState([]),[k,d]=a.useState(!0),[r,n]=a.useState(null),[p,v]=a.useState({open:!1,invitation:null}),[j,h]=a.useState("lg"),c=()=>{if(typeof window>"u")return"lg";const f=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",_=parseInt(f);return _===0?"none":_<=4?"sm":_<=8?"md":_<=16?"lg":"full"};a.useEffect(()=>{typeof window<"u"&&h(c())},[]);const m=async()=>{d(!0);try{const i=await U.get(route("users.invitations.pending"));N(i.data.invitations||[])}catch(i){console.error("Error fetching invitations:",i),I.error("Failed to load invitations")}finally{d(!1)}};a.useEffect(()=>{m()},[]);const $=async i=>{n(`resend-${i.id}`);try{const f=await U.post(route("users.invitations.resend",{invitation:i.id}));I.success(`Invitation resent to ${i.email}`),m(),y?.()}catch(f){console.error("Error resending invitation:",f),I.error(f.response?.data?.message||"Failed to resend invitation")}finally{n(null)}},l=async()=>{if(p.invitation){n(`cancel-${p.invitation.id}`);try{await U.delete(route("users.invitations.cancel",{invitation:p.invitation.id})),I.success(`Invitation to ${p.invitation.email} cancelled`),v({open:!1,invitation:null}),m(),y?.()}catch(i){console.error("Error canceling invitation:",i),I.error("Failed to cancel invitation")}finally{n(null)}}},L=i=>{const D=(new Date(i.expires_at)-new Date)/(1e3*60*60*24);return D<1?"danger":D<3?"warning":"success"},S=i=>{try{return rs(new Date(i),{addSuffix:!0})}catch{return i}};return k?e.jsx(K,{className:"w-full",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs(H,{className:"flex items-center justify-center p-8",children:[e.jsx(_e,{size:"lg"}),e.jsx("p",{className:"text-default-500 mt-4",children:"Loading invitations..."})]})}):x.length===0?e.jsx(K,{className:"w-full",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:"color-mix(in srgb, var(--theme-content1) 50%, transparent)"},children:e.jsxs(H,{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx("div",{className:"p-4 rounded-full mb-4",style:{background:"color-mix(in srgb, var(--theme-default-200) 30%, transparent)"},children:e.jsx(X,{className:"w-8 h-8 text-default-400"})}),e.jsx("p",{className:"text-default-700 font-medium mb-1",children:"No Pending Invitations"}),e.jsx("p",{className:"text-default-500 text-sm",children:"All invitations have been accepted or expired"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{className:"w-full",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsxs(Re,{className:"flex justify-between items-center px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)"},children:e.jsx(X,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Pending Invitations"}),e.jsxs("p",{className:"text-sm text-default-500",children:[x.length," invitation",x.length!==1?"s":""," awaiting acceptance"]})]})]}),e.jsx(u,{size:"sm",variant:"flat",startContent:e.jsx(je,{className:"w-4 h-4"}),onPress:m,radius:j,isLoading:k,children:"Refresh"})]}),e.jsx(is,{}),e.jsx(H,{className:"p-0",children:e.jsx("div",{className:"divide-y divide-divider",children:x.map(i=>e.jsx("div",{className:"p-4 hover:bg-default-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-foreground truncate",children:i.email}),e.jsxs(B,{size:"sm",variant:"flat",color:L(i),startContent:e.jsx(Fe,{className:"w-3 h-3"}),children:["Expires ",S(i.expires_at)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-default-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ts,{className:"w-4 h-4 text-default-400"}),e.jsx("span",{className:"capitalize",children:i.role?.replace(/-/g," ")})]}),i.metadata?.department_id&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"w-4 h-4 text-default-400"}),e.jsx("span",{children:"Department assigned"})]}),i.metadata?.designation_id&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(as,{className:"w-4 h-4 text-default-400"}),e.jsx("span",{children:"Designation assigned"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-default-500",children:[e.jsxs("span",{children:["Sent ",S(i.created_at)]}),i.inviter&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["by ",i.inviter.name]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{content:"Resend invitation email",children:e.jsx(u,{size:"sm",variant:"flat",color:"primary",isIconOnly:!0,onPress:()=>$(i),isLoading:r===`resend-${i.id}`,radius:j,children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsx(Y,{content:"Cancel invitation",color:"danger",children:e.jsx(u,{size:"sm",variant:"flat",color:"danger",isIconOnly:!0,onPress:()=>v({open:!0,invitation:i}),isLoading:r===`cancel-${i.id}`,radius:j,children:e.jsx(Ke,{className:"w-4 h-4"})})})]})]})},i.id))})})]}),e.jsx(ie,{isOpen:p.open,onClose:()=>v({open:!1,invitation:null}),size:"sm",backdrop:"blur",radius:j,children:e.jsxs(ne,{children:[e.jsx(le,{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-danger"}),e.jsx("span",{children:"Cancel Invitation"})]})}),e.jsxs(oe,{children:[e.jsxs("p",{className:"text-sm text-default-600",children:["Are you sure you want to cancel the invitation to"," ",e.jsx("strong",{children:p.invitation?.email}),"?"]}),e.jsx("p",{className:"text-sm text-default-500 mt-2",children:"The invitation link will no longer work, and they won't be able to join your organization using this invitation."})]}),e.jsxs(de,{children:[e.jsx(u,{variant:"flat",onPress:()=>v({open:!1,invitation:null}),radius:j,children:"Keep Invitation"}),e.jsx(u,{color:"danger",onPress:l,isLoading:r!==null,radius:j,children:"Cancel Invitation"})]})]})})]})},ys=({open:y,onClose:x,roles:N,departments:k,themeRadius:d="lg"})=>{const[r,n]=a.useState({role_id:"",active:"",department_id:"",from_date:"",to_date:""}),[p,v]=a.useState(!1),j=async()=>{v(!0);const c=new Promise(async(m,$)=>{try{const l=new URLSearchParams;r.role_id&&l.append("role_id",r.role_id),r.active!==""&&l.append("active",r.active),r.department_id&&l.append("department_id",r.department_id),r.from_date&&l.append("from_date",r.from_date),r.to_date&&l.append("to_date",r.to_date);const L=route("users.export")+"?"+l.toString(),S=document.createElement("a");S.href=L,S.setAttribute("download",`users_export_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(S),S.click(),document.body.removeChild(S),setTimeout(()=>{m(["Users exported successfully"]),x(),n({role_id:"",active:"",department_id:"",from_date:"",to_date:""})},1e3)}catch(l){$([l.message||"Failed to export users"])}finally{v(!1)}});I.promise(c,{loading:"Exporting users...",success:m=>m.join(", "),error:m=>Array.isArray(m)?m.join(", "):m})},h=()=>{p||(n({role_id:"",active:"",department_id:"",from_date:"",to_date:""}),x())};return e.jsx(ie,{isOpen:y,onOpenChange:h,size:"2xl",scrollBehavior:"inside",classNames:{base:"bg-content1",header:"border-b border-divider",body:"py-6",footer:"border-t border-divider"},children:e.jsxs(ne,{children:[e.jsxs(le,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Export Users"})]}),e.jsx("p",{className:"text-sm text-default-500 font-normal",children:"Apply filters to export specific users to CSV"})]}),e.jsx(oe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(z,{label:"Filter by Role",placeholder:"All Roles",selectedKeys:r.role_id?[r.role_id]:[],onSelectionChange:c=>n({...r,role_id:Array.from(c)[0]||""}),radius:d,classNames:{trigger:"bg-default-100"},children:[e.jsx(F,{children:"All Roles"},""),N?.map(c=>e.jsx(F,{value:String(c.id),children:c.name},String(c.id)))]}),e.jsxs(z,{label:"Filter by Status",placeholder:"All Statuses",selectedKeys:r.active!==""?[r.active]:[],onSelectionChange:c=>n({...r,active:Array.from(c)[0]||""}),radius:d,classNames:{trigger:"bg-default-100"},children:[e.jsx(F,{children:"All Statuses"},""),e.jsx(F,{children:"Active"},"1"),e.jsx(F,{children:"Inactive"},"0")]}),k&&k.length>0&&e.jsxs(z,{label:"Filter by Department",placeholder:"All Departments",selectedKeys:r.department_id?[r.department_id]:[],onSelectionChange:c=>n({...r,department_id:Array.from(c)[0]||""}),radius:d,classNames:{trigger:"bg-default-100"},children:[e.jsx(F,{children:"All Departments"},""),k.map(c=>e.jsx(F,{value:String(c.id),children:c.name},String(c.id)))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(re,{type:"date",label:"From Date",placeholder:"Select start date",value:r.from_date,onChange:c=>n({...r,from_date:c.target.value}),radius:d,classNames:{inputWrapper:"bg-default-100"}}),e.jsx(re,{type:"date",label:"To Date",placeholder:"Select end date",value:r.to_date,onChange:c=>n({...r,to_date:c.target.value}),radius:d,classNames:{inputWrapper:"bg-default-100"}})]}),e.jsx("p",{className:"text-xs text-default-400",children:"* CSV file will include: ID, Name, Username, Email, Phone, Status, Roles, Email Verified, Created At"})]})}),e.jsxs(de,{children:[e.jsx(u,{variant:"flat",onPress:h,isDisabled:p,radius:d,startContent:e.jsx(ke,{className:"w-4 h-4"}),children:"Cancel"}),e.jsx(u,{color:"primary",onPress:j,isLoading:p,radius:d,startContent:!p&&e.jsx(ae,{className:"w-4 h-4"}),children:p?"Exporting...":"Export CSV"})]})]})})},Ns=({open:y,onClose:x,user:N,onSuccess:k,themeRadius:d="lg"})=>{const[r,n]=a.useState(""),[p,v]=a.useState(!1),j=async()=>{v(!0);const c=new Promise(async(m,$)=>{try{const l=await U.post(route("users.lock",N.id),{reason:r||void 0});l.status===200&&(m([l.data.message||"Account locked successfully"]),k?.(l.data.user),x(),n(""))}catch(l){$(l.response?.data?.errors||[l.response?.data?.error||l.response?.data?.message||"Failed to lock account"])}finally{v(!1)}});I.promise(c,{loading:"Locking account...",success:m=>m.join(", "),error:m=>Array.isArray(m)?m.join(", "):m})},h=()=>{p||(n(""),x())};return e.jsx(ie,{isOpen:y,onOpenChange:h,size:"2xl",scrollBehavior:"inside",classNames:{base:"bg-content1",header:"border-b border-divider",body:"py-6",footer:"border-t border-divider"},children:e.jsxs(ne,{children:[e.jsxs(le,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-danger"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Lock Account"})]}),e.jsxs("p",{className:"text-sm text-default-500 font-normal",children:["Lock ",N?.name,"'s account and prevent access"]})]}),e.jsx(oe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-danger-50 dark:bg-danger-100/10 border border-danger-200 dark:border-danger-200/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-danger-600 dark:text-danger-500",children:[e.jsx("strong",{children:"Warning:"})," This will immediately lock the user's account and prevent them from logging in. The user will be deactivated and will need an administrator to unlock their account."]})}),e.jsx(ns,{label:"Reason for Locking (Optional)",placeholder:"Enter the reason for locking this account...",value:r,onValueChange:n,minRows:3,maxRows:6,maxLength:500,radius:d,classNames:{inputWrapper:"bg-default-100"},description:`${r.length}/500 characters`})]})}),e.jsxs(de,{children:[e.jsx(u,{variant:"flat",onPress:h,isDisabled:p,radius:d,startContent:e.jsx(ke,{className:"w-4 h-4"}),children:"Cancel"}),e.jsx(u,{color:"danger",onPress:j,isLoading:p,radius:d,startContent:!p&&e.jsx(Z,{className:"w-4 h-4"}),children:p?"Locking...":"Lock Account"})]})]})})},_s=y=>({paginate:"users.paginate",stats:"users.stats",store:"users.store",update:"users.update",destroy:"users.destroy",toggleStatus:"users.toggleStatus",updateRoles:"users.updateRole",invite:"users.invite",export:"users.export",restore:"users.restore",lock:"users.lock",unlock:"users.unlock",forcePasswordReset:"users.forcePasswordReset",resendVerification:"users.resendVerification",devices:"devices.admin.list",devicesToggle:"devices.admin.toggle",devicesReset:"devices.admin.reset"}),Fs=({title:y,roles:x,departments:N,designations:k,context:d="tenant"})=>{const r=a.useMemo(()=>_s(),[d]),[n,p]=a.useState(!1),[v,j]=a.useState(!1),[h,c]=a.useState(!1),[m,$]=a.useState(!1),[l,L]=a.useState("lg"),S=()=>{if(typeof window>"u")return"lg";const t=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",o=parseInt(t);return o===0?"none":o<=4?"sm":o<=8?"md":o<=12?"lg":"xl"};a.useEffect(()=>{typeof window<"u"&&L(S())},[]),a.useEffect(()=>{const s=()=>{p(window.innerWidth<640),j(window.innerWidth<768),c(window.innerWidth>=1025),$(window.innerWidth>=641&&window.innerWidth<=1024)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const[i,f]=a.useState([]),[_,D]=a.useState(!0),[q,ce]=a.useState(null),[me,G]=a.useState(0),[pe,J]=a.useState(1),[C,xe]=a.useState(null),[g,Ae]=a.useState({search:"",role:"all",status:"all",department:"all"}),[Ss,Cs]=a.useState(!1),[T,ue]=a.useState("table"),[b,ee]=a.useState({currentPage:1,perPage:10,total:i.length}),[fe,Rs]=a.useState({}),[w,Pe]=a.useState({total_users:0,active_users:0,inactive_users:0,deleted_users:0,verified_users:0,unverified_users:0,locked_accounts:0,users_with_roles:0,users_without_roles:0,recent_users_30_days:0,active_percentage:0,verified_percentage:0,roles_coverage:0,total_roles:0}),P=a.useMemo(()=>({data:i,total:me,current_page:b.currentPage,per_page:b.perPage,last_page:pe}),[i,me,b.currentPage,b.perPage,pe]),R=a.useCallback(async()=>{try{const{data:s}=await U.get(route(r.stats));s.stats&&Pe(s.stats)}catch(s){console.error("Error fetching user stats:",s)}},[r.stats]),M=a.useCallback(async()=>{D(!0);try{const s=await U.get(route(r.paginate),{params:{page:b.currentPage,perPage:b.perPage,search:g.search||void 0,role:g.role!=="all"?g.role:void 0,status:g.status!=="all"?g.status:void 0,department:g.department!=="all"?g.department:void 0}});if(s.status===200){const{users:t}=s.data;t.data&&Array.isArray(t.data)?(f(t.data),t.meta?(G(t.meta.total||0),J(t.meta.last_page||1)):(G(t.total||t.data.length),J(t.last_page||1))):Array.isArray(t)?(f(t),G(t.length),J(1)):(console.error("Unexpected users data format:",t),f([]),G(0),J(1))}}catch(s){console.error("Error fetching users:",s),I.error("Failed to load users data"),f([])}finally{D(!1)}},[g,b.currentPage,b.perPage,r.paginate]);a.useEffect(()=>{M()},[M]),a.useEffect(()=>{R();const s=setInterval(R,6e4);return()=>clearInterval(s)},[R]);const O=(s,t)=>{Ae(o=>({...o,[s]:t})),ee(o=>({...o,currentPage:1}))},he=s=>{ee(t=>({...t,currentPage:s})),window.scrollTo({top:0,behavior:"smooth"})},Ie=s=>{ee(t=>({...t,currentPage:1,perPage:s}))},E=a.useCallback((s,t=null)=>{xe(s),ce(t)},[]),V=a.useCallback(()=>{xe(null),ce(null)},[]),Q=a.useCallback(s=>{f(s)},[]),$e=a.useCallback(s=>{f(t=>t.map(o=>o.id===s.id?{...o,...s}:o))},[]),Ee=a.useCallback(s=>{f(t=>t.filter(o=>o.id!==s)),R()},[R]),ge=a.useCallback((s,t)=>{f(o=>o.map(A=>A.id===s?{...A,active:t}:A)),R()},[R]),Ue=a.useCallback((s,t)=>{f(o=>o.map(A=>A.id===s?{...A,roles:t}:A)),R()},[R]),ve=(s,t="w-4 h-4")=>{const o=s?.toLowerCase()||"";return o.includes("mobile")||o.includes("android")||o.includes("iphone")?e.jsx(Ne,{className:`${t} text-primary`}):o.includes("tablet")||o.includes("ipad")?e.jsx(ps,{className:`${t} text-secondary`}):e.jsx(xs,{className:`${t} text-default-500`})},ze=s=>{const t=s?.toLowerCase()||"";return t.includes("mobile")||t.includes("android")||t.includes("iphone")?"Mobile":t.includes("tablet")||t.includes("ipad")?"Tablet":"Desktop"},Le=({user:s,index:t})=>e.jsx(K,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200 h-full min-h-[320px]",style:{background:`linear-gradient(135deg, 
          color-mix(in srgb, var(--theme-content1) 90%, transparent) 20%, 
          color-mix(in srgb, var(--theme-content2) 80%, transparent) 80%)`,borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(H,{className:"p-3 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3 pb-2 border-b border-white/10",children:[e.jsx(fs,{avatarProps:{radius:"md",src:s?.profile_image_url||s?.profile_image,size:"sm",fallback:e.jsx(cs,{className:"w-4 h-4"}),style:{borderColor:"var(--theme-primary)",borderWidth:"2px"}},name:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-foreground text-sm line-clamp-1",children:s.name}),e.jsxs("span",{className:"text-default-500 text-xs line-clamp-1",children:["ID: ",s.id]})]}),classNames:{wrapper:"flex-1 min-w-0",name:"text-sm font-semibold",description:"text-xs text-default-500"}}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{content:"Edit User",size:"sm",children:e.jsx(u,{isIconOnly:!0,size:"sm",variant:"light",className:"text-default-400 hover:text-primary min-w-6 w-6 h-6",onPress:()=>E("edit",s),children:e.jsx(Je,{className:"w-3 h-3"})})}),e.jsxs(hs,{placement:"bottom-end",children:[e.jsx(gs,{children:e.jsx(u,{isIconOnly:!0,size:"sm",variant:"ghost",radius:l,isDisabled:fe[s.id],className:"min-w-6 w-6 h-6",style:{background:"color-mix(in srgb, var(--theme-content2) 30%, transparent)"},children:e.jsx(Qe,{className:"w-3 h-3"})})}),e.jsx(vs,{"aria-label":"Device management actions",variant:"bordered",className:"min-w-[180px]",style:{background:"color-mix(in srgb, var(--theme-content1) 95%, transparent)",backdropFilter:"blur(16px)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(js,{startContent:e.jsx(Ne,{className:"w-3 h-3"}),onPress:()=>Be.visit(route(r.devices,{userId:s.id})),className:"text-xs",children:"Device History"},"view-devices")})]})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(X,{className:"w-3 h-3 text-default-400 shrink-0"}),e.jsx("span",{className:"text-default-600 line-clamp-1 flex-1",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(ms,{className:"w-3 h-3 text-default-400 shrink-0"}),e.jsx("span",{className:"text-default-600 line-clamp-1",children:s.phone})]}),(s.department||s.department_id)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(Ce,{className:"w-3 h-3 text-default-400 shrink-0"}),e.jsx("span",{className:"text-default-600 line-clamp-1",children:typeof s.department=="string"?s.department:"N/A"})]})]}),e.jsxs("div",{className:"mb-3 p-2 rounded-lg",style:{background:"color-mix(in srgb, var(--theme-content2) 40%, transparent)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-default-700",children:"Device Status"}),s.single_device_login&&s.active_device&&e.jsx(Y,{content:e.jsxs("div",{className:"p-2 max-w-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[ve(s.active_device.user_agent,"w-4 h-4"),e.jsx("span",{className:"font-medium text-xs",children:s.active_device.device_name||"Unknown Device"})]}),e.jsxs("div",{className:"text-xs text-default-500",children:[ze(s.active_device.user_agent)," •",s.active_device.is_active?" Active":" Inactive"]})]}),size:"sm",children:e.jsx("div",{className:"cursor-help",children:ve(s.active_device.user_agent,"w-4 h-4")})})]}),e.jsx(B,{size:"sm",variant:"flat",color:s.single_device_login?s.active_device?"warning":"success":"default",startContent:s.single_device_login?s.active_device?e.jsx(Z,{className:"w-3 h-3"}):e.jsx(Xe,{className:"w-3 h-3"}):e.jsx(ye,{className:"w-3 h-3"}),className:"text-xs",children:s.single_device_login?s.active_device?"Locked":"Free":"Disabled"})]}),e.jsxs("div",{className:"mt-auto space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-default-700",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{size:"sm",isSelected:s.active,onValueChange:o=>ge(s.id,o),color:s.active?"success":"danger",classNames:{wrapper:"group-data-[selected=true]:bg-success",thumb:"group-data-[selected=true]:ml-4"}}),e.jsx("span",{className:`text-xs font-medium ${s.active?"text-success":"text-danger"}`,children:s.active?"Active":"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-default-700 mb-1 block",children:"Roles"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.roles&&s.roles.length>0?s.roles.slice(0,3).map((o,A)=>{const Me=typeof o=="object"&&o!==null?o.name:o;return e.jsx(B,{size:"sm",variant:"flat",color:"secondary",className:"text-xs h-5",children:Me},A)}):e.jsx(B,{size:"sm",variant:"bordered",color:"default",className:"text-xs h-5",children:"No Roles"}),s.roles&&s.roles.length>3&&e.jsxs(B,{size:"sm",variant:"bordered",color:"primary",className:"text-xs h-5",children:["+",s.roles.length-3]})]})]})]})]})}),De=a.useMemo(()=>[{title:"Total Users",value:w?.total_users||0,icon:e.jsx(te,{className:"w-5 h-5"}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"All registered users"},{title:"Active Users",value:w?.active_users||0,icon:e.jsx(ls,{className:"w-5 h-5"}),color:"text-green-400",iconBg:"bg-green-500/20",description:`${w?.active_percentage||0}% of total`},{title:"Inactive Users",value:w?.inactive_users||0,icon:e.jsx(Oe,{className:"w-5 h-5"}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Deactivated accounts"},{title:"Email Verified",value:w?.verified_users||0,icon:e.jsx(ye,{className:"w-5 h-5"}),color:"text-emerald-400",iconBg:"bg-emerald-500/20",description:`${w?.verified_percentage||0}% verified`},{title:"Unverified",value:w?.unverified_users||0,icon:e.jsx(Se,{className:"w-5 h-5"}),color:"text-yellow-400",iconBg:"bg-yellow-500/20",description:"Pending verification"},{title:"Locked Accounts",value:w?.locked_accounts||0,icon:e.jsx(Z,{className:"w-5 h-5"}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Security locked"},{title:"With Roles",value:w?.users_with_roles||0,icon:e.jsx(He,{className:"w-5 h-5"}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:`${w?.roles_coverage||0}% coverage`},{title:"New Users (30d)",value:w?.recent_users_30_days||0,icon:e.jsx(Fe,{className:"w-5 h-5"}),color:"text-cyan-400",iconBg:"bg-cyan-500/20",description:"Last 30 days"}],[w]),se=d==="admin"?"Platform Administrators":"Users Management",Te=d==="admin"?"Manage platform administrator accounts and access":"Manage user accounts, roles and permissions";return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{title:y||se}),C==="add"&&e.jsx(we,{user:null,roles:x,open:C==="add",setUsers:Q,closeModal:V,editMode:!1,context:d}),C==="edit"&&q&&e.jsx(we,{user:q,roles:x,open:C==="edit",setUsers:Q,closeModal:V,editMode:!0,context:d}),C==="invite"&&d==="tenant"&&e.jsx(es,{roles:x,open:C==="invite",closeModal:V,onInviteSent:()=>{M()}}),C==="export"&&e.jsx(ys,{open:C==="export",onClose:V,roles:x,departments:N,themeRadius:l}),C==="lock"&&q&&e.jsx(Ns,{open:C==="lock",onClose:V,user:q,onSuccess:s=>{Q(s),M()},themeRadius:l}),e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":se,children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(We.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(K,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                    var(--theme-content1, #FAFAFA) 20%, 
                    var(--theme-content2, #F4F4F5) 10%, 
                    var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(Re,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                      color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                      color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${h?"p-6":m?"p-4":"p-3"} w-full`,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[_?e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx(W,{className:"w-12 h-12 rounded-xl"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(W,{className:"w-64 h-6 rounded mb-2"}),e.jsx(W,{className:"w-48 h-4 rounded"})]})]}):e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                ${h?"p-3":m?"p-2.5":"p-2"} 
                                rounded-xl flex items-center justify-center
                              `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(te,{className:`
                                  ${h?"w-8 h-8":m?"w-6 h-6":"w-5 h-5"}
                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                  ${h?"text-2xl":m?"text-xl":"text-lg"}
                                  font-bold text-foreground
                                  ${h?"":"truncate"}
                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:se}),e.jsx("p",{className:`
                                  ${h?"text-sm":"text-xs"} 
                                  text-default-500
                                  ${h?"":"truncate"}
                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:Te})]})]}),_?e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-3",children:[e.jsx(W,{className:"w-24 h-8 rounded"}),e.jsx(W,{className:"w-20 h-8 rounded"})]}):e.jsxs("div",{className:"flex flex-wrap gap-2 lg:gap-3",children:[e.jsx(u,{size:n?"sm":"md",color:"primary",startContent:e.jsx(be,{className:"w-4 h-4"}),onPress:()=>E("add"),radius:l,style:{fontFamily:'var(--fontFamily, "Inter")'},className:"min-w-0",children:n?"Add":d==="admin"?"Add Admin":"Add User"}),d==="tenant"&&e.jsx(u,{size:n?"sm":"md",variant:"bordered",startContent:e.jsx(X,{className:"w-4 h-4"}),onPress:()=>E("invite"),radius:l,style:{background:"color-mix(in srgb, var(--theme-secondary) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-secondary) 30%, transparent)",color:"var(--theme-secondary)",fontFamily:'var(--fontFamily, "Inter")'},className:"min-w-0",children:n?"Invite":"Invite User"}),e.jsx(u,{size:n?"sm":"md",variant:"bordered",startContent:e.jsx(ae,{className:"w-4 h-4"}),onPress:()=>E("export"),radius:l,style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-primary) 30%, transparent)",color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},className:"min-w-0",children:n?"Export":"Export Users"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx(re,{size:n?"sm":"md",placeholder:"Search users...",value:g.search,onValueChange:s=>O("search",s),startContent:e.jsx(os,{className:"w-4 h-4 text-default-400"}),isClearable:!0,onClear:()=>O("search",""),radius:l,classNames:{inputWrapper:"bg-default-100"},className:"flex-1"}),e.jsx(z,{size:n?"sm":"md",placeholder:"All Roles",selectedKeys:g.role!=="all"?[g.role]:[],onSelectionChange:s=>O("role",Array.from(s)[0]||"all"),radius:l,classNames:{trigger:"bg-default-100"},className:"w-full md:w-48",children:x?.map(s=>e.jsx(F,{children:s.name||s},s.name||s))}),e.jsxs(z,{size:n?"sm":"md",placeholder:"All Status",selectedKeys:g.status!=="all"?[g.status]:[],onSelectionChange:s=>O("status",Array.from(s)[0]||"all"),radius:l,classNames:{trigger:"bg-default-100"},className:"w-full md:w-40",children:[e.jsx(F,{children:"Active"},"active"),e.jsx(F,{children:"Inactive"},"inactive")]}),d==="tenant"&&N&&N.length>0&&e.jsx(z,{size:n?"sm":"md",placeholder:"All Departments",selectedKeys:g.department!=="all"?[g.department]:[],onSelectionChange:s=>O("department",Array.from(s)[0]||"all"),radius:l,classNames:{trigger:"bg-default-100"},className:"w-full md:w-48",children:N?.map(s=>e.jsx(F,{children:s.name},String(s.id)))}),e.jsxs(ds,{size:n?"sm":"md",radius:l,children:[e.jsx(u,{isIconOnly:!0,variant:T==="table"?"solid":"bordered",color:T==="table"?"primary":"default",onPress:()=>ue("table"),children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsx(u,{isIconOnly:!0,variant:T==="grid"?"solid":"bordered",color:T==="grid"?"primary":"default",onPress:()=>ue("grid"),children:e.jsx(Ge,{className:"w-4 h-4"})})]})]})]})})}),e.jsxs(H,{className:"p-6",children:[e.jsx(Ze,{stats:De,className:"mb-6",isLoading:_}),d==="tenant"&&e.jsx(ws,{className:"mb-6",onInvitationAction:()=>{M(),R()}}),e.jsx("div",{className:"overflow-hidden",children:_?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(_e,{size:"lg"})}):T==="table"?e.jsx(ss,{allUsers:P.data,roles:x,setUsers:Q,isMobile:n,isTablet:v,pagination:b,onPageChange:he,onRowsPerPageChange:Ie,totalUsers:P.total,loading:_,onEdit:(s,t)=>{E(t==="lock"?"lock":"edit",s)},updateUserOptimized:$e,deleteUserOptimized:Ee,toggleUserStatusOptimized:ge,updateUserRolesOptimized:Ue,deviceActions:fe,context:d}):e.jsxs("div",{children:[P.data&&P.data.length>0?e.jsx("div",{className:`grid gap-4 ${n?"grid-cols-1":v?"grid-cols-2":"grid-cols-3 xl:grid-cols-4"}`,children:P.data.map((s,t)=>e.jsx(Le,{user:s,index:t},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"w-16 h-16 mx-auto text-default-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No users found"}),e.jsx("p",{className:"text-default-500 mb-4",children:"Try adjusting your search criteria or filters"}),e.jsx(u,{color:"primary",startContent:e.jsx(be,{className:"w-4 h-4"}),onPress:()=>E("add"),children:d==="admin"?"Add First Admin":"Add First User"})]}),P.data&&P.data.length>0&&e.jsx("div",{className:"flex justify-center mt-6 border-t pt-4",style:{borderColor:"var(--theme-divider, #E4E4E7)"},children:e.jsx(us,{total:Math.ceil(P.total/b.perPage),initialPage:b.currentPage,page:b.currentPage,onChange:he,size:n?"sm":"md",variant:"bordered",showControls:!0,radius:l,style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})})]})]})})})})})]})};Fs.layout=y=>e.jsx(Ye,{children:y});export{Fs as default};
