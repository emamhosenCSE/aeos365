import{r as c,j as e,R as pe,H as Hs,m as we,c as he,b as f,f as Qs,a as xe,d as y,s as Gs,e as F,A as Ve}from"./app-C5lQX7UO.js";import{S as Js}from"./StatsCards-CTmpIHZm.js";import{z as ee,o as Ce,B as Xs,d as Ue,t as Be,C as Ne,u as _e,D as Ge,f as Ys,E as Zs,A as et}from"./App-b0cSRXv4.js";import{s as p}from"./toastUtils-FOPlT_v5.js";import{F as ke}from"./DocumentIcon-BaxxzUaB.js";import{F as We}from"./ShieldCheckIcon-Lr4RcW0o.js";import{e as st,d as Se,a as Fe,b as Re,m as Me}from"./PlusIcon-hCCa9Avo.js";import{F as Ke}from"./MagnifyingGlassIcon-FD9b4416.js";import{F as tt}from"./CheckCircleIcon-BDeABBju.js";import{F as fe}from"./KeyIcon-BkwPixaL.js";import{F as at}from"./GlobeAltIcon-DSSOsrBF.js";import{c as Pe}from"./chunk-C6WKGNND-DE1NYqMQ.js";import{i as b}from"./chunk-SQIAVXJX-JCrnSLUk.js";import{s as se}from"./chunk-C3QHEOC2-C4U64fsk.js";import{l as D}from"./chunk-Y5DMIIWQ-CcWrQJnK.js";import{m as te,a as ae,b as re,c as ie}from"./chunk-TW2E3XVA-BpqqyJRF.js";import{s as Ae}from"./chunk-I3A4XRYQ-DAco9gg9.js";import{m as ne}from"./chunk-5LXTSPS7-5Ebaxja-.js";import{c as Q}from"./chunk-PMMJMDBI-C-cH3j7I.js";import{t as He}from"./chunk-AUA5GDXN-BfGxDRDE.js";import"./app-Bq-q9uAS.js";import"./chunk-P7ACKWSP-DGs9qwdH.js";import"./index-BeiV6kVn.js";/* empty css                      */import"./routeUtils-Dar4FrIb.js";import"./chunk-CV4BWJDJ-C2siGNsy.js";import"./index-DhmF-6Cs.js";import"./index-BXRhekn9.js";import"./UserIcon-Bny3-uxA.js";import"./Cog6ToothIcon-BxIVzCrx.js";import"./useBranding-BdLeVaZK.js";import"./useDialog-CPcCu8EE.js";import"./VisuallyHidden-BIYdY5qX.js";import"./keyboard-BROQwhc4.js";import"./useLabels-BSPM8vAp.js";import"./index-CZEthvtF.js";import"./XMarkIcon-67ql1OSv.js";import"./useMediaQuery-DKZmmC24.js";import"./chunk-IHO36JMK-C2CY5vR0.js";import"./AcademicCapIcon-qLTocPBU.js";import"./IdentificationIcon-DDN2LgD3.js";import"./ArrowLeftIcon-CEF9dMYC.js";import"./ArrowRightIcon-D5L4KbEU.js";import"./BriefcaseIcon-MCw9JH5Q.js";import"./BuildingOfficeIcon-DHDfq3Il.js";import"./CalendarDaysIcon-B0vwq9qL.js";import"./CalendarIcon-DLOXfZsM.js";import"./CircleStackIcon-Bn_usKCe.js";import"./ClipboardDocumentCheckIcon-DbCJJdKR.js";import"./CogIcon-Bp9coc2a.js";import"./DeviceTabletIcon-DzmMmOeR.js";import"./CpuChipIcon-Do_08dh9.js";import"./CurrencyDollarIcon-BeQq8PBJ.js";import"./DevicePhoneMobileIcon-CaXezoVt.js";import"./DocumentArrowUpIcon-CUP7Txvb.js";import"./EnvelopeIcon-BV7JE3W8.js";import"./ExclamationCircleIcon-FoF6j9gu.js";import"./EyeIcon-1Rngeclu.js";import"./InformationCircleIcon-CvrzIYvC.js";import"./LockClosedIcon-CBY3J_Eq.js";import"./MapPinIcon-C1ZKJRuX.js";import"./PlusCircleIcon-BOXDRGJR.js";import"./PrinterIcon-BkL3DXP0.js";import"./RocketLaunchIcon-oIcFgtS_.js";import"./ShoppingCartIcon-CTTedb3q.js";import"./UserCircleIcon-CGukKXVi.js";import"./UserGroupIcon-BUxfF95Y.js";import"./MaintenanceModeBanner-WmsYYFVK.js";import"./Item-Cf2efc_s.js";import"./SelectionManager-DOykb5Zn.js";import"./chunk-WQVQ7P2I-Das5P9Cf.js";import"./number-CB4zbwAz.js";import"./index-DuvEf_dB.js";import"./useSelectableItem-D9HgBYPJ.js";import"./useTreeState-7-jX6Eit.js";import"./useMenuTriggerState-Bm6SXfn-.js";import"./chunk-LGMZDQT5-JOtjRivx.js";import"./chunk-KQW2TNLT-FgiaJ7J5.js";import"./chunk-ICU6NNET-KTThvCTm.js";import"./useLabel-BcTiTZIt.js";import"./chunk-7F3ZLNJ6-DwE1PLMW.js";import"./index-DeaY2kDj.js";import"./useToggleState-BJ_Q2hhA.js";import"./index-CI4LZYcs.js";const rt={page:e.jsx(ke,{className:"w-4 h-4"}),section:e.jsx(Zs,{className:"w-4 h-4"}),widget:e.jsx(Ys,{className:"w-4 h-4"}),action:e.jsx(Ge,{className:"w-4 h-4"}),api:e.jsx(at,{className:"w-4 h-4"})},Qe={page:"primary",section:"secondary",widget:"success",action:"warning",api:"danger"},it={platform_core:"danger",core_system:"primary",self_service:"secondary",human_resources:"success",project_management:"warning",document_management:"default",customer_relations:"primary",supply_chain:"secondary",retail_sales:"success",financial_management:"warning",system_administration:"danger"},Ee={view:{label:"View",description:"Can view/read data"},create:{label:"Create",description:"Can create new records"},update:{label:"Edit",description:"Can modify existing records"},delete:{label:"Delete",description:"Can remove records"},import:{label:"Import",description:"Can import data from files"},export:{label:"Export",description:"Can export data to files"},approve:{label:"Approve",description:"Can approve requests"},assign:{label:"Assign",description:"Can assign to users"},manage:{label:"Manage",description:"Full management access"},operate:{label:"Operate",description:"Can operate/execute"},punch:{label:"Punch",description:"Can punch attendance"},change:{label:"Change",description:"Can change settings"},impersonate:{label:"Impersonate",description:"Can act as another user"},analytics:{label:"Analytics",description:"Can view analytics"},settings:{label:"Settings",description:"Can configure settings"},log:{label:"Log",description:"Can view logs"},schedule:{label:"Schedule",description:"Can manage schedules"},restore:{label:"Restore",description:"Can restore data"},own:{label:"Own",description:"Access to own records only"}},Je=g=>g.split("-").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" "),nt=g=>{const u=g.split(".");if(u.length>=2){const R=Je(u[0]),C=u[1];if(u.length>=3&&C==="own"){const G=u[2];return`${(Ee[G]||{label:G.charAt(0).toUpperCase()+G.slice(1)}).label} Own ${R}`}return`${(Ee[C]||{label:C.charAt(0).toUpperCase()+C.slice(1)}).label} ${R}`}return g},ot=g=>{const u=g.split(".");if(u.length>=2){const R=u.length>=3&&u[1]==="own"?u[2]:u[1];return Ee[R]?.description||`Permission for ${g}`}return`Permission for ${g}`},lt=g=>{const u={};g.forEach(_=>{const $=_.name.split(".")[0];u[$]||(u[$]={name:Je($),permissions:[]}),u[$].permissions.push({..._,displayName:nt(_.name),description:ot(_.name)})});const R=Object.keys(u).sort(),C={};return R.forEach(_=>{C[_]=u[_]}),C},ct=(g,u)=>{const[R,C]=c.useState(g);return c.useEffect(()=>{const _=setTimeout(()=>{C(g)},u);return()=>clearTimeout(_)},[g,u]),R},dt=g=>{const{modules:u=[],roles:R=[],permissions:C=[],statistics:_={},accessScopes:G={all:"Full Access",own:"Own Only",team:"Team",department:"Department"},categories:$={},componentTypes:Xe={},title:Ye="Module Permission Registry",readonly:mt=!1,is_platform_context:Ze=!1,can_manage_structure:es=!1}=g,T=Ze,J=es,ze=()=>"/modules",N=(s,t=null)=>{if(T){const a=s.replace("modules.","admin.modules.");return t?route(a,t):route(a)}return t?route(s,t):route(s)},[W,ss]=c.useState(u),[k,ts]=c.useState(_),[I,S]=c.useState(!1),[$e,as]=c.useState(""),[oe,rs]=c.useState("all"),[X,is]=c.useState("all"),[ns,os]=c.useState(new Set),[ls,cs]=c.useState(new Set),[O,ut]=c.useState(R),[h,ds]=c.useState(null),[x,E]=c.useState({modules:[],sub_modules:[],components:[],actions:[]}),[ms,Oe]=c.useState(!1),[us,qe]=c.useState(!1),[pt,ht]=c.useState(!0),[ps,le]=c.useState(!1),[hs,ge]=c.useState(!1),[xs,je]=c.useState(!1),[fs,ce]=c.useState(!1),[gs,be]=c.useState(!1),[de,De]=c.useState(null),[me,xt]=c.useState(null),[ue,ft]=c.useState(null),[js,gt]=c.useState(null),[bs,jt]=c.useState(null),[M,vs]=c.useState(null),[L,ys]=c.useState(null),[j,P]=c.useState({code:"",name:"",description:"",icon:"",category:"core_system",route_prefix:"",is_active:!0,priority:100}),[v,V]=c.useState({code:"",name:"",description:"",icon:"",route:"",is_active:!0,priority:100}),[w,K]=c.useState({code:"",name:"",description:"",type:"page",route:"",is_active:!0}),[A,z]=c.useState([]),Y=ct($e,300),ve=c.useMemo(()=>W.filter(s=>{const t=!Y||s.name.toLowerCase().includes(Y.toLowerCase())||s.code.toLowerCase().includes(Y.toLowerCase())||s.description?.toLowerCase().includes(Y.toLowerCase()),a=oe==="all"||s.category===oe,o=X==="all"||X==="active"&&s.is_active||X==="inactive"&&!s.is_active;return t&&a&&o}),[W,Y,oe,X]);c.useMemo(()=>[{title:"Total Modules",value:k.total_modules||0,icon:e.jsx(ee,{className:"w-6 h-6"}),color:"primary",description:"Top-level modules"},{title:"Sub-Modules",value:k.total_sub_modules||0,icon:e.jsx(Ce,{className:"w-6 h-6"}),color:"secondary",description:"Functional areas"},{title:"Components",value:k.total_components||0,icon:e.jsx(ke,{className:"w-6 h-6"}),color:"success",description:"UI components"},{title:"Permission Rules",value:k.total_permission_requirements||0,icon:e.jsx(We,{className:"w-6 h-6"}),color:"warning",description:"Access requirements"}],[k]);const Te=s=>{os(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},Ie=s=>{cs(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},H=async()=>{S(!0);try{const s=await F.get(N("modules.api.index"));ss(s.data.modules||[]),ts(s.data.statistics||{}),p.success("Data refreshed successfully")}catch(s){p.error("Failed to refresh data"),console.error("Refresh error:",s)}finally{S(!1)}},ws=async s=>{if(!s){E({modules:[],sub_modules:[],components:[],actions:[]});return}Oe(!0);try{const t=await F.get(`${ze()}/role-access/${s}`);E(t.data.access||{modules:[],sub_modules:[],components:[],actions:[]})}catch(t){console.error("Failed to load role access:",t),p.error("Failed to load role access"),E({modules:[],sub_modules:[],components:[],actions:[]})}finally{Oe(!1)}},Cs=s=>{const t=Array.from(s)[0];ds(t?parseInt(t):null),t?ws(parseInt(t)):E({modules:[],sub_modules:[],components:[],actions:[]})},Le=s=>x.modules.includes(s),Ns=(s,t)=>x.modules.includes(t)||x.sub_modules.includes(s),_s=(s,t,a)=>x.modules.includes(a)||x.sub_modules.includes(t)||x.components.includes(s),Ss=(s,t,a,o)=>x.modules.includes(o)||x.sub_modules.includes(a)||x.components.includes(t)||x.actions.some(r=>r.id===s||r===s),Fs=s=>x.modules.includes(s.id)?!1:s.sub_modules?.some(a=>x.sub_modules.includes(a.id)||a.components?.some(o=>x.components.includes(o.id)||o.actions?.some(r=>x.actions.some(i=>i.id===r.id||i===r.id)))),Rs=(s,t)=>{E(a=>{const o={...a};if(t){o.modules.includes(s)||(o.modules=[...o.modules,s]);const r=W.find(i=>i.id===s);if(r){const i=r.sub_modules?.map(m=>m.id)||[],n=r.sub_modules?.flatMap(m=>m.components?.map(d=>d.id)||[])||[],l=r.sub_modules?.flatMap(m=>m.components?.flatMap(d=>d.actions?.map(B=>B.id)||[])||[])||[];o.sub_modules=o.sub_modules.filter(m=>!i.includes(m)),o.components=o.components.filter(m=>!n.includes(m)),o.actions=o.actions.filter(m=>!l.includes(m.id||m))}}else o.modules=o.modules.filter(r=>r!==s);return o})},Ms=(s,t,a)=>{E(o=>{const r={...o};if(o.modules.includes(t)){if(!a){r.modules=r.modules.filter(n=>n!==t);const i=W.find(n=>n.id===t);if(i){const n=i.sub_modules?.filter(l=>l.id!==s).map(l=>l.id)||[];r.sub_modules=[...new Set([...r.sub_modules,...n])]}}return r}if(a){r.sub_modules.includes(s)||(r.sub_modules=[...r.sub_modules,s]);const n=W.find(l=>l.id===t)?.sub_modules?.find(l=>l.id===s);if(n){const l=n.components?.map(d=>d.id)||[],m=n.components?.flatMap(d=>d.actions?.map(B=>B.id)||[])||[];r.components=r.components.filter(d=>!l.includes(d)),r.actions=r.actions.filter(d=>!m.includes(d.id||d))}}else r.sub_modules=r.sub_modules.filter(i=>i!==s);return r})},Ps=(s,t,a,o)=>{E(r=>{const i={...r};if(r.modules.includes(a)||r.sub_modules.includes(t)){if(!o&&r.sub_modules.includes(t)){i.sub_modules=i.sub_modules.filter(d=>d!==t);const m=W.find(d=>d.id===a)?.sub_modules?.find(d=>d.id===t)?.components?.filter(d=>d.id!==s).map(d=>d.id)||[];i.components=[...new Set([...i.components,...m])]}return i}return o?i.components.includes(s)||(i.components=[...i.components,s]):i.components=i.components.filter(n=>n!==s),i})},As=(s,t,a,o,r,i="all")=>{E(n=>{const l={...n};return n.modules.includes(o)||n.sub_modules.includes(a)||n.components.includes(t)||(r?l.actions.findIndex(d=>d.id===s||d===s)===-1&&(l.actions=[...l.actions,{id:s,scope:i}]):l.actions=l.actions.filter(m=>(m.id||m)!==s)),l})},ks=async()=>{if(!h){p.error("Please select a role first");return}if(O.find(a=>a.id===h)?.is_protected){p.error("Cannot modify access for protected roles");return}qe(!0);const t=new Promise(async(a,o)=>{try{const r=await F.post(`${ze()}/role-access/${h}/sync`,x);r.data.access&&E(r.data.access),a([r.data.message||"Role access updated successfully"])}catch(r){console.error("Failed to save role access:",r),o(r.response?.data?.error||"Failed to save role access")}finally{qe(!1)}});p.promise(t,{loading:"Saving role access...",success:a=>a.join(", "),error:a=>a})},Es=(s=null)=>{s?(De(s),P({code:s.code,name:s.name,description:s.description||"",icon:s.icon||"",category:s.category||"core_system",route_prefix:s.route_prefix||"",is_active:s.is_active,priority:s.priority||100})):(De(null),P({code:"",name:"",description:"",icon:"",category:"core_system",route_prefix:"",is_active:!0,priority:100})),le(!0)},ye=s=>{ys(s);const a=(s.permission_requirements||s.permissionRequirements||[]).map(o=>Number(o.permission_id));z(a),ce(!0)},zs=async()=>{if(!J){p.error("Module structure can only be managed from platform admin");return}S(!0);try{de?(await F.put(N("modules.update",de.id),j),p.success("Module updated successfully")):(await F.post(N("modules.store"),j),p.success("Module created successfully")),le(!1),H()}catch(s){p.error(s.response?.data?.message||"Failed to save module")}finally{S(!1)}},$s=async()=>{if(!J){p.error("Module structure can only be managed from platform admin");return}S(!0);try{me?(await F.put(N("modules.sub-modules.update",me.id),v),p.success("Sub-module updated successfully")):(await F.post(N("modules.sub-modules.store",js),v),p.success("Sub-module created successfully")),ge(!1),H()}catch(s){p.error(s.response?.data?.message||"Failed to save sub-module")}finally{S(!1)}},Os=async()=>{if(!J){p.error("Module structure can only be managed from platform admin");return}S(!0);try{ue?(await F.put(N("modules.components.update",ue.id),w),p.success("Component updated successfully")):(await F.post(N("modules.components.store",bs),w),p.success("Component created successfully")),je(!1),H()}catch(s){p.error(s.response?.data?.message||"Failed to save component")}finally{S(!1)}},qs=async()=>{if(T){p.error("Permission requirements are managed per-tenant. Switch to a tenant context.");return}S(!0);try{let s;L.type==="module"?s=N("modules.sync-permissions",L.id):L.type==="sub_module"?s=N("modules.sub-modules.sync-permissions",L.id):s=N("modules.components.sync-permissions",L.id);const t=A.map(o=>({permission:C.find(i=>i.id===o)?.name||"",type:"required",group:null})).filter(o=>o.permission),a=await F.post(s,{permissions:t});p.success("Permissions updated successfully"),ce(!1),H()}catch(s){console.error("Error saving permissions:",s),console.error("Error response:",s.response?.data);const t=s.response?.data?.errors?Object.values(s.response.data.errors).flat().join(", "):s.response?.data?.message||"Failed to save permissions";p.error(t)}finally{S(!1)}},Ds=async()=>{if(M){if(!J){p.error("Module structure can only be managed from platform admin");return}S(!0);try{let s;M.type==="module"?s=N("modules.destroy",M.id):M.type==="sub_module"?s=N("modules.sub-modules.destroy",M.id):s=N("modules.components.destroy",M.id),await F.delete(s),p.success(`${M.type.replace("_"," ")} deleted successfully`),be(!1),vs(null),H()}catch(s){p.error(s.response?.data?.message||"Failed to delete")}finally{S(!1)}}},Ts=s=>{const t=ns.has(s.id),a=s.sub_modules||[],o=s.permission_requirements?.length||0,r=h&&O.find(i=>i.id===h)?.is_protected;return e.jsx(he,{className:"mb-3",children:e.jsxs(xe,{className:"p-0",children:[e.jsxs("div",{className:`flex items-center justify-between p-4 cursor-pointer hover:bg-default-100 transition-colors ${s.is_active?"":"opacity-60"}`,onClick:()=>Te(s.id),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[h&&e.jsx(Q,{isSelected:Le(s.id)||r,isIndeterminate:!Le(s.id)&&Fs(s),isDisabled:r,onValueChange:i=>Rs(s.id,i),onClick:i=>i.stopPropagation(),color:"primary",size:"lg"}),e.jsx(f,{isIconOnly:!0,size:"sm",variant:"light",onClick:i=>{i.stopPropagation(),Te(s.id)},children:t?e.jsx(Ue,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})}),e.jsx(ee,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:s.name}),e.jsx(y,{size:"sm",variant:"flat",color:it[s.category]||"default",children:s.code}),!s.is_active&&e.jsx(y,{size:"sm",variant:"flat",color:"danger",children:"Inactive"})]}),e.jsx("p",{className:"text-sm text-default-500 mt-1",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{content:a.length,color:"primary",size:"sm",children:e.jsx(y,{size:"sm",variant:"bordered",children:"Sub-modules"})}),e.jsx(Ne,{content:o,color:"warning",size:"sm",children:e.jsx(y,{size:"sm",variant:"bordered",children:"Permissions"})}),e.jsxs(Se,{children:[e.jsx(Fe,{children:e.jsx(f,{isIconOnly:!0,size:"sm",variant:"light",onClick:i=>i.stopPropagation(),children:e.jsx(_e,{className:"w-5 h-5"})})}),e.jsx(Re,{children:e.jsx(Me,{startContent:e.jsx(fe,{className:"w-4 h-4"}),onClick:()=>ye({...s,type:"module"}),children:T?"View Required Permissions":"Manage Permissions"},"permissions")})]})]})]}),e.jsx(Ve,{children:t&&a.length>0&&e.jsx(we.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"border-t border-default-200",children:e.jsx("div",{className:"pl-8 py-2",children:a.map(i=>Is(i,s.id))})})})]})},s.id)},Is=(s,t)=>{const a=ls.has(s.id),o=s.components||[];s.permission_requirements?.length;const r=h&&O.find(n=>n.id===h)?.is_protected,i=x.modules.includes(t);return e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg bg-default-50 hover:bg-default-100 cursor-pointer transition-colors ${s.is_active?"":"opacity-60"}`,onClick:()=>Ie(s.id),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[h&&e.jsx(Q,{isSelected:Ns(s.id,t)||r,isDisabled:r||i,onValueChange:n=>Ms(s.id,t,n),onClick:n=>n.stopPropagation(),color:"secondary",size:"md"}),e.jsx(f,{isIconOnly:!0,size:"sm",variant:"light",onClick:n=>{n.stopPropagation(),Ie(s.id)},children:a?e.jsx(Ue,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})}),e.jsx(Ce,{className:"w-5 h-5 text-secondary"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(y,{size:"sm",variant:"flat",color:"secondary",children:s.code}),!s.is_active&&e.jsx(y,{size:"sm",variant:"flat",color:"danger",children:"Inactive"})]}),s.description&&e.jsx("p",{className:"text-xs text-default-400 mt-0.5",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{content:o.length,color:"success",size:"sm",children:e.jsx(y,{size:"sm",variant:"bordered",children:"Components"})}),e.jsxs(Se,{children:[e.jsx(Fe,{children:e.jsx(f,{isIconOnly:!0,size:"sm",variant:"light",onClick:n=>n.stopPropagation(),children:e.jsx(_e,{className:"w-4 h-4"})})}),e.jsx(Re,{children:e.jsx(Me,{startContent:e.jsx(fe,{className:"w-4 h-4"}),onClick:()=>ye({...s,type:"sub_module"}),children:T?"View Required Permissions":"Manage Permissions"},"permissions")})]})]})]}),e.jsx(Ve,{children:a&&o.length>0&&e.jsx(we.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"pl-10 mt-2",children:o.map(n=>Ls(n,s.id,t))})})]},s.id)},Ls=(s,t,a)=>{const o=s.permission_requirements?.length||0,r=s.actions||[],i=h&&O.find(l=>l.id===h)?.is_protected,n=x.modules.includes(a)||x.sub_modules.includes(t);return e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:`flex items-center justify-between p-2 rounded-md bg-default-100 hover:bg-default-200 transition-colors ${s.is_active?"":"opacity-60"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[h&&e.jsx(Q,{isSelected:_s(s.id,t,a)||i,isDisabled:i||n,onValueChange:l=>Ps(s.id,t,a,l),color:"success",size:"sm"}),e.jsx(He,{content:s.type,children:e.jsx("span",{className:`text-${Qe[s.type]}`,children:rt[s.type]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsx(y,{size:"sm",variant:"flat",color:Qe[s.type],children:s.type}),s.route&&e.jsx(y,{size:"sm",variant:"bordered",color:"default",children:s.route}),r.length>0&&e.jsxs(y,{size:"sm",variant:"flat",color:"secondary",children:[r.length," actions"]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o>0&&e.jsxs(y,{size:"sm",variant:"flat",color:"warning",children:[o," perms"]}),e.jsxs(Se,{children:[e.jsx(Fe,{children:e.jsx(f,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(_e,{className:"w-4 h-4"})})}),e.jsx(Re,{children:e.jsx(Me,{startContent:e.jsx(fe,{className:"w-4 h-4"}),onClick:()=>ye({...s,type:"component"}),children:T?"View Required Permissions":"Manage Permissions"},"permissions")})]})]})]}),r.length>0&&e.jsx("div",{className:"ml-8 mt-1 space-y-1",children:r.map((l,m)=>{const d=x.modules.includes(a)||x.sub_modules.includes(t)||x.components.includes(s.id);return e.jsxs("div",{className:"flex items-center justify-between p-1.5 pl-3 rounded bg-default-50 hover:bg-default-100 transition-colors text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsx(Q,{isSelected:Ss(l.id,s.id,t,a)||i,isDisabled:i||d,onValueChange:B=>As(l.id,s.id,t,a,B),color:"warning",size:"sm"}),e.jsx(Ge,{className:"w-3 h-3 text-default-400"}),e.jsx("span",{className:"text-default-700",children:l.name}),e.jsx(y,{size:"sm",variant:"dot",color:"secondary",className:"text-xs",children:l.code})]}),e.jsx("div",{className:"flex items-center gap-1",children:l.default_required_permissions?.length>0&&e.jsx(He,{content:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Required Permissions:"}),l.default_required_permissions.map((B,Ks)=>e.jsxs("div",{children:["â€¢ ",B]},Ks))]}),children:e.jsxs(y,{size:"sm",variant:"flat",color:"warning",className:"text-xs",children:[l.default_required_permissions.length," perms"]})})})]},l.code||m)})})]},s.id)},q=()=>{if(typeof window>"u")return"lg";const t=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",a=parseInt(t);return a===0?"none":a<=4?"sm":a<=8?"md":a<=16?"lg":"full"},[U,Vs]=pe.useState(!1),[Us,Bs]=pe.useState(!1),[Z,Ws]=pe.useState(!1);return pe.useEffect(()=>{const s=()=>{Vs(window.innerWidth<640),Bs(window.innerWidth<768),Ws(window.innerWidth>=1025)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),e.jsxs(e.Fragment,{children:[e.jsx(Hs,{title:Ye}),e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"Module Permission Registry",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(we.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(he,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                                        var(--theme-content1, #FAFAFA) 20%, 
                                        var(--theme-content2, #F4F4F5) 10%, 
                                        var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(Pe,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                            color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                            color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${Z?"p-6":Us?"p-4":U?"p-3":"p-4"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                            ${Z?"p-3":U?"p-2":"p-2.5"} 
                                                            rounded-xl flex items-center justify-center
                                                        `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(Xs,{className:`
                                                                ${Z?"w-8 h-8":U?"w-5 h-5":"w-6 h-6"}
                                                            `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                                ${Z?"text-2xl":U?"text-lg":"text-xl"}
                                                                font-bold text-foreground
                                                                ${U?"truncate":""}
                                                            `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:T?"Platform Module Management":"Module Permission Management"}),e.jsx("p",{className:`
                                                                ${Z?"text-sm":"text-xs"} 
                                                                text-default-500
                                                                ${U?"truncate":""}
                                                            `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:T?"Manage module structure, sub-modules, and components":"Manage module permissions and access control hierarchy"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(f,{className:"font-medium",style:{background:"color-mix(in srgb, var(--theme-default) 15%, transparent)",color:"var(--theme-foreground)",borderRadius:q(),border:"1px solid color-mix(in srgb, var(--theme-default) 30%, transparent)"},startContent:e.jsx(Qs,{className:"w-4 h-4"}),onPress:H,isLoading:I,children:"Refresh"}),J&&e.jsx(f,{className:"text-white font-medium",style:{background:"linear-gradient(135deg, var(--theme-primary), color-mix(in srgb, var(--theme-primary) 80%, var(--theme-secondary)))",borderRadius:q()},startContent:e.jsx(st,{className:"w-4 h-4"}),onPress:()=>Es(),children:U?"Add":"Add Module"})]})]})})})}),e.jsxs(xe,{className:"p-6",children:[e.jsx(Js,{stats:[{title:"Total Modules",value:k.total_modules||0,icon:e.jsx(ee,{className:"w-6 h-6"}),color:"text-blue-500",iconBg:"bg-blue-500/20",description:"Top-level modules"},{title:"Sub-Modules",value:k.total_sub_modules||0,icon:e.jsx(Ce,{className:"w-6 h-6"}),color:"text-purple-500",iconBg:"bg-purple-500/20",description:"Functional areas"},{title:"Components",value:k.total_components||0,icon:e.jsx(ke,{className:"w-6 h-6"}),color:"text-green-500",iconBg:"bg-green-500/20",description:"UI components"},{title:"Permission Rules",value:k.total_permission_requirements||0,icon:e.jsx(We,{className:"w-6 h-6"}),color:"text-orange-500",iconBg:"bg-orange-500/20",description:"Access requirements"}],className:"mb-6"}),e.jsx("div",{className:"mb-6 p-4",style:{background:"color-mix(in srgb, var(--theme-content2) 50%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)",borderRadius:q(),backdropFilter:"blur(16px)"},children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(b,{placeholder:"Search modules...",value:$e,onChange:s=>as(s.target.value),startContent:e.jsx(Ke,{className:"w-4 h-4 text-default-400"}),className:"flex-1",variant:"bordered",radius:q(),classNames:{inputWrapper:"bg-white/50 dark:bg-default-50/10 backdrop-blur-md border-default-200/30",input:"text-foreground placeholder:text-default-400"}}),e.jsxs(se,{label:"Category",selectedKeys:[oe],onChange:s=>rs(s.target.value),className:"w-full sm:w-48",variant:"bordered",radius:q(),classNames:{trigger:"bg-white/50 dark:bg-default-50/10 backdrop-blur-md border-default-200/30",value:"text-foreground"},children:[e.jsx(D,{value:"all",children:"All Categories"},"all"),Object.entries($).map(([s,t])=>e.jsx(D,{value:s,children:t},s))]}),e.jsxs(se,{label:"Status",selectedKeys:[X],onChange:s=>is(s.target.value),className:"w-full sm:w-36",variant:"bordered",radius:q(),classNames:{trigger:"bg-white/50 dark:bg-default-50/10 backdrop-blur-md border-default-200/30",value:"text-foreground"},children:[e.jsx(D,{value:"all",children:"All"},"all"),e.jsx(D,{value:"active",children:"Active"},"active"),e.jsx(D,{value:"inactive",children:"Inactive"},"inactive")]})]})}),e.jsxs(he,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                                                var(--theme-content1, #FAFAFA) 20%, 
                                                var(--theme-content2, #F4F4F5) 10%, 
                                                var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsxs(Pe,{className:"flex justify-between items-center border-b pb-2",style:{borderColor:"var(--theme-divider, #E4E4E7)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg flex items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)"},children:e.jsx(ee,{className:"w-6 h-6",style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Module Access Management"}),e.jsxs("p",{className:"text-xs text-default-500",children:[ve.length," modules available"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{label:"Select Role",placeholder:"Choose a role",selectedKeys:h?[String(h)]:[],onSelectionChange:Cs,className:"w-56",variant:"bordered",size:"sm",radius:q(),isLoading:ms,classNames:{trigger:"bg-white/50 dark:bg-default-50/10 backdrop-blur-md border-default-200/30",value:"text-foreground"},children:O.map(s=>e.jsx(D,{value:String(s.id),description:s.is_protected?"Full access (protected)":null,children:s.name},String(s.id)))}),h&&!O.find(s=>s.id===h)?.is_protected&&e.jsx(f,{color:"primary",variant:"solid",size:"sm",onPress:ks,isLoading:us,style:{background:"linear-gradient(135deg, var(--theme-primary), color-mix(in srgb, var(--theme-primary) 80%, var(--theme-secondary)))",borderRadius:q()},children:"Save Access"})]})]}),e.jsxs(xe,{children:[h&&!O.find(s=>s.id===h)?.is_protected&&e.jsxs("div",{className:"mb-4 text-sm text-default-500 flex items-center gap-2",children:[e.jsx(y,{size:"sm",color:"primary",variant:"flat",children:"Tip"}),e.jsx("span",{children:"Check a parent item (module/sub-module) to grant access to all its children."})]}),h&&O.find(s=>s.id===h)?.is_protected?e.jsxs("div",{className:"text-center py-8 text-success",children:[e.jsx(tt,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{className:"font-semibold",children:"This role has full system access"}),e.jsx("p",{className:"text-sm mt-2 text-default-500",children:"Protected roles automatically have access to all modules"})]}):I?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(Gs,{size:"lg"})}):ve.length===0?e.jsxs("div",{className:"text-center py-12 text-default-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No modules found"})]}):e.jsx("div",{className:"space-y-2",children:ve.map(s=>Ts(s))})]})]})]})]})})})})}),e.jsx(te,{isOpen:ps,onClose:()=>le(!1),size:"2xl",children:e.jsxs(ae,{children:[e.jsx(re,{children:de?"Edit Module":"Create New Module"}),e.jsx(ie,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{label:"Code",placeholder:"MODULE_CODE",value:j.code,onChange:s=>P({...j,code:s.target.value.toUpperCase()}),isRequired:!0}),e.jsx(b,{label:"Name",placeholder:"Module Name",value:j.name,onChange:s=>P({...j,name:s.target.value}),isRequired:!0}),e.jsx(b,{label:"Icon",placeholder:"Icon class name",value:j.icon,onChange:s=>P({...j,icon:s.target.value}),className:"col-span-2"}),e.jsx(b,{label:"Route Prefix",placeholder:"/module-route",value:j.route_prefix,onChange:s=>P({...j,route_prefix:s.target.value})}),e.jsx(se,{label:"Category",selectedKeys:[j.category],onChange:s=>P({...j,category:s.target.value}),children:Object.entries($).map(([s,t])=>e.jsx(D,{value:s,children:t},s))}),e.jsx(b,{label:"Priority",type:"number",value:j.priority,onChange:s=>P({...j,priority:parseInt(s.target.value)})}),e.jsx("div",{className:"flex items-center",children:e.jsx(Ae,{isSelected:j.is_active,onValueChange:s=>P({...j,is_active:s}),children:"Active"})}),e.jsx(b,{label:"Description",placeholder:"Module description",value:j.description,onChange:s=>P({...j,description:s.target.value}),className:"col-span-2"})]})}),e.jsxs(ne,{children:[e.jsx(f,{variant:"flat",onClick:()=>le(!1),children:"Cancel"}),e.jsx(f,{color:"primary",onClick:zs,isLoading:I,children:de?"Update":"Create"})]})]})}),e.jsx(te,{isOpen:hs,onClose:()=>ge(!1),size:"xl",children:e.jsxs(ae,{children:[e.jsx(re,{children:me?"Edit Sub-Module":"Create New Sub-Module"}),e.jsx(ie,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{label:"Code",placeholder:"SUBMODULE_CODE",value:v.code,onChange:s=>V({...v,code:s.target.value.toUpperCase()}),isRequired:!0}),e.jsx(b,{label:"Name",placeholder:"Sub-Module Name",value:v.name,onChange:s=>V({...v,name:s.target.value}),isRequired:!0}),e.jsx(b,{label:"Icon",placeholder:"Icon class name",value:v.icon,onChange:s=>V({...v,icon:s.target.value})}),e.jsx(b,{label:"Route",placeholder:"Named route",value:v.route,onChange:s=>V({...v,route:s.target.value})}),e.jsx(b,{label:"Priority",type:"number",value:v.priority,onChange:s=>V({...v,priority:parseInt(s.target.value)})}),e.jsx("div",{className:"flex items-center",children:e.jsx(Ae,{isSelected:v.is_active,onValueChange:s=>V({...v,is_active:s}),children:"Active"})}),e.jsx(b,{label:"Description",placeholder:"Sub-module description",value:v.description,onChange:s=>V({...v,description:s.target.value}),className:"col-span-2"})]})}),e.jsxs(ne,{children:[e.jsx(f,{variant:"flat",onClick:()=>ge(!1),children:"Cancel"}),e.jsx(f,{color:"primary",onClick:$s,isLoading:I,children:me?"Update":"Create"})]})]})}),e.jsx(te,{isOpen:xs,onClose:()=>je(!1),size:"xl",children:e.jsxs(ae,{children:[e.jsx(re,{children:ue?"Edit Component":"Create New Component"}),e.jsx(ie,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{label:"Code",placeholder:"COMPONENT_CODE",value:w.code,onChange:s=>K({...w,code:s.target.value.toUpperCase()}),isRequired:!0}),e.jsx(b,{label:"Name",placeholder:"Component Name",value:w.name,onChange:s=>K({...w,name:s.target.value}),isRequired:!0}),e.jsx(se,{label:"Type",selectedKeys:[w.type],onChange:s=>K({...w,type:s.target.value}),children:Object.entries(Xe).map(([s,t])=>e.jsx(D,{value:s,children:t},s))}),e.jsx(b,{label:"Route",placeholder:"Named route",value:w.route,onChange:s=>K({...w,route:s.target.value})}),e.jsx("div",{className:"flex items-center col-span-2",children:e.jsx(Ae,{isSelected:w.is_active,onValueChange:s=>K({...w,is_active:s}),children:"Active"})}),e.jsx(b,{label:"Description",placeholder:"Component description",value:w.description,onChange:s=>K({...w,description:s.target.value}),className:"col-span-2"})]})}),e.jsxs(ne,{children:[e.jsx(f,{variant:"flat",onClick:()=>je(!1),children:"Cancel"}),e.jsx(f,{color:"primary",onClick:Os,isLoading:I,children:ue?"Update":"Create"})]})]})}),e.jsx(te,{isOpen:fs,onClose:()=>ce(!1),size:"4xl",scrollBehavior:"inside",children:e.jsxs(ae,{children:[e.jsx(re,{className:"flex flex-col gap-1",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-primary"}),"Manage Permissions - ",L?.name]})}),e.jsxs(ie,{children:[e.jsxs("p",{className:"text-sm text-default-500 mb-4",children:["Select the permissions required to access this ",L?.type?.replace("_","-"),"."]}),e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-4",children:[e.jsx(b,{placeholder:"Search permissions...",startContent:e.jsx(Ke,{className:"w-4 h-4 text-default-400"}),size:"sm",className:"max-w-xs",id:"permission-search",onValueChange:s=>{document.getElementById("permission-search")?.setAttribute("data-search",s.toLowerCase()),document.dispatchEvent(new CustomEvent("permission-search-change"))}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{size:"sm",variant:"flat",color:"primary",onPress:()=>z(C.map(s=>s.id)),children:"Select All"}),e.jsx(f,{size:"sm",variant:"flat",onPress:()=>z([]),children:"Clear All"})]})]}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:Object.entries(lt(C)).map(([s,t])=>{const a=t.permissions.map(n=>n.id),o=a.filter(n=>A.includes(n)).length,r=o===a.length,i=o>0&&o<a.length;return e.jsxs(he,{className:"bg-default-50 dark:bg-default-100/10",children:[e.jsx(Pe,{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{isSelected:r,isIndeterminate:i,onValueChange:n=>{z(n?l=>[...new Set([...l,...a])]:l=>l.filter(m=>!a.includes(m)))},size:"sm"}),e.jsx("span",{className:"font-semibold text-foreground",children:t.name})]}),e.jsxs(y,{size:"sm",variant:"flat",color:r?"success":i?"warning":"default",children:[o,"/",a.length]})]})}),e.jsx(xe,{className:"pt-0 pb-3 px-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:t.permissions.map(n=>e.jsxs("div",{className:`flex items-start gap-2 p-2 rounded-lg border transition-colors cursor-pointer ${A.includes(n.id)?"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800":"bg-default-100/50 dark:bg-default-50/10 border-transparent hover:border-default-300"}`,onClick:()=>{A.includes(n.id)?z(A.filter(l=>l!==n.id)):z([...A,n.id])},children:[e.jsx(Q,{isSelected:A.includes(n.id),onValueChange:l=>{z(l?[...A,n.id]:A.filter(m=>m!==n.id))},size:"sm",className:"mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:n.displayName}),e.jsx("p",{className:"text-xs text-default-400 truncate",children:n.description})]})]},n.id))})})]},s)})})]}),e.jsxs(ne,{children:[e.jsx(f,{variant:"flat",onClick:()=>ce(!1),children:"Cancel"}),e.jsxs(f,{color:"primary",onClick:qs,isLoading:I,children:["Save Permissions (",A.length,")"]})]})]})}),e.jsx(te,{isOpen:gs,onClose:()=>be(!1),children:e.jsxs(ae,{children:[e.jsx(re,{className:"text-danger",children:"Confirm Delete"}),e.jsxs(ie,{children:[e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:M?.name}),"?"]}),M?.type==="module"&&e.jsx("p",{className:"text-sm text-warning mt-2",children:"This will also delete all sub-modules and components within this module."}),M?.type==="sub_module"&&e.jsx("p",{className:"text-sm text-warning mt-2",children:"This will also delete all components within this sub-module."})]}),e.jsxs(ne,{children:[e.jsx(f,{variant:"flat",onClick:()=>be(!1),children:"Cancel"}),e.jsx(f,{color:"danger",onClick:Ds,isLoading:I,children:"Delete"})]})]})})]})};dt.layout=g=>e.jsx(et,{children:g});export{dt as default};
