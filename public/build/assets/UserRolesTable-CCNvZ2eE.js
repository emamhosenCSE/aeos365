import{j as e,s as b,b as I,e as z,r as G,n as T}from"./app-B1idACz3.js";import{F as K}from"./UserGroupIcon-C2aGroqx.js";import{at as q,z as J,F as M,au as Q}from"./App-BxA45E4t.js";import{t as L,a as U,b as W,c as $}from"./chunk-F3UDT23P-C-ho-l6F.js";import{t as O,a as B}from"./chunk-YRZGWF2W-DSN9j3G1.js";import{p as D}from"./chunk-NL7EUJG2-aTLCznnI.js";import{t as E}from"./chunk-AUA5GDXN-Dy7XAS6o.js";import{s as X}from"./toastUtils-CW5B8m6C.js";import{F as Y}from"./EnvelopeIcon-B0z_TX9R.js";import{d as Z,a as ee,b as te,m as re}from"./PlusIcon-B7YJbjTI.js";const xe=({roles:u=[],permissions:S=[],getRolePermissions:g,onEdit:j,onDelete:f,canManageRole:y,isMobile:s,isTablet:R,pagination:a,onPageChange:v,loading:p=!1})=>{const w=()=>{if(typeof window>"u")return"lg";const d=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",c=parseInt(d);return c===0?"none":c<=4?"sm":c<=8?"md":c<=16?"lg":"full"},N=(()=>{const r=[{name:"#",uid:"sl",width:60},{name:"ROLE",uid:"role",width:"auto",minWidth:200},{name:"DESCRIPTION",uid:"description",width:250},{name:"STATUS",uid:"status",width:100},{name:"ACTIONS",uid:"actions",width:100}];return s?r.filter(d=>["sl","role","status","actions"].includes(d.uid)):R?r.filter(d=>!["description"].includes(d.uid)):r})(),C=(r,d,c)=>{const n=(a?.currentPage&&a?.perPage?Number((a.currentPage-1)*a.perPage):0)+(typeof c=="number"?c:0)+1;switch((g?g(r.id):[]).map(o=>S.find(m=>m.id===o)?.name).filter(Boolean),d){case"sl":return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-white/10 backdrop-blur-md rounded-lg border border-white/20",children:e.jsx("span",{className:"text-sm font-semibold text-foreground",children:n})})});case"role":return e.jsx("div",{className:"min-w-max",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shrink-0",style:{background:"linear-gradient(135deg, var(--theme-primary), color-mix(in srgb, var(--theme-primary) 70%, var(--theme-secondary)))"},children:r.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-foreground text-left whitespace-nowrap",children:r.name}),r.name==="Super Administrator"&&e.jsx(z,{size:"sm",color:"warning",variant:"flat",children:"System"})]}),s&&r.description&&e.jsx("p",{className:"text-default-500 text-left text-xs truncate max-w-[150px]",children:r.description})]})]})});case"description":return e.jsx("div",{className:"max-w-[250px]",children:e.jsx("p",{className:"text-sm text-default-600 truncate",children:r.description||e.jsx("span",{className:"text-default-400 italic",children:"No description"})})});case"status":return e.jsx(z,{size:"sm",color:r.is_active!==!1?"success":"default",variant:"flat",children:r.is_active!==!1?"Active":"Inactive"});case"actions":const o=["Super Administrator","platform_super_administrator","tenant_super_administrator"].includes(r.name),m=!o&&(y?y(r):!0);return e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(E,{content:o?"Protected role cannot be edited":"Edit Role",children:e.jsx(I,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>j?.(r),isDisabled:!m,className:m?"text-primary hover:text-primary/80":"text-default-300 cursor-not-allowed",children:e.jsx(q,{className:"w-4 h-4"})})}),e.jsx(E,{content:o?"Protected role cannot be deleted":"Delete Role",children:e.jsx(I,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>f?.(r),isDisabled:!m,className:m?"text-danger hover:text-danger/80":"text-default-300 cursor-not-allowed",children:e.jsx(J,{className:"w-4 h-4"})})})]});default:return null}},h=()=>!a||p?null:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-2",style:{borderTop:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)",background:"color-mix(in srgb, var(--theme-content2) 30%, transparent)",backdropFilter:"blur(16px)"},children:[e.jsxs("span",{className:"text-xs mb-3 sm:mb-0 opacity-70",style:{color:"var(--theme-foreground)"},children:["Showing ",(a.currentPage-1)*a.perPage+1," to ",Math.min(a.currentPage*a.perPage,a.total)," of ",a.total," roles"]}),e.jsx(D,{total:Math.ceil(a.total/a.perPage),initialPage:a.currentPage,page:a.currentPage,onChange:v,size:s?"sm":"md",variant:"bordered",showControls:!0})]});return e.jsxs("div",{className:"w-full overflow-hidden flex flex-col relative",style:{maxHeight:"calc(100vh - 400px)",background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",backdropFilter:"blur(16px)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:w()},children:[p&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 20%, transparent)",backdropFilter:"blur(8px)",borderRadius:w()},children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-6",children:[e.jsx(b,{size:"lg",color:"primary"}),e.jsx("span",{className:"text-sm",style:{color:"var(--theme-foreground)"},children:"Loading roles..."})]})}),e.jsx("div",{className:"overflow-auto grow",children:e.jsxs(L,{"aria-label":"Roles table",removeWrapper:!0,classNames:{base:"bg-transparent min-w-[600px]",th:"backdrop-blur-md font-medium text-xs sticky top-0 z-10 whitespace-nowrap",td:"py-3 whitespace-nowrap",table:"border-collapse table-auto",tr:"hover:opacity-80 transition-all duration-200"},isHeaderSticky:!0,isCompact:s,children:[e.jsx(O,{columns:N,children:r=>e.jsx(B,{align:r.uid==="actions"||r.uid==="sl"?"center":"start",width:r.width,minWidth:r.minWidth,className:"backdrop-blur-md",style:{backgroundColor:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)"},children:r.name},r.uid)}),e.jsx(U,{items:u||[],emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(K,{className:"w-12 h-12 mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),e.jsx("h6",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No roles found"}),e.jsx("p",{className:"text-sm opacity-70",style:{color:"var(--theme-foreground)"},children:"Try adjusting your search or filter criteria"})]}),loadingContent:e.jsx(b,{}),isLoading:p,children:r=>{const d=u?u.findIndex(c=>c.id===r.id):0;return e.jsx(W,{className:"transition-all duration-200",style:{color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)"},children:c=>e.jsx($,{className:"transition-all duration-300",children:C(r,c,d)})},r.id)}})]})}),h()]})},fe=({users:u=[],roles:S=[],onRowClick:g,onRoleChange:j,isMobile:f,isTablet:y,pagination:s,onPageChange:R,loading:a=!1,context:v="tenant"})=>{const[p,w]=G.useState({}),k=(t,n,l)=>{w(o=>({...o,[`${t}-${n}`]:l}))},N=(t,n)=>p[`${t}-${n}`]||!1,C=async(t,n)=>{k(t,"role",!0);const l=new Promise(async(o,m)=>{try{const x=v==="admin"||v==="platform",P=x?route("admin.users.update-roles",{user:t}):route("users.updateRole",{id:t}),_=x?await T.patch(P,{roles:n}):await T.post(P,{roles:n});_.status===200&&(j&&j(t,n),o([_.data.message||"Role updated successfully"]))}catch(x){x.response?.status===422?m(x.response.data.errors||["Failed to update user role."]):m(["An unexpected error occurred. Please try again later."])}finally{k(t,"role",!1)}});X.promise(l,{loading:"Updating user role...",success:o=>o.join(", "),error:o=>Array.isArray(o)?o.join(", "):o})},h=()=>{if(typeof window>"u")return"lg";const n=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",l=parseInt(n);return l===0?"none":l<=4?"sm":l<=8?"md":l<=16?"lg":"full"},d=(()=>{const t=[{name:"#",uid:"sl",width:60},{name:"USER",uid:"user",width:"auto",minWidth:200},{name:"EMAIL",uid:"email",width:220},{name:"ASSIGNED ROLES",uid:"roles",width:"auto",minWidth:300},{name:"STATUS",uid:"status",width:100}];return f?t.filter(n=>["sl","user","roles"].includes(n.uid)):y?t.filter(n=>!["status"].includes(n.uid)):t})(),c=(t,n,l)=>{const x=(s?.currentPage&&s?.perPage?Number((s.currentPage-1)*s.perPage):0)+(typeof l=="number"?l:0)+1,P=t.roles||[];switch(n){case"sl":return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-white/10 backdrop-blur-md rounded-lg border border-white/20",children:e.jsx("span",{className:"text-sm font-semibold text-foreground",children:x})})});case"user":return e.jsx("div",{className:"min-w-max",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{src:t.profile_image_url||t.avatar,name:t.name,size:"sm",className:"shrink-0"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"font-semibold text-foreground text-left whitespace-nowrap",children:t.name||"Unknown User"}),f&&t.email&&e.jsx("p",{className:"text-default-500 text-left text-xs truncate max-w-[150px]",children:t.email})]})]})});case"email":return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-default-400"}),e.jsx("span",{className:"text-sm text-default-600",children:t.email||"No email"})]});case"roles":const _=P.map(i=>typeof i=="object"&&i!==null?i.name:i)||[],A=new Set(_),V=Array.from(A).join(", ")||"No Roles";return e.jsx("div",{className:"flex items-center",children:e.jsxs(Z,{isDisabled:N(t.id,"role"),className:"max-w-[220px]",children:[e.jsx(ee,{children:e.jsx(I,{className:"capitalize",variant:"solid",size:"sm",radius:h(),startContent:N(t.id,"role")?e.jsx(b,{size:"sm"}):null,style:{background:"var(--theme-primary, #3B82F6)",color:"white",fontFamily:'var(--fontFamily, "Inter")',borderRadius:h(),cursor:"pointer"},children:V})}),e.jsx(te,{disallowEmptySelection:!1,"aria-label":"Role selection",closeOnSelect:!1,selectedKeys:A,selectionMode:"multiple",variant:"flat",onSelectionChange:i=>{const H=Array.from(i);C(t.id,H)},children:(S||[]).map(i=>e.jsx(re,{children:typeof i=="object"&&i!==null?i.name:i},typeof i=="object"&&i!==null?i.name:i))})]})});case"status":return e.jsx(z,{size:"sm",color:t.is_active!==!1?"success":"default",variant:"flat",children:t.is_active!==!1?"Active":"Inactive"});default:return null}},F=()=>!s||a?null:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-2",style:{borderTop:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)",background:"color-mix(in srgb, var(--theme-content2) 30%, transparent)",backdropFilter:"blur(16px)"},children:[e.jsxs("span",{className:"text-xs mb-3 sm:mb-0 opacity-70",style:{color:"var(--theme-foreground)"},children:["Showing ",(s.currentPage-1)*s.perPage+1," to ",Math.min(s.currentPage*s.perPage,s.total)," of ",s.total," users"]}),e.jsx(D,{total:Math.ceil(s.total/s.perPage),initialPage:s.currentPage,page:s.currentPage,onChange:R,size:f?"sm":"md",variant:"bordered",showControls:!0})]});return e.jsxs("div",{className:"w-full overflow-hidden flex flex-col relative",style:{maxHeight:"calc(100vh - 400px)",background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",backdropFilter:"blur(16px)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:h()},children:[a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 20%, transparent)",backdropFilter:"blur(8px)",borderRadius:h()},children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-6",children:[e.jsx(b,{size:"lg",color:"primary"}),e.jsx("span",{className:"text-sm",style:{color:"var(--theme-foreground)"},children:"Loading users..."})]})}),e.jsx("div",{className:"overflow-auto grow",children:e.jsxs(L,{"aria-label":"User roles table",removeWrapper:!0,classNames:{base:"bg-transparent min-w-[600px]",th:"backdrop-blur-md font-medium text-xs sticky top-0 z-10 whitespace-nowrap",td:"py-3 whitespace-nowrap",table:"border-collapse table-auto",tr:"hover:opacity-80 transition-all duration-200"},isHeaderSticky:!0,isCompact:f,children:[e.jsx(O,{columns:d,children:t=>e.jsx(B,{align:t.uid==="actions"||t.uid==="sl"?"center":"start",width:t.width,minWidth:t.minWidth,className:"backdrop-blur-md",style:{backgroundColor:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)"},children:t.name},t.uid)}),e.jsx(U,{items:u||[],emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(M,{className:"w-12 h-12 mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),e.jsx("h6",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No users found"}),e.jsx("p",{className:"text-sm opacity-70",style:{color:"var(--theme-foreground)"},children:"Try adjusting your search or filter criteria"})]}),loadingContent:e.jsx(b,{}),isLoading:a,children:t=>{const n=u?u.findIndex(l=>l.id===t.id):0;return e.jsx(W,{className:"transition-all duration-200 cursor-pointer hover:bg-default-100/50",style:{color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)"},onClick:()=>g?.(t),children:l=>e.jsx($,{className:"transition-all duration-300",children:c(t,l,n)})},t.id)}})]})}),F()]})};export{xe as R,fe as U};
