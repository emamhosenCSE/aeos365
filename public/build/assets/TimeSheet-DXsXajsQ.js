import{R as Qe,r as a,j as e,p as I,s as $e,g as Me,A as Xe,m as De,F as X,b as V,u as ie,e as Z,c as ee,a as te,d as xe,H as Ze}from"./app-DInl32dX.js";import{u as ce,F as es}from"./useMediaQuery-C-YwQMFM.js";import{at as ss,b as de,d as ts,m as Re,aD as as,A as rs}from"./App-WuTgSQpq.js";import{d as w}from"./dayjs.min-CIbyyQus.js";import{P as ns}from"./PageHeader-QBe3IBA2.js";import{F as K}from"./CheckCircleIcon-CBemRlBB.js";import{F as fe}from"./MagnifyingGlassIcon-BHtwTbT7.js";import{F as J}from"./CalendarDaysIcon-C0QniVM8.js";import{i as L}from"./chunk-SQIAVXJX-D14i8yCn.js";import{F as ye}from"./UserGroupIcon-D3XNApS5.js";import{F as ls}from"./UserIcon-BXV25mJ2.js";import{c as os}from"./chunk-C6WKGNND-BNiYL7Dh.js";import{d as se}from"./chunk-IHO36JMK-D4pDtZyX.js";import{a as Ae,s as is}from"./chunk-C3QHEOC2-D3HZRbzZ.js";import{s as cs}from"./chunk-P7ACKWSP-8b9-fXrc.js";import{t as ds,a as ms,b as us,c as U}from"./chunk-F3UDT23P-xcwvfsFh.js";import{t as hs,a as ps}from"./chunk-YRZGWF2W-kwLZuFgu.js";import{p as xs}from"./chunk-NL7EUJG2-C-ztCjvq.js";import{u as me}from"./chunk-NGIUTAK3-Bp36Yu6Y.js";import{l as fs}from"./chunk-3YGGVHYO-C9zoBHkw.js";import{s as W}from"./toastUtils-Dk6tac5H.js";import{M as ys,T as gs,a as vs,b as bs,L as Le}from"./leaflet-DoJm5bOs.js";import{F as ve}from"./MapPinIcon-DQuQoAYs.js";import{F as Ee}from"./GlobeAltIcon-GWZbt4C2.js";import{F as ge}from"./InformationCircleIcon-B9AJIWR0.js";import{m as Te,a as Ye,b as ze,c as Ue}from"./chunk-TW2E3XVA-iMcMikRA.js";import{l as js}from"./chunk-Y5DMIIWQ-Dpn2oOZz.js";import{m as Ve}from"./chunk-5LXTSPS7-DX-2Lz-B.js";import{c as Pe}from"./chunk-PMMJMDBI-zfrzwnR9.js";import{t as Ns}from"./chunk-WEIB4WXA-LEvOAg9Q.js";import{F as ws}from"./PlusIcon-CsvijEwK.js";import{F as _s}from"./CalendarIcon-BDoD0DmU.js";import"./app-Bq-q9uAS.js";import"./index-DPMKIREV.js";/* empty css                      */import"./routeUtils-C1ntbTNy.js";import"./chunk-CV4BWJDJ-DcxL8QrL.js";import"./index-BCLbv8my.js";import"./index-CSng9BnJ.js";import"./Cog6ToothIcon-zHlKFwwi.js";import"./useBranding-dC6b8PrL.js";import"./useDialog-8HGvvybm.js";import"./VisuallyHidden-CS7DyqzD.js";import"./keyboard-DNevlDsW.js";import"./useLabels-DRQXF7iz.js";import"./index-C19oxd6b.js";import"./XMarkIcon-Bc5pdXLR.js";import"./chunk-AUA5GDXN-D3hqgLS_.js";import"./chunk-WQVQ7P2I-CFFCRwf1.js";import"./number-CB4zbwAz.js";import"./chunk-LGMZDQT5-AEtpri7C.js";import"./ShieldCheckIcon-DvFPoteO.js";import"./AcademicCapIcon-CC6YBlU6.js";import"./IdentificationIcon-CKrgedc9.js";import"./ArrowLeftIcon-CFp3Pghx.js";import"./ArrowRightIcon-B8tzotBf.js";import"./BriefcaseIcon-Djk_M_FX.js";import"./BuildingOfficeIcon-B3NavyzP.js";import"./CircleStackIcon-BjngXmVM.js";import"./ClipboardDocumentCheckIcon-_A_HhLvf.js";import"./CogIcon-CzJ7j4DE.js";import"./DeviceTabletIcon-De9VuiFM.js";import"./CpuChipIcon-BrpEkwev.js";import"./CurrencyDollarIcon-B3zwuJ0N.js";import"./DevicePhoneMobileIcon-CLvqE2l7.js";import"./DocumentArrowUpIcon-shdZWIak.js";import"./DocumentIcon-CBf8GOfS.js";import"./EnvelopeIcon-DLtlA8EK.js";import"./ExclamationCircleIcon-DwrHwjxW.js";import"./EyeIcon-D4ng1SC5.js";import"./KeyIcon-B2Hwn88Z.js";import"./LockClosedIcon-D9VXsZXL.js";import"./PlusCircleIcon-BjCDE8zj.js";import"./PrinterIcon-_tOUuOIj.js";import"./RocketLaunchIcon-BNG_hBUS.js";import"./ShoppingCartIcon-uZ3xP94w.js";import"./UserCircleIcon--t-sGGtv.js";import"./chunk-I3A4XRYQ-C0-YSi_Z.js";import"./useToggleState-DazvJpvY.js";import"./chunk-ICU6NNET-DqkKT8ny.js";import"./MaintenanceModeBanner-DqK68c5B.js";import"./chunk-KQW2TNLT-BWWZAnNV.js";import"./useLabel-CkOStKP1.js";import"./useMenuTriggerState-CjU22Gti.js";import"./useSelectableItem-BDDZlxQu.js";import"./SelectionManager-C4bZoYw_.js";import"./Item-DGSYw1SN.js";import"./chunk-7F3ZLNJ6-CouOzA8x.js";import"./useHasTabbableChild-CYzrd8JV.js";import"./index-CEAs1XR5.js";import"./index-CokAva9Y.js";import"./chunk-OH2E76JR-Cg-ZWR_4.js";import"./index-gV97IVYX.js";import"./index-GuVMPMJG.js";import"./useTreeState-wpFJCnLf.js";const Fs=Qe.memo(({absentUsers:_,selectedDate:m,getUserLeave:F,isLoaded:N=!1,onMarkAsPresent:M})=>{const[h,g]=a.useState(5),[t,r]=a.useState(""),x=()=>{const d=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",k=parseInt(d);return k===0?"none":k<=4?"sm":k<=8?"md":k<=16?"lg":"full"},b=a.useMemo(()=>{if(!t.trim())return _;const n=t.toLowerCase();return _.filter(d=>{const k=d.name?.toLowerCase()||"",$=d.employee_id?.toString().toLowerCase()||"",y=d.email?.toLowerCase()||"",u=d.phone?.toString().toLowerCase()||"";return k.includes(n)||$.includes(n)||y.includes(n)||u.includes(n)})},[_,t]),S=()=>{g(n=>n+5)},R=n=>{r(n.target.value),g(5)},o=n=>{switch(n?.toLowerCase()){case"approved":return e.jsx(K,{className:"w-4 h-4",style:{color:"var(--theme-success)"}});case"rejected":return e.jsx(Me,{className:"w-4 h-4",style:{color:"var(--theme-danger)"}});case"pending":return e.jsx(I,{className:"w-4 h-4",style:{color:"var(--theme-warning)"}});default:return e.jsx(I,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}})}},p=n=>{switch(n?.toLowerCase()){case"approved":return"var(--theme-success)";case"rejected":return"var(--theme-danger)";case"pending":return"var(--theme-warning)";default:return"var(--theme-primary)"}},v=b.length;return N?N&&_.length===0?e.jsxs("div",{className:"h-full",children:[e.jsx(ns,{title:"Perfect Attendance!",subtitle:`No employees are absent on ${w(m).format("MMMM D, YYYY")}`,icon:e.jsx(K,{className:"w-6 h-6"}),variant:"gradient",actionButtons:[{label:"0",variant:"flat",color:"success",icon:e.jsx(K,{className:"w-4 h-4"}),className:"bg-green-500/10 text-green-500 border-green-500/20"}]}),e.jsxs("div",{role:"region","aria-label":"No absent employees today",className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-success) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--theme-success)"}}),e.jsx("p",{className:"mb-2 text-sm font-medium",style:{color:"var(--theme-success)",fontFamily:'var(--fontFamily, "Inter")'},children:"Perfect Attendance!"}),e.jsx("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No employees are absent today."}),e.jsx("p",{className:"text-default-500 mt-1 block text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"All employees are either present or on approved leave."})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Me,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),"Absent Employees (",v,")"]})}),e.jsx("div",{className:"mb-3 flex-shrink-0",children:e.jsx(L,{type:"text",placeholder:"Search absent employees...",value:t,onChange:R,startContent:e.jsx(fe,{className:"w-4 h-4 text-default-400"}),variant:"bordered",size:"sm",radius:x(),"aria-label":"Search absent employees",classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),t&&e.jsx("div",{className:"mb-2 flex-shrink-0",children:e.jsxs("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[b.length," of ",_.length," employees found"]})}),t&&b.length===0&&e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(fe,{className:"w-8 h-8 text-default-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:['No employees found matching "',t,'"']})]}),e.jsxs("div",{role:"region","aria-label":"Absent employees list",className:"flex-1 overflow-y-auto min-h-0",style:{maxHeight:"calc(100vh - 400px)"},children:[e.jsx(Xe,{children:b.slice(0,h).map(n=>{const d=F(n.id);return e.jsx(De.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"p-3 mb-3 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},onMouseEnter:k=>{k.currentTarget.style.background="color-mix(in srgb, var(--theme-content2) 60%, transparent)"},onMouseLeave:k=>{k.currentTarget.style.background="color-mix(in srgb, var(--theme-content1) 80%, transparent)"},children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(ss,{src:n.profile_image_url||n.profile_image,name:n.name,size:"sm",showBorder:!0}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:n.name}),n.employee_id&&e.jsxs("p",{className:"block text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["ID: ",n.employee_id]}),d?e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(J,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:d.from_date===d.to_date?d.from_date:`${d.from_date} - ${d.to_date}`})]}),e.jsxs("p",{className:"flex items-center gap-1 text-xs",style:{color:p(d.status),fontFamily:'var(--fontFamily, "Inter")'},children:[o(d.status),e.jsxs("span",{className:"truncate",children:[d.leave_type," Leave"]})]})]}):e.jsxs("p",{className:"flex items-center gap-1 mt-1 text-xs",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:"Absent without leave"})]})]})]}),d&&e.jsx("div",{className:"px-1.5 py-0.5 ml-2 flex-shrink-0",style:{background:`color-mix(in srgb, ${p(d.status)} 15%, transparent)`,borderColor:`color-mix(in srgb, ${p(d.status)} 30%, transparent)`,borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 6px)"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[o(d.status),e.jsx("span",{className:"font-semibold text-xs",style:{color:p(d.status),fontFamily:'var(--fontFamily, "Inter")'},children:d.status})]})})]}),M&&!d&&e.jsx("div",{className:"flex justify-end",children:e.jsx(V,{color:"primary",variant:"flat",size:"sm",radius:x(),startContent:e.jsx(de,{className:"w-3 h-3"}),onPress:()=>M(n,m),style:{fontFamily:'var(--fontFamily, "Inter")'},className:"text-xs",children:"Mark Present"})})]})},n.id)})}),h<b.length&&e.jsx("div",{className:"text-center mt-4 pb-4 flex-shrink-0",children:e.jsxs(V,{variant:"bordered",onPress:S,startContent:e.jsx(ts,{className:"w-4 h-4"}),size:"sm",color:"warning",radius:x(),fullWidth:!0,style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Show More (",b.length-h," remaining)"]})})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-default)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(I,{className:"w-5 h-5",style:{color:"var(--theme-default)"}}),"Loading Attendance Data..."]})}),e.jsxs("div",{className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 5%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx($e,{size:"lg",className:"mb-4",style:{color:"var(--theme-primary)"}}),e.jsx("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Checking attendance records..."})]})]})}),ks=({handleDateChange:_,selectedDate:m,updateTimeSheet:F,externalFilterData:N,externalEmployee:M,onMarkAsPresent:h})=>{const{auth:g}=ie().props,{url:t}=ie(),r=ce("(min-width: 1025px)"),x=ce("(min-width: 641px) and (max-width: 1024px)"),[b,S]=a.useState([]),[R,o]=a.useState([]),[p,v]=a.useState([]),[n,d]=a.useState(""),[k,$]=a.useState(0),[y,u]=a.useState(0),[i,c]=a.useState(10),[f,D]=a.useState(1),[C,be]=a.useState(M||""),[ae,O]=a.useState(!1),[re,Es]=a.useState(0),[Ps,je]=a.useState(null),[Ne,$s]=a.useState(!0),[ue,we]=a.useState(new Date),[ne,q]=a.useState(""),_e=a.useRef(null),P=a.useRef({currentMonth:w().format("YYYY-MM"),employee:M||"",filterData:N||{currentMonth:w().format("YYYY-MM")},selectedDate:m,perPage:10,updateTimeSheet:F,refreshKey:0,currentPage:1}),Q=()=>{if(typeof window>"u")return"lg";const j=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",l=parseInt(j);return l===0?"none":l<=4?"sm":l<=8?"md":l<=16?"lg":"full"},[A,Fe]=a.useState(N||{currentMonth:w().format("YYYY-MM")}),le=a.useCallback(async()=>{try{return O(!1),await Ce(m,f,i,C,A,!0),t!=="/attendance-employee"&&await Ie(m,C),we(new Date),!0}catch(s){return console.error("Error refreshing timesheet:",s),!1}finally{O(!0)}},[m,f,i,C,A,t]),he=a.useCallback(async()=>{if(m)try{const s=route("check-timesheet-updates",{date:w(m).format("YYYY-MM-DD"),month:A.currentMonth}),j=await fetch(s);if(!j.ok){const T=await j.json().catch(()=>({}));throw new Error(`HTTP ${j.status}: ${T.message||"Failed to check for updates"}`)}const l=await j.json();l.success&&l.last_updated!==_e.current&&l.last_updated&&(_e.current=l.last_updated,await le(),je(new Date)),we(new Date)}catch(s){console.error("Error checking for timesheet updates:",s)}},[m,A.currentMonth,le]),ke=a.useMemo(()=>ue?ue.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[ue]),Ce=async(s,j,l,T,Y,pe=!1)=>{if(!s){O(!0),d("No date selected");return}const oe=t!=="/attendance-employee"?route("admin.getPresentUsersForDate"):route("getCurrentUserAttendanceForDate");try{O(!1),d("");const z=await Z.get(oe,{params:{page:j,perPage:l,employee:T,date:w(s).format("YYYY-MM-DD"),currentYear:Y?.currentMonth?w(Y.currentMonth).year():"",currentMonth:Y?.currentMonth?w(Y.currentMonth).format("MM"):"",_t:pe?Date.now():void 0}});z.status===200?(S(z.data.attendances||[]),$(z.data.total||0),u(z.data.last_page||1),D(z.data.current_page||1),je(new Date),d("")):d(`Unexpected response: ${z.status}`)}catch(z){console.error("Error fetching attendance data:",z),d(z.response?.data?.message||"An error occurred while retrieving attendance data."),S([]),$(0)}finally{O(!0)}},Ie=async(s,j)=>{if(t==="/attendance-employee"){v([]),o([]);return}if(!s){v([]),o([]);return}try{const l=await Z.get(route("admin.getAbsentUsersForDate"),{params:{date:w(s).format("YYYY-MM-DD"),employee:j||"",_t:Date.now()}});l.status===200?(v(l.data.absent_users||[]),o(l.data.leaves||[])):(console.warn("Unexpected response getting absent users:",l.status),v([]),o([]))}catch(l){console.error("Error fetching absent users:",l),v([]),o([])}},We=s=>{D(s)};a.useCallback((s,j)=>{Fe(l=>({...l,[s]:j}))},[]);const Be=s=>R.find(j=>String(j.user_id)===String(s)),Se=(s,j)=>{if(!s)return null;try{let l;if(typeof s=="string"){const T=w(j).format("YYYY-MM-DD");if(s.match(/^\d{2}:\d{2}:\d{2}$/)){const Y=`${T}T${s}`;l=new Date(Y)}else if(s.includes("T")||s.includes(" "))l=new Date(s);else if(s.match(/^\d{2}:\d{2}$/)){const Y=`${T}T${s}:00`;l=new Date(Y)}else l=new Date(`${T}T${s}`)}else l=new Date(s);return isNaN(l.getTime())?(console.warn("Invalid time data:",s),"Invalid time"):l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(l){return console.warn("Error formatting time:",{timeString:s,date:j,error:l}),"Invalid time"}},H=g.permissions?.includes("attendance.view")||!1;g.permissions?.includes("attendance.own.view");const Oe=g.permissions?.includes("attendance.manage")||!1,He=g.permissions?.includes("attendance.export")||Oe||!1;a.useMemo(()=>p,[p]);const Ge=[...!H||t==="/attendance-employee"?[{name:"Date",uid:"date",icon:J,ariaLabel:"Attendance date"}]:[],...H&&t!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:ls,ariaLabel:"Employee name and information"}]:[],{name:"Clock In",uid:"clockin_time",icon:I,ariaLabel:"All clock in times"},{name:"Clock Out",uid:"clockout_time",icon:I,ariaLabel:"All clock out times"},{name:"Work Hours",uid:"production_time",icon:I,ariaLabel:"Total working hours"},{name:"Punches",uid:"punch_details",icon:I,ariaLabel:"Number of time punches recorded"}],Ke=(s,j)=>{const l="text-xs sm:text-sm md:text-base whitespace-nowrap",T=w(s.date).isSame(w(),"day");switch(j){case"date":return e.jsx(U,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-primary shrink-0"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:w(s.date).format("MMM D, YYYY")})})]})});case"employee":const Y=r||x?"md":"sm";return e.jsx(U,{className:"whitespace-nowrap",children:e.jsx(me,{avatarProps:{src:s.user?.profile_image_url||s.user?.profile_image,size:Y,name:s.user?.name||"Unnamed User",...as({name:s.user?.name||"Unnamed User",size:Y})},description:s.user?.phone?e.jsx(fs,{href:`tel:${s.user?.phone}`,size:"sm",className:"text-xs hover:underline",style:{color:"var(--theme-primary)"},children:s.user?.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-default-400 italic",children:[e.jsx(es,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:s.user?.name||"Unnamed User"})})});case"clockin_time":return e.jsx(U,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-success"}),e.jsx("div",{className:"flex flex-col",children:s.punches&&s.punches.length>0?s.punches.filter(B=>B.punch_in).map((B,G)=>e.jsxs("span",{className:"block text-xs",children:[e.jsxs("span",{className:"text-default-400 mr-1",children:[G+1,"."]}),Se(B.punch_in,s.date)||"Invalid time"]},G)):e.jsx("span",{children:"Not clocked in"})})]})});case"clockout_time":return e.jsx(U,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-danger"}),e.jsx("div",{className:"flex flex-col",children:s.punches&&s.punches.length>0?s.punches.map((B,G)=>e.jsxs("span",{className:"block text-xs",children:[e.jsxs("span",{className:"text-default-400 mr-1",children:[G+1,"."]}),B.punch_out?Se(B.punch_out,s.date)||"Invalid time":"No punch out"]},G)):s.punchin_time?e.jsx("span",{children:T?"Currently working":"Missing punch-out"}):e.jsx("span",{children:"Not started"})})]})});case"production_time":const pe=s.total_work_minutes>0,oe=s.has_incomplete_punch,z=s.punchin_time&&!s.punchout_time&&T;if(pe){const B=Math.floor(s.total_work_minutes/60),G=Math.floor(s.total_work_minutes%60);return e.jsx(U,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:`w-4 h-4 ${oe?"text-warning":"text-primary"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:`${B}h ${G}m`}),e.jsx("span",{className:"text-xs text-default-500",children:oe?"Partial data - in progress":"Total worked time"})]})]})})}else{if(z)return e.jsx(U,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"In Progress"}),e.jsx("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});if(s.punchin_time&&!s.punchout_time&&!T)return e.jsx(U,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-danger"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-danger",children:"Incomplete punch"}),e.jsx("span",{className:"text-xs text-default-500",children:"Missing punch out"})]})]})})}return e.jsx(U,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"No work time"}),e.jsx("span",{className:"text-xs text-default-500",children:"No attendance"})]})]})});case"punch_details":return e.jsx(U,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-default-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-medium",children:[s.punch_count||0," punch",(s.punch_count||0)!==1?"es":""]}),s.complete_punches!==s.punch_count&&e.jsxs("span",{className:"text-xs text-warning",children:[s.complete_punches," complete"]}),s.complete_punches===s.punch_count&&s.punch_count>0&&e.jsx("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e.jsx(U,{className:`${l}`,children:"N/A"})}},Je=a.useCallback(async()=>{q("excel");try{const s=await Z.get(route("attendance.exportExcel"),{params:{date:m},responseType:"blob"}),j=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=j,l.setAttribute("download",`Daily_Timesheet_${w(m).format("YYYY_MM_DD")}.xlsx`),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(j),q("")}catch(s){console.error("Error downloading Excel:",s),alert("Failed to download attendance excel."),q("")}},[m]),qe=a.useCallback(async()=>{q("pdf");try{const s=await Z.get(route("attendance.exportPdf"),{params:{date:m},responseType:"blob"}),j=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=j,l.setAttribute("download",`Daily_Timesheet_${w(m).format("YYYY_MM_DD")}.pdf`),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(j),q("")}catch(s){console.error("Error downloading PDF:",s),alert("Failed to download attendance pdf."),q("")}},[m]);return a.useEffect(()=>{if(m){if((C!==P.current.employee||A!==P.current.filterData||m!==P.current.selectedDate||i!==P.current.perPage||F!==P.current.updateTimeSheet||re!==P.current.refreshKey)&&f!==1){P.current={...P.current,employee:C,filterData:A,selectedDate:m,perPage:i,updateTimeSheet:F,refreshKey:re},D(1);return}(async()=>{O(!1);try{await Promise.all([Ce(m,f,i,C,A),t!=="/attendance-employee"?Ie(m,C):Promise.resolve()])}catch(l){console.error("Error updating attendance data:",l)}finally{O(!0)}})(),P.current={...P.current,employee:C,filterData:A,selectedDate:m,perPage:i,updateTimeSheet:F,refreshKey:re,currentPage:f}}},[m,f,i,C,A,F,re]),a.useEffect(()=>{N&&Fe(N)},[N]),a.useEffect(()=>{M!==void 0&&be(M)},[M]),a.useEffect(()=>{JSON.stringify(A)!==JSON.stringify(P.current.filterData)&&(P.current={...P.current,filterData:{...A}},le())},[A,le]),a.useEffect(()=>{if(!Ne||!m)return;he();const s=setInterval(he,5e3);return()=>{clearInterval(s)}},[Ne,he,m]),e.jsx(e.Fragment,{children:H&&e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"Timesheet Management",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(De.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(ee,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                                        var(--theme-content1, #FAFAFA) 20%, 
                                        var(--theme-content2, #F4F4F5) 10%, 
                                        var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(os,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                            color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                            color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${r?"p-6":x?"p-4":"p-3"} w-full`,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                                ${r?"p-3":x?"p-2.5":"p-2"} 
                                                                rounded-xl flex items-center justify-center
                                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(I,{className:`
                                                                    ${r?"w-8 h-8":x?"w-6 h-6":"w-5 h-5"}
                                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                                    ${r?"text-2xl":x?"text-xl":"text-lg"}
                                                                    font-bold text-foreground
                                                                    ${r?"":"truncate"}
                                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Daily Timesheet"}),e.jsx("p",{className:`
                                                                    ${r?"text-sm":"text-xs"} 
                                                                    text-default-500
                                                                    ${r?"":"truncate"}
                                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:new Date(m).toLocaleString("en-US",{month:r?"long":"short",day:"numeric",year:r?"numeric":void 0})})]})]}),"                                                ",e.jsxs("div",{className:"flex items-center gap-4",children:[ke&&e.jsxs("span",{className:"text-xs text-default-500",children:["Updated: ",ke]}),e.jsx("div",{className:"flex items-center gap-2",children:He&&e.jsxs(e.Fragment,{children:[e.jsx(V,{color:"success",variant:"flat",size:r?"md":"sm",radius:Q(),startContent:e.jsx(Re,{className:`
                                                                                ${r?"w-4 h-4":"w-3.5 h-3.5"}
                                                                            `}),onPress:Je,isDisabled:!ae||b.length===0||ne!=="",isLoading:ne==="excel",style:{fontFamily:'var(--fontFamily, "Inter")'},children:r?"Excel":"XLS"}),e.jsx(V,{color:"danger",variant:"flat",size:r?"md":"sm",radius:Q(),startContent:e.jsx(Re,{className:`
                                                                                ${r?"w-4 h-4":"w-3.5 h-3.5"}
                                                                            `}),onPress:qe,isDisabled:!ae||b.length===0||ne!=="",isLoading:ne==="pdf",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"PDF"})]})})]})]}),r&&e.jsxs("div",{className:"flex items-center gap-6 pt-2 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-success"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Present: ",k]})]}),H&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-warning"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Absent: ",p.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Total: ",k+p.length]})]})]})]})})}),e.jsx(se,{}),e.jsx(te,{children:e.jsx("div",{role:"search","aria-label":"Timesheet filters",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:H&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:e.jsx(L,{type:"text",label:"Search Employee",placeholder:"Enter employee name",value:C,onChange:s=>be(s.target.value),variant:"bordered",size:"sm",radius:Q(),startContent:e.jsx(fe,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Search employees"})}),e.jsx("div",{className:"col-span-1",children:e.jsx(L,{label:"Select Date",type:"date",variant:"bordered",onChange:_,value:new Date(m).toISOString().slice(0,10)||"",size:"sm",radius:Q(),startContent:e.jsx(J,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Select date for timesheet"})})]})})})}),e.jsx(se,{}),e.jsx(te,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full",children:[e.jsx("div",{className:`${H?"lg:flex-1 lg:w-0":"w-full"} min-h-0`,children:n?e.jsx(ee,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:n})]})}):e.jsxs("div",{role:"region","aria-label":"Present employees attendance table",className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h6",{className:"text-lg font-semibold text-foreground flex items-center gap-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(K,{className:"w-5 h-5",style:{color:"var(--theme-success)"}}),"Present Employees (",k,")"]})}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(Ae,{orientation:"horizontal",className:"overflow-y-hidden flex-1",children:e.jsx(cs,{className:"rounded-lg",isLoaded:ae,children:e.jsxs(ds,{isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,radius:Q(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(hs,{columns:Ge,children:s=>e.jsx(ps,{align:"start",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon&&e.jsx(s.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]})},s.uid)}),e.jsx(ms,{items:b,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(I,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx("p",{className:"text-default-500",children:"No attendance records found"})]}),children:s=>e.jsx(us,{children:j=>Ke(s,j)},s.id||s.user_id)})]})})}),k>i&&e.jsx("div",{className:"py-4 flex justify-center",children:e.jsx(xs,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",radius:Q(),page:f,total:y,onChange:We,"aria-label":"Timesheet pagination",style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})]})}),H&&e.jsx("div",{className:"lg:w-80 lg:flex-shrink-0 h-full",children:e.jsx(Fs,{absentUsers:p,selectedDate:m,getUserLeave:Be,isLoaded:ae,onMarkAsPresent:h})})]})})]})})})})})})};delete Le.Icon.Default.prototype._getIconUrl;Le.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const E={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Cs=({onLocationSelect:_})=>(bs({click(m){const{lat:F,lng:N}=m.latlng;_({latitude:F,longitude:N,accuracy:10,source:"manual"})}}),null),Is=({onLocationChange:_,initialLocation:m=null,className:F="",style:N={}})=>{const M=()=>{if(typeof window>"u")return"lg";const p=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",v=parseInt(p);return v===0?"none":v<=4?"sm":v<=8?"md":v<=16?"lg":"full"},[h,g]=a.useState({status:E.CHECKING,coordinates:m||{latitude:23.8103,longitude:90.4125},error:null,accuracy:null}),[t,r]=a.useState({latitude:"",longitude:""}),x=a.useCallback(()=>new Promise((o,p)=>{if(!navigator.geolocation){p(new Error("Geolocation is not supported by this browser"));return}const v={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(n=>{const d={latitude:n.coords.latitude,longitude:n.coords.longitude,accuracy:n.coords.accuracy,source:"gps"};o(d)},n=>{let d="Location unavailable";switch(n.code){case 1:d="Location access denied. Please allow location permission.";break;case 2:d="Location unavailable. Please ensure GPS is enabled.";break;case 3:d="Location request timed out.";break;default:d="Unable to retrieve location."}p(new Error(d))},v)}),[]);a.useEffect(()=>{if(m){g(o=>({...o,status:E.ACTIVE,coordinates:m,accuracy:m.accuracy||null}));return}g(o=>({...o,status:E.CHECKING})),x().then(o=>{g({status:E.ACTIVE,coordinates:o,error:null,accuracy:o.accuracy}),_?.(o)}).catch(o=>{const p=o.message.includes("denied");g({status:p?E.DENIED:E.INACTIVE,coordinates:{latitude:23.8103,longitude:90.4125},error:o.message,accuracy:null})})},[m]);const b=a.useCallback(o=>{g(p=>({...p,coordinates:o,status:E.ACTIVE,accuracy:o.accuracy||10})),_?.(o)},[]),S=a.useCallback(()=>{const o=parseFloat(t.latitude),p=parseFloat(t.longitude);if(isNaN(o)||isNaN(p)||o<-90||o>90||p<-180||p>180){g(n=>({...n,error:"Invalid coordinates. Latitude must be between -90 and 90, longitude between -180 and 180."}));return}b({latitude:o,longitude:p,accuracy:50,source:"manual"}),r({latitude:"",longitude:""})},[t,b]),R=a.useCallback(()=>{g(o=>({...o,status:E.CHECKING,error:null})),x().then(o=>{g({status:E.ACTIVE,coordinates:o,error:null,accuracy:o.accuracy}),_?.(o)}).catch(o=>{const p=o.message.includes("denied");g(v=>({...v,status:p?E.DENIED:E.INACTIVE,error:o.message}))})},[x]);return e.jsxs("div",{className:`space-y-4 ${F}`,style:N,children:[e.jsx(ee,{style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs(te,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Location Selection"})]}),h.status===E.CHECKING&&e.jsx($e,{size:"sm"}),(h.status===E.DENIED||h.status===E.INACTIVE)&&e.jsx(V,{size:"sm",color:"primary",variant:"flat",onPress:R,startContent:e.jsx(Ee,{className:"w-3 h-3"}),children:"Get GPS"})]}),h.coordinates&&e.jsxs("div",{className:"text-xs space-y-1",style:{color:"var(--theme-foreground-600)"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Lat:"})," ",h.coordinates.latitude.toFixed(6),",",e.jsx("strong",{children:" Lng:"})," ",h.coordinates.longitude.toFixed(6)]}),h.accuracy&&e.jsxs("div",{children:[e.jsx("strong",{children:"Accuracy:"})," ±",Math.round(h.accuracy),"m"]})]}),h.error&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 p-2 rounded",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",color:"var(--theme-danger)"},children:[e.jsx(X,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-xs",children:h.error})]})]})}),e.jsx(ee,{style:{borderRadius:"var(--borderRadius, 8px)",overflow:"hidden"},children:e.jsx("div",{style:{height:"300px",width:"100%"},children:h.coordinates&&e.jsxs(ys,{center:[h.coordinates.latitude,h.coordinates.longitude],zoom:16,style:{height:"100%",width:"100%"},children:[e.jsx(gs,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(vs,{position:[h.coordinates.latitude,h.coordinates.longitude]}),e.jsx(Cs,{onLocationSelect:b})]})})}),e.jsx(ee,{style:{background:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs(te,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ee,{className:"w-4 h-4",style:{color:"var(--theme-secondary)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Manual Coordinates"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(L,{size:"sm",label:"Latitude",placeholder:"23.8103",value:t.latitude,onValueChange:o=>r(p=>({...p,latitude:o})),variant:"bordered",radius:M()}),e.jsx(L,{size:"sm",label:"Longitude",placeholder:"90.4125",value:t.longitude,onValueChange:o=>r(p=>({...p,longitude:o})),variant:"bordered",radius:M()}),e.jsx(V,{size:"sm",color:"secondary",variant:"flat",onPress:S,isDisabled:!t.latitude||!t.longitude,className:"h-10",children:"Set Location"})]}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--theme-foreground-600)"},children:"Click on the map or enter coordinates manually to set the punch location."})]})})]})},Ss=({open:_,closeModal:m,selectedDate:F,allUsers:N,refreshTimeSheet:M,currentUser:h=null})=>{const{props:{auth:g}}=ie(),t=()=>{if(typeof window>"u")return"lg";const u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",i=parseInt(u);return i===0?"none":i<=4?"sm":i<=8?"md":i<=16?"lg":"full"},[r,x]=a.useState({user_id:"",date:F,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Manually marked present by admin",coordinates:null}),[b,S]=a.useState({}),[R,o]=a.useState(!1);a.useEffect(()=>{x(h?y=>({...y,user_id:h.id,date:F}):y=>({...y,user_id:"",date:F,punch_in_time:"09:00",punch_out_time:""}))},[h,F]);const p=a.useCallback(y=>{x(u=>({...u,coordinates:y,location:y.source==="manual"?`Manual: ${y.latitude.toFixed(6)}, ${y.longitude.toFixed(6)}`:`GPS: ${y.latitude.toFixed(6)}, ${y.longitude.toFixed(6)} (±${Math.round(y.accuracy)}m)`}))},[]),v=a.useMemo(()=>N?.filter(y=>y.roles?.some(u=>u.name==="Employee"))||[],[N]),n=(y,u)=>{x(i=>({...i,[y]:u})),b[y]&&S(i=>({...i,[y]:void 0}))},d=a.useMemo(()=>{if(r.punch_in_time&&r.punch_out_time){const y=w(`${r.date} ${r.punch_in_time}`),u=w(`${r.date} ${r.punch_out_time}`);if(u.isAfter(y)){const i=u.diff(y,"minute"),c=Math.floor(i/60),f=i%60;return`${c}h ${f}m`}}return null},[r.punch_in_time,r.punch_out_time,r.date]),k=async y=>{y.preventDefault(),o(!0),S({});try{if(!r.coordinates){W.error("Please select a location on the map before submitting."),o(!1);return}const u={user_id:parseInt(r.user_id),date:r.date,punch_in_time:r.punch_in_time,punch_out_time:r.punch_out_time||null,lat:r.coordinates.latitude,lng:r.coordinates.longitude,address:r.location||`Manually marked present by ${g.user?.name||"Administrator"}`},i=await Z.post(route("attendance.mark-as-present"),u);i.status===200&&(W.success(i.data.message||"User marked as present successfully!"),M(),m())}catch(u){u.response?.status===422?(S(u.response.data.errors||{}),W.error(u.response.data.message||"Please check the form for errors")):W.error(u.response?.data?.message||"Failed to mark user as present")}finally{o(!1)}},$=h||v.find(y=>y.id==r.user_id);return e.jsx(Te,{isOpen:_,onClose:m,size:"2xl",radius:t(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-4 max-h-[90vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider flex-shrink-0",body:"overflow-y-auto max-h-[calc(90vh-8rem)]",footer:"border-t border-divider flex-shrink-0",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(Ye,{children:y=>e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Mark Employee as Present"})]})}),e.jsxs("form",{onSubmit:k,children:[e.jsx(Ue,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Employee Selection"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[h?e.jsx("div",{className:"p-3 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsx(me,{avatarProps:{size:"sm",src:h.profile_image_url,showFallback:!0,name:h.name},description:`Employee ID: ${h.employee_id}`,name:h.name})}):e.jsx(is,{label:"Select Employee",placeholder:"Choose an employee to mark as present",selectedKeys:r.user_id?new Set([r.user_id.toString()]):new Set,onSelectionChange:u=>{const i=Array.from(u)[0];n("user_id",i||"")},isInvalid:!!b.user_id,errorMessage:b.user_id,variant:"bordered",size:"sm",radius:t(),classNames:{trigger:"min-h-unit-12",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},renderValue:u=>u.map(i=>{const c=v.find(f=>f.id.toString()===i.key);return c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:c.name}),e.jsxs("span",{className:"text-xs text-default-500",children:["(",c.employee_id,")"]})]},i.key):null}),children:v.map(u=>e.jsx(js,{value:u.id.toString(),textValue:`${u.name} (${u.employee_id})`,children:e.jsx(me,{avatarProps:{size:"sm",src:u.profile_image_url,showFallback:!0,name:u.name},description:`ID: ${u.employee_id}`,name:u.name})},u.id.toString()))}),e.jsx(L,{label:"Date",type:"date",value:r.date,onValueChange:u=>n("date",u),isInvalid:!!b.date,errorMessage:b.date,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(J,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})]})]}),e.jsx(se,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Working Hours"})]}),d&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded-md bg-success/10 text-success",children:["Duration: ",d]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Punch In Time",type:"time",value:r.punch_in_time,onValueChange:u=>n("punch_in_time",u),isInvalid:!!b.punch_in_time,errorMessage:b.punch_in_time,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(I,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(L,{label:"Punch Out Time (Optional)",type:"time",value:r.punch_out_time,onValueChange:u=>n("punch_out_time",u),isInvalid:!!b.punch_out_time,errorMessage:b.punch_out_time,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(I,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"Leave empty if employee is still working"})]})]}),e.jsx(se,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Location & Security Information"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsx(Is,{onLocationChange:p,initialLocation:r.coordinates})})]}),$&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--theme-foreground)"},children:"Preview"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[$.name," will be marked present for"," ",w(r.date).format("MMM D, YYYY")," from"," ",r.punch_in_time," ",r.punch_out_time&&`to ${r.punch_out_time}`,d&&` (${d})`]})]})]})})]})}),e.jsxs(Ve,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(V,{color:"default",variant:"bordered",onPress:y,radius:t(),size:"sm",isDisabled:R,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(V,{type:"submit",color:"primary",variant:"solid",isLoading:R,isDisabled:R||!r.user_id,radius:t(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:R?"Marking Present...":"Mark as Present"})]})]})]})})})},Ms=({open:_,closeModal:m,selectedDate:F,allUsers:N,refreshTimeSheet:M,selectedUsers:h=[]})=>{const g=()=>{if(typeof window>"u")return"lg";const c=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",f=parseInt(c);return f===0?"none":f<=4?"sm":f<=8?"md":f<=16?"lg":"full"},[t,r]=a.useState({user_ids:[],date:F,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Bulk marked present by admin"}),[x,b]=a.useState({}),[S,R]=a.useState(!1),[o,p]=a.useState(!1),v=a.useMemo(()=>N?.filter(i=>i.roles?.some(c=>c.name==="Employee"))||[],[N]);a.useEffect(()=>{const i=h.map(c=>c.id.toString());r(c=>({...c,user_ids:i,date:F})),p(i.length===v.length),b({})},[h,F,_,v.length]);const n=(i,c)=>{r(f=>({...f,[i]:c})),x[i]&&b(f=>({...f,[i]:void 0}))},d=(i,c)=>{const f=i.toString();r(D=>({...D,user_ids:c?[...D.user_ids,f]:D.user_ids.filter(C=>C!==f)}))},k=i=>{p(i),r(c=>({...c,user_ids:i?v.map(f=>f.id.toString()):[]}))},$=a.useMemo(()=>{if(t.punch_in_time&&t.punch_out_time){const i=w(`${t.date} ${t.punch_in_time}`),c=w(`${t.date} ${t.punch_out_time}`);if(c.isAfter(i)){const f=c.diff(i,"minute"),D=Math.floor(f/60),C=f%60;return`${D}h ${C}m`}}return null},[t.punch_in_time,t.punch_out_time,t.date]),y=async i=>{i.preventDefault(),R(!0),b({});try{const c={user_ids:t.user_ids.map(D=>parseInt(D)),date:t.date,punch_in_time:t.punch_in_time,punch_out_time:t.punch_out_time||null,reason:t.reason||"Bulk marked present by administrator",location:t.location},f=await Z.post(route("attendance.bulk-mark-as-present"),c);if(f.status===200){const{data:D}=f.data,{summary:C}=f.data;C.successful>0&&W.success(`Successfully marked ${C.successful} employees as present!`),C.failed>0&&W.warning(`${C.failed} employees failed to be marked present.`),C.skipped>0&&W.info(`${C.skipped} employees were skipped (already have attendance).`),M(),m()}}catch(c){c.response?.status===422?(b(c.response.data.errors||{}),W.error(c.response.data.message||"Please check the form for errors")):W.error(c.response?.data?.message||"Failed to bulk mark users as present")}finally{R(!1)}},u=v.filter(i=>t.user_ids.includes(i.id.toString()));return e.jsx(Te,{isOpen:_,onClose:m,size:"4xl",radius:g(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(Ye,{children:i=>e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Bulk Mark as Present"})]}),e.jsxs(xe,{variant:"bordered",size:"sm",style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)"},children:[t.user_ids.length," selected"]})]})}),e.jsxs("form",{onSubmit:y,children:[e.jsx(Ue,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Date & Time Configuration"})]}),$&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded-md bg-success/10 text-success",children:["Duration: ",$]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(L,{label:"Date",type:"date",value:t.date,onValueChange:c=>n("date",c),isInvalid:!!x.date,errorMessage:x.date,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(J,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(L,{label:"Punch In Time",type:"time",value:t.punch_in_time,onValueChange:c=>n("punch_in_time",c),isInvalid:!!x.punch_in_time,errorMessage:x.punch_in_time,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(I,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(L,{label:"Punch Out Time (Optional)",type:"time",value:t.punch_out_time,onValueChange:c=>n("punch_out_time",c),isInvalid:!!x.punch_out_time,errorMessage:x.punch_out_time,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(I,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"Leave empty if employees are still working"})]})]}),e.jsx(se,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:["Select Employees (",t.user_ids.length," of ",v.length,")"]})]}),e.jsx(Pe,{isSelected:o,onValueChange:k,color:"primary",size:"sm",children:"Select All"})]}),e.jsx(ee,{children:e.jsx(te,{className:"p-4",children:e.jsx(Ae,{className:"max-h-64",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:v.map(c=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-default-50",children:[e.jsx(Pe,{isSelected:t.user_ids.includes(c.id.toString()),onValueChange:f=>d(c.id,f),color:"primary",size:"sm"}),e.jsx(me,{avatarProps:{size:"sm",src:c.profile_image_url,showFallback:!0,name:c.name},description:`ID: ${c.employee_id}`,name:c.name,classNames:{name:"text-sm",description:"text-xs"}})]},c.id))})})})}),x.user_ids&&e.jsx("p",{className:"text-danger text-sm",children:x.user_ids})]}),e.jsx(se,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Additional Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(L,{label:"Location",value:t.location,onValueChange:c=>n("location",c),isInvalid:!!x.location,errorMessage:x.location,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(ve,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(Ns,{label:"Reason (Optional)",placeholder:"Reason for bulk marking employees as present...",value:t.reason,onValueChange:c=>n("reason",c),isInvalid:!!x.reason,errorMessage:x.reason,variant:"bordered",size:"sm",radius:g(),minRows:3,maxRows:5,classNames:{input:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'}})]})]}),u.length>0&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ge,{className:"w-5 h-5 mt-0.5",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-sm mb-2",style:{color:"var(--theme-foreground)"},children:["Preview - ",u.length," employee",u.length!==1?"s":""," will be marked present"]}),e.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--theme-foreground-600)"},children:["Date: ",w(t.date).format("MMM D, YYYY")," | Time: ",t.punch_in_time,t.punch_out_time&&` to ${t.punch_out_time}`,$&&` (${$})`]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[u.slice(0,10).map(c=>e.jsx(xe,{size:"sm",variant:"flat",color:"primary",children:c.name},c.id)),u.length>10&&e.jsxs(xe,{size:"sm",variant:"flat",color:"default",children:["+",u.length-10," more"]})]})]})]})})]})}),e.jsxs(Ve,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(V,{color:"default",variant:"bordered",onPress:i,radius:g(),size:"sm",isDisabled:S,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(V,{type:"submit",color:"primary",variant:"solid",isLoading:S,isDisabled:S||t.user_ids.length===0,radius:g(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:S?"Processing...":`Mark ${t.user_ids.length} Employee${t.user_ids.length!==1?"s":""} as Present`})]})]})]})})})},Rs=({title:_,allUsers:m})=>{const{auth:F}=ie().props;ce("(max-width: 768px)"),ce("(max-width: 640px)");const[N,M]=a.useState(w().format("YYYY-MM-DD")),[h,g]=a.useState({type:null,selectedUsers:[],currentUser:null}),[t,r]=a.useState(0),[x,b]=a.useState({currentMonth:w().format("YYYY-MM")});a.useCallback((n,d=[],k=null)=>{g({type:n,selectedUsers:d,currentUser:k})},[]);const S=a.useCallback(()=>{g({type:null,selectedUsers:[],currentUser:null})},[]),R=a.useCallback(n=>{const d=n.target.value;M(d)},[]),o=a.useCallback(()=>{r(n=>n+1)},[]),p=a.useCallback((n,d)=>{g({type:"mark_as_present",selectedUsers:[],currentUser:n,selectedDate:d})},[]);a.useMemo(()=>{const n=w(N);return[{title:"Present Today",value:0,icon:e.jsx(K,{className:"w-5 h-5"}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Employees present"},{title:"Absent Today",value:0,icon:e.jsx(de,{className:"w-5 h-5"}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Employees absent"},{title:"Total Employees",value:m?.length||0,icon:e.jsx(ws,{className:"w-5 h-5"}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Date",value:n.format("MMM D"),icon:e.jsx(_s,{className:"w-5 h-5"}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:n.format("dddd")}]},[N,m]);const v=a.useMemo(()=>({open:!!h.type,closeModal:S,selectedDate:h.selectedDate||N,allUsers:m,refreshTimeSheet:o,selectedUsers:h.selectedUsers,currentUser:h.currentUser}),[h.type,S,h.selectedDate,N,m,o,h.selectedUsers,h.currentUser]);return F.permissions?.includes("attendance.view"),e.jsxs(e.Fragment,{children:[e.jsx(Ze,{title:_}),h.type==="mark_as_present"&&e.jsx(Ss,{...v}),h.type==="bulk_mark_as_present"&&e.jsx(Ms,{...v}),e.jsx(ks,{handleDateChange:R,selectedDate:N,updateTimeSheet:t,externalFilterData:x,externalEmployee:"",onMarkAsPresent:p})]})};Rs.layout=_=>e.jsx(rs,{children:_});export{Rs as default};
