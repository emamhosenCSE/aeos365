import{r as c,u as z,j as e,H as P,c as E,d as V,F as W,J as T,b as p,k as L,e as q,L as Q,n as h,a as H}from"./app-B1idACz3.js";import{I as B}from"./InstallationLayout-BiISO1NG.js";import{s as r}from"./toastUtils-CW5B8m6C.js";import{F as j}from"./CircleStackIcon-DdzMQ0P3.js";import{F as v}from"./CheckCircleIcon-znT6UY48.js";import{F as J}from"./PlusCircleIcon-ChwrtP31.js";import{F as U}from"./InformationCircleIcon-DqlZzEsT.js";import{c as Y}from"./chunk-C6WKGNND-DYIi9UqF.js";import{i as x}from"./chunk-SQIAVXJX-BmeQe73H.js";import{d as G}from"./chunk-IHO36JMK-_QcGGA4V.js";import{t as K}from"./chunk-AUA5GDXN-Dy7XAS6o.js";import{c as O}from"./chunk-NDVZOYT4-Co_i4Fag.js";import"./app-BmhO9GrS.js";import"./index-B22Xm-65.js";/* empty css                      */import"./chunk-VFIJPDYX-nQIpe2PR.js";import"./useProgressBar-Bpr0HQnj.js";import"./number-CB4zbwAz.js";import"./useLabel-BWLgnRON.js";import"./useLabels-xtEGP3rr.js";import"./useNumberFormatter-p89ekOdc.js";import"./NumberFormatter-DNR9MAW-.js";import"./chunk-KQW2TNLT-Cz1cLYHm.js";import"./index-BvevyAVm.js";import"./chunk-ICU6NNET-CXrsm0Bw.js";import"./index-BvG5LGgQ.js";import"./chunk-WQVQ7P2I-BDe9YmDI.js";import"./chunk-LGMZDQT5-BFW_lSqD.js";function Fe({dbConfig:u={},environmentIssues:w=[]}){const[o,l]=c.useState(null),[N,y]=c.useState(!1),[i,d]=c.useState(null),[k,D]=c.useState(!1),[b,f]=c.useState([]),[S,F]=c.useState(!1),[C,R]=c.useState(!1),{data:a,setData:m,post:X,processing:g,errors:n}=z({host:u.host||"localhost",port:u.port||"3306",database:u.database||"eos365",username:u.username||"root",password:u.password||""}),_=async()=>{y(!0),l(null);try{const s=await h.post(route("installation.test-database"),a);s.data.success?(l({success:!0,message:s.data.message}),r.success("Database connection successful!")):(l({success:!1,message:s.data.message}),r.error("Database connection failed"))}catch(s){const t=s.response?.data?.message||"Connection test failed";l({success:!1,message:t}),r.error(t)}finally{y(!1)}},A=async()=>{D(!0),d(null),f([]),R(!1);try{const s=await h.post(route("installation.test-server"),{host:a.host,port:a.port,username:a.username,password:a.password});s.data.success?(d({success:!0,message:s.data.message}),f(s.data.databases||[]),R(s.data.can_create_database||!1),r.success("Server connection successful!")):(d({success:!1,message:s.data.message}),r.error("Server connection failed"))}catch(s){const t=s.response?.data?.message||"Server connection test failed";d({success:!1,message:t}),r.error(t)}finally{D(!1)}},M=async()=>{if(!a.database){r.error("Please enter a database name");return}F(!0);try{const s=await h.post(route("installation.create-database"),{host:a.host,port:a.port,username:a.username,password:a.password,database:a.database});s.data.success?(r.success(s.data.message||"Database created successfully!"),f(t=>[...t,a.database]),_()):r.error(s.data.message||"Failed to create database")}catch(s){const t=s.response?.data?.message||"Failed to create database";r.error(t)}finally{F(!1)}},$=s=>{m("database",s),l(null)},I=s=>{if(s.preventDefault(),!o||!o.success){r.warning("Please test the database connection first");return}H.visit(route("installation.platform"))};return e.jsxs(B,{currentStep:4,children:[e.jsx(P,{title:"Installation - Database Configuration"}),e.jsxs(E,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                        var(--theme-content1, #FAFAFA) 20%, 
                        var(--theme-content2, #F4F4F5) 10%, 
                        var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsxs(Y,{className:"flex flex-col items-center gap-3 sm:gap-4 pt-6 sm:pt-8 pb-4 sm:pb-6 border-b border-divider",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-primary-100 dark:bg-primary-900/30 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"w-8 h-8 sm:w-10 sm:h-10 text-primary-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-1 sm:mb-2",children:"Database Configuration"}),e.jsx("p",{className:"text-sm sm:text-base text-default-600",children:"Configure your MySQL database connection"})]})]}),e.jsxs("form",{onSubmit:I,children:[e.jsx(V,{className:"px-4 sm:px-6 md:px-8 py-6 sm:py-8",children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[w.length>0&&e.jsx("div",{className:"bg-warning-50 dark:bg-warning-900/20 rounded-lg p-3 sm:p-4 border border-warning-200 dark:border-warning-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-warning-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-200 mb-2",children:"Environment Issues Detected:"}),e.jsx("ul",{className:"list-disc list-inside text-xs text-warning-700 dark:text-warning-300 space-y-1",children:w.map((s,t)=>e.jsx("li",{children:s},t))})]})]})}),e.jsxs("div",{className:"bg-default-50 dark:bg-default-100/10 rounded-lg p-4 border border-default-200 dark:border-default-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(T,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Step 1: Test Server Connection"})]}),e.jsx("p",{className:"text-xs text-default-500 mb-4",children:"First, verify your MySQL server is accessible. This will also show available databases."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4",children:[e.jsx(x,{label:"Database Host",placeholder:"localhost",value:a.host,onValueChange:s=>{m("host",s),d(null),l(null)},isInvalid:!!n.host,errorMessage:n.host,isRequired:!0,size:"sm",classNames:{inputWrapper:"bg-default-100"}}),e.jsx(x,{label:"Database Port",placeholder:"3306",value:a.port,onValueChange:s=>{m("port",s),d(null),l(null)},isInvalid:!!n.port,errorMessage:n.port,isRequired:!0,size:"sm",classNames:{inputWrapper:"bg-default-100"}})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4",children:[e.jsx(x,{label:"Database Username",placeholder:"root",value:a.username,onValueChange:s=>{m("username",s),d(null),l(null)},isInvalid:!!n.username,errorMessage:n.username,isRequired:!0,size:"sm",classNames:{inputWrapper:"bg-default-100"}}),e.jsx(x,{type:"password",label:"Database Password",placeholder:"Leave empty if no password",value:a.password,onValueChange:s=>{m("password",s),d(null),l(null)},isInvalid:!!n.password,errorMessage:n.password,size:"sm",classNames:{inputWrapper:"bg-default-100"}})]}),e.jsx(p,{type:"button",color:"secondary",variant:"flat",onPress:A,isLoading:k,isDisabled:!a.host||!a.port||!a.username,size:"sm",startContent:!k&&e.jsx(T,{className:"w-4 h-4"}),children:"Test Server Connection"}),i&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg border mt-3 ${i.success?"bg-success-50 dark:bg-success-900/20 border-success-200 dark:border-success-800":"bg-danger-50 dark:bg-danger-900/20 border-danger-200 dark:border-danger-800"}`,children:[i.success?e.jsx(v,{className:"w-5 h-5 text-success-600 flex-shrink-0"}):e.jsx(L,{className:"w-5 h-5 text-danger-600 flex-shrink-0"}),e.jsx("p",{className:`text-sm ${i.success?"text-success-800 dark:text-success-200":"text-danger-800 dark:text-danger-200"}`,children:i.message})]})]}),i?.success&&e.jsxs("div",{className:"bg-default-50 dark:bg-default-100/10 rounded-lg p-4 border border-default-200 dark:border-default-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(j,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Step 2: Select or Create Database"})]}),b.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-default-500 mb-2",children:"Available databases (click to select):"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(s=>e.jsx(q,{variant:a.database===s?"solid":"flat",color:a.database===s?"primary":"default",className:"cursor-pointer",onClick:()=>$(s),children:s},s))})]}),e.jsx(G,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-end",children:[e.jsx("div",{className:"flex-1 w-full",children:e.jsx(x,{label:"Database Name",placeholder:"eos365",value:a.database,onValueChange:s=>{m("database",s),l(null)},isInvalid:!!n.database,errorMessage:n.database,isRequired:!0,size:"sm",classNames:{inputWrapper:"bg-default-100"}})}),C&&!b.includes(a.database)&&a.database&&e.jsx(K,{content:"Create this database on the server",children:e.jsx(p,{type:"button",color:"success",variant:"flat",onPress:M,isLoading:S,size:"sm",startContent:!S&&e.jsx(J,{className:"w-4 h-4"}),children:"Create Database"})})]}),!C&&!b.includes(a.database)&&a.database&&e.jsxs("div",{className:"flex items-start gap-2 mt-3 p-3 bg-warning-50 dark:bg-warning-900/20 rounded-lg border border-warning-200 dark:border-warning-800",children:[e.jsx(U,{className:"w-4 h-4 text-warning-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-warning-700 dark:text-warning-300",children:"Your MySQL user doesn't have CREATE DATABASE privileges. Please create the database manually using phpMyAdmin or MySQL command line, or use a user with administrative privileges."})]})]}),i?.success&&a.database&&e.jsxs("div",{className:"bg-default-50 dark:bg-default-100/10 rounded-lg p-4 border border-default-200 dark:border-default-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(v,{className:"w-5 h-5 text-primary-600"}),e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Step 3: Verify Database Connection"})]}),e.jsx("p",{className:"text-xs text-default-500 mb-4",children:"Test the full database connection to ensure everything is configured correctly."}),e.jsx(p,{type:"button",color:"primary",variant:"flat",onPress:_,isLoading:N,isDisabled:!a.host||!a.port||!a.database||!a.username,size:"sm",startContent:!N&&e.jsx(j,{className:"w-4 h-4"}),children:"Test Database Connection"}),o&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg border mt-3 ${o.success?"bg-success-50 dark:bg-success-900/20 border-success-200 dark:border-success-800":"bg-danger-50 dark:bg-danger-900/20 border-danger-200 dark:border-danger-800"}`,children:[o.success?e.jsx(v,{className:"w-5 h-5 text-success-600 flex-shrink-0"}):e.jsx(L,{className:"w-5 h-5 text-danger-600 flex-shrink-0"}),e.jsx("p",{className:`text-sm ${o.success?"text-success-800 dark:text-success-200":"text-danger-800 dark:text-danger-200"}`,children:o.message})]})]})]})}),e.jsxs(O,{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 border-t border-divider px-4 sm:px-6 md:px-8 py-4 sm:py-6",children:[e.jsx(p,{as:Q,href:route("installation.requirements"),variant:"flat",color:"default",isDisabled:g,className:"w-full sm:w-auto order-2 sm:order-1",children:"Back"}),e.jsx(p,{type:"submit",color:"primary",isLoading:g,isDisabled:!o||!o.success||g,className:"w-full sm:w-auto order-1 sm:order-2",children:"Continue"})]})]})]})]})}export{Fe as default};
