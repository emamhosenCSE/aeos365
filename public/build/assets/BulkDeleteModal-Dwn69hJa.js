import{r as o,j as e,b as M,g as _e,e as ne,R as Fe,u as ze,p as Ne,d as O,c as ie,a as de,F as we,s as Xe}from"./app-D_-WVEdp.js";import{u as De,a as ts}from"./useMediaQuery-C9RChyNu.js";import{s as $}from"./toastUtils-ycRu2wJH.js";import{v as xe,M as Le,u as Me,aD as Ae,g as Se,au as rs,aq as as,az as ns,t as os}from"./App-BUqmM69P.js";import{D as qe}from"./index-3SaTkLKc.js";import{F as he}from"./CheckCircleIcon-BLFfNgko.js";import{u as Be}from"./index-UttBzQzf.js";import{m as ye,a as ge,b as ve,c as be}from"./chunk-TW2E3XVA-DRRpZ_vq.js";import{t as Pe}from"./chunk-WEIB4WXA-Cf-_iQ3U.js";import{m as je}from"./chunk-5LXTSPS7-BCVKdAIS.js";import{F as ls}from"./XCircleIcon-D6KDcGyr.js";import{F as is}from"./CheckCircleIcon-C2VXk29s.js";import{F as ds}from"./ClockIcon-BQdZYdg-.js";import{F as cs}from"./ExclamationTriangleIcon-ChGvqHTR.js";import{F as oe}from"./CalendarDaysIcon-Bilw7IDH.js";import{l as Ue}from"./chunk-3YGGVHYO-DexRuSoX.js";import{c as ms}from"./createLucideIcon-C1Lw2JZZ.js";import{F as Ze}from"./UserIcon-DG_m3xOa.js";import{F as us}from"./BriefcaseIcon-CF6Ga2Jm.js";import{c as ue,t as fs,a as ps,b as xs}from"./chunk-F3UDT23P-Do6efwEh.js";import{t as Re}from"./chunk-AUA5GDXN-DN3ZdlyW.js";import{d as Ve,a as He,b as We,m as Ee}from"./PlusIcon-Wgugrc1t.js";import{u as Oe}from"./chunk-NGIUTAK3-BBUe3TPm.js";import{a as Ye,s as Ce}from"./chunk-C3QHEOC2-DMWTZzTs.js";import{p as Ke}from"./chunk-NL7EUJG2-B61Hmqfn.js";import{t as hs,a as ys}from"./chunk-YRZGWF2W-BJdYbE6l.js";import{d as Te}from"./chunk-IHO36JMK-YsOKRYLU.js";import{p as gs}from"./chunk-VFIJPDYX-BIb_-4ja.js";import{C as Ie}from"./calendar-C5iwzKHx.js";import{U as vs}from"./user-Cd9TD6pS.js";import{C as Qe}from"./clock-U4t2_ODV.js";import{l as le}from"./chunk-Y5DMIIWQ-BglIhMCb.js";import{i as pe}from"./chunk-SQIAVXJX-BbTP8Q49.js";import{c as $e}from"./chunk-C6WKGNND-DzOcfHNA.js";import{F as Ge}from"./InformationCircleIcon-BG0xleBU.js";import{s as bs}from"./chunk-I3A4XRYQ-CJNCN2D_.js";const Je=ms("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);function js({leave:l,onApprovalComplete:b}){const{isOpen:j,onOpen:N,onClose:f}=Be(),{isOpen:w,onOpen:C,onClose:h}=Be(),[E,p]=o.useState(""),[S,_]=o.useState(""),[F,R]=o.useState(!1),[D,i]=o.useState({}),g=async()=>{R(!0),i({});try{const x=await ne.post(qe("leaves.approve",l.id),{comments:E||null});x.data.success?($.success(x.data.message||"Leave approved successfully"),f(),p(""),b&&b(x.data)):$.error(x.data.message||"Failed to approve leave")}catch(x){console.error("Approval error:",x),x.response?.data?.message?$.error(x.response.data.message):$.error("An error occurred while approving the leave")}finally{R(!1)}},d=async()=>{if(R(!0),i({}),!S||S.trim().length<10){i({reason:"Rejection reason must be at least 10 characters"}),R(!1);return}try{const x=await ne.post(qe("leaves.reject",l.id),{reason:S});x.data.success?($.success(x.data.message||"Leave rejected successfully"),h(),_(""),b&&b(x.data)):$.error(x.data.message||"Failed to reject leave")}catch(x){console.error("Rejection error:",x),x.response?.status===422?i(x.response.data.errors||{}):x.response?.data?.message?$.error(x.response.data.message):$.error("An error occurred while rejecting the leave")}finally{R(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{color:"success",variant:"solid",startContent:e.jsx(he,{className:"w-4 h-4"}),onPress:N,size:"sm",children:"Approve"}),e.jsx(M,{color:"danger",variant:"solid",startContent:e.jsx(_e,{className:"w-4 h-4"}),onPress:C,size:"sm",children:"Reject"})]}),e.jsx(ye,{isOpen:j,onClose:f,size:"md",children:e.jsxs(ge,{children:[e.jsx(ve,{children:"Approve Leave Request"}),e.jsxs(be,{children:[e.jsx("p",{className:"text-sm text-default-600 mb-4",children:"Are you sure you want to approve this leave request?"}),e.jsx(Pe,{label:"Comments (Optional)",placeholder:"Add any comments for the approval...",value:E,onValueChange:p,variant:"bordered",size:"sm",minRows:3,maxRows:5})]}),e.jsxs(je,{children:[e.jsx(M,{color:"default",variant:"bordered",onPress:f,size:"sm",isDisabled:F,children:"Cancel"}),e.jsx(M,{color:"success",onPress:g,size:"sm",isLoading:F,startContent:!F&&e.jsx(he,{className:"w-4 h-4"}),children:"Approve"})]})]})}),e.jsx(ye,{isOpen:w,onClose:h,size:"md",children:e.jsxs(ge,{children:[e.jsx(ve,{children:"Reject Leave Request"}),e.jsxs(be,{children:[e.jsx("p",{className:"text-sm text-default-600 mb-4",children:"Please provide a reason for rejecting this leave request."}),e.jsx(Pe,{label:"Rejection Reason",placeholder:"Explain why this leave is being rejected (minimum 10 characters)...",value:S,onValueChange:_,isInvalid:!!D.reason,errorMessage:D.reason,variant:"bordered",size:"sm",minRows:3,maxRows:5,isRequired:!0})]}),e.jsxs(je,{children:[e.jsx(M,{color:"default",variant:"bordered",onPress:h,size:"sm",isDisabled:F,children:"Cancel"}),e.jsx(M,{color:"danger",onPress:d,size:"sm",isLoading:F,startContent:!F&&e.jsx(_e,{className:"w-4 h-4"}),children:"Reject"})]})]})})]})}const Ns=Fe.forwardRef(({leaves:l,allUsers:b,handleClickOpen:j,setCurrentLeave:N,openModal:f,setLeaves:w,setCurrentPage:C,currentPage:h,totalRows:E,lastPage:p,perPage:S,selectedMonth:_,employee:F,isAdminView:R=!1,onBulkApprove:D,onBulkReject:i,onBulkDelete:g,canApproveLeaves:d=!1,canEditLeaves:x=!1,canDeleteLeaves:T=!1,fetchLeavesStats:V},Z)=>{const{auth:J}=ze().props,q=De("(min-width: 1025px)");De("(min-width: 641px) and (max-width: 1024px)");const ee=De("(max-width: 640px)"),[Y,te]=o.useState(!1),[s,y]=o.useState(null),[t,H]=o.useState(new Set);Fe.useMemo(()=>Array.from(t).join(", ").replaceAll("_"," "),[t]);const z=()=>{if(typeof window>"u")return"lg";const I=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",c=parseInt(I);return c===0?"none":c<=4?"sm":c<=8?"md":c<=16?"lg":"full"},W=Fe.useMemo(()=>{const n=t==="all",I=n||t.size>0,c=n?l.length:t.size;return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between gap-3 items-end",children:e.jsx("div",{className:"flex gap-3",children:I&&g&&e.jsxs(M,{color:"danger",variant:"flat",startContent:e.jsx(xe,{className:"w-4 h-4"}),onPress:()=>{const a=n?l:l.filter(r=>t.has(r.id.toString()));g(a)},style:{background:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-danger) 30%, transparent)",color:"var(--theme-danger)",borderRadius:z()},children:["Delete ",c," selected"]})})}),I&&e.jsxs("span",{className:"text-small opacity-70",style:{color:"var(--theme-foreground)"},children:[c," of ",l.length," selected"]})]})},[t,l,g]);J.permissions?.includes("leaves.view"),J.permissions?.includes("leave.own.view");const P={New:{color:"primary",icon:cs},Pending:{color:"warning",icon:ds},Approved:{color:"success",icon:is},Declined:{color:"danger",icon:ls}},B=n=>{switch(n?.toLowerCase()){case"casual":return e.jsx(us,{className:"w-3 h-3 text-blue-500"});case"weekend":return e.jsx(rs,{className:"w-3 h-3 text-yellow-500"});case"sick":return e.jsx(ts,{className:"w-3 h-3 text-red-500"});case"earned":return e.jsx(Ne,{className:"w-3 h-3 text-green-500"});default:return e.jsx(Se,{className:"w-3 h-3 text-primary"})}},A=o.useCallback(n=>{C&&C(n)},[C]),Q=o.useCallback(async(n,I)=>{if(n.status===I)return $.info(`Leave is already ${I}.`),Promise.resolve(`The leave status is already updated to ${I}`);const c=`${n.id}-${I}`;if(s===c)return;y(c);const a=new Promise(async(r,m)=>{try{const u=await ne.post(route("leave-update-status"),{id:n.id,status:I});u.status===200?(w(v=>v.map(K=>K.id===n.id?{...K,status:I}:K)),V(),r(u.data.message||"Leave status updated successfully")):m(u.data?.message||"Failed to update leave status")}catch(u){const v=u.response?.data?.message||u.response?.statusText||"Failed to update leave status";m(v)}finally{y(null)}});return $.promise(a,{loading:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),a},[w,s,V]),X=n=>{const c=(P[n]||P.New).icon,r=(m=>{switch(m.toLowerCase()){case"approved":return{bg:"color-mix(in srgb, var(--theme-success) 20%, transparent)",border:"color-mix(in srgb, var(--theme-success) 40%, transparent)",color:"var(--theme-success)"};case"rejected":return{bg:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",border:"color-mix(in srgb, var(--theme-danger) 40%, transparent)",color:"var(--theme-danger)"};case"pending":return{bg:"color-mix(in srgb, var(--theme-warning) 20%, transparent)",border:"color-mix(in srgb, var(--theme-warning) 40%, transparent)",color:"var(--theme-warning)"};default:return{bg:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",border:"color-mix(in srgb, var(--theme-primary) 40%, transparent)",color:"var(--theme-primary)"}}})(n);return e.jsx(O,{size:"sm",variant:"flat",startContent:e.jsx(c,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},style:{background:r.bg,border:`1px solid ${r.border}`,color:r.color,borderRadius:z()},children:n})},G=(n,I)=>{const c=new Date(n),a=new Date(I),r=Math.abs(a-c),m=Math.ceil(r/(1e3*60*60*24))+1;return m===1?"1 day":`${m} days`},k=n=>new Date(n).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),U=n=>b?.find(I=>String(I.id)===String(n))||{name:"Unknown User",phone:""},ce=({leave:n,updatingLeave:I,setCurrentLeave:c,openModal:a,handleClickOpen:r,updateLeaveStatus:m,canEditLeaves:u,canDeleteLeaves:v,canApproveLeaves:K,isAdminView:L})=>{const re=U(n.user_id),ss=G(n.from_date,n.to_date);return P[n.status]||P.New,e.jsx(ie,{className:"mb-2",style:{background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",backdropFilter:"blur(16px)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:z()},children:e.jsxs(de,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-3 flex-1",children:L&&e.jsx(Oe,{avatarProps:{src:re?.profile_image_url||re?.profile_image,size:"sm",name:re?.name||"Unnamed User",...Ae({name:re?.name||"Unnamed User",size:"sm"})},description:re?.phone?e.jsx(Ue,{href:`tel:${re?.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:re?.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(Je,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:re?.name||"Unnamed User"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[X(n.status),(u||v)&&e.jsxs(Ve,{children:[e.jsx(He,{children:e.jsx(M,{isIconOnly:!0,size:"sm",variant:"light",className:"min-w-8 h-8",children:e.jsx(Me,{className:"w-4 h-4"})})}),e.jsxs(We,{"aria-label":"Leave actions",children:[u&&e.jsx(Ee,{startContent:e.jsx(Le,{className:"w-4 h-4"}),onPress:()=>{c(n),a("edit_leave")},children:"Edit Leave"},"edit"),v&&e.jsx(Ee,{className:"text-danger",color:"danger",startContent:e.jsx(xe,{className:"w-4 h-4"}),onPress:()=>r(n.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e.jsx(Te,{className:"my-3"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:n.leave_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsxs("span",{className:"text-sm opacity-80",style:{color:"var(--theme-foreground)"},children:[k(n.from_date)," - ",k(n.to_date)]}),e.jsx(O,{size:"sm",variant:"bordered",style:{background:"color-mix(in srgb, var(--theme-content2) 50%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)",color:"var(--theme-foreground)",borderRadius:z()},children:ss})]}),n.reason&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 mt-0.5 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsx("span",{className:"text-sm flex-1 opacity-80",style:{color:"var(--theme-foreground)"},children:n.reason})]})]}),L&&K&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"my-3"}),e.jsx("div",{className:"flex gap-2",children:["Approved","Declined"].map(ae=>e.jsx(M,{size:"sm",variant:n.status===ae?"solid":"bordered",color:P[ae].color,isLoading:I===`${n.id}-${ae}`,onPress:()=>{I!==`${n.id}-${ae}`&&m(n,ae)},startContent:I!==`${n.id}-${ae}`?Fe.createElement(P[ae].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:ae},ae))})]})]})})},me=o.useCallback((n,I)=>{const c=U(n.user_id);switch(I){case"employee":return e.jsx(ue,{className:"whitespace-nowrap",children:e.jsx(Oe,{avatarProps:{src:c?.profile_image_url||c?.profile_image,size:"sm",name:c?.name||"Unnamed User",...Ae({name:c?.name||"Unnamed User",size:"sm"})},description:c?.phone?e.jsx(Ue,{href:`tel:${c?.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:c?.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(Je,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:c?.name||"Unnamed User"})})});case"leave_type":return e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[B(n.leave_type),e.jsx("span",{className:"text-sm font-medium capitalize",children:n.leave_type})]})});case"from_date":case"to_date":return e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",style:{color:"var(--theme-foreground)"},children:k(n[I])}),I==="from_date"&&e.jsx("div",{className:"text-xs opacity-60",style:{color:"var(--theme-foreground)"},children:G(n.from_date,n.to_date)})]})]})});case"status":const a=n.approval_chain&&n.status==="pending"&&n.approval_chain.some(r=>r.level===n.current_approval_level&&r.approver_id===J.user.id&&r.status==="pending");return e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[X(n.status),a?e.jsx(js,{leave:n,onApprovalComplete:()=>{V&&V(),window.location.reload()}}):R&&d&&e.jsxs(Ve,{children:[e.jsx(He,{children:e.jsx(M,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:s&&s.startsWith(`${n.id}-`),onPress:()=>{},className:"min-w-8 h-8",children:e.jsx(Me,{className:"w-4 h-4"})})}),e.jsx(We,{"aria-label":"Status actions",onAction:r=>Q(n,r),children:Object.keys(P).map(r=>{const m=P[r],u=m.icon;return e.jsx(Ee,{startContent:e.jsx(u,{className:"w-4 h-4"}),color:m.color,children:r},r)})})]})]})});case"reason":return e.jsx(ue,{children:e.jsx(Re,{content:n.reason||"No reason provided",children:e.jsx("span",{className:"max-w-xs truncate cursor-help text-xs opacity-70",style:{color:"var(--theme-foreground)"},children:n.reason||"No reason provided"})})});case"actions":return e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[x&&e.jsx(Re,{content:"Edit Leave",children:e.jsx(M,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",isDisabled:s&&s.startsWith(`${n.id}-`),onPress:()=>{s&&s.startsWith(`${n.id}-`)||(N(n),f("edit_leave"))},className:"min-w-8 h-8",children:e.jsx(Le,{className:"w-4 h-4"})})}),T&&e.jsx(Re,{content:"Delete Leave",color:"danger",children:e.jsx(M,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",isDisabled:s&&s.startsWith(`${n.id}-`),onPress:()=>{s&&s.startsWith(`${n.id}-`)||(N(n),j(n.id,"delete_leave"))},className:"min-w-8 h-8",children:e.jsx(xe,{className:"w-4 h-4"})})})]})});default:return e.jsx(ue,{children:n[I]})}},[R,d,x,T,q,s,N,f,j,Q,J,V]),fe=[...R?[{name:"Employee",uid:"employee",icon:Ze}]:[],{name:"Leave Type",uid:"leave_type",icon:Se},{name:"From Date",uid:"from_date",icon:oe},{name:"To Date",uid:"to_date",icon:oe},{name:"Status",uid:"status",icon:Ne},{name:"Reason",uid:"reason",icon:Se},...R?[{name:"Actions",uid:"actions"}]:[]];return ee?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ye,{className:"max-h-[70vh]",children:l.map(n=>e.jsx(ce,{leave:n,updatingLeave:s,setCurrentLeave:N,openModal:f,handleClickOpen:j,updateLeaveStatus:Q,canEditLeaves:x,canDeleteLeaves:T,canApproveLeaves:d,isAdminView:R},n.id))}),E>S&&e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(Ke,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:h,radius:z(),total:p,onChange:A,style:{fontFamily:'var(--fontFamily, "Inter")'}})})]}):e.jsxs("div",{children:[e.jsx(Ye,{className:"max-h-[70vh]",children:e.jsxs(fs,{isStriped:!0,setSelection:!0,selectionMode:R?"multiple":"none",selectedKeys:t,onSelectionChange:H,topContent:W,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",disabledBehavior:"selection",radius:z(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(hs,{columns:fe,children:n=>e.jsx(ys,{align:n.uid==="actions"?"center":"start",className:"backdrop-blur-md",style:{backgroundColor:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[n.icon&&e.jsx(n.icon,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-semibold",children:n.name})]})},n.uid)}),e.jsx(ps,{items:l,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(oe,{className:"w-12 h-12 mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),e.jsx("h6",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No leaves found"}),e.jsx("p",{className:"text-sm opacity-70",style:{color:"var(--theme-foreground)"},children:F?`No leaves found for "${F}"`:"No leave requests for the selected period"})]}),children:n=>e.jsx(xs,{className:"transition-all duration-200 hover:scale-[1.01]",style:{color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)"},children:I=>me(n,I)},n.id)})]})}),E>S&&e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(Ke,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:h,radius:z(),total:p,onChange:A,style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsxs("div",{className:"text-xs opacity-70",style:{color:"var(--theme-foreground)"},children:["Page ",h," of ",p," (Total: ",E," records)"]})]})]})});Ns.displayName="LeaveEmployeeTable";const es=({selectedDepartmentId:l,selectedEmployeeId:b,onDepartmentChange:j,onEmployeeChange:N,allUsers:f=[],departments:w=[],showSearch:C=!0,variant:h="outlined",size:E="medium",disabled:p=!1,required:S=!1,error:_={},label:F={department:"Department",employee:"Employee"},showAllOption:R=!0,autoSelectFirstDepartment:D=!0,className:i="",theme:g})=>{const d=()=>{if(typeof window>"u")return"lg";const y=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",t=parseInt(y);return t===0?"none":t<=4?"sm":t<=8?"md":t<=16?"lg":"full"},[x,T]=o.useState(""),[V,Z]=o.useState(""),[J,q]=o.useState(!1);o.useEffect(()=>{if(D&&w.length>0&&!l){const s=w[0];s&&j(s.id)}},[w,l,j,D]);const ee=o.useMemo(()=>x.trim()?w.filter(s=>s.name.toLowerCase().includes(x.toLowerCase())||s.id.toString().includes(x)):w,[w,x]),Y=o.useMemo(()=>l?f.filter(s=>String(s.department_id)===String(l)):R?f:[],[f,l,R]),te=o.useMemo(()=>V.trim()?Y.filter(s=>s.name.toLowerCase().includes(V.toLowerCase())||s.email?.toLowerCase().includes(V.toLowerCase())||s.id.toString().includes(V)||s.designation?.toLowerCase().includes(V.toLowerCase())):Y,[Y,V]);return o.useEffect(()=>{l&&b&&(Y.some(y=>String(y.id)===String(b))||N(""))},[l,b,Y,N]),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-4 ${i}`,children:[e.jsx("div",{children:e.jsxs(Ce,{label:F.department,placeholder:"Select Department",selectionMode:"single",selectedKeys:l!=null?new Set([String(l)]):new Set,onSelectionChange:s=>{const y=Array.from(s)[0],t=y===""||y===void 0||y===null?null:parseInt(y);j(t),b&&N(null),T(""),Z("")},isDisabled:p,isRequired:S,isInvalid:!!_.department_id,errorMessage:_.department_id,variant:"bordered",size:E==="medium"?"sm":E,radius:d(),className:"w-full",classNames:{trigger:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[R&&e.jsx(le,{value:"",textValue:"All Departments",children:e.jsx("span",{children:"All Departments"})},""),ee.map(s=>e.jsx(le,{value:String(s.id),textValue:s.name,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.name}),e.jsx(O,{size:"sm",variant:"bordered",className:"ml-auto text-xs",children:f.filter(y=>y.department_id===s.id).length})]})},String(s.id)))]})}),e.jsx("div",{children:e.jsxs(Ce,{label:F.employee,placeholder:!l&&!R?"Select department first":"Select Employee",selectionMode:"single",selectedKeys:b!=null?new Set([String(b)]):new Set,onSelectionChange:s=>{const y=Array.from(s)[0],t=y===""||y===void 0||y===null?null:parseInt(y);N(t),Z("")},isDisabled:p||J||!l&&!R,isRequired:S,isInvalid:!!_.user_id,errorMessage:_.user_id,variant:"bordered",size:E==="medium"?"sm":E,radius:d(),className:"w-full",classNames:{trigger:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[R&&e.jsx(le,{value:"",textValue:l?"All Employees in Department":"Select Department First",children:e.jsx("span",{children:l?"All Employees in Department":"Select Department First"})},""),te.map(s=>e.jsx(le,{value:String(s.id),textValue:s.name,children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(as,{src:s.profile_image_url||s.profile_image,size:"sm",name:s.name}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),s.designation&&e.jsx("span",{className:"text-xs text-gray-500",children:s.designation})]}),s.department&&e.jsx(O,{size:"sm",variant:"bordered",className:"text-xs h-5",children:s.department})]})},String(s.id))),te.length===0&&e.jsx(le,{isDisabled:!0,children:e.jsx("span",{className:"text-sm text-gray-500",children:l?"No employees found in selected department":"No employees found"})},"no-employees")]})})]})};function ws({approvalChain:l,currentLevel:b,status:j}){if(!l||l.length===0)return null;const N=h=>{switch(h){case"approved":return e.jsx(he,{className:"w-5 h-5 text-success"});case"rejected":return e.jsx(_e,{className:"w-5 h-5 text-danger"});case"pending":return e.jsx(Ne,{className:"w-5 h-5 text-warning"});default:return e.jsx(Ne,{className:"w-5 h-5 text-default-400"})}},f=h=>{switch(h){case"approved":return"success";case"rejected":return"danger";case"pending":return"warning";default:return"default"}},w=l.filter(h=>h.status==="approved").length,C=w/l.length*100;return e.jsx(ie,{className:"w-full",children:e.jsxs(de,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Approval Workflow"}),e.jsx(O,{size:"sm",color:f(j),variant:"flat",children:j||"Pending"})]}),e.jsx(gs,{value:C,color:j==="rejected"?"danger":"success",size:"sm",className:"mb-2"}),e.jsx("div",{className:"space-y-3",children:l.map((h,E)=>{const p=h.level===b;return h.level<b,e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg transition-colors ${p?"bg-warning-50 dark:bg-warning-900/20 border-l-3 border-warning":h.status==="approved"?"bg-success-50 dark:bg-success-900/20":h.status==="rejected"?"bg-danger-50 dark:bg-danger-900/20":"bg-default-100 dark:bg-default-50"}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:N(h.status)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground truncate",children:["Level ",h.level,": ",h.approver_name]}),p&&e.jsx(O,{size:"sm",color:"warning",variant:"flat",children:"Current"})]}),h.approved_at&&e.jsxs("p",{className:"text-xs text-default-500",children:[h.status==="approved"?"Approved":"Reviewed"," on"," ",new Date(h.approved_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),h.comments&&e.jsxs("p",{className:"text-xs text-default-600 mt-1 italic",children:['"',h.comments,'"']}),p&&h.status==="pending"&&e.jsx("p",{className:"text-xs text-warning-600 dark:text-warning-400 mt-1 font-medium",children:"Awaiting approval"})]})]},E)})}),j==="pending"&&e.jsxs("div",{className:"text-xs text-default-500 text-center pt-2 border-t border-divider",children:[w," of ",l.length," approvals completed"]})]})})}const it=({open:l,closeModal:b,leavesData:j,setLeavesData:N,currentLeave:f,allUsers:w,departments:C=[],setTotalRows:h,setLastPage:E,setLeaves:p,handleMonthChange:S,employee:_,selectedMonth:F,addLeaveOptimized:R,updateLeaveOptimized:D,fetchLeavesStats:i})=>{const g=()=>{if(typeof window>"u")return"lg";const r=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",m=parseInt(r);return m===0?"none":m<=4?"sm":m<=8?"md":m<=16?"lg":"full"},{auth:d}=ze().props,[x,T]=o.useState(f?.user_id||d.user.id),V=()=>f?.user_id?w?.find(r=>r.id===f.user_id)?.department_id||null:d?.user?.department_id||null,[Z,J]=o.useState(V()),[q,ee]=o.useState(j?.leaveTypes||[]),[Y,te]=o.useState([]),[s,y]=o.useState(f?.leave_type||""),t=a=>{if(!a)return new Date().toISOString().split("T")[0];if(typeof a=="string"&&a.match(/^\d{4}-\d{2}-\d{2}$/))return a;if(typeof a=="string"&&a.includes("T")){if(a.includes("T18:00:00")){const m=a.split("T")[0].split("-"),u=parseInt(m[0]),v=parseInt(m[1]),K=parseInt(m[2])+1;return new Date(u,v-1,K).toISOString().split("T")[0]}return a.split("T")[0]}try{const r=new Date(a);if(isNaN(r.getTime()))return new Date().toISOString().split("T")[0];const m=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),v=String(r.getDate()).padStart(2,"0");return`${m}-${u}-${v}`}catch(r){return console.error("Error formatting date:",r),new Date().toISOString().split("T")[0]}},[H,z]=o.useState(f?.from_date?t(f.from_date):""),[W,P]=o.useState(f?.to_date?t(f.to_date):""),[B,A]=o.useState(f?.no_of_days||""),[Q,X]=o.useState(""),[G,k]=o.useState(f?.reason||""),[U,ce]=o.useState({}),[me,fe]=o.useState(!1),[n,I]=o.useState("");o.useEffect(()=>{if(j){const a=j.leaveTypes||[];ee(a);const r=j.leaveCountsByUser?.[x]||[];if(te(r),a.length>0&&!s&&!f&&y(a[0].type),f&&!s){const m=a?.find(u=>u.id===f.leave_type);m&&y(m.type)}}},[j,x,f]),o.useEffect(()=>{if(f){T(f.user_id);const a=w?.find(r=>r.id===f.user_id);a?.department_id&&J(a.department_id)}},[f,w]),o.useEffect(()=>{if(!s||!Y||!q)return;const r=Y.find(u=>u.leave_type===s)?.days_used||0;I(r);const m=q.find(u=>u.type===s);if(m){const u=m.days-r;X(u),f&&B>u&&A(u)}},[s,Y,q,f,B]),o.useEffect(()=>{A(((r,m)=>{if(!r||!m)return"";const u=new Date(r),v=new Date(m);if(u>v)return"";const K=v.getTime()-u.getTime();return Math.ceil(K/(1e3*3600*24))+1})(H,W))},[H,W]);const c=async a=>{a.preventDefault(),fe(!0);const r=new Promise(async(m,u)=>{try{const v={route:route().current(),user_id:x,leaveType:s,fromDate:H,toDate:W,daysCount:B,leaveReason:G,employee:_,month:F},K=f?route("leave-update"):route("leave-add");f&&(v.id=f.id);const L=await axios.post(K,v);L.status===200||L.status===201?(N(L.data.leavesData),f&&D&&L.data.leave?(D(L.data.leave),i()):R&&L.data.leave?(R(L.data.leave),i(),L.data.pagination&&(h(L.data.pagination.total),E(L.data.pagination.lastPage))):(L.data.leaves&&(p(L.data.leaves.data),h(L.data.leaves.total),E(L.data.leaves.last_page)),L.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(L.data.leavesData)),b(),m([L.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",L.status),u(`Unexpected response status: ${L.status}`))}catch(v){console.error("Full error object:",v),v.response?(console.error("Error response status:",v.response.status),console.error("Error response data:",v.response.data),v.response.status===422?(ce(v.response.data.errors||{}),u(v.response.data.error||"Failed to submit leave application")):u(`HTTP Error ${v.response.status}: ${v.response.data.message||"An unexpected error occurred. Please try again later."}`)):v.request?(console.error("No response received:",v.request),u("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",v.message),u("An error occurred while setting up the request."))}finally{fe(!1)}});$.promise(r,{loading:"Submitting leave application...",success:m=>Array.isArray(m)?m.join(", "):m,error:m=>typeof m=="string"?m:"Failed to submit leave application"})};return e.jsx(ye,{isOpen:l,onClose:b,size:"3xl",radius:g(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ge,{children:a=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{size:20,style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:f?"Edit Leave":"Add Leave"})]})}),e.jsxs("form",{onSubmit:c,children:[e.jsx(be,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(Ce,{label:"Leave Type",placeholder:"Select Leave Type",selectionMode:"single",selectedKeys:s&&s!==""?new Set([s]):new Set,onSelectionChange:r=>{const m=Array.from(r)[0];y(m||"")},isInvalid:!!U.leaveType,errorMessage:U.leaveType,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(vs,{size:16,className:"text-default-400"}),classNames:{trigger:"min-h-unit-10",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:q.map(r=>{const m=Y?.find(K=>K.leave_type===r.type),v=(m?r.days-m.days_used:r.days)<=0;return e.jsx(le,{value:r.type,isDisabled:v,title:v?"No remaining leaves available":"",textValue:r.type,children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:r.type}),e.jsx("span",{className:"text-small text-default-500",children:m?`${m.days_used} / ${r.days} days`:`${r.days} days`})]})},r.type)})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(pe,{label:"From Date",type:"date",value:H,onValueChange:z,isInvalid:!!U.fromDate,errorMessage:U.fromDate,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(Ie,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(pe,{label:"To Date",type:"date",value:W,onValueChange:P,isInvalid:!!U.toDate,errorMessage:U.toDate,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(Ie,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(pe,{label:"Number of Days",value:B.toString(),isReadOnly:!0,isInvalid:!!U.daysCount,errorMessage:U.daysCount,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(Qe,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(pe,{label:"Remaining Leaves",value:`${Q} day${Q!==1?"s":""} of ${q.find(r=>r.type===s)?.days||0} total`,isReadOnly:!0,isInvalid:!!U.remainingLeaves,errorMessage:U.remainingLeaves,variant:"bordered",size:"sm",radius:g(),startContent:e.jsx(Qe,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),route().current()==="leaves"&&e.jsx("div",{className:"col-span-full",children:e.jsx(es,{selectedDepartmentId:Z,selectedEmployeeId:x,onDepartmentChange:J,onEmployeeChange:T,allUsers:w,departments:C,showSearch:!0,error:U,variant:"bordered",size:"sm",showAllOption:!1,autoSelectFirstDepartment:!0,required:!0})}),e.jsx("div",{className:"col-span-full",children:e.jsx(Pe,{label:"Leave Reason",placeholder:"Please provide a detailed reason for your leave request...",value:G,onValueChange:k,isInvalid:!!U.leaveReason,errorMessage:U.leaveReason,variant:"bordered",size:"sm",radius:g(),minRows:3,maxRows:5,classNames:{input:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),f&&f.approval_chain&&f.approval_chain.length>0&&e.jsx("div",{className:"col-span-full",children:e.jsx(ws,{approvalChain:f.approval_chain,currentLevel:f.current_approval_level,status:f.status})})]})}),e.jsxs(je,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(M,{color:"default",variant:"bordered",onPress:a,radius:g(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(M,{type:"submit",color:"primary",variant:"solid",isLoading:me,isDisabled:me,radius:g(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:me?"Submitting...":"Submit"})]})]})]})})})},dt=({open:l,closeModal:b,leaveId:j,setLeavesData:N,setLeaves:f,setTotalRows:w,setLastPage:C,setError:h,deleteLeaveOptimized:E,fetchLeavesStats:p})=>{const[S,_]=o.useState(!1),F=()=>{if(typeof window>"u")return"lg";const i=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",g=parseInt(i);return g===0?"none":g<=4?"sm":g<=8?"md":g<=16?"lg":"full"},R=async()=>{if(!j){$.error("Invalid leave ID provided");return}_(!0);const D=new Promise(async(i,g)=>{try{const d=await ne.delete(route("leave-delete",{id:j,route:route().current()}));d.status===200&&(E?(E(j),w(x=>Math.max(0,x-1)),p&&p()):(N&&N(d.data.leavesData),w&&w(d.data.leaves.total),C&&C(d.data.leaves.last_page),f&&f(d.data.leaves.data),h&&h(!1),p&&p()),i("Leave application deleted successfully"))}catch(d){if(console.error("Error deleting leave:",d),d.response?.status===404){const{leavesData:x}=d.response.data||{};N&&x&&N(x),h&&h(d.response?.data?.message||"Leave not found."),g("Leave not found or already deleted")}else d.response?.status===403?g("You do not have permission to delete this leave"):d.response?.status===422?g("Cannot delete leave with current status"):g(d.response?.data?.error||"Failed to delete leave application")}finally{_(!1),b()}});$.promise(D,{pending:"Deleting leave application...",success:{render({data:i}){return i}},error:{render({data:i}){return i}}})};return e.jsx(ye,{isOpen:l,onClose:b,size:"md",radius:F(),classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"py-6",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},isDismissable:!S,hideCloseButton:S,children:e.jsx(ge,{children:D=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:"color-mix(in srgb, #ef4444 15%, transparent)",color:"#ef4444"},children:e.jsx(we,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")',color:"var(--theme-foreground)"},children:"Confirm Deletion"})]})}),e.jsx(be,{style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{className:"w-5 h-5 mt-0.5 flex-shrink-0",style:{color:"#ef4444"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Are you sure you want to delete this leave application?"}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"This action cannot be undone. The leave application will be permanently removed from the system."})]})]})}),e.jsxs(je,{className:"flex justify-end gap-2 px-6 py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(M,{color:"default",variant:"bordered",onPress:D,radius:F(),size:"sm",isDisabled:S,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(M,{color:"danger",variant:"solid",onPress:R,radius:F(),size:"sm",isLoading:S,isDisabled:S,startContent:!S&&e.jsx(xe,{className:"w-4 h-4"}),style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:S?"Deleting...":"Delete Leave"})]})]})})})},se=()=>{if(typeof window>"u")return"lg";const b=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",j=parseInt(b);return j===0?"none":j<=4?"sm":j<=8?"md":j<=12?"lg":"xl"},Fs=({selectedDates:l=[],onDatesChange:b,existingLeaves:j=[],publicHolidays:N=[],minDate:f=null,maxDate:w=null,userId:C=null,fetchFromAPI:h=!1})=>{const[E,p]=o.useState(new Date),[S,_]=o.useState({existingLeaves:j,publicHolidays:N}),[F,R]=o.useState(!1),[D,i]=o.useState(null),g=o.useCallback(async s=>{if(!(!h||!C)&&D!==s){R(!0);try{const y=await ne.get(route("leaves.bulk.calendar-data"),{params:{user_id:C,year:s}});y.data.success&&(_({existingLeaves:y.data.data.existingLeaves||[],publicHolidays:y.data.data.publicHolidays||[]}),i(s))}catch(y){console.error("Failed to fetch calendar data:",y)}finally{R(!1)}}},[h,C,D]);o.useEffect(()=>{const s=E.getFullYear();g(s)},[g,E.getFullYear()]),o.useEffect(()=>{h&&C&&i(null)},[C,h]);const d=h?S.existingLeaves:j,x=h?S.publicHolidays:N,T=o.useMemo(()=>{const s=E.getFullYear(),y=E.getMonth(),t=new Date(s,y,1),z=new Date(s,y+1,0).getDate(),W=t.getDay(),P=new Date(s,y,0).getDate(),B=[];for(let k=W-1;k>=0;k--)B.push({date:P-k,isCurrentMonth:!1,fullDate:new Date(s,y-1,P-k)});const A=[];for(let k=1;k<=z;k++)A.push({date:k,isCurrentMonth:!0,fullDate:new Date(s,y,k)});const X=42-(B.length+A.length),G=[];for(let k=1;k<=X;k++)G.push({date:k,isCurrentMonth:!1,fullDate:new Date(s,y+1,k)});return[...B,...A,...G]},[E]),V=o.useCallback(()=>{p(s=>new Date(s.getFullYear(),s.getMonth()-1,1))},[]),Z=o.useCallback(()=>{p(s=>new Date(s.getFullYear(),s.getMonth()+1,1))},[]),J=o.useCallback(()=>{p(new Date)},[]),q=o.useCallback(s=>{if(!s.isCurrentMonth||F)return;const y=s.fullDate.getFullYear()+"-"+String(s.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(s.fullDate.getDate()).padStart(2,"0"),t=d.some(P=>{if(!P.from_date||!P.to_date)return!1;const B=P.from_date.split("T")[0],A=P.to_date.split("T")[0];return y>=B&&y<=A}),H=x.includes(y);if(t||H||f&&s.fullDate<new Date(f)||w&&s.fullDate>new Date(w))return;const z=l.includes(y);let W;z?W=l.filter(P=>P!==y):W=[...l,y],b(W.sort())},[l,b,f,w,F,d,x]),ee=o.useCallback(s=>{if(!s.isCurrentMonth)return{selectable:!1};const y=s.fullDate.getFullYear()+"-"+String(s.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(s.fullDate.getDate()).padStart(2,"0"),t=l.includes(y),H=s.fullDate.toDateString()===new Date().toDateString(),z=s.fullDate<new Date().setHours(0,0,0,0),W=s.fullDate.getDay()===0||s.fullDate.getDay()===6,P=d.some(Q=>{if(!Q.from_date||!Q.to_date)return!1;const X=Q.from_date.split("T")[0],G=Q.to_date.split("T")[0];return y>=X&&y<=G}),B=x.includes(y),A=!F&&!P&&!B&&(!f||s.fullDate>=new Date(f))&&(!w||s.fullDate<=new Date(w));return{isSelected:t,isToday:H,isPast:z,isWeekend:W,hasExistingLeave:P,isPublicHoliday:B,selectable:A}},[l,d,x,f,w,F]),Y=E.toLocaleDateString("en-US",{month:"long",year:"numeric"}),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs(ie,{radius:se(),className:"w-full shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                    color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                    color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx($e,{className:"pb-3 px-4 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 sm:w-5 sm:h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:Y}),h&&D&&e.jsx(O,{size:"sm",variant:"bordered",color:"primary",className:"ml-2 text-xs hidden sm:flex",radius:se(),style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:D})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{isIconOnly:!0,size:"sm",variant:"light",onClick:V,isDisabled:F,radius:se(),className:"min-w-8 h-8",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(ns,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx(M,{size:"sm",variant:"light",onClick:J,isDisabled:F,radius:se(),className:"px-2 py-1 text-xs hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Today"}),e.jsx(M,{isIconOnly:!0,size:"sm",variant:"light",onClick:Z,isDisabled:F,radius:se(),className:"min-w-8 h-8",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(os,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]})}),e.jsxs(de,{className:"pt-0 px-4 pb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[F&&e.jsxs("div",{className:"flex justify-center items-center py-4 rounded-lg mb-4",style:{background:"var(--theme-content2, #F4F4F5)",borderColor:"var(--theme-divider, #E4E4E7)"},children:[e.jsx(Xe,{size:"sm",color:"primary"}),e.jsxs("span",{className:"ml-2 text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:["Loading calendar data for ",E.getFullYear(),"..."]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mb-4",children:[e.jsx(O,{size:"sm",color:"primary",variant:"solid",radius:se(),className:"text-xs font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Selected"}),e.jsx(O,{size:"sm",color:"danger",variant:"solid",radius:se(),className:"text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Leave"}),e.jsx(O,{size:"sm",color:"warning",variant:"solid",radius:se(),className:"text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Holiday"}),e.jsx(O,{size:"sm",color:"secondary",variant:"solid",radius:se(),className:"text-xs font-medium hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Today"}),e.jsx(O,{size:"sm",color:"default",variant:"bordered",radius:se(),className:"text-xs hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Weekend"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0.5 sm:gap-1 mb-2",children:te.map(s=>e.jsx("div",{className:"flex items-center justify-center w-8 h-6 sm:w-10 sm:h-8 text-xs sm:text-sm font-medium",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-0.5 sm:gap-1",children:T.map((s,y)=>{const t=ee(s);return e.jsxs("div",{onClick:()=>q(s),className:`
                                    relative flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 min-h-8 sm:min-h-10
                                    rounded-md transition-all duration-200 text-xs sm:text-sm select-none
                                    ${t.selectable?"cursor-pointer":"cursor-not-allowed"}
                                    ${s.isCurrentMonth?"":"opacity-30"}
                                    ${F?"opacity-50 pointer-events-none":""}
                                    ${t.isSelected?"font-bold border-2 shadow-md scale-105 z-10":""}
                                    ${t.hasExistingLeave&&!t.isSelected?"border-2 font-medium cursor-not-allowed":""}
                                    ${t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"border-2 font-medium cursor-not-allowed":""}
                                    ${t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"font-semibold border-2 shadow-sm":""}
                                    ${t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"border opacity-70":""}
                                    ${!t.selectable&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"cursor-not-allowed opacity-60":""}
                                    ${t.selectable&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"border border-transparent hover:scale-105":""}
                                `,style:{backgroundColor:t.isSelected?"var(--theme-primary)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-200)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday||F?"var(--theme-content2)":"transparent",color:t.isSelected?"var(--theme-primary-foreground)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger-foreground)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning-foreground)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-800)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"var(--theme-foreground-500)":!t.selectable&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"var(--theme-foreground-400)":"var(--theme-foreground-900)",borderColor:t.isSelected?"var(--theme-primary-600)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger-600)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning-600)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-500)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"var(--theme-divider)":"transparent",borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},role:"button",tabIndex:t.selectable?0:-1,title:t.hasExistingLeave?"Existing leave - cannot select":t.isPublicHoliday?"Public holiday - cannot select":t.selectable?"":"Not selectable","aria-label":`${s.fullDate.toDateString()}${t.isSelected?" (selected)":""}${t.hasExistingLeave?" (existing leave)":""}${t.isPublicHoliday?" (public holiday)":""}`,onKeyDown:H=>{(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),q(s))},children:[s.date,t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&e.jsx("div",{className:"absolute top-0.5 right-0.5 w-1 h-1 rounded-full opacity-50 hidden sm:block",style:{backgroundColor:"var(--theme-foreground-500)"}})]},y)})}),l.length>0&&e.jsxs("div",{className:"mt-4 p-3 sm:p-4 rounded-lg relative overflow-hidden",style:{background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-primary) 10%, transparent) 20%, 
                            color-mix(in srgb, var(--theme-primary) 5%, transparent) 80%)`,border:"1px solid color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"text-xs sm:text-sm font-semibold mb-2",style:{color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:["ðŸ“… ",l.length," date",l.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.slice(0,8).map(s=>e.jsx(O,{size:"sm",color:"primary",variant:"solid",radius:se(),className:"text-xs font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})},s)),l.length>8&&e.jsxs(O,{size:"sm",color:"primary",variant:"bordered",radius:se(),className:"text-xs font-medium",style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:["+",l.length-8," more"]})]})]}),e.jsx("div",{className:"absolute -top-2 -right-2 w-12 h-12 rounded-full opacity-30",style:{backgroundColor:"var(--theme-primary)"}})]})]})]})},ke=()=>{if(typeof window>"u")return"lg";const b=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",j=parseInt(b);return j===0?"none":j<=4?"sm":j<=8?"md":j<=12?"lg":"xl"},Ss=({validationResults:l=[],balanceImpact:b=null,isValidating:j=!1})=>{if(l.length===0&&!j)return null;const N=l.filter(p=>p.status==="valid").length,f=l.filter(p=>p.status==="warning").length,w=l.filter(p=>p.status==="conflict").length;l.length;const C=p=>{const S={className:"w-4 h-4"};switch(p){case"valid":return e.jsx(he,{...S,style:{color:"var(--theme-success, #22C55E)"}});case"warning":return e.jsx(we,{...S,style:{color:"var(--theme-warning, #F59E0B)"}});case"conflict":return e.jsx(_e,{...S,style:{color:"var(--theme-danger, #EF4444)"}});default:return e.jsx(Ge,{...S,style:{color:"var(--theme-foreground-400, #A1A1AA)"}})}},h=p=>{switch(p){case"valid":return"success";case"warning":return"warning";case"conflict":return"danger";default:return"default"}},E=p=>new Date(p).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[e.jsxs(ie,{radius:ke(),className:"shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                        color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                        color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx($e,{className:"pb-2 px-4 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Validation Results"}),j&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{size:"sm",color:"primary"}),e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Validating..."})]})]})}),e.jsxs(de,{className:"pt-0 px-4 pb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-success, #22C55E)",fontFamily:'var(--fontFamily, "Inter")'},children:N}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-success, #22C55E)",fontFamily:'var(--fontFamily, "Inter")'},children:"Valid"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-warning, #F59E0B)",fontFamily:'var(--fontFamily, "Inter")'},children:f}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-warning, #F59E0B)",fontFamily:'var(--fontFamily, "Inter")'},children:"Warnings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-danger, #EF4444)",fontFamily:'var(--fontFamily, "Inter")'},children:w}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-danger, #EF4444)",fontFamily:'var(--fontFamily, "Inter")'},children:"Conflicts"})]})]}),b&&e.jsxs("div",{className:"p-3 sm:p-4 rounded-lg border",style:{background:"var(--theme-content2, #F4F4F5)",borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 8px)"},children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-medium mb-3 sm:mb-4 flex items-center gap-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ge,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}}),"Leave Balance Impact"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Leave Type:"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:b.leave_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Current Balance:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[b.current_balance," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Requested Days:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[b.requested_days," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Remaining Balance:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{color:b.remaining_balance<0?"var(--theme-danger)":"var(--theme-success)",fontFamily:'var(--fontFamily, "Inter")'},children:[b.remaining_balance," days"]})]})]}),b.remaining_balance<0&&e.jsx("div",{className:"mt-3 p-2 sm:p-3 rounded-md border",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["âš ï¸ This request exceeds your available leave balance by ",Math.abs(b.remaining_balance)," days."]})})]})]})]}),l.length>0&&e.jsxs(ie,{radius:ke(),className:"shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                            color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx($e,{className:"px-4 pt-4 pb-2",children:e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Date-by-Date Results"})}),e.jsx(de,{className:"px-4 pb-4 pt-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex flex-col gap-2 max-h-40 overflow-y-auto",children:l.map((p,S)=>e.jsxs("div",{className:"flex items-start justify-between p-3 rounded-lg border transition-colors",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 8px)"},onMouseEnter:_=>{_.target.style.borderColor="var(--theme-divider-hover, #D4D4D8)"},onMouseLeave:_=>{_.target.style.borderColor="var(--theme-divider, #E4E4E7)"},children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[C(p.status),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:E(p.date)}),e.jsx("p",{className:"text-xs opacity-75",style:{color:"var(--theme-foreground-500, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:p.date})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(O,{size:"sm",variant:"bordered",color:h(p.status),radius:ke(),className:"capitalize text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:p.status}),p.errors&&p.errors.length>0&&e.jsx("div",{className:"text-right",children:p.errors.map((_,F)=>e.jsx("p",{className:"text-xs",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:_},F))}),p.warnings&&p.warnings.length>0&&e.jsx("div",{className:"text-right",children:p.warnings.map((_,F)=>e.jsx("p",{className:"text-xs",style:{color:"var(--theme-warning)",fontFamily:'var(--fontFamily, "Inter")'},children:_},F))})]})]},S))})})]})]})},ct=({open:l,onClose:b,onSuccess:j,allUsers:N=[],departments:f=[],leavesData:w={leaveTypes:[],leaveCountsByUser:{}},isAdmin:C=!1,existingLeaves:h=[],publicHolidays:E=[]})=>{const{auth:p}=ze().props,S=()=>{if(typeof window>"u")return"lg";const a=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",r=parseInt(a);return r===0?"none":r<=4?"sm":r<=8?"md":r<=16?"lg":"full"},[_,F]=o.useState([]),[R,D]=o.useState(null),[i,g]=o.useState(null),[d,x]=o.useState(""),[T,V]=o.useState(""),[Z,J]=o.useState(!1),[q,ee]=o.useState([]),[Y,te]=o.useState(!1),[s,y]=o.useState([]),[t,H]=o.useState(null),[z,W]=o.useState(!1),[P,B]=o.useState(!1),[A,Q]=o.useState(!1),[X,G]=o.useState({});o.useMemo(()=>!h||h.length===0?[]:h.filter(c=>c.user_id===parseInt(i)),[h,i]);const k=o.useMemo(()=>q.length>0?q:w?.leaveTypes||[],[q,w]),U=o.useMemo(()=>q.length>0?q.map(c=>({leave_type:c.type,days_used:c.used,total_days:c.days,remaining_days:c.remaining})):w?.leaveCountsByUser?.[i]||[],[q,w,i]),ce=o.useCallback(async c=>{if(c){te(!0);try{const a=await ne.get(route("leaves.bulk.leave-types"),{params:{user_id:c,year:new Date().getFullYear()}});a.data.success&&ee(a.data.leave_types)}catch(a){console.error("Failed to fetch user leave types:",a),ee([])}finally{te(!1)}}},[]);o.useEffect(()=>{(l&&i&&C||l&&i&&!C)&&ce(i)},[i,l,C,ce]),o.useEffect(()=>{if(l&&p?.user){const c=N?.find(a=>a.id===p.user.id);(c&&c.department_id&&!C||C&&!R&&!i&&c&&c.department_id)&&(D(c.department_id),g(p.user.id))}},[l,p?.user,N,C,R,i]),o.useEffect(()=>{l||(F([]),D(null),g(p?.user?.id||null),x(""),V(""),J(!1),y([]),H(null),B(!1),G({}),ee([]))},[l,p?.user?.id]),o.useEffect(()=>{if(k.length>0&&!d&&l&&i){const c=k.find(a=>{if(q.length>0)return a.remaining>0;const r=U?.find(u=>u.leave_type===a.type);return(r?a.days-r.days_used:a.days)>0});c&&x(c.type)}},[k,U,q,d,l,i]);const me=o.useCallback(async()=>{if(_.length===0){const c=Promise.reject(new Error("No dates selected"));$.promise(c,{error:"Please select at least one date"});return}if(!d){const c=Promise.reject(new Error("No leave type selected"));$.promise(c,{error:"Please select a leave type"});return}if(!T.trim()||T.trim().length<5){const c=Promise.reject("Please provide a reason for leave (at least 5 characters)");$.promise(c,{error:"Please provide a reason for leave (at least 5 characters)"});return}W(!0),G({});try{const c=k.find(r=>r.type===d),a=await ne.post(route("leaves.bulk.validate"),{user_id:parseInt(i),dates:_,leave_type_id:c?.id,reason:T.trim()});if(a.data.success){y(a.data.validation_results),H(a.data.estimated_balance_impact),B(!0);const r=a.data.validation_results.filter(v=>v.status==="conflict").length,m=a.data.validation_results.filter(v=>v.status==="warning").length,u=Promise.resolve();r>0?$.promise(u,{success:`${r} date(s) have conflicts. Please review before submitting.`}):m>0?$.promise(u,{success:`${m} date(s) have warnings. You may proceed if acceptable.`}):$.promise(u,{success:"All dates validated successfully!"})}}catch(c){console.error("Validation error:",c),c.response?.status===422&&G(c.response.data.errors||{});const a=Promise.reject(c);$.promise(a,{error:c.response?.data?.message||"Failed to validate dates"})}finally{W(!1)}},[_,d,T,i,k]),fe=o.useCallback(async()=>{if(!P){const r=Promise.reject(new Error("Not validated"));$.promise(r,{error:"Please validate dates before submitting"});return}if(s.filter(r=>r.status==="conflict").length>0&&!Z){const r=Promise.reject("Please resolve conflicts or enable partial success mode");$.promise(r,{error:"Please resolve conflicts or enable partial success mode"});return}Q(!0);const a=new Promise(async(r,m)=>{try{const u=k.find(K=>K.type===d),v=await ne.post(route("leaves.bulk.store"),{user_id:parseInt(i),dates:_,leave_type_id:u?.id,reason:T.trim(),allow_partial_success:Z});v.status===200||v.status===201?(j?.(v.data),b(),r([v.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",v.status),m(`Unexpected response status: ${v.status}`))}catch(u){console.error("Full error object:",u),u.response?(console.error("Error response status:",u.response.status),console.error("Error response data:",u.response.data),u.response.status===422?(G(u.response.data.errors||{}),m(u.response.data.error||"Failed to submit bulk leave requests")):m(`HTTP Error ${u.response.status}: ${u.response.data.message||"An unexpected error occurred. Please try again later."}`)):u.request?(console.error("No response received:",u.request),m("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",u.message),m("An error occurred while setting up the request."))}finally{Q(!1)}});$.promise(a,{pending:"Creating bulk leave requests...",success:{render({data:r}){return r.join(", ")}},error:{render({data:r}){return r}}})},[P,s,Z,i,_,d,T,j,b,k]),n=_.length>0&&d&&T.trim().length>=5,I=P&&(s.filter(c=>c.status==="conflict").length===0||Z);return e.jsx(ye,{isOpen:l,onClose:b,size:"5xl",radius:S(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md max-h-[95vh] my-2",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider flex-shrink-0",body:"overflow-y-auto max-h-[calc(95vh-160px)]",footer:"border-t border-divider flex-shrink-0",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ge,{children:c=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"flex flex-col gap-1 py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 sm:w-6 sm:h-6",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Add Bulk Leave"}),e.jsx("p",{className:"text-sm text-default-500 mt-0.5",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Select multiple dates and create leave requests in batch"})]})]})}),e.jsx(be,{className:"py-4 px-4 sm:py-6 sm:px-6 overflow-y-auto",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",style:{color:"var(--theme-foreground-900, #18181B)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(oe,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),"Select Dates"]}),e.jsx(Fs,{selectedDates:_,onDatesChange:a=>{F(a),B(!1)},userId:i,fetchFromAPI:!0})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",style:{color:"var(--theme-foreground-900, #18181B)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ze,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),"Leave Details"]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[C&&N.length>0&&e.jsx(es,{selectedDepartmentId:R,selectedEmployeeId:i,onDepartmentChange:D,onEmployeeChange:a=>{g(a),x(""),B(!1),ee([])},allUsers:N,departments:f,showSearch:!0,error:X,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!1,required:!0,disabled:A||z}),e.jsx("div",{children:e.jsx(Ce,{label:"Leave Type",placeholder:"Select Leave Type",selectionMode:"single",selectedKeys:d?new Set([d]):new Set,onSelectionChange:a=>{const r=Array.from(a)[0];x(r||""),B(!1)},isDisabled:A||z||Y,isInvalid:!!X.leave_type_id,errorMessage:X.leave_type_id,variant:"bordered",size:"sm",radius:S(),classNames:{trigger:"min-h-unit-10",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:Y?e.jsx(le,{isDisabled:!0,children:"Loading leave types..."},"loading"):k.map(a=>{let r,m;if(q.length>0)r=a.remaining,m=r<=0;else{const u=U?.find(v=>v.leave_type===a.type);r=u?a.days-u.days_used:a.days,m=r<=0}return e.jsx(le,{value:a.type,isDisabled:m,title:m?"No remaining leaves available":"",textValue:a.type,children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:a.type}),e.jsxs("span",{children:["(",r," remaining)"]})]})},a.type)})})}),d&&e.jsx(pe,{label:"Remaining Leaves",value:(()=>{const a=k.find(u=>u.type===d);let r,m;if(q.length>0&&a)r=a.remaining,m=a.days;else{const u=U?.find(v=>v.leave_type===d);r=u?a?.days-u.days_used:a?.days,m=a?.days}return`${r||0} remaining of ${m||0} total`})(),isReadOnly:!0,variant:"bordered",size:"sm",radius:S(),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(pe,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:T,onChange:a=>{V(a.target.value),B(!1)},isRequired:!0,isInvalid:!!X.reason||T.length>0&&T.length<5,errorMessage:X.reason||(T.length>0&&T.length<5?"Reason must be at least 5 characters":`${T.length}/500 characters`),maxLength:500,isDisabled:A||z,variant:"bordered",size:"sm",radius:S(),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(bs,{isSelected:Z,onValueChange:J,size:"sm",isDisabled:A||z}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allow partial success"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Valid dates will be processed even if some dates fail validation"})]})]})]})]}),_.length>0&&e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",style:{borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                            color-mix(in srgb, var(--theme-content1) 30%, transparent) 20%, 
                                            color-mix(in srgb, var(--theme-content2) 20%, transparent) 10%)`,fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Selected Dates Summary"}),e.jsxs("p",{className:"text-base font-medium text-gray-900 dark:text-white",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("strong",{children:_.length})," date",_.length!==1?"s":""," selected"]}),d&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Leave type: ",d]})]}),e.jsx(Ss,{validationResults:s,balanceImpact:t,isValidating:z})]})})]})}),e.jsxs(je,{className:"flex flex-col sm:flex-row justify-between items-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(M,{variant:"light",onPress:c,isDisabled:A,radius:S(),className:"w-full sm:w-auto order-2 sm:order-1",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto order-1 sm:order-2",children:[e.jsx(M,{variant:"bordered",color:"primary",onPress:me,isLoading:z,isDisabled:!n||A,startContent:!z&&e.jsx(we,{className:"w-4 h-4"}),radius:S(),className:"w-full sm:w-auto",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("span",{className:"truncate",children:z?"Validating...":"Validate Dates"})}),e.jsx(M,{variant:"solid",color:"primary",onPress:fe,isLoading:A,isDisabled:!I||z,startContent:!A&&e.jsx(he,{className:"w-4 h-4"}),radius:S(),className:"w-full sm:w-auto",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("span",{className:"truncate",children:A?"Creating...":`Create ${_.length} Leave${_.length!==1?"s":""}`})})]})]})]})})})},mt=({open:l,onClose:b,onSuccess:j,selectedLeaves:N=[],allUsers:f=[]})=>{const w=()=>{if(typeof window>"u")return"lg";const i=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",g=parseInt(i);return g===0?"none":g<=4?"sm":g<=8?"md":g<=16?"lg":"full"},[C,h]=o.useState(!1),[E,p]=o.useState({}),S=o.useCallback(D=>f.find(g=>g.id===D)?.name||`User ID: ${D}`,[f]),_=N.filter(D=>D.status&&D.status.toLowerCase()==="approved"),F=_.length===0,R=o.useCallback(async()=>{if(!F){const i=Promise.reject("Cannot delete approved leaves");$.promise(i,{error:"Cannot delete approved leave requests"});return}if(N.length===0){const i=Promise.reject("No leaves selected");$.promise(i,{error:"No leave requests selected for deletion"});return}h(!0);const D=new Promise(async(i,g)=>{try{const d=N.map(T=>T.id),x=await ne.delete(route("leaves.bulk.delete"),{data:{leave_ids:d}});x.status===200&&x.data.success?(j?.(x.data),b(),i([x.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",x.status),g(`Unexpected response status: ${x.status}`))}catch(d){console.error("Full error object:",d),d.response?(console.error("Error response status:",d.response.status),console.error("Error response data:",d.response.data),d.response.status===422?(p(d.response.data.errors||{}),g(d.response.data.error||"Failed to delete leave requests")):d.response.status===403?g(d.response.data.error||"You are not authorized to delete these leave requests"):d.response.status===404?g(d.response.data.error||"Some leave requests were not found"):g(`HTTP Error ${d.response.status}: ${d.response.data.message||"An unexpected error occurred. Please try again later."}`)):d.request?(console.error("No response received:",d.request),g("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",d.message),g("An error occurred while setting up the request."))}finally{h(!1)}});$.promise(D,{pending:"Deleting leave requests...",success:{render({data:i}){return i.join(", ")}},error:{render({data:i}){return i}}})},[N,F,j,b]);return e.jsx(ye,{isOpen:l,onClose:b,size:"2xl",radius:w(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ge,{children:D=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-6 h-6",style:{color:"var(--theme-danger, #f31260)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")',color:"var(--theme-foreground)"},children:"Delete Leave Requests"}),e.jsxs("p",{className:"text-sm mt-0.5",style:{color:"var(--theme-foreground-600)"},children:["Confirm deletion of ",N.length," leave request",N.length!==1?"s":""]})]})]})}),e.jsx(be,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[!F&&e.jsx(ie,{className:"border",style:{backgroundColor:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 30%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(de,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("h4",{className:"font-semibold",style:{color:"var(--theme-danger)"},children:"Cannot Delete Approved Leaves"})]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:[_.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:["Selected Leave Requests (",N.length,")"]})]}),e.jsx(ie,{className:"border max-h-80 overflow-y-auto",style:{backgroundColor:"var(--theme-content1)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(de,{className:"p-0",children:N.map((i,g)=>{const d=i.status&&i.status.toLowerCase()==="approved";return e.jsxs("div",{children:[e.jsxs("div",{className:`p-4 ${d?"opacity-60":""}`,style:{backgroundColor:d?"color-mix(in srgb, var(--theme-danger) 5%, transparent)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx("span",{className:"font-medium text-sm",style:{color:"var(--theme-foreground)"},children:S(i.user_id)}),e.jsx(O,{size:"sm",variant:"bordered",color:i.status?.toLowerCase()==="approved"?"success":i.status?.toLowerCase()==="pending"?"warning":i.status?.toLowerCase()==="rejected"?"danger":"default",radius:w(),style:{borderRadius:"var(--borderRadius, 8px)"},children:i.status||"Unknown"}),d&&e.jsx(O,{size:"sm",variant:"bordered",color:"danger",radius:w(),style:{borderRadius:"var(--borderRadius, 8px)"},children:"Cannot Delete"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:[i.leave_type," - ",i.from_date," to ",i.to_date]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:[i.no_of_days," day",i.no_of_days!==1?"s":""," - ",i.reason]})]})]}),g<N.length-1&&e.jsx(Te,{style:{background:"var(--theme-divider)"}})]},i.id)})})})]}),F&&e.jsx(ie,{className:"border",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(de,{className:"p-4",children:e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--theme-warning)"},children:"âš ï¸ This action cannot be undone. The selected leave requests will be permanently deleted."})})})]})}),e.jsxs(je,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(M,{color:"default",variant:"bordered",onPress:D,radius:w(),size:"sm",isDisabled:C,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(M,{color:"danger",variant:"solid",onPress:R,isLoading:C,isDisabled:!F||C||N.length===0,startContent:!C&&e.jsx(xe,{className:"w-4 h-4"}),radius:w(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:C?"Deleting...":`Delete ${N.length} Request${N.length!==1?"s":""}`})]})]})})})};export{ct as B,dt as D,it as L,mt as a,Ns as b};
