import{o as D,r as p,j as e,H as P,c as A,d as z,L as k,b as _,f as E,a as M}from"./app-BkgCtHXO.js";import{I as $}from"./InstallationLayout-DKeNoLxJ.js";import{s as I}from"./toastUtils-x3kUGVfR.js";import{F as B}from"./ClipboardDocumentCheckIcon-BCkrSIkK.js";import{F as W}from"./CheckCircleIcon-BA11f32N.js";import{F as T}from"./CircleStackIcon-CjgcQrbr.js";import{F as H}from"./Cog6ToothIcon-Bovovt86.js";import{F as U}from"./UserCircleIcon-BqKUdOjE.js";import{c as G}from"./chunk-C6WKGNND-MUA-e_xI.js";import{p as O}from"./chunk-VFIJPDYX-B1X8rpWN.js";import{d as F}from"./chunk-IHO36JMK-CdY0f3fU.js";import{c as Y}from"./chunk-NDVZOYT4-Cmoe8RLh.js";import"./app-Bq-q9uAS.js";import"./index-B7m8hOZr.js";/* empty css                      */import"./useProgressBar-DuTeptIi.js";import"./number-CB4zbwAz.js";import"./useLabel-fBkMOesA.js";import"./useLabels-4bh2Qhvc.js";import"./useNumberFormatter-BUt0Cwtg.js";import"./NumberFormatter-DNR9MAW-.js";function ue({dbConfig:s,platformConfig:n,adminConfig:l}){console.log("Review Page Props:",{dbConfig:s,platformConfig:n,adminConfig:l});const f=s&&(s.db_host||s.host)&&(s.db_database||s.database)&&(s.db_username||s.username),b=n&&n.app_name&&n.app_url,j=l&&l.admin_email,v=!f||!b||!j,{post:q,processing:u}=D({}),[o,w]=p.useState(!1),[i,g]=p.useState([{key:"environment",label:"Updating environment configuration",status:"pending"},{key:"migrations",label:"Running database migrations",status:"pending"},{key:"seeding",label:"Seeding initial data",status:"pending"},{key:"admin",label:"Creating administrator account",status:"pending"},{key:"settings",label:"Configuring platform settings",status:"pending"},{key:"finalization",label:"Finalizing installation",status:"pending"}]),[x,N]=p.useState(-1),[d,y]=p.useState(null),[S,R]=p.useState(!1),L=async()=>{w(!0),y(null),N(0);try{const a=setInterval(()=>{N(r=>{if(r<i.length-1){const m=[...i];return r>=0&&(m[r].status="completed"),r+1<i.length&&(m[r+1].status="processing"),g(m),r+1}return r})},1e3),t=await E.post(route("installation.install"),{});clearInterval(a),console.log("âœ… Installation Response:",t.data);const c=i.map(r=>({...r,status:"completed"}));g(c),R(!0),typeof window.disableInstallationWarning=="function"&&window.disableInstallationWarning(),I.success(t.data.message||"Installation completed successfully!"),setTimeout(()=>{console.log("ðŸ”„ Navigating to Complete page..."),M.visit(route("installation.complete"))},1500)}catch(a){console.error("âŒ Installation Error:",a);const t=a.response?.data;if(console.error("Error Details:",{message:t?.message,error:t?.error,file:t?.file,line:t?.line,stage:t?.stage}),x>=0&&x<i.length){const r=[...i];r[x].status="failed",g(r)}const c=t?.message||t?.error||"Installation failed. Please check console for details.";y({message:c,stage:t?.stage,file:t?.file,line:t?.line}),I.error(c),w(!1)}},h=({icon:a,title:t,data:c})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-foreground",children:t})]}),e.jsx("div",{className:"bg-default-50 dark:bg-default-100/10 rounded-lg p-4",children:Object.entries(c).map(([r,m])=>e.jsxs("div",{className:"flex justify-between py-2 border-b border-divider last:border-b-0",children:[e.jsxs("span",{className:"text-sm text-default-600 capitalize",children:[r.replace(/_/g," "),":"]}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:r.includes("password")?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":m||"N/A"})]},r))})]});return e.jsxs($,{currentStep:7,installationComplete:S,children:[e.jsx(P,{title:"Installation - Review"}),e.jsxs(A,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                        var(--theme-content1, #FAFAFA) 20%, 
                        var(--theme-content2, #F4F4F5) 10%, 
                        var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsxs(G,{className:"flex flex-col items-center gap-4 pt-8 pb-6 border-b border-divider",children:[e.jsx("div",{className:"w-16 h-16 bg-primary-100 dark:bg-primary-900/30 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"w-10 h-10 text-primary-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Review & Install"}),e.jsx("p",{className:"text-default-600",children:"Review your configuration before proceeding with installation"})]})]}),e.jsxs(z,{className:"px-8 py-8",children:[v&&e.jsx("div",{className:"mb-6 bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-danger",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-danger mb-2",children:"Incomplete Session Data"}),e.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-300 mb-4",children:"Your session data is incomplete or in an old format. This will cause installation errors. Please go back to the Database step and re-enter your configuration."}),e.jsxs("div",{className:"text-xs text-danger-600 dark:text-danger-400 mb-4 space-y-1",children:[e.jsxs("div",{children:["â€¢ Database Config: ",f?"âœ“ Complete":"âœ— Incomplete"]}),e.jsxs("div",{children:["â€¢ Platform Config: ",b?"âœ“ Complete":"âœ— Incomplete"]}),e.jsxs("div",{children:["â€¢ Admin Config: ",j?"âœ“ Complete":"âœ— Incomplete"]})]}),e.jsxs(k,{href:route("installation.database"),className:"inline-flex items-center gap-2 px-4 py-2 bg-danger text-white rounded-lg hover:bg-danger-600 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),"Go Back to Database Step"]})]})]})}),o&&e.jsxs("div",{className:"mb-8 space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Installing Platform..."}),e.jsx("p",{className:"text-sm text-default-600",children:"Please wait while we set up your platform"})]}),e.jsx(O,{value:(x+1)/i.length*100,color:"primary",size:"lg",className:"w-full"}),e.jsx("div",{className:"space-y-2",children:i.map((a,t)=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg transition-all ${a.status==="processing"?"bg-primary-50 dark:bg-primary-900/20":a.status==="completed"?"bg-success-50 dark:bg-success-900/20":a.status==="failed"?"bg-danger-50 dark:bg-danger-900/20":"bg-default-50 dark:bg-default-100/10"}`,children:[a.status==="completed"&&e.jsx(W,{className:"w-5 h-5 text-success shrink-0"}),a.status==="processing"&&e.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin shrink-0"}),a.status==="failed"&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-danger flex items-center justify-center shrink-0",children:e.jsx("span",{className:"text-white text-xs",children:"âœ•"})}),a.status==="pending"&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-default-200 shrink-0"}),e.jsx("span",{className:`text-sm ${a.status==="completed"?"text-success":a.status==="processing"?"text-primary font-medium":a.status==="failed"?"text-danger":"text-default-600"}`,children:a.label})]},a.key))}),d&&e.jsxs("div",{className:"bg-danger-50 dark:bg-danger-900/20 border border-danger-200 dark:border-danger-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-danger mb-2",children:"Installation Failed"}),e.jsx("p",{className:"text-sm text-danger-700 dark:text-danger-300 mb-2",children:d.message}),d.file&&e.jsxs("div",{className:"text-xs text-danger-600 dark:text-danger-400 space-y-1",children:[e.jsxs("div",{children:["File: ",d.file]}),e.jsxs("div",{children:["Line: ",d.line]}),e.jsxs("div",{children:["Stage: ",d.stage]})]}),e.jsx("p",{className:"text-xs text-danger-600 dark:text-danger-400 mt-2",children:"Check browser console and Laravel logs for more details."})]})]}),!o&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-warning-50 dark:bg-warning-900/20 rounded-lg p-4 border border-warning-200 dark:border-warning-800",children:e.jsxs("p",{className:"text-sm text-warning-800 dark:text-warning-200",children:[e.jsx("strong",{children:"Before you proceed:"})," Make sure all the information below is correct. The installation process will create database tables, run migrations, and set up your platform."]})}),s&&e.jsx(h,{icon:T,title:"Database Configuration",data:{host:s.db_host||s.host,port:s.db_port||s.port,database:s.db_database||s.database,username:s.db_username||s.username,password:s.db_password||s.password?"********":"No password"}}),e.jsx(F,{}),n&&e.jsx(h,{icon:H,title:"Platform Settings",data:{app_name:n.app_name,app_url:n.app_url,mail_from_address:n.mail_from_address,mail_from_name:n.mail_from_name}}),e.jsx(F,{}),l&&e.jsx(h,{icon:U,title:"Admin Account",data:{name:l.admin_name||l.name,email:l.admin_email||l.email,password:l.admin_password||l.password?"********":"N/A"}}),e.jsxs("div",{className:"bg-primary-50 dark:bg-primary-900/20 rounded-lg p-4 border border-primary-200 dark:border-primary-800",children:[e.jsx("h4",{className:"font-semibold text-foreground mb-3 text-sm",children:"Installation will perform the following:"}),e.jsxs("ul",{className:"text-sm text-default-600 space-y-1",children:[e.jsx("li",{children:"â€¢ Update environment configuration (.env file)"}),e.jsx("li",{children:"â€¢ Run database migrations"}),e.jsx("li",{children:"â€¢ Seed initial data (roles, permissions, modules)"}),e.jsx("li",{children:"â€¢ Create platform super administrator account"}),e.jsx("li",{children:"â€¢ Configure platform settings"}),e.jsx("li",{children:"â€¢ Clear application cache"}),e.jsx("li",{children:"â€¢ Create installation lock file"})]})]})]})]}),e.jsxs(Y,{className:"flex justify-between items-center border-t border-divider px-8 py-6",children:[e.jsx(_,{as:k,href:route("installation.admin"),variant:"flat",color:"default",isDisabled:u||o,children:"Back"}),e.jsx(_,{onPress:L,color:"primary",size:"lg",isLoading:u||o,isDisabled:u||o||v,children:o?"Installing...":"Install Now"})]})]})]})}export{ue as default};
