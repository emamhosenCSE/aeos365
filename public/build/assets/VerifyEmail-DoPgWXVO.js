import{r as i,n as L,e as E,j as e,H as M,b as H}from"./app-DInl32dX.js";import{h as $,c as P,s as K}from"./routeUtils-C1ntbTNy.js";import{A as _}from"./AuthCard-BLeYv4E9.js";import{R as z}from"./RegisterLayout-1jTJ-eSo.js";import{u as W}from"./useBranding-dC6b8PrL.js";import{s as x}from"./toastUtils-Dk6tac5H.js";import{P as Y}from"./ProgressSteps-DNWufEhO.js";import G from"./CancelRegistrationButton-CEtzj0OU.js";import{F as J}from"./EnvelopeIcon-DLtlA8EK.js";import"./app-Bq-q9uAS.js";import"./SafeLink-CCKZvkZz.js";import"./chunk-AUA5GDXN-D3hqgLS_.js";import"./index-C19oxd6b.js";import"./index-CSng9BnJ.js";import"./chunk-WQVQ7P2I-CFFCRwf1.js";import"./number-CB4zbwAz.js";import"./chunk-LGMZDQT5-AEtpri7C.js";import"./index-DPMKIREV.js";/* empty css                      */import"./MaintenanceModeBanner-DqK68c5B.js";import"./ArrowLeftIcon-CFp3Pghx.js";import"./index-DhXKQFMP.js";import"./index-GuVMPMJG.js";import"./chunk-TW2E3XVA-iMcMikRA.js";import"./useDialog-8HGvvybm.js";import"./VisuallyHidden-CS7DyqzD.js";import"./keyboard-DNevlDsW.js";import"./useLabels-DRQXF7iz.js";import"./chunk-5LXTSPS7-DX-2Lz-B.js";function ke({steps:R=[],currentStep:V,savedData:O={},email:D="",companyName:Q=""}){const[c,h]=i.useState(["","","","","",""]),[y,b]=i.useState(!1),[g,N]=i.useState(!1),[n,w]=i.useState(0),[l,C]=i.useState(600),p=i.useRef([]),S=i.useRef(!1),{themeSettings:T}=L(),f=T?.mode==="dark",{siteName:I}=W(),o={heading:f?"text-white":"text-slate-900",copy:f?"text-slate-300":"text-slate-600",badge:f?"text-slate-300":"text-slate-500",link:f?"text-primary-400 hover:text-primary-300":"text-primary-600 hover:text-primary-700"};i.useEffect(()=>{S.current||(S.current=!0,v())},[]),i.useEffect(()=>{if(n>0){const t=setTimeout(()=>w(n-1),1e3);return()=>clearTimeout(t)}},[n]),i.useEffect(()=>{if(l>0){const t=setTimeout(()=>C(l-1),1e3);return()=>clearTimeout(t)}},[l]);const A=t=>{const r=Math.floor(t/60),s=t%60;return`${r}:${s.toString().padStart(2,"0")}`},v=async()=>{if(!(n>0)){N(!0);try{if(!$("platform.register.verify-email.send"))throw new Error("Verification route not available");const t=await E.post(P("platform.register.verify-email.send"));x.success(t.data.message||"Verification code sent to your email"),w(60),C(600)}catch(t){console.error("Failed to send code:",t);let r="Failed to send verification code";if(t.response){const s=t.response.status,a=t.response.data;s===429?r=a.message||"Too many attempts. Please wait before trying again.":s===500?r=a.message||"Server error occurred. Please try again later.":s===422?r=a.message||"Validation error. Please check your information.":r=a.message||r}else t.request&&(r="No response from server. Please check your connection.");x.error(r)}finally{N(!1)}}},F=(t,r)=>{if(r&&!/^\d$/.test(r))return;const s=[...c];s[t]=r,h(s),r&&t<5&&p.current[t+1]?.focus(),s.every(a=>a!=="")&&t===5&&j(s.join(""))},q=(t,r)=>{r.key==="Backspace"&&!c[t]&&t>0&&p.current[t-1]?.focus()},B=t=>{t.preventDefault();const s=t.clipboardData.getData("text").slice(0,6).split("").filter(a=>/^\d$/.test(a));if(s.length>0){const a=[...c];s.forEach((u,k)=>{k<6&&(a[k]=u)}),h(a);const m=a.findIndex(u=>u===""),d=m===-1?5:m;p.current[d]?.focus(),a.every(u=>u!=="")&&j(a.join(""))}},j=async t=>{const r=t||c.join("");if(r.length!==6){x.error("Please enter the complete 6-digit code");return}b(!0);try{if(!$("platform.register.verify-email.verify"))throw new Error("Verification route not available");const s=await E.post(P("platform.register.verify-email.verify"),{code:r});x.success(s.data.message||"Email verified successfully"),setTimeout(()=>{K("platform.register.verify-phone")},500)}catch(s){console.error("Verification failed:",s);let a="Invalid verification code";if(s.response){const m=s.response.status,d=s.response.data;m===429?a=d.message||"Too many attempts. Please wait before trying again.":m===422?a=d.message||"Invalid or expired verification code":m===500?a=d.message||"Server error occurred. Please try again.":a=d.message||a}else s.request&&(a="No response from server. Please check your connection.");x.error(a),h(["","","","","",""]),p.current[0]?.focus()}finally{b(!1)}};return e.jsxs(z,{children:[e.jsx(M,{title:`Verify Company Email - ${I}`}),e.jsxs("section",{className:"max-w-5xl mx-auto px-4 sm:px-6 py-6 sm:py-12 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4 text-center",children:[e.jsx("p",{className:`text-[10px] sm:text-sm uppercase tracking-[0.3em] ${o.badge}`,children:"Step 4"}),e.jsx("h1",{className:`text-2xl sm:text-4xl font-semibold ${o.heading} px-2`,children:"Verify Company Email"}),e.jsxs("p",{className:`${o.copy} text-sm sm:text-base px-2`,children:["We've sent a 6-digit verification code to your company email ",e.jsx("strong",{className:o.heading,children:D})]}),e.jsx("p",{className:`${o.copy} text-xs sm:text-sm px-2 italic`,children:"Note: You'll create your admin account after completing registration"})]}),e.jsx(Y,{steps:R,currentStep:V}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(J,{className:"w-8 h-8 text-primary"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsx("p",{className:`text-sm ${o.copy} mb-4`,children:"Enter the verification code"})}),e.jsx("div",{className:"flex justify-center gap-2 sm:gap-3",onPaste:B,children:c.map((t,r)=>e.jsx("input",{ref:s=>p.current[r]=s,type:"text",inputMode:"numeric",maxLength:1,value:t,onChange:s=>F(r,s.target.value),onKeyDown:s=>q(r,s),className:`w-10 h-12 sm:w-12 sm:h-14 text-center text-xl sm:text-2xl font-semibold border-2 rounded-lg transition-all
                      ${t?"border-primary bg-primary/5":"border-default-300"}
                      ${f?"bg-default-100 text-white":"bg-white text-slate-900"}
                      focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary`,disabled:y},r))}),e.jsxs("div",{className:"text-center space-y-2",children:[l>0?e.jsxs("p",{className:`text-xs ${l<60?"text-warning":o.copy}`,children:["Code expires in ",e.jsx("strong",{children:A(l)})]}):e.jsx("p",{className:"text-xs text-danger",children:"Code has expired. Please request a new one."}),n>0?e.jsxs("p",{className:`text-sm ${o.copy}`,children:["Resend code in ",e.jsxs("strong",{children:[n,"s"]})]}):e.jsx("button",{type:"button",onClick:v,disabled:g,className:`text-sm ${o.link} font-medium disabled:opacity-50`,children:g?"Sending...":"Resend verification code"})]})]}),e.jsx(H,{color:"primary",onPress:()=>j(),className:"w-full",isLoading:y,isDisabled:c.some(t=>t==="")||y,children:y?"Verifying...":"Verify Company Email"}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("p",{className:`text-xs ${o.copy}`,children:["Didn't receive the code? Check your spam folder or"," ",e.jsx("button",{onClick:v,disabled:n>0||g,className:o.link,children:"resend it"})]}),e.jsxs("p",{className:`text-xs ${o.copy} bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800`,children:["ðŸ’¡ ",e.jsx("strong",{children:"Next Step:"})," After verification, you'll create your admin account on your workspace subdomain"]}),e.jsx("div",{className:"pt-2 border-t border-divider",children:e.jsx(G,{variant:"light",size:"sm"})})]})]})})]})]})}export{ke as default};
