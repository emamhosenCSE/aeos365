import{r as a,j as e,H as K,c as i,b as w,f as Y,a as q,d as x,e as R}from"./app-DLWZL5EI.js";import{A as Q}from"./App-CPiN04Y0.js";import{s as _}from"./toastUtils-CQ8tPw7l.js";import{F as X}from"./ChartBarIcon-CnSK0enl.js";import{a as C,c as E,F as Z,b as ee}from"./UsersIcon-CpsA-xGl.js";import{F as k}from"./CurrencyDollarIcon-DK6JNn4H.js";import{F as se}from"./DocumentIcon-YVJ_odhG.js";import{c as re}from"./chunk-C6WKGNND-Dq1nEPC1.js";import{s as te}from"./chunk-C3QHEOC2-Bmp2Jpe_.js";import{l as f}from"./chunk-Y5DMIIWQ-zhqLBGLU.js";import{s as ae}from"./chunk-I3A4XRYQ-CbmreU5k.js";import{s as d}from"./chunk-P7ACKWSP-C7P2-EIz.js";import{p as F}from"./chunk-VFIJPDYX-DD_no7wC.js";import{t as ie,a as ne,b as le,c as p}from"./chunk-F3UDT23P-iuiXDnoX.js";import{t as oe,a as u}from"./chunk-YRZGWF2W-C3idaI1g.js";import"./app-BI-xrU3s.js";import"./index-lAyyVki8.js";/* empty css                      */import"./routeUtils-C6MiLID5.js";import"./chunk-CV4BWJDJ-C645uC3W.js";import"./index-DD7PnbC4.js";import"./index-Dz459_my.js";import"./UserIcon-DiPxEy9e.js";import"./PlusIcon-CgcHryUb.js";import"./Item-hnCJOaQ5.js";import"./SelectionManager-UhxaObWG.js";import"./keyboard-CSKkBtIV.js";import"./index-B5MKI_DQ.js";import"./useDialog-LKdJQ55I.js";import"./getScrollParent-B27hviGV.js";import"./useLabels-CKC_NELL.js";import"./VisuallyHidden-Dslt4DE9.js";import"./chunk-WQVQ7P2I-BXEU6rr0.js";import"./number-CB4zbwAz.js";import"./index-D3fxkw17.js";import"./useSelectableItem-Qild1lMf.js";import"./chunk-IHO36JMK-DYeauZfe.js";import"./useTreeState-CsNDLaZy.js";import"./useMenuTriggerState-CpMESG3a.js";import"./chunk-LGMZDQT5-BbUrfslF.js";import"./Cog6ToothIcon-CI3NiAkm.js";import"./GlobeAltIcon-CFAl4tmE.js";import"./useBranding-C98uB2bk.js";import"./XMarkIcon-C9tv-sqJ.js";import"./chunk-SQIAVXJX-C5zDfxFa.js";import"./chunk-KQW2TNLT-BxZBj3py.js";import"./useField-CN4URFK6.js";import"./useLabel-BC4q2FsI.js";import"./chunk-ICU6NNET-BuoRM2Mj.js";import"./MagnifyingGlassIcon-C9l2NPQE.js";import"./chunk-AUA5GDXN-DgHZKZnK.js";import"./useMediaQuery-CZ_V8brP.js";import"./ShieldCheckIcon-BxwQA0uM.js";import"./AcademicCapIcon-Bs9t2qow.js";import"./IdentificationIcon-6E2VOCK1.js";import"./ArrowLeftIcon-a6q7R3tQ.js";import"./ArrowRightIcon-BZNmx9ah.js";import"./BoltIcon-BRTqiOqL.js";import"./BriefcaseIcon-CunjT5yU.js";import"./BuildingOfficeIcon-BJoAl2gF.js";import"./CalendarDaysIcon-BR4QgBq8.js";import"./CalendarIcon-BTj7Nn7B.js";import"./CheckCircleIcon-CaJShsm_.js";import"./CircleStackIcon-20fpj2M5.js";import"./ClipboardDocumentCheckIcon-Bwahsg1t.js";import"./CogIcon-CQIGGanJ.js";import"./DeviceTabletIcon-CR6eyvHQ.js";import"./CpuChipIcon-Dkmm6hKt.js";import"./DevicePhoneMobileIcon-DzKKUXAD.js";import"./DocumentArrowUpIcon-CdnT1l-_.js";import"./PencilIcon-Da-ZoIco.js";import"./TrashIcon-C6DesZfk.js";import"./EnvelopeIcon-BNQywoLu.js";import"./ExclamationCircleIcon-D-5waelr.js";import"./EyeSlashIcon-C7uJqcIF.js";import"./EyeIcon-Ds6DAjR7.js";import"./FunnelIcon-D8WHt0li.js";import"./InformationCircleIcon-2sIUPx4E.js";import"./KeyIcon-Dl6jmBIi.js";import"./LockClosedIcon-DWSbAAT6.js";import"./MapPinIcon-CoSq0ZKP.js";import"./PlusCircleIcon-borTRmVT.js";import"./PrinterIcon-jsVlFWpL.js";import"./RocketLaunchIcon-C1ofXZeY.js";import"./ShoppingCartIcon-DijpYrUE.js";import"./UserCircleIcon-D9Bl7hMN.js";import"./UserGroupIcon-DLyCB4U6.js";import"./chunk-TW2E3XVA-dNGvEz5r.js";import"./MaintenanceModeBanner-CpiCdC4n.js";import"./chunk-7F3ZLNJ6-BH294qJ7.js";import"./index-CGn2JJsk.js";import"./useToggleState-C1tJJPv7.js";import"./useProgressBar-BmJFnG-i.js";import"./useNumberFormatter-DOVyNCK1.js";import"./NumberFormatter-DNR9MAW-.js";import"./chunk-PMMJMDBI-DH4qNxn7.js";import"./index-BJ8QHXMy.js";import"./useHasTabbableChild-DwAon3z_.js";const ce=()=>({background:`linear-gradient(135deg, 
    var(--theme-content1, #FAFAFA) 20%, 
    var(--theme-content2, #F4F4F5) 10%, 
    var(--theme-content3, #F1F3F4) 20%)`,borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'}),D=()=>{const j=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",l=parseInt(j);return l===0?"none":l<=4?"sm":l<=8?"md":l<=12?"lg":"xl"},de=()=>{const[c,j]=a.useState(!0),[l,z]=a.useState("30"),[g,L]=a.useState(!1),[$,P]=a.useState(new Date),[b,A]=a.useState("lg"),[t,U]=a.useState({mrr:0,mrrChange:0,arr:0,churnRate:0,churnChange:0,activeSubscriptions:0,subscriptionsChange:0,arpu:0,ltv:0}),[M,T]=a.useState([]),[S,V]=a.useState([]),[B,I]=a.useState([]),[O,H]=a.useState([]);a.useEffect(()=>{A(D());const s=()=>A(D());return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const N=async()=>{try{j(!0);const r=(await R.get(route("admin.analytics.revenue"),{params:{days:l}})).data;U({mrr:r.mrr||0,mrrChange:r.mrr_change||0,arr:(r.mrr||0)*12,churnRate:r.churn_rate||0,churnChange:r.churn_change||0,activeSubscriptions:r.active_subscriptions||0,subscriptionsChange:r.subscriptions_change||0,arpu:r.arpu||0,ltv:r.ltv||0}),T(r.currency_breakdown||[]),V(r.revenue_trend||[]),I(r.cohort_data||[]),H(r.plan_distribution||[]),P(new Date)}catch(s){console.error("Failed to fetch revenue analytics:",s),_.error("Failed to load revenue analytics")}finally{j(!1)}};a.useEffect(()=>{N()},[l]),a.useEffect(()=>{if(g){const s=setInterval(N,3e5);return()=>clearInterval(s)}},[g]);const W=async()=>{const s=new Promise(async(r,m)=>{try{const h=await R.get(route("admin.analytics.revenue.export"),{params:{format:"csv",days:l},responseType:"blob"}),y=window.URL.createObjectURL(new Blob([h.data])),n=document.createElement("a");n.href=y,n.setAttribute("download",`revenue-analytics-${Date.now()}.csv`),document.body.appendChild(n),n.click(),n.remove(),r(["Export completed successfully"])}catch{m(["Export failed"])}});_.promise(s,{loading:"Exporting to CSV...",success:r=>r.join(", "),error:r=>Array.isArray(r)?r.join(", "):r})},G=async()=>{const s=new Promise(async(r,m)=>{try{const h=await R.get(route("admin.analytics.revenue.export"),{params:{format:"pdf",days:l},responseType:"blob"}),y=window.URL.createObjectURL(new Blob([h.data])),n=document.createElement("a");n.href=y,n.setAttribute("download",`revenue-analytics-${Date.now()}.pdf`),document.body.appendChild(n),n.click(),n.remove(),r(["Export completed successfully"])}catch{m(["Export failed"])}});_.promise(s,{loading:"Exporting to PDF...",success:r=>r.join(", "),error:r=>Array.isArray(r)?r.join(", "):r})},o=(s,r="USD")=>`${{USD:"$",EUR:"€",GBP:"£",CAD:"CA$",AUD:"A$",JPY:"¥"}[r]||"$"}${(s/1e3).toFixed(1)}k`,v=s=>`${s>=0?"+":""}${s.toFixed(1)}%`,J=s=>s>=90?"success":s>=70?"warning":"danger";return e.jsxs(e.Fragment,{children:[e.jsx(K,{title:"Revenue Analytics - Admin"}),e.jsx("div",{className:"mx-auto w-full max-w-7xl space-y-6 px-4 py-6 md:px-6",children:e.jsxs(i,{className:"transition-all duration-200",style:ce(),children:[e.jsx(re,{className:"border-b border-divider p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between w-full gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl flex items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(X,{className:"w-8 h-8",style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Revenue Analytics"}),e.jsx("p",{className:"text-sm text-default-500",children:"Track MRR, ARR, churn, and revenue metrics across all tenants"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs(te,{label:"Date Range",selectedKeys:[l],onSelectionChange:s=>z(Array.from(s)[0]),className:"w-full sm:w-48",size:"sm",radius:b,children:[e.jsx(f,{children:"Last 7 days"},"7"),e.jsx(f,{children:"Last 30 days"},"30"),e.jsx(f,{children:"Last 90 days"},"90"),e.jsx(f,{children:"Last 12 months"},"365"),e.jsx(f,{children:"All time"},"all")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-default-500",children:"Auto-refresh"}),e.jsx(ae,{size:"sm",isSelected:g,onValueChange:L})]}),e.jsx(w,{isIconOnly:!0,size:"sm",variant:"flat",onPress:N,radius:b,children:e.jsx(Y,{className:"w-4 h-4"})})]})]})}),e.jsxs(q,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:c?e.jsx(e.Fragment,{children:[...Array(6)].map((s,r)=>e.jsxs(i,{className:"p-4",children:[e.jsx(d,{className:"h-6 w-20 rounded mb-2"}),e.jsx(d,{className:"h-8 w-24 rounded mb-1"}),e.jsx(d,{className:"h-4 w-16 rounded"})]},r))}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-default-500 mb-1",children:"MRR"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:o(t.mrr)}),e.jsx(x,{size:"sm",variant:"flat",color:t.mrrChange>=0?"success":"danger",startContent:t.mrrChange>=0?e.jsx(C,{className:"w-3 h-3"}):e.jsx(E,{className:"w-3 h-3"}),children:v(t.mrrChange)})]}),e.jsx(k,{className:"w-5 h-5 text-primary"})]})}),e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-default-500 mb-1",children:"ARR"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:o(t.arr)}),e.jsx("p",{className:"text-xs text-default-400",children:"MRR × 12"})]}),e.jsx(C,{className:"w-5 h-5 text-success"})]})}),e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-default-500 mb-1",children:"Churn Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:[t.churnRate.toFixed(1),"%"]}),e.jsx(x,{size:"sm",variant:"flat",color:t.churnChange<=0?"success":"danger",children:v(t.churnChange)})]}),e.jsx(E,{className:"w-5 h-5 text-danger"})]})}),e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-default-500 mb-1",children:"Active Subscriptions"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:t.activeSubscriptions}),e.jsx(x,{size:"sm",variant:"flat",color:t.subscriptionsChange>=0?"success":"danger",children:v(t.subscriptionsChange)})]}),e.jsx(Z,{className:"w-5 h-5 text-primary"})]})}),e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-default-500 mb-1",children:"ARPU"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:o(t.arpu)}),e.jsx("p",{className:"text-xs text-default-400",children:"Per user/month"})]}),e.jsx(k,{className:"w-5 h-5 text-warning"})]})}),e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-default-500 mb-1",children:"LTV"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:o(t.ltv)}),e.jsx("p",{className:"text-xs text-default-400",children:"Lifetime value"})]}),e.jsx(C,{className:"w-5 h-5 text-success"})]})})]})}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1",children:"Multi-Currency Revenue"}),e.jsx("p",{className:"text-sm text-default-500",children:"Revenue distribution across currencies"})]}),c?e.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:[...Array(6)].map((s,r)=>e.jsx(d,{className:"h-20 rounded"},r))}):e.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:M.map(s=>e.jsxs("div",{className:"p-4 border border-divider rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(x,{size:"sm",variant:"flat",color:"primary",children:s.currency}),e.jsxs("span",{className:"text-xs text-default-500",children:[s.percentage,"%"]})]}),e.jsx("p",{className:"text-xl font-bold text-foreground",children:o(s.mrr,s.currency)}),e.jsx(F,{value:s.percentage,size:"sm",color:"primary",className:"mt-2"})]},s.currency))})]}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1",children:"Revenue Trend"}),e.jsx("p",{className:"text-sm text-default-500",children:"12-month historical MRR"})]}),c?e.jsx(d,{className:"h-64 rounded"}):e.jsx("div",{className:"space-y-2",children:S.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-default-500 w-24",children:s.month}),e.jsx(F,{value:s.mrr/Math.max(...S.map(m=>m.mrr))*100,size:"md",color:"primary",className:"flex-1",showValueLabel:!0,formatOptions:{style:"currency",currency:"USD"}}),e.jsx("span",{className:"text-sm font-semibold text-foreground w-20 text-right",children:o(s.mrr)})]},r))})]}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1",children:"Cohort Analysis"}),e.jsx("p",{className:"text-sm text-default-500",children:"Monthly cohort retention and MRR"})]}),c?e.jsx(d,{className:"h-64 rounded"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ie,{"aria-label":"Cohort analysis",classNames:{wrapper:"shadow-none border border-divider rounded-lg",th:"bg-default-100 text-default-600 font-semibold",td:"py-3"},children:[e.jsxs(oe,{children:[e.jsx(u,{children:"Cohort"}),e.jsx(u,{children:"New Subs"}),e.jsx(u,{children:"Starting MRR"}),e.jsx(u,{children:"Current MRR"}),e.jsx(u,{children:"Retention"}),e.jsx(u,{children:"Churn"})]}),e.jsx(ne,{children:B.map(s=>e.jsxs(le,{children:[e.jsx(p,{className:"font-semibold",children:s.month}),e.jsx(p,{children:s.new_subscriptions}),e.jsx(p,{children:o(s.starting_mrr)}),e.jsx(p,{children:o(s.current_mrr)}),e.jsx(p,{children:e.jsxs(x,{size:"sm",variant:"flat",color:J(s.retention_rate),children:[s.retention_rate.toFixed(0),"%"]})}),e.jsx(p,{children:e.jsxs("span",{className:"text-danger",children:[s.churn_percentage.toFixed(1),"%"]})})]},s.month))})]})})]}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1",children:"Plan Distribution"}),e.jsx("p",{className:"text-sm text-default-500",children:"Subscription breakdown by plan tier"})]}),c?e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((s,r)=>e.jsx(d,{className:"h-16 rounded"},r))}):e.jsx("div",{className:"space-y-4",children:O.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{size:"sm",variant:"flat",color:s.color||"default",children:s.name}),e.jsxs("span",{className:"text-sm text-default-500",children:[s.count," subscriptions (",s.percentage,"%)"]})]}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:o(s.mrr)})]}),e.jsx(F,{value:s.percentage,size:"md",color:s.color||"primary"})]},s.name))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 p-4 border border-divider rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-1",children:"Export Reports"}),e.jsxs("p",{className:"text-xs text-default-500",children:["Last updated: ",$.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{size:"sm",variant:"flat",startContent:e.jsx(ee,{className:"w-4 h-4"}),onPress:W,radius:b,children:"Export CSV"}),e.jsx(w,{size:"sm",variant:"flat",color:"primary",startContent:e.jsx(se,{className:"w-4 h-4"}),onPress:G,radius:b,children:"Export PDF"})]})]})]})]})})]})};de.layout=c=>e.jsx(Q,{children:c});export{de as default};
