import{r as m,j as a,d as q,p as O,b as S,e as I}from"./app-wtupjOeZ.js";import{s as M}from"./toastUtils-Cf6YTa-g.js";import{F as P}from"./BriefcaseIcon-CuVqjMcq.js";import{F as w}from"./UserIcon-rNmxQw0t.js";import{F as N}from"./CalendarIcon-B5Yq8p-W.js";import{F as A}from"./CurrencyDollarIcon-CDhmrMDj.js";import{F as V}from"./MapPinIcon-CUWhKVSF.js";import{m as T,a as W,b as $,c as K}from"./chunk-TW2E3XVA-DQg2kJpP.js";import{a as z}from"./chunk-CV4BWJDJ-3ZFHjdSy.js";import{s as _}from"./chunk-C3QHEOC2-C734JINB.js";import{l as f}from"./chunk-Y5DMIIWQ-fxEb3tue.js";import{i as g}from"./chunk-SQIAVXJX-CLoGEUuy.js";import{m as B}from"./chunk-5LXTSPS7-DmXv8AgV.js";const se=({open:b,onClose:h,user:o,departments:C=[],designations:c=[],managers:E=[],onSuccess:j})=>{const l=(()=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",s=parseInt(e);return s===0?"none":s<=4?"sm":s<=8?"md":s<=12?"lg":"xl"})(),[t,p]=m.useState({user_id:o?.id||"",department_id:"",designation_id:"",date_of_joining:"",employment_type:"full_time",basic_salary:"",manager_id:"",work_location:"",probation_end_date:""}),[n,u]=m.useState({}),[y,x]=m.useState(!1);m.useEffect(()=>{o&&p(r=>({...r,user_id:o.id}))},[o]),m.useEffect(()=>{b||(p({user_id:o?.id||"",department_id:"",designation_id:"",date_of_joining:"",employment_type:"full_time",basic_salary:"",manager_id:"",work_location:"",probation_end_date:""}),u({}),x(!1))},[b,o]);const R=m.useMemo(()=>t.department_id?c.filter(r=>String(r.department_id)===String(t.department_id)):c,[t.department_id,c]),d=(r,e)=>{p(s=>({...s,[r]:e})),n[r]&&u(s=>{const i={...s};return delete i[r],i}),r==="department_id"&&t.designation_id&&(c.some(i=>String(i.id)===String(t.designation_id)&&String(i.department_id)===String(e))||p(i=>({...i,designation_id:""})))},D=()=>{const r={};if(t.department_id||(r.department_id="Department is required"),t.designation_id||(r.designation_id="Designation is required"),t.date_of_joining||(r.date_of_joining="Date of joining is required"),t.employment_type||(r.employment_type="Employment type is required"),t.basic_salary?(isNaN(t.basic_salary)||Number(t.basic_salary)<0)&&(r.basic_salary="Please enter a valid salary amount"):r.basic_salary="Basic salary is required",t.work_location||(r.work_location="Work location is required"),t.probation_end_date&&t.date_of_joining){const e=new Date(t.date_of_joining);new Date(t.probation_end_date)<=e&&(r.probation_end_date="Probation end date must be after joining date")}return u(r),Object.keys(r).length===0},k=async()=>{if(!D())return;x(!0);const r=new Promise(async(e,s)=>{try{const i=await I.post(route("hrm.employees.onboard"),t);i.status===200||i.status===201?(e([i.data.message||"Employee onboarded successfully!"]),j&&j(i.data.employee),h()):s(["An unexpected error occurred"])}catch(i){if(console.error("Onboarding error:",i),i.response?.data?.errors){const v=i.response.data.errors;u(v),s(Object.values(v).flat())}else i.response?.data?.message?s([i.response.data.message]):s(["Failed to onboard employee. Please try again."])}finally{x(!1)}});M.promise(r,{loading:"Onboarding employee...",success:e=>e.join(", "),error:e=>Array.isArray(e)?e.join(", "):e})},F=[{value:"full_time",label:"Full Time"},{value:"part_time",label:"Part Time"},{value:"contract",label:"Contract"},{value:"intern",label:"Intern"}];return a.jsx(T,{isOpen:b,onOpenChange:h,size:"2xl",scrollBehavior:"inside",classNames:{base:"bg-content1",header:"border-b border-divider",body:"py-6",footer:"border-t border-divider"},children:a.jsx(W,{children:r=>a.jsxs(a.Fragment,{children:[a.jsxs($,{className:"flex flex-col gap-1",children:[a.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Onboard as Employee"}),a.jsx("p",{className:"text-sm font-normal text-default-500",children:"Fill in the employment details to onboard this user as an employee"})]}),a.jsxs(K,{children:[o&&a.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-default-100 mb-4",children:[a.jsx(z,{src:o.profile_picture,name:o.name,size:"md",radius:l,classNames:{base:"bg-gradient-to-br from-primary-400 to-primary-600",icon:"text-white"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-foreground",children:o.name}),a.jsx("p",{className:"text-xs text-default-500",children:o.email})]}),o.roles&&o.roles.length>0&&a.jsx("div",{className:"flex gap-1 flex-wrap",children:o.roles.map((e,s)=>a.jsx(q,{size:"sm",variant:"flat",color:"primary",children:e.name||e},s))})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(_,{label:"Department",placeholder:"Select department",selectedKeys:t.department_id?[String(t.department_id)]:[],onSelectionChange:e=>d("department_id",Array.from(e)[0]),isRequired:!0,isInvalid:!!n.department_id,errorMessage:n.department_id,radius:l,startContent:a.jsx(P,{className:"w-4 h-4 text-default-400"}),classNames:{trigger:"bg-default-100"},children:C.map(e=>a.jsx(f,{value:String(e.id),children:e.name},String(e.id)))}),a.jsx(_,{label:"Designation",placeholder:"Select designation",selectedKeys:t.designation_id?[String(t.designation_id)]:[],onSelectionChange:e=>d("designation_id",Array.from(e)[0]),isRequired:!0,isInvalid:!!n.designation_id,errorMessage:n.designation_id,radius:l,startContent:a.jsx(w,{className:"w-4 h-4 text-default-400"}),classNames:{trigger:"bg-default-100"},isDisabled:!t.department_id,children:R.map(e=>a.jsx(f,{value:String(e.id),children:e.name},String(e.id)))}),a.jsx(g,{type:"date",label:"Date of Joining",placeholder:"Select joining date",value:t.date_of_joining,onValueChange:e=>d("date_of_joining",e),isRequired:!0,isInvalid:!!n.date_of_joining,errorMessage:n.date_of_joining,radius:l,startContent:a.jsx(N,{className:"w-4 h-4 text-default-400"}),classNames:{inputWrapper:"bg-default-100"}}),a.jsx(_,{label:"Employment Type",placeholder:"Select employment type",selectedKeys:t.employment_type?[t.employment_type]:[],onSelectionChange:e=>d("employment_type",Array.from(e)[0]),isRequired:!0,isInvalid:!!n.employment_type,errorMessage:n.employment_type,radius:l,startContent:a.jsx(O,{className:"w-4 h-4 text-default-400"}),classNames:{trigger:"bg-default-100"},children:F.map(e=>a.jsx(f,{value:e.value,children:e.label},e.value))}),a.jsx(g,{type:"number",label:"Basic Salary",placeholder:"Enter basic salary",value:t.basic_salary,onValueChange:e=>d("basic_salary",e),isRequired:!0,isInvalid:!!n.basic_salary,errorMessage:n.basic_salary,radius:l,startContent:a.jsx(A,{className:"w-4 h-4 text-default-400"}),classNames:{inputWrapper:"bg-default-100"}}),a.jsx(_,{label:"Manager",placeholder:"Select manager (optional)",selectedKeys:t.manager_id?[String(t.manager_id)]:[],onSelectionChange:e=>d("manager_id",Array.from(e)[0]),radius:l,startContent:a.jsx(w,{className:"w-4 h-4 text-default-400"}),classNames:{trigger:"bg-default-100"},children:E.map(e=>a.jsx(f,{value:String(e.id),children:e.name},String(e.id)))}),a.jsx(g,{type:"text",label:"Work Location",placeholder:"Enter work location",value:t.work_location,onValueChange:e=>d("work_location",e),isRequired:!0,isInvalid:!!n.work_location,errorMessage:n.work_location,radius:l,startContent:a.jsx(V,{className:"w-4 h-4 text-default-400"}),classNames:{inputWrapper:"bg-default-100"},className:"md:col-span-2"}),a.jsx(g,{type:"date",label:"Probation End Date (Optional)",placeholder:"Select probation end date",value:t.probation_end_date,onValueChange:e=>d("probation_end_date",e),isInvalid:!!n.probation_end_date,errorMessage:n.probation_end_date,radius:l,startContent:a.jsx(N,{className:"w-4 h-4 text-default-400"}),classNames:{inputWrapper:"bg-default-100"},className:"md:col-span-2"})]}),a.jsx("div",{className:"mt-4 p-3 rounded-lg bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800",children:a.jsxs("p",{className:"text-xs text-primary-700 dark:text-primary-300",children:[a.jsx("strong",{children:"Note:"})," After onboarding, the employee will receive a welcome email with instructions to complete their profile and onboarding tasks."]})})]}),a.jsxs(B,{children:[a.jsx(S,{variant:"flat",onPress:r,isDisabled:y,radius:l,children:"Cancel"}),a.jsx(S,{color:"primary",onPress:k,isLoading:y,radius:l,children:y?"Onboarding...":"Onboard Employee"})]})]})})})};export{se as O};
