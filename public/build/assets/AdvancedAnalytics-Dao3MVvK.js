import{r as t,j as e,H as fe,b,f as ge,c as N,a as C,d as V,e as D}from"./app-DLWZL5EI.js";import{s as T}from"./toastUtils-CQ8tPw7l.js";import{F as B}from"./CurrencyDollarIcon-DK6JNn4H.js";import{F as P}from"./ChartBarIcon-CnSK0enl.js";import{F as H,c as R,a as M,b as U}from"./UsersIcon-CpsA-xGl.js";import{s as $}from"./chunk-C3QHEOC2-Bmp2Jpe_.js";import{l as i}from"./chunk-Y5DMIIWQ-zhqLBGLU.js";import{s as ve}from"./chunk-I3A4XRYQ-CbmreU5k.js";import{c as k}from"./chunk-C6WKGNND-Dq1nEPC1.js";import{s as v}from"./chunk-P7ACKWSP-C7P2-EIz.js";import{t as K,a as W,b as q,c as o}from"./chunk-F3UDT23P-iuiXDnoX.js";import{t as J,a as m}from"./chunk-YRZGWF2W-C3idaI1g.js";import{p as Q}from"./chunk-VFIJPDYX-DD_no7wC.js";import{m as we,a as be,b as ye,c as Ne}from"./chunk-TW2E3XVA-dNGvEz5r.js";import{m as Ce}from"./chunk-5LXTSPS7-CJuDP5FM.js";import"./app-BI-xrU3s.js";import"./index-lAyyVki8.js";import"./useField-CN4URFK6.js";import"./useLabel-BC4q2FsI.js";import"./useLabels-CKC_NELL.js";import"./useMenuTriggerState-CpMESG3a.js";import"./chunk-WQVQ7P2I-BXEU6rr0.js";import"./number-CB4zbwAz.js";import"./index-Dz459_my.js";import"./index-B5MKI_DQ.js";import"./useDialog-LKdJQ55I.js";import"./getScrollParent-B27hviGV.js";import"./keyboard-CSKkBtIV.js";import"./VisuallyHidden-Dslt4DE9.js";import"./useSelectableItem-Qild1lMf.js";import"./SelectionManager-UhxaObWG.js";import"./chunk-ICU6NNET-BuoRM2Mj.js";import"./Item-hnCJOaQ5.js";import"./chunk-7F3ZLNJ6-BH294qJ7.js";import"./index-D3fxkw17.js";import"./chunk-IHO36JMK-DYeauZfe.js";import"./index-CGn2JJsk.js";import"./chunk-LGMZDQT5-BbUrfslF.js";import"./useToggleState-C1tJJPv7.js";import"./chunk-PMMJMDBI-DH4qNxn7.js";import"./index-BJ8QHXMy.js";import"./useHasTabbableChild-DwAon3z_.js";import"./useProgressBar-BmJFnG-i.js";import"./useNumberFormatter-DOVyNCK1.js";import"./NumberFormatter-DNR9MAW-.js";const X=()=>{const y=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",r=parseInt(y);return r===0?"none":r<=4?"sm":r<=8?"md":r<=12?"lg":"xl"},S=()=>({background:`linear-gradient(135deg, 
        var(--theme-content1, #FAFAFA) 20%, 
        var(--theme-content2, #F4F4F5) 10%, 
        var(--theme-content3, #F1F3F4) 20%)`,borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'}),js=()=>{const[n,y]=t.useState(!0),[r,G]=t.useState("lg"),[_,Y]=t.useState(!1),[Z,ee]=t.useState(new Date),[f,se]=t.useState("30"),[g,ae]=t.useState("all"),[u,re]=t.useState("USD"),[c,te]=t.useState({totalRevenue:0,totalRevenueChange:0,mrr:0,mrrChange:0,arr:0,arrChange:0,arpu:0,arpuChange:0,ltv:0,ltvChange:0,churnRate:0,churnRateChange:0}),[l,ne]=t.useState({newSubscriptions:0,newSubscriptionsChange:0,cancelledSubscriptions:0,cancelledSubscriptionsChange:0,netGrowth:0,netGrowthChange:0,trialConversion:0,trialConversionChange:0,upgradeRate:0,upgradeRateChange:0,downgradeRate:0,downgradeRateChange:0}),[le,ie]=t.useState([]),[z,ce]=t.useState([]),[de,oe]=t.useState([]),[me,F]=t.useState(!1),[I,he]=t.useState(null),[xe,ue]=t.useState("");t.useEffect(()=>{G(X());const s=()=>G(X());return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const A=async()=>{y(!0);try{const a=(await D.get(route("admin.analytics.advanced"),{params:{days:f,plan:g,currency:u}})).data;te(a.revenueMetrics||c),ne(a.growthMetrics||l),ie(a.cohorts||[]),ce(a.revenueTrend||[]),oe(a.planPerformance||[]),ee(new Date)}catch{T.error("Failed to load analytics data")}finally{y(!1)}};t.useEffect(()=>{A()},[f,g,u]),t.useEffect(()=>{if(!_)return;const s=setInterval(A,300*1e3);return()=>clearInterval(s)},[_,f,g,u]);const h=async s=>{try{const a=await D.get(route("admin.analytics.drill-down",s),{params:{days:f,plan:g,currency:u}});ue(s),he(a.data),F(!0)}catch{T.error("Failed to load detailed breakdown")}},E=async s=>{const a=D.post(route("admin.reports.generate"),{type:"advanced_analytics",format:s,filters:{days:f,plan:g,currency:u}},{responseType:"blob"});T.promise(a,{loading:`Generating ${s.toUpperCase()} export...`,success:j=>{const L=window.URL.createObjectURL(new Blob([j.data])),x=document.createElement("a");return x.href=L,x.setAttribute("download",`analytics-${new Date().toISOString().split("T")[0]}.${s}`),document.body.appendChild(x),x.click(),x.remove(),"Export downloaded successfully"},error:"Failed to generate export"})},p=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:u,minimumFractionDigits:0}).format(s),O=s=>`${s>=0?"+":""}${s.toFixed(1)}%`,w=s=>new Intl.NumberFormat("en-US").format(s),d=({title:s,value:a,change:j,icon:L,onClick:x,isLoading:je})=>e.jsx(N,{isPressable:!!x,onPress:x,className:"transition-all duration-200 hover:scale-105",style:S(),children:e.jsx(C,{className:"p-4",children:je?e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{className:"h-6 w-3/4 rounded"}),e.jsx(v,{className:"h-8 w-1/2 rounded"}),e.jsx(v,{className:"h-4 w-2/3 rounded"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-default-500",children:s}),e.jsx(L,{className:"w-5 h-5 text-default-400"})]}),e.jsx("div",{className:"text-2xl font-bold",children:a}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[j>=0?e.jsx(M,{className:"w-4 h-4 text-success"}):e.jsx(R,{className:"w-4 h-4 text-danger"}),e.jsx("span",{className:`text-sm ${j>=0?"text-success":"text-danger"}`,children:O(j)})]})]})})}),pe=s=>s>=80?"success":s>=60?"warning":"danger";return e.jsxs(e.Fragment,{children:[e.jsx(fe,{title:"Advanced Analytics"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Advanced Analytics"}),e.jsxs("p",{className:"text-sm text-default-500 mt-1",children:["Last updated: ",Z.toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs($,{label:"Date Range",selectedKeys:[f],onSelectionChange:s=>se(Array.from(s)[0]),className:"w-40",radius:r,children:[e.jsx(i,{children:"Last 7 days"},"7"),e.jsx(i,{children:"Last 30 days"},"30"),e.jsx(i,{children:"Last 90 days"},"90"),e.jsx(i,{children:"Last 6 months"},"180"),e.jsx(i,{children:"Last 12 months"},"365"),e.jsx(i,{children:"All time"},"all")]}),e.jsxs($,{label:"Plan",selectedKeys:[g],onSelectionChange:s=>ae(Array.from(s)[0]),className:"w-40",radius:r,children:[e.jsx(i,{children:"All Plans"},"all"),e.jsx(i,{children:"Free"},"free"),e.jsx(i,{children:"Starter"},"starter"),e.jsx(i,{children:"Professional"},"professional"),e.jsx(i,{children:"Enterprise"},"enterprise")]}),e.jsxs($,{label:"Currency",selectedKeys:[u],onSelectionChange:s=>re(Array.from(s)[0]),className:"w-32",radius:r,children:[e.jsx(i,{children:"USD"},"USD"),e.jsx(i,{children:"EUR"},"EUR"),e.jsx(i,{children:"GBP"},"GBP")]}),e.jsx(ve,{isSelected:_,onValueChange:Y,size:"sm",children:"Auto-refresh"}),e.jsx(b,{isIconOnly:!0,variant:"flat",onPress:A,isLoading:n,radius:r,children:e.jsx(ge,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Revenue Metrics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsx(d,{title:"Total Revenue",value:p(c.totalRevenue),change:c.totalRevenueChange,icon:B,onClick:()=>h("total_revenue"),isLoading:n}),e.jsx(d,{title:"MRR",value:p(c.mrr),change:c.mrrChange,icon:P,onClick:()=>h("mrr"),isLoading:n}),e.jsx(d,{title:"ARR",value:p(c.arr),change:c.arrChange,icon:P,onClick:()=>h("arr"),isLoading:n}),e.jsx(d,{title:"ARPU",value:p(c.arpu),change:c.arpuChange,icon:H,onClick:()=>h("arpu"),isLoading:n}),e.jsx(d,{title:"LTV",value:p(c.ltv),change:c.ltvChange,icon:B,onClick:()=>h("ltv"),isLoading:n}),e.jsx(d,{title:"Churn Rate",value:`${c.churnRate.toFixed(1)}%`,change:c.churnRateChange,icon:R,onClick:()=>h("churn"),isLoading:n})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Growth Metrics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsx(d,{title:"New Subscriptions",value:w(l.newSubscriptions),change:l.newSubscriptionsChange,icon:M,onClick:()=>h("new_subs"),isLoading:n}),e.jsx(d,{title:"Cancelled",value:w(l.cancelledSubscriptions),change:l.cancelledSubscriptionsChange,icon:R,onClick:()=>h("cancelled"),isLoading:n}),e.jsx(d,{title:"Net Growth",value:`${l.netGrowth>=0?"+":""}${l.netGrowth}`,change:l.netGrowthChange,icon:P,isLoading:n}),e.jsx(d,{title:"Trial Conversion",value:`${l.trialConversion.toFixed(1)}%`,change:l.trialConversionChange,icon:H,isLoading:n}),e.jsx(d,{title:"Upgrade Rate",value:`${l.upgradeRate.toFixed(1)}%`,change:l.upgradeRateChange,icon:M,isLoading:n}),e.jsx(d,{title:"Downgrade Rate",value:`${l.downgradeRate.toFixed(1)}%`,change:l.downgradeRateChange,icon:R,isLoading:n})]})]}),e.jsxs(N,{style:S(),children:[e.jsx(k,{className:"border-b border-divider p-4",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Cohort Analysis"})}),e.jsx(C,{className:"p-4",children:n?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,a)=>e.jsx(v,{className:"h-12 w-full rounded"},a))}):e.jsxs(K,{"aria-label":"Cohort analysis table",className:"min-w-full",radius:r,children:[e.jsxs(J,{children:[e.jsx(m,{children:"COHORT MONTH"}),e.jsx(m,{children:"STARTING SUBS"}),e.jsx(m,{children:"CURRENT ACTIVE"}),e.jsx(m,{children:"RETENTION"}),e.jsx(m,{children:"MRR RETENTION"}),e.jsx(m,{children:"CHURN RATE"})]}),e.jsx(W,{emptyContent:"No cohort data available",children:le.map((s,a)=>e.jsxs(q,{children:[e.jsx(o,{className:"font-medium",children:s.month}),e.jsx(o,{children:w(s.starting)}),e.jsx(o,{children:w(s.current)}),e.jsx(o,{children:e.jsxs(V,{color:pe(s.retention),size:"sm",variant:"flat",children:[s.retention.toFixed(1),"%"]})}),e.jsxs(o,{children:[s.mrrRetention.toFixed(1),"%"]}),e.jsxs(o,{children:[s.churn.toFixed(1),"%"]})]},a))})]})})]}),e.jsxs(N,{style:S(),children:[e.jsx(k,{className:"border-b border-divider p-4",children:e.jsx("h2",{className:"text-lg font-semibold",children:"12-Month Revenue Trend"})}),e.jsx(C,{className:"p-4",children:n?e.jsx("div",{className:"space-y-3",children:[...Array(12)].map((s,a)=>e.jsx(v,{className:"h-10 w-full rounded"},a))}):e.jsx("div",{className:"space-y-3",children:z.map((s,a)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:s.month}),e.jsx("span",{children:p(s.revenue)})]}),e.jsx(Q,{value:s.revenue/Math.max(...z.map(j=>j.revenue))*100,color:"primary",size:"sm",radius:r}),s.change!==void 0&&e.jsxs("div",{className:"text-xs text-default-500",children:[s.change>=0?"+":"",s.change.toFixed(1),"% MoM"]})]},a))})})]}),e.jsxs(N,{style:S(),children:[e.jsxs(k,{className:"border-b border-divider p-4 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Plan Performance"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"flat",startContent:e.jsx(U,{className:"w-4 h-4"}),onPress:()=>E("csv"),radius:r,children:"CSV"}),e.jsx(b,{size:"sm",variant:"flat",startContent:e.jsx(U,{className:"w-4 h-4"}),onPress:()=>E("pdf"),radius:r,children:"PDF"}),e.jsx(b,{size:"sm",variant:"flat",startContent:e.jsx(U,{className:"w-4 h-4"}),onPress:()=>E("excel"),radius:r,children:"Excel"})]})]}),e.jsx(C,{className:"p-4",children:n?e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((s,a)=>e.jsx(v,{className:"h-16 w-full rounded"},a))}):e.jsx("div",{className:"space-y-4",children:de.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{color:s.tier==="enterprise"?"warning":s.tier==="professional"?"success":"primary",size:"sm",variant:"flat",children:s.name}),e.jsxs("span",{className:"text-sm text-default-500",children:[w(s.subscribers)," subscribers"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold",children:p(s.revenue)}),e.jsxs("div",{className:"text-xs text-default-500",children:[s.percentage,"% of total"]})]})]}),e.jsx(Q,{value:s.percentage,color:s.tier==="enterprise"?"warning":s.tier==="professional"?"success":"primary",size:"sm",radius:r})]},a))})})]})]}),e.jsx(we,{isOpen:me,onOpenChange:F,size:"2xl",scrollBehavior:"inside",radius:r,children:e.jsxs(be,{children:[e.jsx(ye,{className:"flex flex-col gap-1",children:e.jsxs("h2",{className:"text-lg font-semibold",children:[xe.replace("_"," ").toUpperCase()," - Detailed Breakdown"]})}),e.jsx(Ne,{children:I&&e.jsx("div",{className:"space-y-4",children:e.jsxs(K,{"aria-label":"Drill-down data",radius:r,children:[e.jsxs(J,{children:[e.jsx(m,{children:"DATE"}),e.jsx(m,{children:"VALUE"}),e.jsx(m,{children:"CHANGE"})]}),e.jsx(W,{children:I.details?.map((s,a)=>e.jsxs(q,{children:[e.jsx(o,{children:s.date}),e.jsx(o,{children:s.value}),e.jsx(o,{children:e.jsx("span",{className:s.change>=0?"text-success":"text-danger",children:O(s.change)})})]},a))||[]})]})})}),e.jsx(Ce,{children:e.jsx(b,{variant:"flat",onPress:()=>F(!1),radius:r,children:"Close"})})]})})]})};export{js as default};
