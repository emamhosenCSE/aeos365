import{r as o,f as U,j as e,H as v,c as x,d as u,e as N,s as M,b as g,L as B}from"./app-B1idACz3.js";import{A as k}from"./AuthCard-B1fXR9gP.js";import{R as S}from"./RegisterLayout-nh_GC2aT.js";import{s as h}from"./toastUtils-CW5B8m6C.js";import{P as _}from"./ProgressSteps-npLoq7WU.js";import{p as O}from"./chunk-VFIJPDYX-nQIpe2PR.js";import"./app-BmhO9GrS.js";import"./useBranding-BpzGYNdv.js";import"./index-B22Xm-65.js";/* empty css                      */import"./MaintenanceModeBanner-BuwtjklV.js";import"./chunk-AUA5GDXN-Dy7XAS6o.js";import"./index-BvG5LGgQ.js";import"./index-BvevyAVm.js";import"./chunk-WQVQ7P2I-BDe9YmDI.js";import"./number-CB4zbwAz.js";import"./chunk-LGMZDQT5-BFW_lSqD.js";import"./ArrowLeftIcon-B39h7gxR.js";import"./useProgressBar-Bpr0HQnj.js";import"./useLabel-BWLgnRON.js";import"./useLabels-xtEGP3rr.js";import"./useNumberFormatter-p89ekOdc.js";import"./NumberFormatter-DNR9MAW-.js";const E={creating_db:{label:"Creating database",description:"Setting up your isolated workspace database...",progress:25},migrating:{label:"Configuring schema",description:"Running database migrations and preparing tables...",progress:50},seeding_roles:{label:"Setting up roles",description:"Configuring default roles for your workspace...",progress:75},completed:{label:"Finalizing",description:"Completing workspace setup...",progress:100}},R=({status:n})=>n==="active"?e.jsx("div",{className:"h-16 w-16 rounded-full bg-emerald-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"h-8 w-8 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):n==="failed"?e.jsx("div",{className:"h-16 w-16 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}):e.jsx(M,{size:"lg",color:"primary"});function ue({steps:n=[],currentStep:f,tenant:r={},baseDomain:$="platform.test"}){const[l,z]=o.useState(r.status==="active"),[X,F]=o.useState(0),[c,j]=o.useState(l?"provisioning":r.status||"pending"),[L,b]=o.useState(l?"creating_db":r.provisioning_step),[P,C]=o.useState(null),[A,I]=o.useState(null),[d,T]=o.useState(!1),{themeSettings:q}=U(),m=q?.mode==="dark",t={heading:m?"text-white":"text-slate-900",copy:m?"text-slate-300":"text-slate-600",badge:m?"text-slate-300":"text-slate-500",surface:m?"bg-white/5 border border-white/10":"bg-white border border-slate-200 shadow-sm"},W=["creating_db","migrating","seeding_roles","completed"];o.useEffect(()=>{if(!l)return;(async()=>{for(let s=0;s<W.length;s++)b(W[s]),F(s),await new Promise(a=>setTimeout(a,600));if(z(!1),j(r.status),b(r.provisioning_step),r.status==="active")try{const a=await(await fetch(route("platform.register.provisioning.status",{tenant:r.id}),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();a.is_ready&&a.login_url&&(I(a.login_url),T(!0),setTimeout(()=>{window.location.href=a.login_url},2e3))}catch(s){console.error("Failed to fetch redirect URL:",s)}})()},[l,r.status,r.provisioning_step,r.id]);const p=E[L]||{label:"Preparing",description:"Initializing your workspace...",progress:10},y=o.useCallback(async()=>{if(!(l||c==="active"||c==="failed"||d))try{const i=await fetch(route("platform.register.provisioning.status",{tenant:r.id}),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!i.ok)throw new Error("Failed to fetch status");const s=await i.json();if(j(s.status),b(s.provisioning_step),s.is_ready&&s.login_url&&(I(s.login_url),T(!0),setTimeout(()=>{window.location.href=s.login_url},2e3)),s.has_failed){const a=s.error||"Provisioning failed. Please contact support.";C(a),h.error(a,{autoClose:!1,closeButton:!0})}}catch(i){console.error("Status fetch error:",i),c==="failed"&&h.error("Unable to check provisioning status. Please refresh the page.",{autoClose:5e3})}},[r.id,c,d,l]);return o.useEffect(()=>{if(l)return;y();const i=setInterval(y,2e3);return()=>clearInterval(i)},[y,l]),c==="active"?e.jsxs(S,{children:[e.jsx(v,{title:"Workspace Ready"}),e.jsxs("section",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-6 sm:py-12 space-y-6 sm:space-y-8 text-center",children:[e.jsx(_,{steps:n,currentStep:f}),e.jsx(k,{children:e.jsx(x,{className:"bg-transparent border-none shadow-none",children:e.jsxs(u,{className:"space-y-4 sm:space-y-6 py-6 sm:py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(R,{status:"active"})}),e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsx(N,{color:"success",variant:"flat",size:"lg",className:"text-xs sm:text-sm",children:"Workspace Ready"}),e.jsx("h1",{className:`text-xl sm:text-3xl font-semibold ${t.heading}`,children:d?"Redirecting to complete setup...":"Almost Done!"}),e.jsxs("p",{className:`${t.copy} text-sm sm:text-base`,children:["Your workspace ",e.jsx("strong",{children:r.name})," is now live. Complete your admin account setup to get started."]})]}),e.jsxs("div",{className:`p-3 sm:p-4 rounded-lg ${t.surface}`,children:[e.jsx("p",{className:`text-xs sm:text-sm ${t.badge}`,children:"Your workspace URL"}),e.jsxs("p",{className:`font-mono text-sm sm:text-lg ${t.heading} break-all`,children:["https://",r.subdomain,".",$]})]}),d&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(M,{size:"sm"}),e.jsx("span",{className:`${t.copy} text-sm sm:text-base`,children:"Redirecting to admin setup..."})]}),A&&!d&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 sm:gap-4",children:[e.jsx(g,{as:"a",href:A,color:"primary",className:"bg-gradient-to-r from-blue-500 to-purple-600 w-full sm:w-auto",children:"Complete Admin Setup"}),e.jsx(g,{as:B,href:route("landing"),variant:"bordered",className:"w-full sm:w-auto",children:"Back to home"})]})]})})})]})]}):c==="failed"?e.jsxs(S,{children:[e.jsx(v,{title:"Provisioning Failed"}),e.jsxs("section",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-6 sm:py-12 space-y-6 sm:space-y-8 text-center",children:[e.jsx(_,{steps:n,currentStep:f}),e.jsx(k,{children:e.jsx(x,{className:"bg-transparent border-none shadow-none",children:e.jsxs(u,{className:"space-y-4 sm:space-y-6 py-6 sm:py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(R,{status:"failed"})}),e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsx(N,{color:"danger",variant:"flat",size:"lg",className:"text-xs sm:text-sm",children:"Provisioning Failed"}),e.jsx("h1",{className:`text-xl sm:text-3xl font-semibold ${t.heading}`,children:"Something went wrong"}),e.jsx("p",{className:`${t.copy} text-sm sm:text-base`,children:"We encountered an issue while setting up your workspace."})]}),P&&e.jsx(x,{className:"bg-red-500/10 border border-red-500/20",children:e.jsx(u,{children:e.jsx("p",{className:"text-red-400 text-xs sm:text-sm break-words",children:P})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 sm:gap-4",children:[e.jsx(g,{color:"primary",onPress:()=>{fetch(route("platform.register.provisioning.retry",{tenant:r.id}),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content,Accept:"application/json"}}).then(()=>{h.success("Retrying provisioning..."),j("provisioning"),C(null)}).catch(i=>{h.error("Failed to retry. Please contact support.")})},className:"bg-gradient-to-r from-blue-500 to-purple-600 w-full sm:w-auto",children:"Retry Provisioning"}),e.jsx(g,{as:"a",href:"mailto:support@eos365.com",variant:"bordered",className:"w-full sm:w-auto",children:"Contact Support"})]}),e.jsx("p",{className:"mt-3 sm:mt-4 text-center text-xs sm:text-sm text-default-500 px-2",children:"All resources have been cleaned up. You can register again with the same details."})]})})})]})]}):e.jsxs(S,{children:[e.jsx(v,{title:"Setting up your workspace"}),e.jsxs("section",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-6 sm:py-12 space-y-6 sm:space-y-8 text-center",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3 px-2",children:[e.jsx("p",{className:`text-[10px] sm:text-sm uppercase tracking-[0.3em] ${t.badge}`,children:"Almost there"}),e.jsx("h1",{className:`text-2xl sm:text-4xl font-semibold ${t.heading}`,children:"Setting up your workspace"}),e.jsxs("p",{className:`${t.copy} text-sm sm:text-base break-words`,children:["We're preparing everything for ",e.jsx("strong",{children:r.name}),". This usually takes less than a minute."]})]}),e.jsx(_,{steps:n,currentStep:f}),e.jsx(k,{children:e.jsx(x,{className:"bg-transparent border-none shadow-none",children:e.jsxs(u,{className:"space-y-6 sm:space-y-8 py-6 sm:py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(R,{status:"provisioning"})}),e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsx(N,{color:"primary",variant:"flat",size:"lg",className:"text-xs sm:text-sm",startContent:e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-blue-500 animate-pulse"}),children:p.label}),e.jsx("p",{className:`${t.copy} text-sm sm:text-base`,children:p.description})]}),e.jsx("div",{className:"max-w-md mx-auto w-full px-2",children:e.jsx(O,{"aria-label":"Provisioning progress",value:p.progress,color:"primary",showValueLabel:!0,className:"max-w-md",classNames:{indicator:"bg-gradient-to-r from-blue-500 to-purple-600",track:m?"bg-white/10":"bg-slate-200"}})}),e.jsx("div",{className:`grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4 text-xs sm:text-sm ${t.copy}`,children:Object.entries(E).map(([i,s])=>{const a=s.progress<p.progress,w=i===L;return e.jsx("div",{className:`p-2 sm:p-3 rounded-lg transition-colors ${w?"bg-blue-500/10 border border-blue-500/30":a?"bg-emerald-500/10 border border-emerald-500/30":`${t.surface}`}`,children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 mb-1",children:[a&&e.jsx("svg",{className:"h-3 w-3 sm:h-4 sm:w-4 text-emerald-500 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),w&&e.jsx("span",{className:"inline-block h-1.5 w-1.5 sm:h-2 sm:w-2 rounded-full bg-blue-500 animate-pulse shrink-0"}),e.jsx("span",{className:`font-medium break-words ${w?"text-blue-400":a?"text-emerald-400":""}`,children:s.label})]})},i)})}),e.jsxs("div",{className:`p-3 sm:p-4 rounded-lg ${t.surface}`,children:[e.jsx("p",{className:`text-xs sm:text-sm ${t.badge}`,children:"Your workspace URL (coming soon)"}),e.jsxs("p",{className:`font-mono text-sm sm:text-lg ${t.heading} break-all`,children:["https://",r.subdomain,".",$]})]})]})})}),e.jsx("p",{className:`text-xs sm:text-sm ${t.copy} px-2`,children:"Please don't close this page. You'll be redirected automatically when ready."})]})]})}export{ue as default};
