import{R as Qe,r as a,j as e,p as C,s as $e,g as Me,A as Xe,m as De,F as Z,b as B,u as ce,e as ee,c as se,a as ne,d as fe,H as Ze}from"./app-BAXRlJ48.js";import{u as de,F as es}from"./useMediaQuery-DMFH0ee8.js";import{aq as ss,b as me,d as ts,m as Re,aD as as,A as rs}from"./App-DPyYvU15.js";import{d as w}from"./dayjs.min-DcqVRuWz.js";import{P as ns}from"./PageHeader-B0Gb2JdX.js";import{F as q}from"./CheckCircleIcon-DpGmT_VL.js";import{F as ye}from"./MagnifyingGlassIcon-CKEATm1j.js";import{F as J}from"./CalendarDaysIcon-CkNTucfv.js";import{i as T}from"./chunk-SQIAVXJX-DHcD0NdT.js";import{F as ge}from"./UserGroupIcon-ReqkIs1d.js";import{F as ls}from"./UserIcon-D4IwKnJn.js";import{c as os}from"./chunk-C6WKGNND-CJZl1JMF.js";import{d as te}from"./chunk-IHO36JMK-DE6UccOS.js";import{a as Ae,s as is}from"./chunk-C3QHEOC2-CWWALGR_.js";import{s as cs}from"./chunk-P7ACKWSP-D1TjPK16.js";import{t as ds,a as ms,b as us,c as W}from"./chunk-F3UDT23P-CbS6cZJx.js";import{t as hs,a as ps}from"./chunk-YRZGWF2W-am2dpIpP.js";import{p as xs}from"./chunk-NL7EUJG2-GipAg-Ht.js";import{u as ue}from"./chunk-NGIUTAK3-BjzX8mQ2.js";import{l as fs}from"./chunk-3YGGVHYO-D2gs0tdJ.js";import{s as re}from"./toastUtils-CgpXtHQI.js";import{M as ys,T as gs,a as vs,b as bs,L as Le}from"./leaflet-Dcpc99xh.js";import{F as be}from"./MapPinIcon-Dwf-7_N3.js";import{F as Ee}from"./GlobeAltIcon-B7g8tGA4.js";import{F as ve}from"./InformationCircleIcon-BySvtpwC.js";import{m as Te,a as Ye,b as ze,c as Ue}from"./chunk-TW2E3XVA-YKxZpKyZ.js";import{l as js}from"./chunk-Y5DMIIWQ-7yisM25U.js";import{m as Ve}from"./chunk-5LXTSPS7-D1xxNIgs.js";import{c as Pe}from"./chunk-PMMJMDBI-Cn7A2qKu.js";import{t as Ns}from"./chunk-WEIB4WXA-DGcvIjPh.js";import{F as ws}from"./PlusIcon-ysjwppa4.js";import{F as _s}from"./CalendarIcon-C7z-hHui.js";import"./app-Bq-q9uAS.js";import"./index-1fQ0x8g_.js";/* empty css                      */import"./routeUtils-B8YzhDEw.js";import"./chunk-CV4BWJDJ-YDxK8YmD.js";import"./index-BQxk6npT.js";import"./index-D-IZDB6p.js";import"./Cog6ToothIcon-BS9S9AuN.js";import"./useBranding-COW0C88J.js";import"./useDialog-3np8Q49m.js";import"./VisuallyHidden-CG9-RmFy.js";import"./keyboard-oTkO-R2L.js";import"./useLabels-pxb2sUWj.js";import"./index-_s1yLG4v.js";import"./XMarkIcon-CT-5AVBL.js";import"./chunk-AUA5GDXN-CgSoZYyJ.js";import"./chunk-WQVQ7P2I-D0_WLrzH.js";import"./number-CB4zbwAz.js";import"./chunk-LGMZDQT5-B8Sl4UZV.js";import"./ShieldCheckIcon-81Yah9s5.js";import"./AcademicCapIcon-Jeb8Wbls.js";import"./IdentificationIcon-snDdY4-U.js";import"./ArrowLeftIcon-D4-_RCwU.js";import"./ArrowRightIcon-DJMmx1E-.js";import"./BriefcaseIcon-7DLvdql-.js";import"./BuildingOfficeIcon-WjMYh5KD.js";import"./CircleStackIcon-D6_GwVfd.js";import"./ClipboardDocumentCheckIcon-DYF8QSt6.js";import"./CogIcon-C-fAMeKY.js";import"./DeviceTabletIcon-DGpKNaqu.js";import"./CpuChipIcon-B5kjosh4.js";import"./CurrencyDollarIcon-C8KFUyn1.js";import"./DevicePhoneMobileIcon-0NBhC7WR.js";import"./DocumentArrowUpIcon-BiuaCjv0.js";import"./DocumentIcon-OchpmxNl.js";import"./EnvelopeIcon-oHQ3-eEU.js";import"./ExclamationCircleIcon-_eLwtUSB.js";import"./EyeIcon-DAw08-uS.js";import"./KeyIcon-CdYfCZg4.js";import"./LockClosedIcon-B9yphYj1.js";import"./PlusCircleIcon-CPCIsgiK.js";import"./PrinterIcon-B9IMeb6s.js";import"./RocketLaunchIcon-qQrkTDyk.js";import"./ShoppingCartIcon-Bdub_1jY.js";import"./UserCircleIcon-D9HcMQtS.js";import"./chunk-I3A4XRYQ-CkETcpjJ.js";import"./useToggleState-I6NzsThi.js";import"./chunk-ICU6NNET-DodoMyo5.js";import"./MaintenanceModeBanner-DwAWmFt4.js";import"./chunk-KQW2TNLT-B3CXe1GN.js";import"./useLabel-B3fAPYpc.js";import"./useMenuTriggerState--PujcPTI.js";import"./useSelectableItem-DMlJJsC7.js";import"./SelectionManager-D9Jz4Bfb.js";import"./Item-fAa8moyn.js";import"./chunk-7F3ZLNJ6-BNnneC7C.js";import"./useHasTabbableChild-rX9Jpkgs.js";import"./index-CzAwltOy.js";import"./index-CokAva9Y.js";import"./chunk-OH2E76JR-BDg-4xQO.js";import"./index-B7eECtKa.js";import"./index-83xPGo9M.js";import"./useTreeState-O2jm2C-5.js";const Fs=Qe.memo(({absentUsers:_,selectedDate:m,getUserLeave:F,isLoaded:N=!1,onMarkAsPresent:S})=>{const[h,y]=a.useState(5),[t,r]=a.useState(""),x=()=>{const c=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",k=parseInt(c);return k===0?"none":k<=4?"sm":k<=8?"md":k<=16?"lg":"full"},b=a.useMemo(()=>{if(!t.trim())return _;const n=t.toLowerCase();return _.filter(c=>{const k=c.name?.toLowerCase()||"",A=c.employee_id?.toString().toLowerCase()||"",f=c.email?.toLowerCase()||"",u=c.phone?.toString().toLowerCase()||"";return k.includes(n)||A.includes(n)||f.includes(n)||u.includes(n)})},[_,t]),I=()=>{y(n=>n+5)},E=n=>{r(n.target.value),y(5)},o=n=>{switch(n?.toLowerCase()){case"approved":return e.jsx(q,{className:"w-4 h-4",style:{color:"var(--theme-success)"}});case"rejected":return e.jsx(Me,{className:"w-4 h-4",style:{color:"var(--theme-danger)"}});case"pending":return e.jsx(C,{className:"w-4 h-4",style:{color:"var(--theme-warning)"}});default:return e.jsx(C,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}})}},p=n=>{switch(n?.toLowerCase()){case"approved":return"var(--theme-success)";case"rejected":return"var(--theme-danger)";case"pending":return"var(--theme-warning)";default:return"var(--theme-primary)"}},v=b.length;return N?N&&_.length===0?e.jsxs("div",{className:"h-full",children:[e.jsx(ns,{title:"Perfect Attendance!",subtitle:`No employees are absent on ${w(m).format("MMMM D, YYYY")}`,icon:e.jsx(q,{className:"w-6 h-6"}),variant:"gradient",actionButtons:[{label:"0",variant:"flat",color:"success",icon:e.jsx(q,{className:"w-4 h-4"}),className:"bg-green-500/10 text-green-500 border-green-500/20"}]}),e.jsxs("div",{role:"region","aria-label":"No absent employees today",className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-success) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--theme-success)"}}),e.jsx("p",{className:"mb-2 text-sm font-medium",style:{color:"var(--theme-success)",fontFamily:'var(--fontFamily, "Inter")'},children:"Perfect Attendance!"}),e.jsx("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No employees are absent today."}),e.jsx("p",{className:"text-default-500 mt-1 block text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"All employees are either present or on approved leave."})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Me,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),"Absent Employees (",v,")"]})}),e.jsx("div",{className:"mb-3 flex-shrink-0",children:e.jsx(T,{type:"text",placeholder:"Search absent employees...",value:t,onChange:E,startContent:e.jsx(ye,{className:"w-4 h-4 text-default-400"}),variant:"bordered",size:"sm",radius:x(),"aria-label":"Search absent employees",classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),t&&e.jsx("div",{className:"mb-2 flex-shrink-0",children:e.jsxs("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[b.length," of ",_.length," employees found"]})}),t&&b.length===0&&e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ye,{className:"w-8 h-8 text-default-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:['No employees found matching "',t,'"']})]}),e.jsxs("div",{role:"region","aria-label":"Absent employees list",className:"flex-1 overflow-y-auto min-h-0",style:{maxHeight:"calc(100vh - 400px)"},children:[e.jsx(Xe,{children:b.slice(0,h).map(n=>{const c=F(n.id);return e.jsx(De.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"p-3 mb-3 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},onMouseEnter:k=>{k.currentTarget.style.background="color-mix(in srgb, var(--theme-content2) 60%, transparent)"},onMouseLeave:k=>{k.currentTarget.style.background="color-mix(in srgb, var(--theme-content1) 80%, transparent)"},children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(ss,{src:n.profile_image_url||n.profile_image,name:n.name,size:"sm",showBorder:!0}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:n.name}),n.employee_id&&e.jsxs("p",{className:"block text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["ID: ",n.employee_id]}),c?e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(J,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:c.from_date===c.to_date?c.from_date:`${c.from_date} - ${c.to_date}`})]}),e.jsxs("p",{className:"flex items-center gap-1 text-xs",style:{color:p(c.status),fontFamily:'var(--fontFamily, "Inter")'},children:[o(c.status),e.jsxs("span",{className:"truncate",children:[c.leave_type," Leave"]})]})]}):e.jsxs("p",{className:"flex items-center gap-1 mt-1 text-xs",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:"Absent without leave"})]})]})]}),c&&e.jsx("div",{className:"px-1.5 py-0.5 ml-2 flex-shrink-0",style:{background:`color-mix(in srgb, ${p(c.status)} 15%, transparent)`,borderColor:`color-mix(in srgb, ${p(c.status)} 30%, transparent)`,borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 6px)"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[o(c.status),e.jsx("span",{className:"font-semibold text-xs",style:{color:p(c.status),fontFamily:'var(--fontFamily, "Inter")'},children:c.status})]})})]}),S&&!c&&e.jsx("div",{className:"flex justify-end",children:e.jsx(B,{color:"primary",variant:"flat",size:"sm",radius:x(),startContent:e.jsx(me,{className:"w-3 h-3"}),onPress:()=>S(n,m),style:{fontFamily:'var(--fontFamily, "Inter")'},className:"text-xs",children:"Mark Present"})})]})},n.id)})}),h<b.length&&e.jsx("div",{className:"text-center mt-4 pb-4 flex-shrink-0",children:e.jsxs(B,{variant:"bordered",onPress:I,startContent:e.jsx(ts,{className:"w-4 h-4"}),size:"sm",color:"warning",radius:x(),fullWidth:!0,style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Show More (",b.length-h," remaining)"]})})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-default)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(C,{className:"w-5 h-5",style:{color:"var(--theme-default)"}}),"Loading Attendance Data..."]})}),e.jsxs("div",{className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 5%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx($e,{size:"lg",className:"mb-4",style:{color:"var(--theme-primary)"}}),e.jsx("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Checking attendance records..."})]})]})}),ks=({handleDateChange:_,selectedDate:m,updateTimeSheet:F,externalFilterData:N,externalEmployee:S,onMarkAsPresent:h})=>{const{auth:y}=ce().props,{url:t}=ce(),r=de("(min-width: 1025px)"),x=de("(min-width: 641px) and (max-width: 1024px)"),[b,I]=a.useState([]),[E,o]=a.useState([]),[p,v]=a.useState([]),[n,c]=a.useState(""),[k,A]=a.useState(0),[f,u]=a.useState(0),[i,d]=a.useState(10),[g,M]=a.useState(1),[R,V]=a.useState(S||""),[ae,P]=a.useState(!1),[O,Es]=a.useState(0),[Ps,je]=a.useState(null),[Ne,$s]=a.useState(!0),[he,we]=a.useState(new Date),[le,Q]=a.useState(""),_e=a.useRef(null),D=a.useRef({currentMonth:w().format("YYYY-MM"),employee:S||"",filterData:N||{currentMonth:w().format("YYYY-MM")},selectedDate:m,perPage:10,updateTimeSheet:F,refreshKey:0,currentPage:1}),X=()=>{if(typeof window>"u")return"lg";const j=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",l=parseInt(j);return l===0?"none":l<=4?"sm":l<=8?"md":l<=16?"lg":"full"},[L,Fe]=a.useState(N||{currentMonth:w().format("YYYY-MM")}),oe=a.useCallback(async()=>{try{return P(!1),await Ce(m,g,i,R,L,!0),t!=="/attendance-employee"&&await Ie(m,R),we(new Date),!0}catch(s){return console.error("Error refreshing timesheet:",s),!1}finally{P(!0)}},[m,g,i,R,L,t]),pe=a.useCallback(async()=>{if(m)try{const s=route("check-timesheet-updates",{date:w(m).format("YYYY-MM-DD"),month:L.currentMonth}),j=await fetch(s);if(!j.ok){const Y=await j.json().catch(()=>({}));throw new Error(`HTTP ${j.status}: ${Y.message||"Failed to check for updates"}`)}const l=await j.json();l.success&&l.last_updated!==_e.current&&l.last_updated&&(_e.current=l.last_updated,await oe(),je(new Date)),we(new Date)}catch(s){console.error("Error checking for timesheet updates:",s)}},[m,L.currentMonth,oe]),ke=a.useMemo(()=>he?he.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[he]),Ce=async(s,j,l,Y,z,xe=!1)=>{if(!s){P(!0),c("No date selected");return}const ie=t!=="/attendance-employee"?route("admin.getPresentUsersForDate"):route("getCurrentUserAttendanceForDate");try{P(!1),c("");const U=await ee.get(ie,{params:{page:j,perPage:l,employee:Y,date:w(s).format("YYYY-MM-DD"),currentYear:z?.currentMonth?w(z.currentMonth).year():"",currentMonth:z?.currentMonth?w(z.currentMonth).format("MM"):"",_t:xe?Date.now():void 0}});U.status===200?(I(U.data.attendances||[]),A(U.data.total||0),u(U.data.last_page||1),M(U.data.current_page||1),je(new Date),c("")):c(`Unexpected response: ${U.status}`)}catch(U){console.error("Error fetching attendance data:",U),c(U.response?.data?.message||"An error occurred while retrieving attendance data."),I([]),A(0)}finally{P(!0)}},Ie=async(s,j)=>{if(t==="/attendance-employee"){v([]),o([]);return}if(!s){v([]),o([]);return}try{const l=await ee.get(route("admin.getAbsentUsersForDate"),{params:{date:w(s).format("YYYY-MM-DD"),employee:j||"",_t:Date.now()}});l.status===200?(v(l.data.absent_users||[]),o(l.data.leaves||[])):(console.warn("Unexpected response getting absent users:",l.status),v([]),o([]))}catch(l){console.error("Error fetching absent users:",l),v([]),o([])}},We=s=>{M(s)};a.useCallback((s,j)=>{Fe(l=>({...l,[s]:j}))},[]);const Be=s=>E.find(j=>String(j.user_id)===String(s)),Se=(s,j)=>{if(!s)return null;try{let l;if(typeof s=="string"){const Y=w(j).format("YYYY-MM-DD");if(s.match(/^\d{2}:\d{2}:\d{2}$/)){const z=`${Y}T${s}`;l=new Date(z)}else if(s.includes("T")||s.includes(" "))l=new Date(s);else if(s.match(/^\d{2}:\d{2}$/)){const z=`${Y}T${s}:00`;l=new Date(z)}else l=new Date(`${Y}T${s}`)}else l=new Date(s);return isNaN(l.getTime())?(console.warn("Invalid time data:",s),"Invalid time"):l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(l){return console.warn("Error formatting time:",{timeString:s,date:j,error:l}),"Invalid time"}},G=y.permissions?.includes("attendance.view")||!1;y.permissions?.includes("attendance.own.view");const Oe=y.permissions?.includes("attendance.manage")||!1,He=y.permissions?.includes("attendance.export")||Oe||!1;a.useMemo(()=>p,[p]);const Ge=[...!G||t==="/attendance-employee"?[{name:"Date",uid:"date",icon:J,ariaLabel:"Attendance date"}]:[],...G&&t!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:ls,ariaLabel:"Employee name and information"}]:[],{name:"Clock In",uid:"clockin_time",icon:C,ariaLabel:"All clock in times"},{name:"Clock Out",uid:"clockout_time",icon:C,ariaLabel:"All clock out times"},{name:"Work Hours",uid:"production_time",icon:C,ariaLabel:"Total working hours"},{name:"Punches",uid:"punch_details",icon:C,ariaLabel:"Number of time punches recorded"}],Ke=(s,j)=>{const l="text-xs sm:text-sm md:text-base whitespace-nowrap",Y=w(s.date).isSame(w(),"day");switch(j){case"date":return e.jsx(W,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-primary shrink-0"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:w(s.date).format("MMM D, YYYY")})})]})});case"employee":const z=r||x?"md":"sm";return e.jsx(W,{className:"whitespace-nowrap",children:e.jsx(ue,{avatarProps:{src:s.user?.profile_image_url||s.user?.profile_image,size:z,name:s.user?.name||"Unnamed User",...as({name:s.user?.name||"Unnamed User",size:z})},description:s.user?.phone?e.jsx(fs,{href:`tel:${s.user?.phone}`,size:"sm",className:"text-xs hover:underline",style:{color:"var(--theme-primary)"},children:s.user?.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-default-400 italic",children:[e.jsx(es,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:s.user?.name||"Unnamed User"})})});case"clockin_time":return e.jsx(W,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-success"}),e.jsx("div",{className:"flex flex-col",children:s.punches&&s.punches.length>0?s.punches.filter(H=>H.punch_in).map((H,K)=>e.jsxs("span",{className:"block text-xs",children:[e.jsxs("span",{className:"text-default-400 mr-1",children:[K+1,"."]}),Se(H.punch_in,s.date)||"Invalid time"]},K)):e.jsx("span",{children:"Not clocked in"})})]})});case"clockout_time":return e.jsx(W,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-danger"}),e.jsx("div",{className:"flex flex-col",children:s.punches&&s.punches.length>0?s.punches.map((H,K)=>e.jsxs("span",{className:"block text-xs",children:[e.jsxs("span",{className:"text-default-400 mr-1",children:[K+1,"."]}),H.punch_out?Se(H.punch_out,s.date)||"Invalid time":"No punch out"]},K)):s.punchin_time?e.jsx("span",{children:Y?"Currently working":"Missing punch-out"}):e.jsx("span",{children:"Not started"})})]})});case"production_time":const xe=s.total_work_minutes>0,ie=s.has_incomplete_punch,U=s.punchin_time&&!s.punchout_time&&Y;if(xe){const H=Math.floor(s.total_work_minutes/60),K=Math.floor(s.total_work_minutes%60);return e.jsx(W,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:`w-4 h-4 ${ie?"text-warning":"text-primary"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:`${H}h ${K}m`}),e.jsx("span",{className:"text-xs text-default-500",children:ie?"Partial data - in progress":"Total worked time"})]})]})})}else{if(U)return e.jsx(W,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"In Progress"}),e.jsx("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});if(s.punchin_time&&!s.punchout_time&&!Y)return e.jsx(W,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-danger"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-danger",children:"Incomplete punch"}),e.jsx("span",{className:"text-xs text-default-500",children:"Missing punch out"})]})]})})}return e.jsx(W,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"No work time"}),e.jsx("span",{className:"text-xs text-default-500",children:"No attendance"})]})]})});case"punch_details":return e.jsx(W,{className:`${l}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-default-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-medium",children:[s.punch_count||0," punch",(s.punch_count||0)!==1?"es":""]}),s.complete_punches!==s.punch_count&&e.jsxs("span",{className:"text-xs text-warning",children:[s.complete_punches," complete"]}),s.complete_punches===s.punch_count&&s.punch_count>0&&e.jsx("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e.jsx(W,{className:`${l}`,children:"N/A"})}},qe=a.useCallback(async()=>{Q("excel");try{const s=await ee.get(route("attendance.exportExcel"),{params:{date:m},responseType:"blob"}),j=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=j,l.setAttribute("download",`Daily_Timesheet_${w(m).format("YYYY_MM_DD")}.xlsx`),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(j),Q("")}catch(s){console.error("Error downloading Excel:",s),alert("Failed to download attendance excel."),Q("")}},[m]),Je=a.useCallback(async()=>{Q("pdf");try{const s=await ee.get(route("attendance.exportPdf"),{params:{date:m},responseType:"blob"}),j=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=j,l.setAttribute("download",`Daily_Timesheet_${w(m).format("YYYY_MM_DD")}.pdf`),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(j),Q("")}catch(s){console.error("Error downloading PDF:",s),alert("Failed to download attendance pdf."),Q("")}},[m]);return a.useEffect(()=>{if(m){if((R!==D.current.employee||L!==D.current.filterData||m!==D.current.selectedDate||i!==D.current.perPage||F!==D.current.updateTimeSheet||O!==D.current.refreshKey)&&g!==1){D.current={...D.current,employee:R,filterData:L,selectedDate:m,perPage:i,updateTimeSheet:F,refreshKey:O},M(1);return}(async()=>{P(!1);try{await Promise.all([Ce(m,g,i,R,L),t!=="/attendance-employee"?Ie(m,R):Promise.resolve()])}catch(l){console.error("Error updating attendance data:",l)}finally{P(!0)}})(),D.current={...D.current,employee:R,filterData:L,selectedDate:m,perPage:i,updateTimeSheet:F,refreshKey:O,currentPage:g}}},[m,g,i,R,L,F,O]),a.useEffect(()=>{N&&Fe(N)},[N]),a.useEffect(()=>{S!==void 0&&V(S)},[S]),a.useEffect(()=>{JSON.stringify(L)!==JSON.stringify(D.current.filterData)&&(D.current={...D.current,filterData:{...L}},oe())},[L,oe]),a.useEffect(()=>{if(!Ne||!m)return;pe();const s=setInterval(pe,5e3);return()=>{clearInterval(s)}},[Ne,pe,m]),e.jsx(e.Fragment,{children:G&&e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"Timesheet Management",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(De.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(se,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                                        var(--theme-content1, #FAFAFA) 20%, 
                                        var(--theme-content2, #F4F4F5) 10%, 
                                        var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(os,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                            color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                            color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${r?"p-6":x?"p-4":"p-3"} w-full`,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                                ${r?"p-3":x?"p-2.5":"p-2"} 
                                                                rounded-xl flex items-center justify-center
                                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(C,{className:`
                                                                    ${r?"w-8 h-8":x?"w-6 h-6":"w-5 h-5"}
                                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                                    ${r?"text-2xl":x?"text-xl":"text-lg"}
                                                                    font-bold text-foreground
                                                                    ${r?"":"truncate"}
                                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Daily Timesheet"}),e.jsx("p",{className:`
                                                                    ${r?"text-sm":"text-xs"} 
                                                                    text-default-500
                                                                    ${r?"":"truncate"}
                                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:new Date(m).toLocaleString("en-US",{month:r?"long":"short",day:"numeric",year:r?"numeric":void 0})})]})]}),"                                                ",e.jsxs("div",{className:"flex items-center gap-4",children:[ke&&e.jsxs("span",{className:"text-xs text-default-500",children:["Updated: ",ke]}),e.jsx("div",{className:"flex items-center gap-2",children:He&&e.jsxs(e.Fragment,{children:[e.jsx(B,{color:"success",variant:"flat",size:r?"md":"sm",radius:X(),startContent:e.jsx(Re,{className:`
                                                                                ${r?"w-4 h-4":"w-3.5 h-3.5"}
                                                                            `}),onPress:qe,isDisabled:!ae||b.length===0||le!=="",isLoading:le==="excel",style:{fontFamily:'var(--fontFamily, "Inter")'},children:r?"Excel":"XLS"}),e.jsx(B,{color:"danger",variant:"flat",size:r?"md":"sm",radius:X(),startContent:e.jsx(Re,{className:`
                                                                                ${r?"w-4 h-4":"w-3.5 h-3.5"}
                                                                            `}),onPress:Je,isDisabled:!ae||b.length===0||le!=="",isLoading:le==="pdf",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"PDF"})]})})]})]}),r&&e.jsxs("div",{className:"flex items-center gap-6 pt-2 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-success"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Present: ",k]})]}),G&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-warning"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Absent: ",p.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Total: ",k+p.length]})]})]})]})})}),e.jsx(te,{}),e.jsx(ne,{children:e.jsx("div",{role:"search","aria-label":"Timesheet filters",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:G&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:e.jsx(T,{type:"text",label:"Search Employee",placeholder:"Enter employee name",value:R,onChange:s=>V(s.target.value),variant:"bordered",size:"sm",radius:X(),startContent:e.jsx(ye,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Search employees"})}),e.jsx("div",{className:"col-span-1",children:e.jsx(T,{label:"Select Date",type:"date",variant:"bordered",onChange:_,value:new Date(m).toISOString().slice(0,10)||"",size:"sm",radius:X(),startContent:e.jsx(J,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Select date for timesheet"})})]})})})}),e.jsx(te,{}),e.jsx(ne,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full",children:[e.jsx("div",{className:`${G?"lg:flex-1 lg:w-0":"w-full"} min-h-0`,children:n?e.jsx(se,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:n})]})}):e.jsxs("div",{role:"region","aria-label":"Present employees attendance table",className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h6",{className:"text-lg font-semibold text-foreground flex items-center gap-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(q,{className:"w-5 h-5",style:{color:"var(--theme-success)"}}),"Present Employees (",k,")"]})}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(Ae,{orientation:"horizontal",className:"overflow-y-hidden flex-1",children:e.jsx(cs,{className:"rounded-lg",isLoaded:ae,children:e.jsxs(ds,{isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,radius:X(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(hs,{columns:Ge,children:s=>e.jsx(ps,{align:"start",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon&&e.jsx(s.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]})},s.uid)}),e.jsx(ms,{items:b,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(C,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx("p",{className:"text-default-500",children:"No attendance records found"})]}),children:s=>e.jsx(us,{children:j=>Ke(s,j)},s.id||s.user_id)})]})})}),k>i&&e.jsx("div",{className:"py-4 flex justify-center",children:e.jsx(xs,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",radius:X(),page:g,total:f,onChange:We,"aria-label":"Timesheet pagination",style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})]})}),G&&e.jsx("div",{className:"lg:w-80 lg:flex-shrink-0 h-full",children:e.jsx(Fs,{absentUsers:p,selectedDate:m,getUserLeave:Be,isLoaded:ae,onMarkAsPresent:h})})]})})]})})})})})})};delete Le.Icon.Default.prototype._getIconUrl;Le.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const $={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Cs=({onLocationSelect:_})=>(bs({click(m){const{lat:F,lng:N}=m.latlng;_({latitude:F,longitude:N,accuracy:10,source:"manual"})}}),null),Is=({onLocationChange:_,initialLocation:m=null,className:F="",style:N={}})=>{const S=()=>{if(typeof window>"u")return"lg";const p=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",v=parseInt(p);return v===0?"none":v<=4?"sm":v<=8?"md":v<=16?"lg":"full"},[h,y]=a.useState({status:$.CHECKING,coordinates:m||{latitude:23.8103,longitude:90.4125},error:null,accuracy:null}),[t,r]=a.useState({latitude:"",longitude:""}),x=a.useCallback(()=>new Promise((o,p)=>{if(!navigator.geolocation){p(new Error("Geolocation is not supported by this browser"));return}const v={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(n=>{const c={latitude:n.coords.latitude,longitude:n.coords.longitude,accuracy:n.coords.accuracy,source:"gps"};o(c)},n=>{let c="Location unavailable";switch(n.code){case 1:c="Location access denied. Please allow location permission.";break;case 2:c="Location unavailable. Please ensure GPS is enabled.";break;case 3:c="Location request timed out.";break;default:c="Unable to retrieve location."}p(new Error(c))},v)}),[]);a.useEffect(()=>{if(m){y(o=>({...o,status:$.ACTIVE,coordinates:m,accuracy:m.accuracy||null}));return}y(o=>({...o,status:$.CHECKING})),x().then(o=>{y({status:$.ACTIVE,coordinates:o,error:null,accuracy:o.accuracy}),_?.(o)}).catch(o=>{const p=o.message.includes("denied");y({status:p?$.DENIED:$.INACTIVE,coordinates:{latitude:23.8103,longitude:90.4125},error:o.message,accuracy:null})})},[m]);const b=a.useCallback(o=>{y(p=>({...p,coordinates:o,status:$.ACTIVE,accuracy:o.accuracy||10})),_?.(o)},[]),I=a.useCallback(()=>{const o=parseFloat(t.latitude),p=parseFloat(t.longitude);if(isNaN(o)||isNaN(p)||o<-90||o>90||p<-180||p>180){y(n=>({...n,error:"Invalid coordinates. Latitude must be between -90 and 90, longitude between -180 and 180."}));return}b({latitude:o,longitude:p,accuracy:50,source:"manual"}),r({latitude:"",longitude:""})},[t,b]),E=a.useCallback(()=>{y(o=>({...o,status:$.CHECKING,error:null})),x().then(o=>{y({status:$.ACTIVE,coordinates:o,error:null,accuracy:o.accuracy}),_?.(o)}).catch(o=>{const p=o.message.includes("denied");y(v=>({...v,status:p?$.DENIED:$.INACTIVE,error:o.message}))})},[x]);return e.jsxs("div",{className:`space-y-4 ${F}`,style:N,children:[e.jsx(se,{style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs(ne,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Location Selection"})]}),h.status===$.CHECKING&&e.jsx($e,{size:"sm"}),(h.status===$.DENIED||h.status===$.INACTIVE)&&e.jsx(B,{size:"sm",color:"primary",variant:"flat",onPress:E,startContent:e.jsx(Ee,{className:"w-3 h-3"}),children:"Get GPS"})]}),h.coordinates&&e.jsxs("div",{className:"text-xs space-y-1",style:{color:"var(--theme-foreground-600)"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Lat:"})," ",h.coordinates.latitude.toFixed(6),",",e.jsx("strong",{children:" Lng:"})," ",h.coordinates.longitude.toFixed(6)]}),h.accuracy&&e.jsxs("div",{children:[e.jsx("strong",{children:"Accuracy:"})," ±",Math.round(h.accuracy),"m"]})]}),h.error&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 p-2 rounded",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",color:"var(--theme-danger)"},children:[e.jsx(Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-xs",children:h.error})]})]})}),e.jsx(se,{style:{borderRadius:"var(--borderRadius, 8px)",overflow:"hidden"},children:e.jsx("div",{style:{height:"300px",width:"100%"},children:h.coordinates&&e.jsxs(ys,{center:[h.coordinates.latitude,h.coordinates.longitude],zoom:16,style:{height:"100%",width:"100%"},children:[e.jsx(gs,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(vs,{position:[h.coordinates.latitude,h.coordinates.longitude]}),e.jsx(Cs,{onLocationSelect:b})]})})}),e.jsx(se,{style:{background:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs(ne,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ee,{className:"w-4 h-4",style:{color:"var(--theme-secondary)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Manual Coordinates"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(T,{size:"sm",label:"Latitude",placeholder:"23.8103",value:t.latitude,onValueChange:o=>r(p=>({...p,latitude:o})),variant:"bordered",radius:S()}),e.jsx(T,{size:"sm",label:"Longitude",placeholder:"90.4125",value:t.longitude,onValueChange:o=>r(p=>({...p,longitude:o})),variant:"bordered",radius:S()}),e.jsx(B,{size:"sm",color:"secondary",variant:"flat",onPress:I,isDisabled:!t.latitude||!t.longitude,className:"h-10",children:"Set Location"})]}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--theme-foreground-600)"},children:"Click on the map or enter coordinates manually to set the punch location."})]})})]})},Ss=({open:_,closeModal:m,selectedDate:F,allUsers:N,refreshTimeSheet:S,currentUser:h=null})=>{const{props:{auth:y}}=ce(),t=()=>{if(typeof window>"u")return"lg";const u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",i=parseInt(u);return i===0?"none":i<=4?"sm":i<=8?"md":i<=16?"lg":"full"},[r,x]=a.useState({user_id:"",date:F,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Manually marked present by admin",coordinates:null}),[b,I]=a.useState({}),[E,o]=a.useState(!1);a.useEffect(()=>{x(h?f=>({...f,user_id:h.id,date:F}):f=>({...f,user_id:"",date:F,punch_in_time:"09:00",punch_out_time:""}))},[h,F]);const p=a.useCallback(f=>{x(u=>({...u,coordinates:f,location:f.source==="manual"?`Manual: ${f.latitude.toFixed(6)}, ${f.longitude.toFixed(6)}`:`GPS: ${f.latitude.toFixed(6)}, ${f.longitude.toFixed(6)} (±${Math.round(f.accuracy)}m)`}))},[]),v=a.useMemo(()=>N?.filter(f=>f.roles?.some(u=>u.name==="Employee"))||[],[N]),n=(f,u)=>{x(i=>({...i,[f]:u})),b[f]&&I(i=>({...i,[f]:void 0}))},c=a.useMemo(()=>{if(r.punch_in_time&&r.punch_out_time){const f=w(`${r.date} ${r.punch_in_time}`),u=w(`${r.date} ${r.punch_out_time}`);if(u.isAfter(f)){const i=u.diff(f,"minute"),d=Math.floor(i/60),g=i%60;return`${d}h ${g}m`}}return null},[r.punch_in_time,r.punch_out_time,r.date]),k=async f=>{f.preventDefault(),o(!0),I({});try{if(!r.coordinates){re.error("Please select a location on the map before submitting."),o(!1);return}const u={user_id:parseInt(r.user_id),date:r.date,punch_in_time:r.punch_in_time,punch_out_time:r.punch_out_time||null,lat:r.coordinates.latitude,lng:r.coordinates.longitude,address:r.location||`Manually marked present by ${y.user?.name||"Administrator"}`},i=await ee.post(route("attendance.mark-as-present"),u);i.status===200&&(re.success(i.data.message||"User marked as present successfully!"),S(),m())}catch(u){u.response?.status===422?(I(u.response.data.errors||{}),re.error(u.response.data.message||"Please check the form for errors")):re.error(u.response?.data?.message||"Failed to mark user as present")}finally{o(!1)}},A=h||v.find(f=>f.id==r.user_id);return e.jsx(Te,{isOpen:_,onClose:m,size:"2xl",radius:t(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-4 max-h-[90vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider flex-shrink-0",body:"overflow-y-auto max-h-[calc(90vh-8rem)]",footer:"border-t border-divider flex-shrink-0",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(Ye,{children:f=>e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Mark Employee as Present"})]})}),e.jsxs("form",{onSubmit:k,children:[e.jsx(Ue,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Employee Selection"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[h?e.jsx("div",{className:"p-3 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsx(ue,{avatarProps:{size:"sm",src:h.profile_image_url,showFallback:!0,name:h.name},description:`Employee ID: ${h.employee_id}`,name:h.name})}):e.jsx(is,{label:"Select Employee",placeholder:"Choose an employee to mark as present",selectedKeys:r.user_id?new Set([r.user_id.toString()]):new Set,onSelectionChange:u=>{const i=Array.from(u)[0];n("user_id",i||"")},isInvalid:!!b.user_id,errorMessage:b.user_id,variant:"bordered",size:"sm",radius:t(),classNames:{trigger:"min-h-unit-12",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},renderValue:u=>u.map(i=>{const d=v.find(g=>g.id.toString()===i.key);return d?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:d.name}),e.jsxs("span",{className:"text-xs text-default-500",children:["(",d.employee_id,")"]})]},i.key):null}),children:v.map(u=>e.jsx(js,{value:u.id.toString(),textValue:`${u.name} (${u.employee_id})`,children:e.jsx(ue,{avatarProps:{size:"sm",src:u.profile_image_url,showFallback:!0,name:u.name},description:`ID: ${u.employee_id}`,name:u.name})},u.id.toString()))}),e.jsx(T,{label:"Date",type:"date",value:r.date,onValueChange:u=>n("date",u),isInvalid:!!b.date,errorMessage:b.date,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(J,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})]})]}),e.jsx(te,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Working Hours"})]}),c&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded-md bg-success/10 text-success",children:["Duration: ",c]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(T,{label:"Punch In Time",type:"time",value:r.punch_in_time,onValueChange:u=>n("punch_in_time",u),isInvalid:!!b.punch_in_time,errorMessage:b.punch_in_time,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(C,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(T,{label:"Punch Out Time (Optional)",type:"time",value:r.punch_out_time,onValueChange:u=>n("punch_out_time",u),isInvalid:!!b.punch_out_time,errorMessage:b.punch_out_time,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(C,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"Leave empty if employee is still working"})]})]}),e.jsx(te,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Location & Security Information"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsx(Is,{onLocationChange:p,initialLocation:r.coordinates})})]}),A&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--theme-foreground)"},children:"Preview"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[A.name," will be marked present for"," ",w(r.date).format("MMM D, YYYY")," from"," ",r.punch_in_time," ",r.punch_out_time&&`to ${r.punch_out_time}`,c&&` (${c})`]})]})]})})]})}),e.jsxs(Ve,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(B,{color:"default",variant:"bordered",onPress:f,radius:t(),size:"sm",isDisabled:E,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(B,{type:"submit",color:"primary",variant:"solid",isLoading:E,isDisabled:E||!r.user_id,radius:t(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:E?"Marking Present...":"Mark as Present"})]})]})]})})})},Ms=({open:_,closeModal:m,selectedDate:F,allUsers:N,refreshTimeSheet:S,selectedUsers:h=[]})=>{const y=()=>{if(typeof window>"u")return"lg";const d=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius")?.trim()||"12px",g=parseInt(d);return g===0?"none":g<=4?"sm":g<=8?"md":g<=16?"lg":"full"},[t,r]=a.useState({user_ids:[],date:F,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Bulk marked present by admin"}),[x,b]=a.useState({}),[I,E]=a.useState(!1),[o,p]=a.useState(!1),v=a.useMemo(()=>N?.filter(i=>i.roles?.some(d=>d.name==="Employee"))||[],[N]);a.useEffect(()=>{const i=h.map(d=>d.id.toString());r(d=>({...d,user_ids:i,date:F})),p(i.length===v.length),b({})},[h,F,_,v.length]);const n=(i,d)=>{r(g=>({...g,[i]:d})),x[i]&&b(g=>({...g,[i]:void 0}))},c=(i,d)=>{const g=i.toString();r(M=>({...M,user_ids:d?[...M.user_ids,g]:M.user_ids.filter(R=>R!==g)}))},k=i=>{p(i),r(d=>({...d,user_ids:i?v.map(g=>g.id.toString()):[]}))},A=a.useMemo(()=>{if(t.punch_in_time&&t.punch_out_time){const i=w(`${t.date} ${t.punch_in_time}`),d=w(`${t.date} ${t.punch_out_time}`);if(d.isAfter(i)){const g=d.diff(i,"minute"),M=Math.floor(g/60),R=g%60;return`${M}h ${R}m`}}return null},[t.punch_in_time,t.punch_out_time,t.date]),f=async i=>{i.preventDefault(),E(!0),b({});try{const d={user_ids:t.user_ids.map(M=>parseInt(M)),date:t.date,punch_in_time:t.punch_in_time,punch_out_time:t.punch_out_time||null,reason:t.reason||"Bulk marked present by administrator",location:t.location},g=new Promise(async(M,R)=>{try{const V=await ee.post(route("attendance.bulk-mark-as-present"),d);if(V.status===200){const{data:ae,summary:P}=V.data;S(),m();const O=[];P.successful>0&&O.push(`Successfully marked ${P.successful} employees as present`),P.failed>0&&O.push(`${P.failed} failed`),P.skipped>0&&O.push(`${P.skipped} skipped (already present)`),M([O.join(". ")])}}catch(V){V.response?.status===422?(b(V.response.data.errors||{}),R([V.response.data.message||"Please check the form for errors"])):R([V.response?.data?.message||"Failed to bulk mark users as present"])}});re.promise(g,{loading:"Marking employees as present...",success:M=>M[0],error:M=>M[0]})}catch(d){console.error("Bulk mark present error:",d)}finally{E(!1)}},u=v.filter(i=>t.user_ids.includes(i.id.toString()));return e.jsx(Te,{isOpen:_,onClose:m,size:"4xl",radius:y(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(Ye,{children:i=>e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Bulk Mark as Present"})]}),e.jsxs(fe,{variant:"bordered",size:"sm",style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)"},children:[t.user_ids.length," selected"]})]})}),e.jsxs("form",{onSubmit:f,children:[e.jsx(Ue,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Date & Time Configuration"})]}),A&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded-md bg-success/10 text-success",children:["Duration: ",A]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(T,{label:"Date",type:"date",value:t.date,onValueChange:d=>n("date",d),isInvalid:!!x.date,errorMessage:x.date,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(J,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(T,{label:"Punch In Time",type:"time",value:t.punch_in_time,onValueChange:d=>n("punch_in_time",d),isInvalid:!!x.punch_in_time,errorMessage:x.punch_in_time,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(C,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(T,{label:"Punch Out Time (Optional)",type:"time",value:t.punch_out_time,onValueChange:d=>n("punch_out_time",d),isInvalid:!!x.punch_out_time,errorMessage:x.punch_out_time,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(C,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"Leave empty if employees are still working"})]})]}),e.jsx(te,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:["Select Employees (",t.user_ids.length," of ",v.length,")"]})]}),e.jsx(Pe,{isSelected:o,onValueChange:k,color:"primary",size:"sm",children:"Select All"})]}),e.jsx(se,{children:e.jsx(ne,{className:"p-4",children:e.jsx(Ae,{className:"max-h-64",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:v.map(d=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-default-50",children:[e.jsx(Pe,{isSelected:t.user_ids.includes(d.id.toString()),onValueChange:g=>c(d.id,g),color:"primary",size:"sm"}),e.jsx(ue,{avatarProps:{size:"sm",src:d.profile_image_url,showFallback:!0,name:d.name},description:`ID: ${d.employee_id}`,name:d.name,classNames:{name:"text-sm",description:"text-xs"}})]},d.id))})})})}),x.user_ids&&e.jsx("p",{className:"text-danger text-sm",children:x.user_ids})]}),e.jsx(te,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Additional Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(T,{label:"Location",value:t.location,onValueChange:d=>n("location",d),isInvalid:!!x.location,errorMessage:x.location,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(be,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(Ns,{label:"Reason (Optional)",placeholder:"Reason for bulk marking employees as present...",value:t.reason,onValueChange:d=>n("reason",d),isInvalid:!!x.reason,errorMessage:x.reason,variant:"bordered",size:"sm",radius:y(),minRows:3,maxRows:5,classNames:{input:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'}})]})]}),u.length>0&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-5 h-5 mt-0.5",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-sm mb-2",style:{color:"var(--theme-foreground)"},children:["Preview - ",u.length," employee",u.length!==1?"s":""," will be marked present"]}),e.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--theme-foreground-600)"},children:["Date: ",w(t.date).format("MMM D, YYYY")," | Time: ",t.punch_in_time,t.punch_out_time&&` to ${t.punch_out_time}`,A&&` (${A})`]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[u.slice(0,10).map(d=>e.jsx(fe,{size:"sm",variant:"flat",color:"primary",children:d.name},d.id)),u.length>10&&e.jsxs(fe,{size:"sm",variant:"flat",color:"default",children:["+",u.length-10," more"]})]})]})]})})]})}),e.jsxs(Ve,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(B,{color:"default",variant:"bordered",onPress:i,radius:y(),size:"sm",isDisabled:I,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(B,{type:"submit",color:"primary",variant:"solid",isLoading:I,isDisabled:I||t.user_ids.length===0,radius:y(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:I?"Processing...":`Mark ${t.user_ids.length} Employee${t.user_ids.length!==1?"s":""} as Present`})]})]})]})})})},Rs=({title:_,allUsers:m})=>{const{auth:F}=ce().props;de("(max-width: 768px)"),de("(max-width: 640px)");const[N,S]=a.useState(w().format("YYYY-MM-DD")),[h,y]=a.useState({type:null,selectedUsers:[],currentUser:null}),[t,r]=a.useState(0),[x,b]=a.useState({currentMonth:w().format("YYYY-MM")});a.useCallback((n,c=[],k=null)=>{y({type:n,selectedUsers:c,currentUser:k})},[]);const I=a.useCallback(()=>{y({type:null,selectedUsers:[],currentUser:null})},[]),E=a.useCallback(n=>{const c=n.target.value;S(c)},[]),o=a.useCallback(()=>{r(n=>n+1)},[]),p=a.useCallback((n,c)=>{y({type:"mark_as_present",selectedUsers:[],currentUser:n,selectedDate:c})},[]);a.useMemo(()=>{const n=w(N);return[{title:"Present Today",value:0,icon:e.jsx(q,{className:"w-5 h-5"}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Employees present"},{title:"Absent Today",value:0,icon:e.jsx(me,{className:"w-5 h-5"}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Employees absent"},{title:"Total Employees",value:m?.length||0,icon:e.jsx(ws,{className:"w-5 h-5"}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Date",value:n.format("MMM D"),icon:e.jsx(_s,{className:"w-5 h-5"}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:n.format("dddd")}]},[N,m]);const v=a.useMemo(()=>({open:!!h.type,closeModal:I,selectedDate:h.selectedDate||N,allUsers:m,refreshTimeSheet:o,selectedUsers:h.selectedUsers,currentUser:h.currentUser}),[h.type,I,h.selectedDate,N,m,o,h.selectedUsers,h.currentUser]);return F.permissions?.includes("attendance.view"),e.jsxs(e.Fragment,{children:[e.jsx(Ze,{title:_}),h.type==="mark_as_present"&&e.jsx(Ss,{...v}),h.type==="bulk_mark_as_present"&&e.jsx(Ms,{...v}),e.jsx(ks,{handleDateChange:E,selectedDate:N,updateTimeSheet:t,externalFilterData:x,externalEmployee:"",onMarkAsPresent:p})]})};Rs.layout=_=>e.jsx(rs,{children:_});export{Rs as default};
