import{r as j,j as e,c as p,d as h,i as $,e as f,b as g,l as D,s as K,A as I,m as T,a as w,H as Y}from"./app-B1idACz3.js";import{e as E,i as z,z as q,N as G,A as W,t as X,f as P}from"./App-BxA45E4t.js";import{d as J,a as U,c as Q,b as B,m as C,e as Z}from"./PlusIcon-B7YJbjTI.js";import{F as H}from"./GlobeAltIcon-BXsgRUBL.js";import{F as A}from"./UserCircleIcon-BluwysQc.js";import{F as ee}from"./EyeIcon-Cqrke5l0.js";import{a as se}from"./chunk-CV4BWJDJ-BFly1wX0.js";import{t as te}from"./chunk-AUA5GDXN-Dy7XAS6o.js";import{F as ae}from"./IdentificationIcon-CvziX476.js";import{F as re}from"./MagnifyingGlassIcon-DgboSUq1.js";import{F as le}from"./XMarkIcon-BkS9W9l-.js";import{F as ie}from"./DeviceTabletIcon--UjnqdVT.js";import{u as de}from"./index-CNzLuNZT.js";import{i as F}from"./chunk-SQIAVXJX-BmeQe73H.js";import{s as ne}from"./chunk-C3QHEOC2-tt4DAwFy.js";import{l as oe}from"./chunk-Y5DMIIWQ-CwpVnCx_.js";import{m as ce,a as me,b as xe,c as pe}from"./chunk-TW2E3XVA-DozWYklk.js";import{d as v}from"./chunk-IHO36JMK-_QcGGA4V.js";import{m as he}from"./chunk-5LXTSPS7-Cw-SP9Ff.js";import"./app-BmhO9GrS.js";import"./index-B22Xm-65.js";/* empty css                      */import"./toastUtils-CW5B8m6C.js";import"./UserIcon-1qA6iUQn.js";import"./Cog6ToothIcon-BTkQVx_H.js";import"./useBranding-BpzGYNdv.js";import"./useDialog-Ch8oEuGx.js";import"./VisuallyHidden-8dXxwzFE.js";import"./keyboard-Ct-gpNNq.js";import"./useLabels-xtEGP3rr.js";import"./index-BvG5LGgQ.js";import"./index-BvevyAVm.js";import"./useMediaQuery-oujQjmbJ.js";import"./ShieldCheckIcon-BVzIZ77z.js";import"./AcademicCapIcon-QvlhCYpE.js";import"./ArrowLeftIcon-B39h7gxR.js";import"./ArrowRightIcon-DyVdpuyc.js";import"./BriefcaseIcon-CtncUTGk.js";import"./BuildingOfficeIcon-DRKs9y4o.js";import"./CalendarDaysIcon-CPIWRTu0.js";import"./CalendarIcon-DXmDQodP.js";import"./CheckCircleIcon-znT6UY48.js";import"./CircleStackIcon-DdzMQ0P3.js";import"./ClipboardDocumentCheckIcon-DRpcDtD7.js";import"./CpuChipIcon-Czc12K36.js";import"./CurrencyDollarIcon-nhXxeFAs.js";import"./DevicePhoneMobileIcon-BEyIwQb0.js";import"./DocumentArrowUpIcon-1h0_t1N_.js";import"./DocumentIcon-CZnboGRP.js";import"./EnvelopeIcon-B0z_TX9R.js";import"./InformationCircleIcon-DqlZzEsT.js";import"./KeyIcon-EZeCAT5w.js";import"./LockClosedIcon-D4pmCoEC.js";import"./MapPinIcon-CvRrNoqN.js";import"./PlusCircleIcon-ChwrtP31.js";import"./PrinterIcon-BAYK2vO7.js";import"./UserGroupIcon-C2aGroqx.js";import"./useHasTabbableChild-D7clvTMF.js";import"./chunk-LGMZDQT5-BFW_lSqD.js";import"./useSelectableItem-2B3SBj_3.js";import"./SelectionManager-CcfpIYkh.js";import"./Item-C3GqwNyW.js";import"./MaintenanceModeBanner-BuwtjklV.js";import"./chunk-WQVQ7P2I-BDe9YmDI.js";import"./number-CB4zbwAz.js";import"./index-BsK0-JqV.js";import"./useTreeState-D7Kaxu17.js";import"./useMenuTriggerState-ZTP0zge5.js";import"./index-CaNeU5V8.js";import"./index-CcVAKcbs.js";import"./chunk-KQW2TNLT-Cz1cLYHm.js";import"./chunk-ICU6NNET-CXrsm0Bw.js";import"./useLabel-BWLgnRON.js";import"./chunk-7F3ZLNJ6-CMjtQ9ZK.js";import"./index-BMFea15Y.js";const ue=({type:s,className:t="w-4 h-4"})=>{const n={created:e.jsx(Z,{className:t}),updated:e.jsx(G,{className:t}),deleted:e.jsx(q,{className:t}),restored:e.jsx(D,{className:t}),viewed:e.jsx(ee,{className:t}),login:e.jsx(A,{className:t}),logout:e.jsx(A,{className:t}),default:e.jsx(z,{className:t})};return n[s]||n.default},je=s=>{const t={created:{bg:"bg-success-100",text:"text-success-700",border:"border-success-300"},updated:{bg:"bg-primary-100",text:"text-primary-700",border:"border-primary-300"},deleted:{bg:"bg-danger-100",text:"text-danger-700",border:"border-danger-300"},restored:{bg:"bg-warning-100",text:"text-warning-700",border:"border-warning-300"},viewed:{bg:"bg-secondary-100",text:"text-secondary-700",border:"border-secondary-300"},login:{bg:"bg-success-100",text:"text-success-700",border:"border-success-300"},logout:{bg:"bg-secondary-100",text:"text-secondary-700",border:"border-secondary-300"},default:{bg:"bg-default-100",text:"text-default-700",border:"border-default-300"}};return t[s]||t.default},fe=s=>{const t=new Date(s),n=new Date,r=n-t,m=Math.floor(r/1e3),o=Math.floor(m/60),d=Math.floor(o/60),c=Math.floor(d/24);return m<60?"Just now":o<60?`${o}m ago`:d<24?`${d}h ago`:c<7?`${c}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==n.getFullYear()?"numeric":void 0})},ge=({activity:s,showDetails:t=!1})=>{const[n,r]=j.useState(!1),m=je(s.event||s.description?.split(" ")[0]?.toLowerCase()),o=s.causer||{},d=s.properties||{},c=d.old||d.attributes;return e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"relative pl-8 pb-6 last:pb-0",children:[e.jsx("div",{className:"absolute left-3 top-0 bottom-0 w-px bg-default-200 dark:bg-default-700"}),e.jsx("div",{className:`absolute left-0 top-1 w-6 h-6 rounded-full ${m.bg} ${m.border} border-2 flex items-center justify-center`,children:e.jsx(ue,{type:s.event||s.description?.split(" ")[0]?.toLowerCase(),className:`w-3 h-3 ${m.text}`})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.description}),s.subject_type&&e.jsxs("p",{className:"text-xs text-default-500 mt-0.5",children:[s.subject_type.split("\\").pop()," #",s.subject_id]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(se,{src:o.avatar_url,name:o.name||"System",size:"sm",className:"w-5 h-5"}),e.jsx("span",{className:"text-xs text-default-600",children:o.name||o.email||"System"}),e.jsx("span",{className:"text-xs text-default-400",children:"â€¢"}),e.jsx(te,{content:new Date(s.created_at).toLocaleString(),children:e.jsx("span",{className:"text-xs text-default-400 cursor-help",children:fe(s.created_at)})})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-2",children:[d.ip_address&&e.jsx(f,{size:"sm",variant:"flat",startContent:e.jsx(H,{className:"w-3 h-3"}),children:d.ip_address}),s.log_name&&s.log_name!=="default"&&e.jsx(f,{size:"sm",variant:"flat",color:"primary",children:s.log_name})]})]}),c&&t&&e.jsx(g,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>r(!n),children:e.jsx(E,{className:`w-4 h-4 transition-transform ${n?"rotate-180":""}`})})]}),e.jsx(I,{children:n&&c&&e.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mt-3",children:e.jsxs("div",{className:"p-3 bg-default-50 dark:bg-default-100 rounded-lg text-xs",children:[d.attributes&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold text-success-600",children:"New values:"}),e.jsx("pre",{className:"mt-1 text-default-600 whitespace-pre-wrap",children:JSON.stringify(d.attributes,null,2)})]}),d.old&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-danger-600",children:"Old values:"}),e.jsx("pre",{className:"mt-1 text-default-600 whitespace-pre-wrap",children:JSON.stringify(d.old,null,2)})]})]})})})]})]})};function be({activities:s=[],isLoading:t=!1,onLoadMore:n,hasMore:r=!1,onFilter:m,logNames:o=[],showDetails:d=!0,title:c="Activity Timeline",emptyMessage:_="No activity to display"}){const[N,L]=j.useState("all"),[R,M]=j.useState(""),l=i=>{L(i),m?.({logName:i==="all"?null:i})},y=s.reduce((i,x)=>{const u=new Date(x.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return i[u]||(i[u]=[]),i[u].push(x),i},{});return e.jsx(p,{className:"w-full",children:e.jsxs(h,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-divider",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:c}),s.length>0&&e.jsxs(f,{size:"sm",variant:"flat",children:[s.length," items"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.length>0&&e.jsxs(J,{children:[e.jsx(U,{children:e.jsx(g,{variant:"flat",size:"sm",startContent:e.jsx(Q,{className:"w-4 h-4"}),endContent:e.jsx(E,{className:"w-3 h-3"}),children:N==="all"?"All Logs":N})}),e.jsxs(B,{"aria-label":"Filter by log name",selectedKeys:[N],selectionMode:"single",onSelectionChange:i=>l(Array.from(i)[0]),children:[e.jsx(C,{children:"All Logs"},"all"),o.map(i=>e.jsx(C,{children:i},i))]})]}),e.jsx(g,{isIconOnly:!0,variant:"light",size:"sm",onPress:()=>m?.({}),isLoading:t,children:e.jsx(D,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"p-4 max-h-[600px] overflow-y-auto",children:t&&s.length===0?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(K,{size:"lg"})}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-default-400",children:[e.jsx(z,{className:"w-12 h-12 mb-4"}),e.jsx("p",{children:_})]}):e.jsxs(e.Fragment,{children:[Object.entries(y).map(([i,x])=>e.jsxs("div",{className:"mb-6 last:mb-0",children:[e.jsx("div",{className:"sticky top-0 bg-background/80 backdrop-blur-sm py-2 mb-4 z-10",children:e.jsx("h4",{className:"text-xs font-semibold text-default-500 uppercase tracking-wider",children:i})}),e.jsx(I,{children:x.map(u=>e.jsx(ge,{activity:u,showDetails:d},u.id))})]},i)),r&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(g,{variant:"flat",size:"sm",onPress:n,isLoading:t,children:"Load More"})})]})})]})})}const Ne=({activity:s,isOpen:t,onClose:n})=>{if(!s)return null;const r=s.properties||{},m=s.causer||{};return e.jsx(ce,{isOpen:t,onClose:n,size:"2xl",scrollBehavior:"inside",children:e.jsxs(me,{children:[e.jsxs(xe,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-primary"}),"Activity Details"]}),e.jsxs("p",{className:"text-sm font-normal text-default-500",children:["ID: ",s.id]})]}),e.jsx(pe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500 uppercase",children:"Description"}),e.jsx("p",{className:"font-medium",children:s.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500 uppercase",children:"Log Name"}),e.jsx("p",{className:"font-medium",children:s.log_name||"default"})]})]}),e.jsx(v,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500 uppercase",children:"Subject Type"}),e.jsx("p",{className:"font-medium",children:s.subject_type?.split("\\").pop()||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500 uppercase",children:"Subject ID"}),e.jsx("p",{className:"font-medium",children:s.subject_id||"N/A"})]})]}),e.jsx(v,{}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500 uppercase mb-2 block",children:"Performed By"}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-default-50 rounded-lg",children:[e.jsx(A,{className:"w-8 h-8 text-default-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.name||"System"}),e.jsx("p",{className:"text-sm text-default-500",children:m.email||"Automated action"})]})]})]}),e.jsx(v,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-default-400"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500",children:"Timestamp"}),e.jsx("p",{className:"text-sm",children:new Date(s.created_at).toLocaleString()})]})]}),r.ip_address&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-default-400"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500",children:"IP Address"}),e.jsx("p",{className:"text-sm",children:r.ip_address})]})]})]}),r.user_agent&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-default-400 mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:"text-xs text-default-500",children:"User Agent"}),e.jsx("p",{className:"text-xs text-default-600 break-all",children:r.user_agent})]})]}),(r.attributes||r.old)&&e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500 uppercase mb-2 block",children:"Changes"}),e.jsxs(X,{"aria-label":"Changes tabs",children:[r.attributes&&e.jsx(P,{title:"New Values",children:e.jsx(p,{className:"mt-2",children:e.jsx(h,{children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-48",children:JSON.stringify(r.attributes,null,2)})})})},"new"),r.old&&e.jsx(P,{title:"Old Values",children:e.jsx(p,{className:"mt-2",children:e.jsx(h,{children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-48",children:JSON.stringify(r.old,null,2)})})})},"old")]})]})]}),e.jsx(v,{}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-default-500 uppercase mb-2 block",children:"Raw Properties"}),e.jsx(p,{children:e.jsx(h,{children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-48",children:JSON.stringify(r,null,2)})})})]})]})}),e.jsx(he,{children:e.jsx(g,{variant:"light",onPress:n,children:"Close"})})]})})};function Us({activities:s=[],filters:t={},logNames:n=[],pagination:r={},auth:m}){const[o,d]=j.useState(!1),[c,_]=j.useState(t.search||""),[N,L]=j.useState(null),{isOpen:R,onClose:M}=de(),[l,y]=j.useState({log_name:t.log_name||"",subject_type:t.subject_type||"",causer_id:t.causer_id||"",date_from:t.date_from||"",date_to:t.date_to||""}),i=j.useCallback(a=>{_(a);const b=setTimeout(()=>{w.get(route("admin.audit-logs.index"),{...l,search:a},{preserveState:!0,preserveScroll:!0})},500);return()=>clearTimeout(b)},[l]),x=(a,b)=>{const S={...l,[a]:b};y(S),w.get(route("admin.audit-logs.index"),{...S,search:c},{preserveState:!0,preserveScroll:!0,onStart:()=>d(!0),onFinish:()=>d(!1)})},u=()=>{y({log_name:"",subject_type:"",causer_id:"",date_from:"",date_to:""}),_(""),w.get(route("admin.audit-logs.index"),{},{preserveState:!0,preserveScroll:!0})},k=a=>{const b=new URLSearchParams({...l,search:c,format:a});window.open(`${route("admin.audit-logs.export")}?${b.toString()}`,"_blank")},V=()=>{r.next_page_url&&w.get(r.next_page_url,{},{preserveState:!0,preserveScroll:!0,only:["activities","pagination"],onStart:()=>d(!0),onFinish:()=>d(!1)})},O=Object.values(l).some(a=>a)||c;return e.jsxs(W,{children:[e.jsx(Y,{title:"Audit Logs"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Audit Logs"}),e.jsx("p",{className:"text-default-500 mt-1",children:"Track all system activities and changes"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(J,{children:[e.jsx(U,{children:e.jsx(g,{variant:"flat",startContent:e.jsx(ae,{className:"w-4 h-4"}),children:"Export"})}),e.jsxs(B,{"aria-label":"Export options",children:[e.jsx(C,{onPress:()=>k("csv"),children:"Export as CSV"},"csv"),e.jsx(C,{onPress:()=>k("json"),children:"Export as JSON"},"json")]})]}),e.jsx(g,{isIconOnly:!0,variant:"flat",onPress:()=>w.reload({only:["activities"]}),isLoading:o,children:e.jsx(D,{className:"w-4 h-4"})})]})]}),e.jsx(p,{className:"mb-6",children:e.jsxs(h,{children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(F,{placeholder:"Search activities...",value:c,onChange:a=>i(a.target.value),startContent:e.jsx(re,{className:"w-4 h-4 text-default-400"}),isClearable:!0,onClear:()=>i("")})}),e.jsx(ne,{label:"Log Type",placeholder:"All logs",selectedKeys:l.log_name?[l.log_name]:[],onChange:a=>x("log_name",a.target.value),className:"w-40",size:"sm",children:n.map(a=>e.jsx(oe,{value:a,children:a},a))}),e.jsx(F,{label:"Subject Type",placeholder:"e.g., User",value:l.subject_type,onChange:a=>x("subject_type",a.target.value),className:"w-40",size:"sm"}),e.jsx(F,{type:"date",label:"From Date",value:l.date_from,onChange:a=>x("date_from",a.target.value),className:"w-40",size:"sm"}),e.jsx(F,{type:"date",label:"To Date",value:l.date_to,onChange:a=>x("date_to",a.target.value),className:"w-40",size:"sm"}),O&&e.jsx(g,{variant:"light",color:"danger",size:"sm",startContent:e.jsx(le,{className:"w-4 h-4"}),onPress:u,children:"Clear"})]}),O&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[c&&e.jsxs(f,{onClose:()=>i(""),variant:"flat",size:"sm",children:["Search: ",c]}),l.log_name&&e.jsxs(f,{onClose:()=>x("log_name",""),variant:"flat",size:"sm",children:["Log: ",l.log_name]}),l.subject_type&&e.jsxs(f,{onClose:()=>x("subject_type",""),variant:"flat",size:"sm",children:["Subject: ",l.subject_type]}),l.date_from&&e.jsxs(f,{onClose:()=>x("date_from",""),variant:"flat",size:"sm",children:["From: ",l.date_from]}),l.date_to&&e.jsxs(f,{onClose:()=>x("date_to",""),variant:"flat",size:"sm",children:["To: ",l.date_to]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(p,{children:e.jsxs(h,{className:"flex flex-row items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-lg",children:e.jsx(z,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r.total||s.length}),e.jsx("p",{className:"text-sm text-default-500",children:"Total Activities"})]})]})}),e.jsx(p,{children:e.jsxs(h,{className:"flex flex-row items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-success-100 rounded-lg",children:e.jsx($,{className:"w-6 h-6 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:s.filter(a=>{const b=new Date(a.created_at),S=new Date;return b.toDateString()===S.toDateString()}).length}),e.jsx("p",{className:"text-sm text-default-500",children:"Today"})]})]})}),e.jsx(p,{children:e.jsxs(h,{className:"flex flex-row items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-warning-100 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:new Set(s.map(a=>a.causer_id).filter(Boolean)).size}),e.jsx("p",{className:"text-sm text-default-500",children:"Active Users"})]})]})}),e.jsx(p,{children:e.jsxs(h,{className:"flex flex-row items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-secondary-100 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 text-secondary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:n.length}),e.jsx("p",{className:"text-sm text-default-500",children:"Log Categories"})]})]})})]}),e.jsx(be,{activities:s,isLoading:o,onLoadMore:V,hasMore:!!r.next_page_url,logNames:n,showDetails:!0,title:"Recent Activity",emptyMessage:"No audit logs found matching your criteria"})]})}),e.jsx(Ne,{activity:N,isOpen:R,onClose:M})]})}export{Us as default};
